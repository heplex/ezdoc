import{_ as o}from"./plugin-vue_export-helper.21dcd24c.js";import{r as p,o as r,c as d,a as n,b as a,w as l,d as s,e}from"./app.55c177dd.js";var u="/assets/image-20211124130409521.1ec9bfb6.png",v="/assets/2021-11-23_175935.1c1433c5.png",k="/assets/image-20211124182140596.51c359d2.png",b="/assets/image-20211124182921234.0b030161.png",m="/assets/image-20211124183003858.8870457b.png",g="/assets/image-20211124193444561.a8e10538.png",h="/assets/image-20211124200317795.f594762e.png",y="/assets/image-20211124200658107.1086228d.png",_="/assets/image-20211125141950900.bad3091b.png",x="/assets/image-20211125141701495.824e0cba.png",f="/assets/image-20211125154112097.cdbb92ef.png",D="/assets/image-20211124202610243.4c33dcee.png",z="/assets/image-20211124204517433.695250fb.png",S="/assets/image-20211124203336300.798ef059.png",J="/assets/image-20211124205050484.4d3a6c36.png",$="/assets/image-20211124205513465.80bc108c.png",P="/assets/image-20211124205854418.3509a77a.png",E="/assets/image-20211124205858730.2ad37b53.png",j="/assets/image-20211124205917317.00cd1396.png",q="/assets/image-20211124211635550.2104cab6.png",N="/assets/image-20211124211700999.0f6c98c9.png",O="/assets/image-20211124211720836.a25c8162.png",A="/assets/image-20211125195818670.b1da3858.png",M="/assets/image-20211125163541645.f9a13515.png",B="/assets/image-20211125170350811.529b9a17.png",R="/assets/image-20211125170418337.9431bb24.png",C="/assets/image-20211125200218093.b4b8f3b1.png",G="/assets/image-20211125201701443.b5c3485b.png",w="/assets/image-20211125201919108.5752ffed.png",I="/assets/image-20211125203757232.7b76e652.png",K="/assets/image-20211125204811759.a6de0efc.png",H="/assets/image-20211125204818869.07643679.png",c="/assets/image-20211125205027013.fe637cb0.png",L="/assets/image-20211125205020738.b142d8ee.png",T="/assets/image-20211125205240208.91a5f7c0.png",Q="/assets/image-20211125205725948.e9165f0a.png",U="/assets/image-20211125210148202.f47bd7af.png",F="/assets/image-20211125210424346.7f8fc3b1.png",V="/assets/image-20211125210626631.c7ba46b3.png",W="/assets/image-20211125210755556.4ee02c71.png",Y="/assets/image-20211125210826057.dcdf4a09.png",X="/assets/image-20211126161304485.efec3a6f.png",Z="/assets/image-20211126161331991.8e395970.png",nn="/assets/image-20211126161408514.8600972f.png",sn="/assets/image-20211126161448527.5e41a1f4.png",an="/assets/image-20211126161504715.68313e38.png",en="/assets/image-20211126161509411.7609aed1.png",tn="/assets/image-20211126165209057.ad5fca94.png",ln="/assets/image-20211126165444124.927f9697.png",pn="/assets/image-20211126172828266.246a76f0.png",cn="/assets/image-20211126165639286.6988de7b.png",on="/assets/image-20211126174715028.c0d7ed4d.png",rn="/assets/image-20211126174159487.6486c796.png",dn="/assets/image-20211129190039986.c86fdd82.png",un="/assets/image-20211207145215817.ea69b262.png",vn="/assets/image-20211207145342350.785f39e1.png",kn="/assets/image-20211129191426344.48b8211e.png",bn="/assets/image-20211129191537050.236caf2f.png",mn="/assets/image-20211129193824428.610ccbb0.png",gn="/assets/image-20211129194148239.331822e3.png",hn="/assets/image-20211129194621820.c7e4f7ad.png",yn="/assets/image-20211129194748765.b48b6712.png",_n="/assets/image-20211129194931944.81e391ac.png",xn="/assets/image-20211129195430146.3e5f1476.png",fn="/assets/image-20211129195503762.13f3efbd.png",Dn="/assets/image-20211130140043382.40b21e48.png",zn="/assets/image-20211130141303457.ec2d4b57.png",Sn="/assets/image-20211130144608025.f69f9464.png",Jn="/assets/image-20211129201625561.b27b8a4a.png",$n="/assets/image-20211129201607240.17e58822.png",Pn="/assets/image-20211129202147390.40299a87.png",En="/assets/image-20211130144850186.54972640.png",jn="/assets/image-20211129203102334.717620e3.png",qn="/assets/image-20211129203235019.ae2b4790.png",Nn="/assets/image-20211129203342171.1c03ddd5.png",On="/assets/image-20211129203457604.6b33be4e.png",An="/assets/image-20211130153628925.2497c3fe.png",Mn="/assets/image-20211130155849143.688c6061.png",Bn="/assets/image-20211130160017465.947a2406.png",Rn="/assets/image-20211130160047648.6cf5e10d.png",Cn="/assets/image-20211130215555218.63bd5e9b.png",Gn="/assets/image-20211130215941857.1e7d3128.png",wn="/assets/image-20211130220028840.66cc2269.png",In="/assets/image-20211130220111602.468444c6.png",Kn="/assets/image-20211201213427157.d1bb6dc0.png",Hn="/assets/image-20211201213751780.19fcfc2b.png",Ln="/assets/image-20211201213832458.3beb8795.png",Tn="/assets/image-20211201214008303.ccd48722.png",Qn="/assets/image-20211201221040200.082e240a.png",Un="/assets/image-20211201215931237.9078b7d2.png",Fn="/assets/image-20211201221225196.763a84d2.png",Vn="/assets/image-20211201221300055.0a35a1bb.png",Wn="/assets/image-20211201222450091.0fd7f373.png",Yn="/assets/image-20211229155834500.ec4b87c2.png",Xn="/assets/image-20211203192047357.905cf619.png",Zn="/assets/image-20211229155949038.cd22740a.png",ns="/assets/image-20211202144429302.cb0f2ae2.png",ss="/assets/image-20211202144531749.6a0ca02a.png",as="/assets/image-20211202144616117.54273e80.png",es="/assets/image-20211202145155428.b971937d.png",ts="/assets/image-20211202145240166.35ace642.png",ls="/assets/image-20211202145349043.a3e35491.png",is="/assets/image-20211202151127254.9f780249.png",ps="/assets/image-20211202151155145.c051da27.png",cs="/assets/image-20211202151225161.1a1f10cc.png",os="/assets/image-20211202191944277.1805d471.png",rs="/assets/image-20211202192047619.11fc617e.png",ds="/assets/image-20211202192129895.33645673.png",us="/assets/image-20211209151549412.9a250335.png",vs="/assets/image-20211209152217433.296496a6.png",ks="/assets/image-20211209152252050.d7ad26b9.png",bs="/assets/image-20211209152403312.18f36afe.png",ms="/assets/image-20211209162923440.00e92b47.png",gs="/assets/image-20211209163021396.59fd0557.png",hs="/assets/image-20211210114507638.6321ee83.png",ys="/assets/image-20211210190653687.e08576af.png",_s="/assets/image-20211213183025291.b888595f.png",xs="/assets/image-20211210184851810.8b677bc0.png",fs="/assets/image-20211213184701784.d4b6d7dc.png",Ds="/assets/image-20211213184742709.8be9e29d.png",zs="/assets/image-20211213184840120.8c3762e0.png",Ss="/assets/image-20220104203155749.4a74704a.png",Js="/assets/image-20220104210823057.1c742161.png",$s="/assets/image-20220104214659229.096698d9.png",Ps="/assets/image-20220104215030265.638e2d1b.png",Es="/assets/image-20220104222750733.1d6fd00f.png",js="/assets/image-20220104222819455.3070b4a5.png",qs="/assets/image-20220105205334996.573bd34f.png",Ns="/assets/image-20220105153343642.00dd37cc.png",Os="/assets/image-20220105153416367.5a1aa334.png",As="/assets/image-20220105153502619.264e8f8d.png",Ms="/assets/image-20220105203819715.7c2b695f.png",Bs="/assets/image-20220105204434044.65d7c471.png",Rs="/assets/image-20220105204921272.37c99ddf.png",Cs="/assets/image-20220105205407393.bbcc392b.png",Gs="/assets/1642498962716.11174107.png",ws="/assets/1642498994935.4ba5c8c3.png",Is="/assets/1642499172789.2ef980e4.png",Ks="/assets/1642499368121.75276a05.png",Hs="/assets/1642499788199.4b819e53.png",Ls="/assets/1642499885324.8feec779.png",Ts="/assets/1642499992148.40f600de.png",Qs="/assets/1642500061153.1735d55a.png",Us="/assets/1642500102996.f9909f9c.png",Fs="/assets/1642500239406.4411351a.png",Vs="/assets/1642500378788.f81cff44.png",Ws="/assets/1642500413802.a718cfbd.png",Ys="/assets/1642500474036.2da4e790.png",Xs="/assets/1642500817131.c9bbddb4.png",Zs="/assets/1642500933316.0fa77a09.png",na="/assets/1642501016474.b9e70b5c.png",sa="/assets/1642501065243.86c49932.png",aa="/assets/1642501521065.c6044dce.png",ea="/assets/1642501549176.3b6176b9.png";const ta={},la=n("h1",{id:"devops",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#devops","aria-hidden":"true"},"#"),s(" DevOps")],-1),ia={class:"table-of-contents"},pa=s("\u4E00\u3001DevOps\u4ECB\u7ECD"),ca=s("\u4E8C\u3001Code\u9636\u6BB5\u5DE5\u5177"),oa=s("\u4E09\u3001Build\u9636\u6BB5\u5DE5\u5177"),ra=s("\u56DB\u3001Operate\u9636\u6BB5\u5DE5\u5177"),da=s("\u4E94\u3001Integrate\u5DE5\u5177"),ua=s("\u516D\u3001CI\u3001CD\u5165\u95E8\u64CD\u4F5C"),va=s("\u4E03\u3001\u96C6\u6210Sonar Qube"),ka=s("\u516B\u3001\u96C6\u6210Harbor"),ba=s("\u4E5D\u3001Jenkins\u6D41\u6C34\u7EBF"),ma=s("\u5341\u3001Kubernetes\u7F16\u6392\u5DE5\u5177"),ga=e('<h3 id="\u4E00\u3001devops\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#\u4E00\u3001devops\u4ECB\u7ECD" aria-hidden="true">#</a> \u4E00\u3001DevOps\u4ECB\u7ECD</h3><p>\u8F6F\u4EF6\u5F00\u53D1\u6700\u5F00\u59CB\u662F\u7531\u4E24\u4E2A\u56E2\u961F\u7EC4\u6210\uFF1A</p><ul><li>\u5F00\u53D1\u8BA1\u5212\u7531<a href="">\u5F00\u53D1\u56E2\u961F</a>\u4ECE\u5934\u5F00\u59CB\u8BBE\u8BA1\u548C\u6574\u4F53\u7CFB\u7EDF\u7684\u6784\u5EFA\u3002\u9700\u8981\u7CFB\u7EDF\u4E0D\u505C\u7684\u8FED\u4EE3\u66F4\u65B0\u3002</li><li><a href="">\u8FD0\u7EF4\u56E2\u961F</a>\u5C06\u5F00\u53D1\u56E2\u961F\u7684Code\u8FDB\u884C\u6D4B\u8BD5\u540E\u90E8\u7F72\u4E0A\u7EBF\u3002\u5E0C\u671B\u7CFB\u7EDF\u7A33\u5B9A\u5B89\u5168\u8FD0\u884C\u3002</li></ul><p>\u8FD9\u770B\u4F3C\u4E24\u4E2A\u76EE\u6807\u4E0D\u540C\u7684\u56E2\u961F\u9700\u8981\u534F\u540C\u5B8C\u6210\u4E00\u4E2A\u8F6F\u4EF6\u7684\u5F00\u53D1\u3002</p><p>\u5728\u5F00\u53D1\u56E2\u961F\u6307\u5B9A\u597D\u8BA1\u5212\u5E76\u5B8C\u6210coding\u540E\uFF0C\u9700\u8981\u63D0\u4F9B\u5230\u8FD0\u7EF4\u56E2\u961F\u3002</p><p>\u8FD0\u7EF4\u56E2\u961F\u5411\u5F00\u53D1\u56E2\u961F\u53CD\u9988\u9700\u8981\u4FEE\u590D\u7684BUG\u4EE5\u53CA\u4E00\u4E9B\u9700\u8981\u8FD4\u5DE5\u7684\u4EFB\u52A1\u3002</p><p>\u8FD9\u65F6\u5F00\u53D1\u56E2\u961F\u9700\u8981\u7ECF\u5E38\u7B49\u5F85\u8FD0\u7EF4\u56E2\u961F\u7684\u53CD\u9988\u3002\u8FD9\u65E0\u7591\u5EF6\u957F\u4E86\u4E8B\u4EF6\u5E76\u63A8\u8FDF\u4E86\u6574\u4E2A\u8F6F\u4EF6\u5F00\u53D1\u7684\u5468\u671F\u3002</p><p>\u4F1A\u6709\u4E00\u79CD\u65B9\u5F0F\uFF0C\u5728\u5F00\u53D1\u56E2\u961F\u7B49\u5F85\u7684\u65F6\u5019\uFF0C\u8BA9\u5F00\u53D1\u56E2\u961F\u8F6C\u79FB\u5230\u4E0B\u4E00\u4E2A\u9879\u76EE\u4E2D\u3002\u7B49\u5F85\u8FD0\u7EF4\u56E2\u961F\u4E3A\u4E4B\u524D\u7684\u4EE3\u7801\u63D0\u4F9B\u53CD\u9988\u3002</p><p>\u53EF\u662F\u8FD9\u6837\u5C31\u610F\u5473\u7740\u4E00\u4E2A\u5B8C\u6574\u7684\u9879\u76EE\u9700\u8981\u4E00\u4E2A\u66F4\u957F\u7684\u5468\u671F\u624D\u53EF\u4EE5\u5F00\u53D1\u51FA\u6700\u7EC8\u4EE3\u7801\u3002</p><hr><p>\u57FA\u4E8E\u73B0\u5728\u7684\u4E92\u8054\u7F51\u73B0\u72B6\uFF0C\u66F4\u63A8\u5D07\u654F\u6377\u5F0F\u5F00\u53D1\uFF0C\u8FD9\u6837\u5C31\u5BFC\u81F4\u9879\u76EE\u7684\u8FED\u4EE3\u901F\u5EA6\u66F4\u5FEB\uFF0C\u4F46\u662F\u7531\u4E8E\u5F00\u53D1\u56E2\u961F\u4E0E\u8FD0\u7EF4\u56E2\u961F\u7684\u6C9F\u901A\u95EE\u9898\uFF0C\u4F1A\u5BFC\u81F4\u65B0\u7248\u672C\u4E0A\u7EBF\u7684\u65F6\u95F4\u6210\u672C\u5F88\u9AD8\u3002\u8FD9\u53C8\u8FDD\u80CC\u7684\u654F\u6377\u5F0F\u5F00\u53D1\u7684\u6700\u521D\u7684\u76EE\u7684\u3002</p><p>\u90A3\u4E48\u5982\u679C\u8BA9\u5F00\u53D1\u56E2\u961F\u548C\u8FD0\u7EF4\u56E2\u961F\u6574\u5408\u5230\u6210\u4E00\u4E2A\u56E2\u961F\uFF0C\u534F\u540C\u5E94\u5BF9\u4E00\u5957\u8F6F\u4EF6\u5462\uFF1F\u8FD9\u5C31\u88AB\u79F0\u4E3A<a href="">DevOps</a>\u3002</p><p><a href="">DevOps</a>\uFF0C\u5B57\u9762\u610F\u601D\u662FDevelopment &amp;Operations\u7684\u7F29\u5199\uFF0C\u4E5F\u5C31\u662F\u5F00\u53D1&amp;\u8FD0\u7EF4\u3002</p><p>\u867D\u7136\u5B57\u9762\u610F\u601D\u53EA\u6D89\u53CA\u5230\u4E86\u5F00\u53D1\u56E2\u961F\u548C\u8FD0\u7EF4\u56E2\u961F\uFF0C\u5176\u5B9EQA\u6D4B\u8BD5\u56E2\u961F\u4E5F\u662F\u53C2\u4E0E\u5176\u4E2D\u7684\u3002</p><p>\u7F51\u4E0A\u53EF\u4EE5\u67E5\u770B\u5230<a href="">DevOps</a>\u7684\u7B26\u53F7\u7C7B\u4F3C\u4E8E\u4E00\u4E2A\u65E0\u7A77\u5927\u7684\u7B26\u53F7</p><table><thead><tr><th style="text-align:center;"><a href="">DevOps</a></th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+u+'" alt="image-20211124130409521" loading="lazy"></td></tr></tbody></table><p>\u8FD9\u8868\u660E<a href="">DevOps</a>\u662F\u4E00\u4E2A\u4E0D\u65AD\u63D0\u9AD8\u6548\u7387\u5E76\u4E14\u6301\u7EED\u4E0D\u65AD\u5DE5\u4F5C\u7684\u8FC7\u7A0B</p><p><a href="">DevOps</a>\u7684\u65B9\u5F0F\u53EF\u4EE5\u8BA9\u516C\u53F8\u80FD\u591F\u66F4\u5FEB\u5730\u5E94\u5BF9\u66F4\u65B0\u548C\u5E02\u573A\u53D1\u5C55\u53D8\u5316\uFF0C\u5F00\u53D1\u53EF\u4EE5\u5FEB\u901F\u4EA4\u4ED8\uFF0C\u90E8\u7F72\u4E5F\u66F4\u52A0\u7A33\u5B9A\u3002</p><p>\u6838\u5FC3\u5C31\u5728\u4E8E<a href="">\u7B80\u5316Dev\u548COps\u56E2\u961F\u4E4B\u95F4\u7684\u6D41\u7A0B\uFF0C\u4F7F\u6574\u4F53\u8F6F\u4EF6\u5F00\u53D1\u8FC7\u7A0B\u66F4\u5FEB\u901F\u3002</a></p><p>\u6574\u4F53\u7684\u8F6F\u4EF6\u5F00\u53D1\u6D41\u7A0B\u5305\u62EC\uFF1A</p><ul><li>PLAN\uFF1A\u5F00\u53D1\u56E2\u961F\u6839\u636E\u5BA2\u6237\u7684\u76EE\u6807\u5236\u5B9A\u5F00\u53D1\u8BA1\u5212</li><li>CODE\uFF1A\u6839\u636EPLAN\u5F00\u59CB\u7F16\u7801\u8FC7\u7A0B\uFF0C\u9700\u8981\u5C06\u4E0D\u540C\u7248\u672C\u7684\u4EE3\u7801\u5B58\u50A8\u5728\u4E00\u4E2A\u5E93\u4E2D\u3002</li><li>BUILD\uFF1A\u7F16\u7801\u5B8C\u6210\u540E\uFF0C\u9700\u8981\u5C06\u4EE3\u7801\u6784\u5EFA\u5E76\u4E14\u8FD0\u884C\u3002</li><li>TEST\uFF1A\u6210\u529F\u6784\u5EFA\u9879\u76EE\u540E\uFF0C\u9700\u8981\u6D4B\u8BD5\u4EE3\u7801\u662F\u5426\u5B58\u5728BUG\u6216\u9519\u8BEF\u3002</li><li>DEPLOY\uFF1A\u4EE3\u7801\u7ECF\u8FC7\u624B\u52A8\u6D4B\u8BD5\u548C\u81EA\u52A8\u5316\u6D4B\u8BD5\u540E\uFF0C\u8BA4\u5B9A\u4EE3\u7801\u5DF2\u7ECF\u51C6\u5907\u597D\u90E8\u7F72\u5E76\u4E14\u4EA4\u7ED9\u8FD0\u7EF4\u56E2\u961F\u3002</li><li>OPERATE\uFF1A\u8FD0\u7EF4\u56E2\u961F\u5C06\u4EE3\u7801\u90E8\u7F72\u5230\u751F\u4EA7\u73AF\u5883\u4E2D\u3002</li><li>MONITOR\uFF1A\u9879\u76EE\u90E8\u7F72\u4E0A\u7EBF\u540E\uFF0C\u9700\u8981\u6301\u7EED\u7684\u76D1\u63A7\u4EA7\u54C1\u3002</li><li>INTEGRATE\uFF1A\u7136\u540E\u5C06\u76D1\u63A7\u9636\u6BB5\u6536\u5230\u7684\u53CD\u9988\u53D1\u9001\u56DEPLAN\u9636\u6BB5\uFF0C\u6574\u4F53\u53CD\u590D\u7684\u6D41\u7A0B\u5C31\u662F<a href="">DevOps</a>\u7684\u6838\u5FC3\uFF0C\u5373\u6301\u7EED\u96C6\u6210\u3001\u6301\u7EED\u90E8\u7F72\u3002</li></ul><p>\u4E3A\u4E86\u4FDD\u8BC1\u6574\u4F53\u6D41\u7A0B\u53EF\u4EE5\u9AD8\u6548\u7684\u5B8C\u6210\uFF0C\u5404\u4E2A\u9636\u6BB5\u90FD\u6709\u6BD4\u8F83\u5E38\u89C1\u7684\u5DE5\u5177\uFF0C\u5982\u4E0B\u56FE\uFF1A</p><table><thead><tr><th style="text-align:center;">\u8F6F\u4EF6\u5F00\u53D1\u8FC7\u7A0B&amp;\u6D89\u53CA\u5DE5\u5177</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+v+'" alt="2021-11-23_175935" loading="lazy"></td></tr></tbody></table><p>\u6700\u7EC8\u53EF\u4EE5\u7ED9<a href="">DevOps</a>\u4E0B\u4E00\u4E2A\u5B9A\u4E49\uFF1A<a href="">DevOps \u5F3A\u8C03\u7684\u662F\u9AD8\u6548\u7EC4\u7EC7\u56E2\u961F\u4E4B\u95F4\u5982\u4F55\u901A\u8FC7\u81EA\u52A8\u5316\u7684\u5DE5\u5177\u534F\u4F5C\u548C\u6C9F\u901A\u6765\u5B8C\u6210\u8F6F\u4EF6\u7684\u751F\u547D\u5468\u671F\u7BA1\u7406\uFF0C\u4ECE\u800C\u66F4\u5FEB\u3001\u66F4\u9891\u7E41\u5730\u4EA4\u4ED8\u66F4\u7A33\u5B9A\u7684\u8F6F\u4EF6\u3002</a></p><p>\u81EA\u52A8\u5316\u7684\u5DE5\u5177\u534F\u4F5C\u548C\u6C9F\u901A\u6765\u5B8C\u6210\u8F6F\u4EF6\u7684\u751F\u547D\u5468\u671F\u7BA1\u7406</p><h3 id="\u4E8C\u3001code\u9636\u6BB5\u5DE5\u5177" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u3001code\u9636\u6BB5\u5DE5\u5177" aria-hidden="true">#</a> \u4E8C\u3001Code\u9636\u6BB5\u5DE5\u5177</h3><p>\u5728code\u9636\u6BB5\uFF0C\u6211\u4EEC\u9700\u8981\u5C06\u4E0D\u540C\u7248\u672C\u7684\u4EE3\u7801\u5B58\u50A8\u5230\u4E00\u4E2A\u4ED3\u5E93\u4E2D\uFF0C\u5E38\u89C1\u7684\u7248\u672C\u63A7\u5236\u5DE5\u5177\u5C31\u662FSVN\u6216\u8005Git\uFF0C\u8FD9\u91CC\u6211\u4EEC\u91C7\u7528Git\u4F5C\u4E3A\u7248\u672C\u63A7\u5236\u5DE5\u5177\uFF0CGitLab\u4F5C\u4E3A\u8FDC\u7A0B\u4ED3\u5E93\u3002</p><h4 id="_2-1-git\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#_2-1-git\u5B89\u88C5" aria-hidden="true">#</a> 2.1 Git\u5B89\u88C5</h4>',28),ha={href:"https://git-scm.com/%EF%BC%88%E5%82%BB%E7%93%9C%E5%BC%8F%E5%AE%89%E8%A3%85%EF%BC%89",target:"_blank",rel:"noopener noreferrer"},ya=s("https://git-scm.com/\uFF08\u50BB\u74DC\u5F0F\u5B89\u88C5\uFF09"),_a=e(`<h4 id="_2-2-gitlab\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#_2-2-gitlab\u5B89\u88C5" aria-hidden="true">#</a> 2.2 GitLab\u5B89\u88C5</h4><p>\u5355\u72EC\u51C6\u5907\u670D\u52A1\u5668\uFF0C\u91C7\u7528Docker\u5B89\u88C5</p><ul><li><p>\u67E5\u770BGitLab\u955C\u50CF</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> search gitlab
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u62C9\u53D6GitLab\u955C\u50CF</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> pull gitlab/gitlab-ce
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u51C6\u5907docker-compose.yml\u6587\u4EF6</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3.1&#39;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">gitlab</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&#39;gitlab/gitlab-ce:latest&#39;</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> gitlab
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">GITLAB_OMNIBUS_CONFIG</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        external_url &#39;http://192.168.11.11:8929&#39;
        gitlab_rails[&#39;gitlab_shell_ssh_port&#39;] = 2224</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&#39;8929:8929&#39;</span>
      <span class="token punctuation">-</span> <span class="token string">&#39;2224:2224&#39;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&#39;./config:/etc/gitlab&#39;</span>
      <span class="token punctuation">-</span> <span class="token string">&#39;./logs:/var/log/gitlab&#39;</span>
      <span class="token punctuation">-</span> <span class="token string">&#39;./data:/var/opt/gitlab&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u542F\u52A8\u5BB9\u5668\uFF08\u9700\u8981\u7A0D\u7B49\u4E00\u5C0F\u4F1A\u2026\u2026\uFF09</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker-compose</span> up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u8BBF\u95EEGitLab\u9996\u9875</p><table><thead><tr><th style="text-align:center;">\u9996\u9875</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+k+`" alt="image-20211124182140596" loading="lazy"></td></tr></tbody></table></li><li><p>\u67E5\u770Broot\u7528\u6237\u521D\u59CB\u5BC6\u7801</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it gitlab <span class="token function">cat</span> /etc/gitlab/initial_root_password
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">\u521D\u59CB\u5BC6\u7801</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+b+'" alt="image-20211124182921234" loading="lazy"></td></tr></tbody></table></li><li><p>\u767B\u5F55root\u7528\u6237</p><table><thead><tr><th style="text-align:center;">\u767B\u5F55\u6210\u529F\u540E\u8DF3\u8F6C\u9875\u9762</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+m+'" alt="image-20211124183003858" loading="lazy"></td></tr></tbody></table></li><li><p>\u7B2C\u4E00\u6B21\u767B\u5F55\u540E\u9700\u8981\u4FEE\u6539\u5BC6\u7801</p><table><thead><tr><th style="text-align:center;">\u4FEE\u6539\u5BC6\u7801</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+g+`" alt="image-20211124193444561" loading="lazy"></td></tr></tbody></table></li></ul><p>\u641E\u5B9A\u540E\uFF0C\u5373\u53EF\u50CFGitee\u3001GitHub\u4E00\u6837\u4F7F\u7528\u3002</p><h3 id="\u4E09\u3001build\u9636\u6BB5\u5DE5\u5177" tabindex="-1"><a class="header-anchor" href="#\u4E09\u3001build\u9636\u6BB5\u5DE5\u5177" aria-hidden="true">#</a> \u4E09\u3001Build\u9636\u6BB5\u5DE5\u5177</h3><p>\u6784\u5EFAJava\u9879\u76EE\u7684\u5DE5\u5177\u4E00\u822C\u6709\u4E24\u79CD\u9009\u62E9\uFF0C\u4E00\u4E2A\u662FMaven\uFF0C\u4E00\u4E2A\u662FGradle\u3002</p><p>\u8FD9\u91CC\u6211\u4EEC\u9009\u62E9Maven\u4F5C\u4E3A\u9879\u76EE\u7684\u7F16\u8BD1\u5DE5\u5177\u3002</p><p>\u5177\u4F53\u5B89\u88C5Maven\u6D41\u7A0B\u4E0D\u505A\u9610\u8FF0\uFF0C\u4F46\u662F\u9700\u8981\u786E\u4FDD\u914D\u7F6E\u597DMaven\u4ED3\u5E93\u79C1\u670D\u4EE5\u53CAJDK\u7F16\u8BD1\u7248\u672C\u3002</p><h3 id="\u56DB\u3001operate\u9636\u6BB5\u5DE5\u5177" tabindex="-1"><a class="header-anchor" href="#\u56DB\u3001operate\u9636\u6BB5\u5DE5\u5177" aria-hidden="true">#</a> \u56DB\u3001Operate\u9636\u6BB5\u5DE5\u5177</h3><p>\u90E8\u7F72\u8FC7\u7A0B\uFF0C\u4F1A\u91C7\u7528Docker\u8FDB\u884C\u90E8\u7F72\uFF0C\u6682\u65F6\u53EA\u5B89\u88C5Docker\u5373\u53EF\uFF0C\u540E\u7EED\u8FD8\u9700\u5B89\u88C5Kubenetes</p><h4 id="_4-1-docker\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#_4-1-docker\u5B89\u88C5" aria-hidden="true">#</a> 4.1 Docker\u5B89\u88C5</h4><ul><li><p>\u51C6\u5907\u6D4B\u8BD5\u73AF\u5883&amp;\u751F\u4EA7\u73AF\u5883</p></li><li><p>\u4E0B\u8F7DDocker\u4F9D\u8D56\u7EC4\u4EF6</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum -y <span class="token function">install</span> yum-utils device-mapper-persistent-data lvm2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u8BBE\u7F6E\u4E0B\u8F7DDocker\u7684\u955C\u50CF\u6E90\u4E3A\u963F\u91CC\u4E91</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u5B89\u88C5Docker\u670D\u52A1</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum -y <span class="token function">install</span> docker-ce
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u5B89\u88C5\u6210\u529F\u540E\uFF0C\u542F\u52A8Docker\u5E76\u8BBE\u7F6E\u5F00\u673A\u81EA\u542F</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u542F\u52A8Docker\u670D\u52A1</span>
systemctl start <span class="token function">docker</span>
<span class="token comment"># \u8BBE\u7F6E\u5F00\u673A\u81EA\u52A8\u542F\u52A8</span>
systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u6D4B\u8BD5\u5B89\u88C5\u6210\u529F</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">\u6548\u679C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+h+'" alt="image-20211124200317795" loading="lazy"></td></tr></tbody></table></li></ul><h4 id="_4-2-docker-compose\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#_4-2-docker-compose\u5B89\u88C5" aria-hidden="true">#</a> 4.2 Docker-Compose\u5B89\u88C5</h4>',13),xa=s("\u4E0B\u8F7DDocker/Compose\uFF1A"),fa={href:"https://github.com/docker/compose",target:"_blank",rel:"noopener noreferrer"},Da=s("https://github.com/docker/compose"),za=e(`<li><p>\u5C06\u4E0B\u8F7D\u597D\u7684<a href="">docker-compose-Linux-x86_64</a>\u6587\u4EF6\u79FB\u52A8\u5230Linux\u64CD\u4F5C\u7CFB\u7EDF\uFF1A\u2026\u2026</p></li><li><p>\u8BBE\u7F6E<a href="">docker-compose-Linux-x86_64</a>\u6587\u4EF6\u6743\u9650\uFF0C\u5E76\u79FB\u52A8\u5230$PATH\u76EE\u5F55\u4E2D</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u8BBE\u7F6E\u6587\u4EF6\u6743\u9650</span>
<span class="token function">chmod</span> a+x docker-compose-Linux-x86_64
<span class="token comment"># \u79FB\u52A8\u5230/usr/bin\u76EE\u5F55\u4E0B\uFF0C\u5E76\u91CD\u547D\u540D\u4E3Adocker-compose</span>
<span class="token function">mv</span> docker-compose-Linux-x86_64 /usr/bin/docker-compose
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u6D4B\u8BD5\u5B89\u88C5\u6210\u529F</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker-compose</span> version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">\u6548\u679C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+y+'" alt="image-20211124200658107" loading="lazy"></td></tr></tbody></table></li>',3),Sa=e('<h3 id="\u4E94\u3001integrate\u5DE5\u5177" tabindex="-1"><a class="header-anchor" href="#\u4E94\u3001integrate\u5DE5\u5177" aria-hidden="true">#</a> \u4E94\u3001Integrate\u5DE5\u5177</h3><p>\u6301\u7EED\u96C6\u6210\u3001\u6301\u7EED\u90E8\u7F72\u7684\u5DE5\u5177\u5F88\u591A\uFF0C\u5176\u4E2DJenkins\u662F\u4E00\u4E2A\u5F00\u6E90\u7684\u6301\u7EED\u96C6\u6210\u5E73\u53F0\u3002</p><p>Jenkins\u6D89\u53CA\u5230\u5C06\u7F16\u5199\u5B8C\u6BD5\u7684\u4EE3\u7801\u53D1\u5E03\u5230\u6D4B\u8BD5\u73AF\u5883\u548C\u751F\u4EA7\u73AF\u5883\u7684\u4EFB\u52A1\uFF0C\u5E76\u4E14\u8FD8\u6D89\u53CA\u5230\u4E86\u6784\u5EFA\u9879\u76EE\u7B49\u4EFB\u52A1\u3002</p><p>Jenkins\u9700\u8981\u5927\u91CF\u7684\u63D2\u4EF6\u4FDD\u8BC1\u5DE5\u4F5C\uFF0C\u5B89\u88C5\u6210\u672C\u8F83\u9AD8\uFF0C\u4E0B\u9762\u4F1A\u57FA\u4E8EDocker\u642D\u5EFAJenkins\u3002</p><h4 id="_5-1-jenkins\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_5-1-jenkins\u4ECB\u7ECD" aria-hidden="true">#</a> 5.1 Jenkins\u4ECB\u7ECD</h4><p>Jenkins\u662F\u4E00\u4E2A\u5F00\u6E90\u8F6F\u4EF6\u9879\u76EE\uFF0C\u662F\u57FA\u4E8EJava\u5F00\u53D1\u7684\u4E00\u79CD\u6301\u7EED\u96C6\u6210\u5DE5\u5177</p><p>Jenkins\u5E94\u7528\u5E7F\u6CDB\uFF0C\u5927\u591A\u6570\u4E92\u8054\u7F51\u516C\u53F8\u90FD\u91C7\u7528Jenkins\u914D\u5408GitLab\u3001Docker\u3001K8s\u4F5C\u4E3A\u5B9E\u73B0<a href="">DevOps</a>\u7684\u6838\u5FC3\u5DE5\u5177\u3002</p><p>Jenkins\u6700\u5F3A\u5927\u7684\u5C31\u5728\u4E8E\u63D2\u4EF6\uFF0CJenkins\u5B98\u65B9\u63D0\u4F9B\u4E86\u5927\u91CF\u7684\u63D2\u4EF6\u5E93\uFF0C\u6765\u81EA\u52A8\u5316CI/CD\u8FC7\u7A0B\u4E2D\u7684\u5404\u79CD\u7410\u788E\u529F\u80FD\u3002</p><table><thead><tr><th style="text-align:center;"></th><th style="text-align:center;"></th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+_+'" alt="image-20211125141950900" loading="lazy"></td><td style="text-align:center;"><img src="'+x+'" alt="image-20211124200317795" loading="lazy"></td></tr></tbody></table><p>Jenkins\u6700\u4E3B\u8981\u7684\u5DE5\u4F5C\u5C31\u662F\u5C06GitLab\u4E0A\u53EF\u4EE5\u6784\u5EFA\u7684\u5DE5\u7A0B\u4EE3\u7801\u62C9\u53D6\u5E76\u4E14\u8FDB\u884C\u6784\u5EFA\uFF0C\u518D\u6839\u636E\u6D41\u7A0B\u53EF\u4EE5\u9009\u62E9\u53D1\u5E03\u5230\u6D4B\u8BD5\u73AF\u5883\u6216\u662F\u751F\u4EA7\u73AF\u5883\u3002</p><p>\u4E00\u822C\u662FGitLab\u4E0A\u7684\u4EE3\u7801\u7ECF\u8FC7\u5927\u91CF\u7684\u6D4B\u8BD5\u540E\uFF0C\u786E\u5B9A\u53D1\u884C\u7248\u672C\uFF0C\u518D\u53D1\u5E03\u5230\u751F\u4EA7\u73AF\u5883\u3002</p><p>CI/CD\u53EF\u4EE5\u7406\u89E3\u4E3A\uFF1A</p><ul><li>CI\u8FC7\u7A0B\u5373\u662F\u901A\u8FC7Jenkins\u5C06\u4EE3\u7801\u62C9\u53D6\u3001\u6784\u5EFA\u3001\u5236\u4F5C\u955C\u50CF\u4EA4\u7ED9\u6D4B\u8BD5\u4EBA\u5458\u6D4B\u8BD5\u3002 <ul><li>\u6301\u7EED\u96C6\u6210\uFF1A\u8BA9\u8F6F\u4EF6\u4EE3\u7801\u53EF\u4EE5\u6301\u7EED\u7684\u96C6\u6210\u5230\u4E3B\u5E72\u4E0A\uFF0C\u5E76\u81EA\u52A8\u6784\u5EFA\u548C\u6D4B\u8BD5\u3002</li></ul></li><li>CD\u8FC7\u7A0B\u5373\u662F\u901A\u8FC7Jenkins\u5C06\u6253\u597D\u6807\u7B7E\u7684\u53D1\u884C\u7248\u672C\u4EE3\u7801\u62C9\u53D6\u3001\u6784\u5EFA\u3001\u5236\u4F5C\u955C\u50CF\u4EA4\u7ED9\u8FD0\u7EF4\u4EBA\u5458\u90E8\u7F72\u3002 <ul><li>\u6301\u7EED\u4EA4\u4ED8\uFF1A\u8BA9\u7ECF\u8FC7\u6301\u7EED\u96C6\u6210\u7684\u4EE3\u7801\u53EF\u4EE5\u8FDB\u884C\u624B\u52A8\u90E8\u7F72\u3002</li><li>\u6301\u7EED\u90E8\u7F72\uFF1A\u8BA9\u53EF\u4EE5\u6301\u7EED\u4EA4\u4ED8\u7684\u4EE3\u7801\u968F\u65F6\u968F\u5730\u7684\u81EA\u52A8\u5316\u90E8\u7F72\u3002</li></ul></li></ul><table><thead><tr><th style="text-align:center;">CI\u3001CD</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+f+`" alt="image-20211125154112097" loading="lazy"></td></tr></tbody></table><h4 id="_5-2-jenkins\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#_5-2-jenkins\u5B89\u88C5" aria-hidden="true">#</a> 5.2 Jenkins\u5B89\u88C5</h4><ul><li><p>\u62C9\u53D6Jenkins\u955C\u50CF</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker pull jenkins/jenkins
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u7F16\u5199docker-compose.yml</p><ul><li>docker-compose up -d</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.1&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">jenkins</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> jenkins/jenkins<span class="token punctuation">:</span>2.319.3<span class="token punctuation">-</span>lts
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> jenkins
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 8090<span class="token punctuation">:</span><span class="token number">8080</span>
      <span class="token punctuation">-</span> 50000<span class="token punctuation">:</span><span class="token number">50000</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /home/data/jenkins/jenkins_home/<span class="token punctuation">:</span>/var/jenkins_home/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u9996\u6B21\u542F\u52A8\u4F1A\u56E0\u4E3A\u6570\u636E\u5377data\u76EE\u5F55\u6CA1\u6709\u6743\u9650\u5BFC\u81F4\u542F\u52A8\u5931\u8D25\uFF0C\u8BBE\u7F6Edata\u76EE\u5F55\u5199\u6743\u9650</p><table><thead><tr><th style="text-align:center;">\u9519\u8BEF\u65E5\u5FD7</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+D+`" alt="image-20211124202610243" loading="lazy"></td></tr></tbody></table><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">chmod</span> -R a+w data/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u91CD\u65B0\u542F\u52A8Jenkins\u5BB9\u5668\u540E\uFF0C\u7531\u4E8EJenkins\u9700\u8981\u4E0B\u8F7D\u5927\u91CF\u5185\u5BB9\uFF0C\u4F46\u662F\u7531\u4E8E\u9ED8\u8BA4\u4E0B\u8F7D\u5730\u5740\u4E0B\u8F7D\u901F\u5EA6\u8F83\u6162\uFF0C\u9700\u8981\u91CD\u65B0\u8BBE\u7F6E\u4E0B\u8F7D\u5730\u5740\u4E3A\u56FD\u5185\u955C\u50CF\u7AD9</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u4FEE\u6539\u6570\u636E\u5377\u4E2D\u7684hudson.model.UpdateCenter.xml\u6587\u4EF6</span>
<span class="token operator">&lt;</span>?xml <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token string">&#39;1.1&#39;</span> <span class="token assign-left variable">encoding</span><span class="token operator">=</span><span class="token string">&#39;UTF-8&#39;</span>?<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>sites<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>site<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>id<span class="token operator">&gt;</span>default<span class="token operator">&lt;</span>/id<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>url<span class="token operator">&gt;</span>https://updates.jenkins.io/update-center.json<span class="token operator">&lt;</span>/url<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/site<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/sites<span class="token operator">&gt;</span>
<span class="token comment"># \u5C06\u4E0B\u8F7D\u5730\u5740\u66FF\u6362\u4E3Ahttp://mirror.esuni.jp/jenkins/updates/update-center.json</span>
<span class="token operator">&lt;</span>?xml <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token string">&#39;1.1&#39;</span> <span class="token assign-left variable">encoding</span><span class="token operator">=</span><span class="token string">&#39;UTF-8&#39;</span>?<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>sites<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>site<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>id<span class="token operator">&gt;</span>default<span class="token operator">&lt;</span>/id<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>url<span class="token operator">&gt;</span>http://mirror.esuni.jp/jenkins/updates/update-center.json<span class="token operator">&lt;</span>/url<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/site<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/sites<span class="token operator">&gt;</span>
<span class="token comment"># \u6E05\u534E\u5927\u5B66\u7684\u63D2\u4EF6\u6E90\u4E5F\u53EF\u4EE5https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u518D\u6B21\u91CD\u542FJenkins\u5BB9\u5668\uFF0C\u8BBF\u95EEJenkins\uFF08\u9700\u8981\u7A0D\u5FAE\u7B49\u4F1A\uFF09</p><table><thead><tr><th style="text-align:center;">Jenkins\u9996\u9875</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+z+'" alt="image-20211124204517433" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+S+`" alt="image-20211124203336300" loading="lazy"></td></tr></tbody></table></li><li><p>\u67E5\u770B\u5BC6\u7801\u767B\u5F55Jenkins\uFF0C\u5E76\u767B\u5F55\u4E0B\u8F7D\u63D2\u4EF6</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it jenkins <span class="token function">cat</span> /var/jenkins_home/secrets/initialAdminPassword
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">\u767B\u5F55\u5E76\u4E0B\u8F7D\u63D2\u4EF6</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+J+'" alt="image-20211124205050484" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+$+'" alt="image-20211124205513465" loading="lazy"></td></tr></tbody></table></li><li><p>\u9009\u62E9\u9700\u8981\u5B89\u88C5\u7684\u63D2\u4EF6</p><table><thead><tr><th style="text-align:center;">\u9009\u62E9\u9700\u8981\u5B89\u88C5\u7684\u63D2\u4EF6</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+P+'" alt="image-20211124205854418" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+E+'" alt="image-20211124205858730" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+j+'" alt="image-20211124205917317" loading="lazy"></td></tr></tbody></table></li><li><p>\u4E0B\u8F7D\u5B8C\u6BD5\u8BBE\u7F6E\u4FE1\u606F\u8FDB\u5165\u9996\u9875\uFF08\u53EF\u80FD\u4F1A\u51FA\u73B0\u4E0B\u8F7D\u5931\u8D25\u7684\u63D2\u4EF6\uFF09</p><table><thead><tr><th></th></tr></thead><tbody><tr><td><img src="'+q+'" alt="image-20211124211635550" loading="lazy"></td></tr><tr><td><img src="'+N+'" alt="image-20211124211700999" loading="lazy"></td></tr><tr><td><img src="'+O+'" alt="image-20211124211720836" loading="lazy"></td></tr></tbody></table></li></ul><h4 id="_5-3-jenkins\u5165\u95E8\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_5-3-jenkins\u5165\u95E8\u914D\u7F6E" aria-hidden="true">#</a> 5.3 Jenkins\u5165\u95E8\u914D\u7F6E</h4><p>\u7531\u4E8EJenkins\u9700\u8981\u4ECEGit\u62C9\u53D6\u4EE3\u7801\u3001\u9700\u8981\u672C\u5730\u6784\u5EFA\u3001\u751A\u81F3\u9700\u8981\u76F4\u63A5\u53D1\u5E03\u81EA\u5B9A\u4E49\u955C\u50CF\u5230Docker\u4ED3\u5E93\uFF0C\u6240\u4EE5Jenkins\u9700\u8981\u914D\u7F6E\u5927\u91CF\u5185\u5BB9\u3002</p><h5 id="_5-3-1-\u6784\u5EFA\u4EFB\u52A1" tabindex="-1"><a class="header-anchor" href="#_5-3-1-\u6784\u5EFA\u4EFB\u52A1" aria-hidden="true">#</a> 5.3.1 \u6784\u5EFA\u4EFB\u52A1</h5><p>\u51C6\u5907\u597DGitLab\u4ED3\u5E93\u4E2D\u7684\u9879\u76EE\uFF0C\u5E76\u4E14\u901A\u8FC7Jenkins\u914D\u7F6E\u9879\u76EE\u7684\u5B9E\u73B0\u5F53\u524D\u9879\u76EE\u7684<a href="">DevOps</a>\u57FA\u672C\u6D41\u7A0B\u3002</p><ul><li><p>\u6784\u5EFAMaven\u5DE5\u7A0B\u53D1\u5E03\u5230GitLab\uFF08Gitee\u3001Github\u5747\u53EF\uFF09</p><table><thead><tr><th style="text-align:center;">GitLab\u67E5\u770B\u9879\u76EE</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+A+'" alt="image-20211125195818670" loading="lazy"></td></tr></tbody></table></li><li><p>Jenkins\u70B9\u51FB\u5DE6\u4FA7\u5BFC\u822A\u65B0\u5EFA\u4EFB\u52A1</p><table><thead><tr><th style="text-align:center;">\u65B0\u5EFA\u4EFB\u52A1</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+M+'" alt="image-20211125163541645" loading="lazy"></td></tr></tbody></table></li><li><p>\u9009\u62E9\u81EA\u7531\u98CE\u683C\u6784\u5EFA\u4EFB\u52A1</p><table><thead><tr><th style="text-align:center;">\u6784\u5EFA\u4EFB\u52A1</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+B+'" alt="image-20211125170350811" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_5-3-1-\u914D\u7F6E\u6E90\u7801\u62C9\u53D6\u5730\u5740" tabindex="-1"><a class="header-anchor" href="#_5-3-1-\u914D\u7F6E\u6E90\u7801\u62C9\u53D6\u5730\u5740" aria-hidden="true">#</a> 5.3.1 \u914D\u7F6E\u6E90\u7801\u62C9\u53D6\u5730\u5740</h5><p>Jenkins\u9700\u8981\u5C06Git\u4E0A\u5B58\u653E\u7684\u6E90\u7801\u5B58\u50A8\u5230Jenkins\u670D\u52A1\u6240\u5728\u78C1\u76D8\u7684\u672C\u5730</p><ul><li><p>\u914D\u7F6E\u4EFB\u52A1\u6E90\u7801\u62C9\u53D6\u7684\u5730\u5740</p><table><thead><tr><th style="text-align:center;">\u6E90\u7801\u7BA1\u7406</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+R+'" alt="image-20211125170418337" loading="lazy"></td></tr></tbody></table></li><li><p>Jenkins\u7ACB\u5373\u6784\u5EFA</p><table><thead><tr><th style="text-align:center;">\u70B9\u51FB\u4EFB\u52A1test\u4E2D\u7684\u7ACB\u5373\u6784\u5EFA</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+C+'" alt="image-20211125200218093" loading="lazy"></td></tr></tbody></table></li><li><p>\u67E5\u770B\u6784\u5EFA\u5DE5\u7A0B\u7684\u65E5\u5FD7\uFF0C\u70B9\u51FB\u4E0A\u8FF0\u2462\u7684\u4EFB\u52A1\u6761\u5373\u53EF</p><table><thead><tr><th style="text-align:center;">\u67E5\u770B\u4EFB\u52A1\u62C9\u53D6Git\u6E90\u7801\u65E5\u5FD7</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+G+'" alt="image-20211125201701443" loading="lazy"></td></tr></tbody></table><p>\u53EF\u4EE5\u770B\u5230\u6E90\u7801\u5DF2\u7ECF\u62C9\u53D6\u5E26Jenkins\u672C\u5730\uFF0C\u53EF\u4EE5\u6839\u636E\u7B2C\u4E09\u884C\u65E5\u5FD7\u4FE1\u606F\uFF0C\u67E5\u770BJenkins\u672C\u5730\u62C9\u53D6\u5230\u7684\u6E90\u7801\u3002</p></li><li><p>\u67E5\u770BJenkins\u5BB9\u5668\u4E2D<a href="">/var/jenkins_home/workspace/test</a>\u7684\u6E90\u7801</p><table><thead><tr><th style="text-align:center;">\u6E90\u7801\u5B58\u653E\u4F4D\u7F6E</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+w+'" alt="image-20211125201919108" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_5-3-2-\u914D\u7F6Emaven\u6784\u5EFA\u4EE3\u7801" tabindex="-1"><a class="header-anchor" href="#_5-3-2-\u914D\u7F6Emaven\u6784\u5EFA\u4EE3\u7801" aria-hidden="true">#</a> 5.3.2 \u914D\u7F6EMaven\u6784\u5EFA\u4EE3\u7801</h5><p>\u4EE3\u7801\u62C9\u53D6\u5230Jenkins\u672C\u5730\u540E\uFF0C\u9700\u8981\u5728Jenkins\u4E2D\u5BF9\u4EE3\u7801\u8FDB\u884C\u6784\u5EFA\uFF0C\u8FD9\u91CC\u9700\u8981Maven\u7684\u73AF\u5883\uFF0C\u800CMaven\u9700\u8981Java\u7684\u73AF\u5883\uFF0C\u63A5\u4E0B\u6765\u9700\u8981\u5728Jenkins\u4E2D\u5B89\u88C5JDK\u548CMaven\uFF0C\u5E76\u4E14\u914D\u7F6E\u5230Jenkins\u670D\u52A1\u3002</p><ul><li><p>\u51C6\u5907JDK\u3001Maven\u538B\u7F29\u5305\u901A\u8FC7\u6570\u636E\u5377\u6620\u5C04\u5230Jenkins\u5BB9\u5668\u5185\u90E8</p><table><thead><tr><th style="text-align:center;">\u6570\u636E\u5377\u5B58\u653E\u4F4D\u7F6E</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+I+`" alt="image-20211125203757232" loading="lazy"></td></tr></tbody></table></li><li><p>\u89E3\u538B\u538B\u7F29\u5305\uFF0C\u5E76\u914D\u7F6EMaven\u7684settings.xml</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- \u963F\u91CC\u4E91\u955C\u50CF\u5730\u5740 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirror</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>alimaven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>aliyun maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>http://maven.aliyun.com/nexus/content/groups/public/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrorOf</span><span class="token punctuation">&gt;</span></span>central<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrorOf</span><span class="token punctuation">&gt;</span></span>          
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirror</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- JDK1.8\u7F16\u8BD1\u63D2\u4EF6 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>jdk-1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activation</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeByDefault</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeByDefault</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jdk</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jdk</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activation</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.compilerVersion</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.compilerVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>        
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Jenkins\u914D\u7F6EJDK&amp;Maven\u5E76\u4FDD\u5B58</p><table><thead><tr><th></th></tr></thead><tbody><tr><td><img src="`+K+'" alt="image-20211125204811759" loading="lazy"></td></tr><tr><td><img src="'+H+'" alt="image-20211125204818869" loading="lazy"></td></tr></tbody></table></li><li><p>\u914D\u7F6EJenkins\u4EFB\u52A1\u6784\u5EFA\u4EE3\u7801</p><table><thead><tr><th style="text-align:center;">\u914D\u7F6EMaven\u6784\u5EFA\u4EE3\u7801</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+c+'" alt="image-20211125205027013" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+L+'" alt="image-20211125205020738" loading="lazy"></td></tr></tbody></table></li><li><p>\u7ACB\u5373\u6784\u5EFA\u6D4B\u8BD5\uFF0C\u67E5\u770Btarget\u4E0B\u7684jar\u5305</p><table><thead><tr><th style="text-align:center;">\u6784\u5EFA\u6E90\u7801</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+T+'" alt="image-20211125205240208" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+Q+'" alt="image-20211125205725948" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_5-3-3-\u914D\u7F6Epublish\u53D1\u5E03-\u8FDC\u7A0B\u64CD\u4F5C" tabindex="-1"><a class="header-anchor" href="#_5-3-3-\u914D\u7F6Epublish\u53D1\u5E03-\u8FDC\u7A0B\u64CD\u4F5C" aria-hidden="true">#</a> 5.3.3 \u914D\u7F6EPublish\u53D1\u5E03&amp;\u8FDC\u7A0B\u64CD\u4F5C</h5><p>jar\u5305\u6784\u5EFA\u597D\u4E4B\u540E\uFF0C\u5C31\u53EF\u4EE5\u6839\u636E\u60C5\u51B5\u53D1\u5E03\u5230\u6D4B\u8BD5\u6216\u751F\u4EA7\u73AF\u5883\uFF0C\u8FD9\u91CC\u9700\u8981\u7528\u5230\u4E4B\u524D\u4E0B\u8F7D\u597D\u7684\u63D2\u4EF6Publish Over SSH\u3002</p><ul><li><p>\u914D\u7F6EPublish Over SSH\u8FDE\u63A5\u6D4B\u8BD5\u3001\u751F\u4EA7\u73AF\u5883</p><table><thead><tr><th style="text-align:center;">Publish Over SSH\u914D\u7F6E</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+U+'" alt="image-20211125210148202" loading="lazy"></td></tr></tbody></table></li><li><p>\u914D\u7F6E\u4EFB\u52A1\u7684\u6784\u5EFA\u540E\u64CD\u4F5C\uFF0C\u53D1\u5E03jar\u5305\u5230\u76EE\u6807\u670D\u52A1</p><table><thead><tr><th style="text-align:center;">\u914D\u7F6E\u6784\u5EFA\u540E\u64CD\u4F5C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+c+'" alt="image-20211125205027013" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+F+'" alt="image-20211125210424346" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+V+'" alt="image-20211125210626631" loading="lazy"></td></tr></tbody></table></li><li><p>\u7ACB\u5373\u6784\u5EFA\u4EFB\u52A1\uFF0C\u5E76\u53BB\u76EE\u6807\u670D\u52A1\u67E5\u770B</p><table><thead><tr><th style="text-align:center;">\u7ACB\u5373\u6784\u5EFA</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+W+'" alt="image-20211125210755556" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+Y+'" alt="image-20211125210826057" loading="lazy"></td></tr></tbody></table></li></ul><h3 id="\u516D\u3001ci\u3001cd\u5165\u95E8\u64CD\u4F5C" tabindex="-1"><a class="header-anchor" href="#\u516D\u3001ci\u3001cd\u5165\u95E8\u64CD\u4F5C" aria-hidden="true">#</a> \u516D\u3001CI\u3001CD\u5165\u95E8\u64CD\u4F5C</h3><p>\u57FA\u4E8EJenkins\u62C9\u53D6GitLab\u7684SpringBoot\u4EE3\u7801\u8FDB\u884C\u6784\u5EFA\u53D1\u5E03\u5230\u6D4B\u8BD5\u73AF\u5883\u5B9E\u73B0\u6301\u7EED\u96C6\u6210</p><p>\u57FA\u4E8EJenkins\u62C9\u53D6GitLab\u6307\u5B9A\u53D1\u884C\u7248\u672C\u7684SpringBoot\u4EE3\u7801\u8FDB\u884C\u6784\u5EFA\u53D1\u5E03\u5230\u751F\u4EA7\u73AF\u5883\u5B9E\u73B0CD\u5B9E\u73B0\u6301\u7EED\u90E8\u7F72</p><h4 id="_6-1-\u6301\u7EED\u96C6\u6210" tabindex="-1"><a class="header-anchor" href="#_6-1-\u6301\u7EED\u96C6\u6210" aria-hidden="true">#</a> 6.1 \u6301\u7EED\u96C6\u6210</h4><p>\u4E3A\u4E86\u8BA9\u7A0B\u5E8F\u4EE3\u7801\u53EF\u4EE5\u81EA\u52A8\u63A8\u9001\u5230\u6D4B\u8BD5\u73AF\u5883\u57FA\u4E8EDocker\u670D\u52A1\u8FD0\u884C\uFF0C\u9700\u8981\u6DFB\u52A0Docker\u914D\u7F6E\u548C\u811A\u672C\u6587\u4EF6\u8BA9\u7A0B\u5E8F\u53EF\u4EE5\u5728\u96C6\u6210\u5230\u4E3B\u5E72\u7684\u540C\u65F6\u8FD0\u884C\u8D77\u6765\u3002</p><ul><li><p>\u6DFB\u52A0Dockerfile\u6587\u4EF6</p><table><thead><tr><th style="text-align:center;">\u6784\u5EFA\u81EA\u5B9A\u4E49\u955C\u50CF</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+X+'" alt="image-20211126161304485" loading="lazy"></td></tr></tbody></table></li><li><p>\u6DFB\u52A0docker-compose.yml\u6587\u4EF6</p><table><thead><tr><th style="text-align:center;">\u52A0\u8F7D\u81EA\u5B9A\u4E49\u955C\u50CF\u542F\u52A8\u5BB9\u5668</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Z+'" alt="image-20211126161331991" loading="lazy"></td></tr></tbody></table></li><li><p>\u8FFD\u52A0Jenkins\u6784\u5EFA\u540E\u64CD\u4F5C\u811A\u672C\u547D\u4EE4</p><table><thead><tr><th style="text-align:center;">\u6784\u5EFA\u540E\u53D1\u5E03\u5E76\u6267\u884C\u811A\u672C\u547D\u4EE4</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+nn+'" alt="image-20211126161408514" loading="lazy"></td></tr></tbody></table></li><li><p>\u53D1\u5E03\u5230GitLab\u540E\u7531Jenkins\u7ACB\u5373\u6784\u5EFA\u5E76\u6258\u9001\u5230\u76EE\u6807\u670D\u52A1\u5668</p><table><thead><tr><th style="text-align:center;">\u6784\u5EFA\u65E5\u5FD7</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+sn+'" alt="image-20211126161448527" loading="lazy"></td></tr></tbody></table></li><li><p>\u6D4B\u8BD5\u90E8\u7F72\u5230\u76EE\u6807\u670D\u52A1\u5668\u7A0B\u5E8F</p><table><thead><tr><th style="text-align:center;">\u67E5\u770B\u76EE\u6807\u670D\u52A1\u5668\u5E76\u6D4B\u8BD5\u63A5\u53E3</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+an+'" alt="image-20211126161504715" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+en+'" alt="image-20211126161509411" loading="lazy"></td></tr></tbody></table></li></ul><h4 id="_6-2-\u6301\u7EED\u4EA4\u4ED8\u3001\u90E8\u7F72" tabindex="-1"><a class="header-anchor" href="#_6-2-\u6301\u7EED\u4EA4\u4ED8\u3001\u90E8\u7F72" aria-hidden="true">#</a> 6.2 \u6301\u7EED\u4EA4\u4ED8\u3001\u90E8\u7F72</h4><p>\u7A0B\u5E8F\u4EE3\u7801\u5728\u7ECF\u8FC7\u591A\u6B21\u96C6\u6210\u64CD\u4F5C\u5230\u8FBE\u6700\u7EC8\u53EF\u4EE5\u4EA4\u4ED8\uFF0C\u6301\u7EED\u4EA4\u4ED8\u6574\u4F53\u6D41\u7A0B\u548C\u6301\u7EED\u96C6\u6210\u7C7B\u4F3C\uFF0C\u4E0D\u8FC7\u9700\u8981\u9009\u53D6\u6307\u5B9A\u7684\u53D1\u884C\u7248\u672C</p><ul><li><p>\u4E0B\u8F7DGit Parameter\u63D2\u4EF6</p><table><thead><tr><th style="text-align:center;">\u4E0B\u8F7DGit Parameter</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+tn+'" alt="image-20211126165209057" loading="lazy"></td></tr></tbody></table></li><li><p>\u8BBE\u7F6E\u9879\u76EE\u53C2\u6570\u5316\u6784\u5EFA</p><table><thead><tr><th style="text-align:center;">\u57FA\u4E8EGit\u6807\u7B7E\u6784\u5EFA</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+ln+'" alt="image-20211126165444124" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+pn+'" alt="image-20211126172828266" loading="lazy"></td></tr></tbody></table></li><li><p>\u7ED9\u9879\u76EE\u6DFB\u52A0tag\u7248\u672C</p><table><thead><tr><th style="text-align:center;">\u6DFB\u52A0tag\u7248\u672C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+cn+'" alt="image-20211126165639286" loading="lazy"></td></tr></tbody></table></li><li><p>\u4EFB\u52A1\u6784\u5EFA\u65F6\uFF0C\u91C7\u7528Shell\u65B9\u5F0F\u6784\u5EFA\uFF0C\u62C9\u53D6\u6307\u5B9Atag\u7248\u672C\u4EE3\u7801</p><table><thead><tr><th style="text-align:center;">\u5207\u6362\u6307\u5B9A\u6807\u7B7E\u5E76\u6784\u5EFA\u9879\u76EE</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+on+'" alt="image-20211126174715028" loading="lazy"></td></tr></tbody></table></li><li><p>\u57FA\u4E8EParameter\u6784\u5EFA\u4EFB\u52A1\uFF0C\u4EFB\u52A1\u53D1\u5E03\u5230\u76EE\u6807\u670D\u52A1\u5668</p><table><thead><tr><th style="text-align:center;">\u6784\u5EFA\u4EFB\u52A1</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+rn+'" alt="image-20211126174159487" loading="lazy"></td></tr></tbody></table></li></ul><h3 id="\u4E03\u3001\u96C6\u6210sonar-qube" tabindex="-1"><a class="header-anchor" href="#\u4E03\u3001\u96C6\u6210sonar-qube" aria-hidden="true">#</a> \u4E03\u3001\u96C6\u6210Sonar Qube</h3><h4 id="_7-1-sonar-qube\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_7-1-sonar-qube\u4ECB\u7ECD" aria-hidden="true">#</a> 7.1 Sonar Qube\u4ECB\u7ECD</h4><p>Sonar Qube\u662F\u4E00\u4E2A\u5F00\u6E90\u7684\u4EE3\u7801\u5206\u6790\u5E73\u53F0\uFF0C\u652F\u6301Java\u3001Python\u3001PHP\u3001JavaScript\u3001CSS\u7B4925\u79CD\u4EE5\u4E0A\u7684\u8BED\u8A00\uFF0C\u53EF\u4EE5\u68C0\u6D4B\u51FA\u91CD\u590D\u4EE3\u7801\u3001\u4EE3\u7801\u6F0F\u6D1E\u3001\u4EE3\u7801\u89C4\u8303\u548C\u5B89\u5168\u6027\u6F0F\u6D1E\u7684\u95EE\u9898\u3002</p><p>Sonar Qube\u53EF\u4EE5\u4E0E\u591A\u79CD\u8F6F\u4EF6\u6574\u5408\u8FDB\u884C\u4EE3\u7801\u626B\u63CF\uFF0C\u6BD4\u5982Maven\uFF0CGradle\uFF0CGit\uFF0CJenkins\u7B49\uFF0C\u5E76\u4E14\u4F1A\u5C06\u4EE3\u7801\u68C0\u6D4B\u7ED3\u679C\u63A8\u9001\u56DESonar Qube\u5E76\u4E14\u5728\u7CFB\u7EDF\u63D0\u4F9B\u7684UI\u754C\u9762\u4E0A\u663E\u793A\u51FA\u6765</p><table><thead><tr><th style="text-align:center;">Sonar Qube\u7684UI\u754C\u9762</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+dn+`" alt="image-20211129190039986" loading="lazy"></td></tr></tbody></table><h4 id="_7-2-sonar-qube\u73AF\u5883\u642D\u5EFA" tabindex="-1"><a class="header-anchor" href="#_7-2-sonar-qube\u73AF\u5883\u642D\u5EFA" aria-hidden="true">#</a> 7.2 Sonar Qube\u73AF\u5883\u642D\u5EFA</h4><h5 id="_7-2-1-sonar-qube\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#_7-2-1-sonar-qube\u5B89\u88C5" aria-hidden="true">#</a> 7.2.1 Sonar Qube\u5B89\u88C5</h5><p>Sonar Qube\u57287.9\u7248\u672C\u4E2D\u5DF2\u7ECF\u653E\u5F03\u4E86\u5BF9MySQL\u7684\u652F\u6301\uFF0C\u5E76\u4E14\u5EFA\u8BAE\u5728\u5546\u4E1A\u73AF\u5883\u4E2D\u91C7\u7528PostgreSQL\uFF0C\u90A3\u4E48\u5B89\u88C5Sonar Qube\u65F6\u9700\u8981\u4F9D\u8D56PostgreSQL\u3002</p><p>\u5E76\u4E14\u8FD9\u91CC\u4F1A\u5B89\u88C5Sonar Qube\u7684\u957F\u671F\u652F\u6301\u7248\u672C<a href="">8.9</a></p><ul><li><p>\u62C9\u53D6\u955C\u50CF</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> pull postgres
<span class="token function">docker</span> pull sonarqube:8.9.6-community
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u7F16\u5199docker-compose.yml</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.1&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">db</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> postgres
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> db
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 5432<span class="token punctuation">:</span><span class="token number">5432</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /etc/localtime<span class="token punctuation">:</span>/etc/localtime
      <span class="token punctuation">-</span> /home/data/sonarqube/postgre/PostgreSqlData<span class="token punctuation">:</span>/var/lib/postgresql/data
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> sonarnet
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">POSTGRES_USER</span><span class="token punctuation">:</span> sonar
      <span class="token key atrule">POSTGRES_PASSWORD</span><span class="token punctuation">:</span> sonar
  <span class="token key atrule">sonarqube</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> sonarqube<span class="token punctuation">:</span>8.9.6<span class="token punctuation">-</span>community
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> sonarqube
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> db
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;9000:9000&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /etc/localtime<span class="token punctuation">:</span>/etc/localtime
      <span class="token punctuation">-</span> /home/data/sonarqube/data<span class="token punctuation">:</span>/opt/sonarqube/data
      <span class="token punctuation">-</span> /home/data/sonarqube/extensions<span class="token punctuation">:</span>/opt/sonarqube/extensions
      <span class="token punctuation">-</span> /home/data/sonarqube/logs<span class="token punctuation">:</span>/opt/sonarqube/logs
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> sonarnet
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">SONAR_JDBC_URL</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>postgresql<span class="token punctuation">:</span>//db<span class="token punctuation">:</span>5432/sonar
      <span class="token key atrule">SONAR_JDBC_USERNAME</span><span class="token punctuation">:</span> sonar
      <span class="token key atrule">SONAR_JDBC_PASSWORD</span><span class="token punctuation">:</span> sonar
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">sonarnet</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u542F\u52A8\u5BB9\u5668</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u9700\u8981\u8BBE\u7F6Esysctl.conf\u6587\u4EF6\u4FE1\u606F</p><table><thead><tr><th style="text-align:center;">\u8BBE\u7F6Evm.max_map_count</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+un+'" alt="image-20211207145215817" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+vn+`" alt="image-20211207145342350" loading="lazy"></td></tr></tbody></table><p>\u5E76\u6267\u884C\u547D\u4EE4\u5237\u65B0</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sysctl -p
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u91CD\u65B0\u542F\u52A8\u9700\u8981\u4E00\u5B9A\u65F6\u95F4\u542F\u52A8\uFF0C\u53EF\u4EE5\u53EF\u4EE5\u67E5\u770B\u5BB9\u5668\u65E5\u5FD7\uFF0C\u770B\u5230\u5982\u4E0B\u5185\u5BB9\u4EE3\u8868\u542F\u52A8\u6210\u529F</p><table><thead><tr><th style="text-align:center;">\u5BB9\u5668\u65E5\u5FD7</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+kn+'" alt="image-20211129191426344" loading="lazy"></td></tr></tbody></table></li><li><p>\u8BBF\u95EESonar Qube\u9996\u9875</p><table><thead><tr><th style="text-align:center;">\u767B\u5F55</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+bn+'" alt="image-20211129191537050" loading="lazy"></td></tr></tbody></table></li><li><p>\u8FD8\u9700\u8981\u91CD\u65B0\u8BBE\u7F6E\u4E00\u6B21\u5BC6\u7801</p><table><thead><tr><th style="text-align:center;">\u91CD\u65B0\u8BBE\u7F6E\u5BC6\u7801</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+mn+'" alt="image-20211129193824428" loading="lazy"></td></tr></tbody></table></li><li><p>Sonar Qube\u9996\u9875</p><table><thead><tr><th style="text-align:center;">Sonar Qube\u9996\u9875</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+gn+'" alt="image-20211129194148239" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_7-2-2-\u5B89\u88C5\u4E2D\u6587\u63D2\u4EF6" tabindex="-1"><a class="header-anchor" href="#_7-2-2-\u5B89\u88C5\u4E2D\u6587\u63D2\u4EF6" aria-hidden="true">#</a> 7.2.2 \u5B89\u88C5\u4E2D\u6587\u63D2\u4EF6</h5><table><thead><tr><th style="text-align:center;">\u5B89\u88C5\u4E2D\u6587\u63D2\u4EF6</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+hn+'" alt="image-20211129194621820" loading="lazy"></td></tr></tbody></table><p>\u5B89\u88C5\u6210\u529F\u540E\u9700\u8981\u91CD\u542F\uFF0C\u5B89\u88C5\u5931\u8D25\u91CD\u65B0\u70B9\u51FBinstall\u91CD\u88C5\u5373\u53EF\u3002</p><p>\u5B89\u88C5\u6210\u529F\u540E\uFF0C\u4F1A\u67E5\u770B\u5230\u91CD\u542F\u6309\u94AE\uFF0C\u70B9\u51FB\u5373\u53EF</p><table><thead><tr><th style="text-align:center;">\u91CD\u542F\u6309\u94AE</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+yn+'" alt="image-20211129194748765" loading="lazy"></td></tr></tbody></table><p>\u91CD\u542F\u540E\u67E5\u770B\u6548\u679C</p><table><thead><tr><th style="text-align:center;">\u9996\u9875\u6548\u679C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+_n+`" alt="image-20211129194931944" loading="lazy"></td></tr></tbody></table><h4 id="_7-3-sonar-qube\u57FA\u672C\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#_7-3-sonar-qube\u57FA\u672C\u4F7F\u7528" aria-hidden="true">#</a> 7.3 Sonar Qube\u57FA\u672C\u4F7F\u7528</h4><p>Sonar Qube\u7684\u4F7F\u7528\u65B9\u5F0F\u5F88\u591A\uFF0CMaven\u53EF\u4EE5\u6574\u5408\uFF0C\u4E5F\u53EF\u4EE5\u91C7\u7528sonar-scanner\u7684\u65B9\u5F0F\uFF0C\u518D\u67E5\u770BSonar Qube\u7684\u68C0\u6D4B\u6548\u679C</p><h5 id="_7-3-1-maven\u5B9E\u73B0\u4EE3\u7801\u68C0\u6D4B" tabindex="-1"><a class="header-anchor" href="#_7-3-1-maven\u5B9E\u73B0\u4EE3\u7801\u68C0\u6D4B" aria-hidden="true">#</a> 7.3.1 Maven\u5B9E\u73B0\u4EE3\u7801\u68C0\u6D4B</h5><ul><li><p>\u4FEE\u6539Maven\u7684settings.xml\u6587\u4EF6\u914D\u7F6ESonar Qube\u4FE1\u606F</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>sonar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activation</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeByDefault</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeByDefault</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activation</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sonar.login</span><span class="token punctuation">&gt;</span></span>admin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sonar.login</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sonar.password</span><span class="token punctuation">&gt;</span></span>123456789<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sonar.password</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sonar.host.url</span><span class="token punctuation">&gt;</span></span>http://192.168.11.11:9000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sonar.host.url</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u5728\u4EE3\u7801\u4F4D\u7F6E\u6267\u884C\u547D\u4EE4\uFF1Amvn sonar:sonar</p><table><thead><tr><th style="text-align:center;">\u6267\u884C\u4EE3\u7801\u68C0\u6D4B</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+xn+'" alt="image-20211129195430146" loading="lazy"></td></tr></tbody></table></li><li><p>\u67E5\u770BSonar Qube\u754C\u9762\u68C0\u6D4B\u7ED3\u679C</p><table><thead><tr><th style="text-align:center;">Sonar Qube\u68C0\u6D4B\u7ED3\u679C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+fn+'" alt="image-20211129195503762" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_7-3-2-sonar-scanner\u5B9E\u73B0\u4EE3\u7801\u68C0\u6D4B" tabindex="-1"><a class="header-anchor" href="#_7-3-2-sonar-scanner\u5B9E\u73B0\u4EE3\u7801\u68C0\u6D4B" aria-hidden="true">#</a> 7.3.2 Sonar-scanner\u5B9E\u73B0\u4EE3\u7801\u68C0\u6D4B</h5>',61),Ja=s("\u4E0B\u8F7DSonar-scanner\uFF1A"),$a={href:"https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/",target:"_blank",rel:"noopener noreferrer"},Pa=s("https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/"),Ea=n("p",null,"\u4E0B\u8F7D4.6.x\u7248\u672C\u5373\u53EF\uFF0C\u8981\u6C42Linux\u7248\u672C",-1),ja=e(`<li><p>\u89E3\u538B\u5E76\u914D\u7F6Esonar\u670D\u52A1\u7AEF\u4FE1\u606F</p><ul><li><p>\u7531\u4E8E\u662Fzip\u538B\u7F29\u5305\uFF0C\u9700\u8981\u5B89\u88C5unzip\u89E3\u538B\u63D2\u4EF6</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum -y <span class="token function">install</span> <span class="token function">unzip</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u89E3\u538B\u538B\u7F29\u5305</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">unzip</span> sonar-scanner-cli/sonar-scanner-cli-4.6.0.2311-linux.zip
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u914D\u7F6EsonarQube\u670D\u52A1\u7AEF\u5730\u5740\uFF0C\u4FEE\u6539conf\u4E0B\u7684sonar-scanner.properties</p><table><thead><tr><th style="text-align:center;">\u914D\u7F6E\u670D\u52A1\u7AEF\u4FE1\u606F</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+Dn+`" alt="image-20211130140043382" loading="lazy"></td></tr></tbody></table></li></ul></li><li><p>\u6267\u884C\u547D\u4EE4\u68C0\u6D4B\u4EE3\u7801</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u5728\u9879\u76EE\u6240\u5728\u76EE\u5F55\u6267\u884C\u4EE5\u4E0B\u547D\u4EE4</span>
~/sonar-scanner/bin/sonar-scanner -Dsonar.sources<span class="token operator">=</span>./ -Dsonar.projectname<span class="token operator">=</span>demo -Dsonar.projectKey<span class="token operator">=</span>java -Dsonar.java.binaries<span class="token operator">=</span>target/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="">Ps\uFF1A\u4E3B\u8981\u67E5\u770B\u6211\u7684sonar-scanner\u6267\u884C\u547D\u4EE4\u7684\u4F4D\u7F6E</a></p><table><thead><tr><th style="text-align:center;">\u67E5\u770B\u65E5\u5FD7\u4FE1\u606F</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+zn+'" alt="image-20211130141303457" loading="lazy"></td></tr></tbody></table></li><li><p>\u67E5\u770BSonarQube\u754C\u9762\u68C0\u6D4B\u7ED3\u679C</p><table><thead><tr><th style="text-align:center;">\u68C0\u6D4B\u7ED3\u679C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Sn+'" alt="image-20211130144608025" loading="lazy"></td></tr></tbody></table></li>',3),qa=e('<h4 id="_7-4-jenkins\u96C6\u6210sonar-qube" tabindex="-1"><a class="header-anchor" href="#_7-4-jenkins\u96C6\u6210sonar-qube" aria-hidden="true">#</a> 7.4 Jenkins\u96C6\u6210Sonar Qube</h4><p>Jenkins\u7EE7\u627FSonar Qube\u5B9E\u73B0\u4EE3\u7801\u626B\u63CF\u9700\u8981\u5148\u4E0B\u8F7D\u6574\u5408\u63D2\u4EF6</p><h5 id="_7-4-1-jenkins\u5B89\u88C5\u63D2\u4EF6" tabindex="-1"><a class="header-anchor" href="#_7-4-1-jenkins\u5B89\u88C5\u63D2\u4EF6" aria-hidden="true">#</a> 7.4.1 Jenkins\u5B89\u88C5\u63D2\u4EF6</h5><table><thead><tr><th style="text-align:center;">\u4E0B\u8F7DSonar Qube\u63D2\u4EF6</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Jn+'" alt="image-20211129201625561" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+$n+'" alt="image-20211129201607240" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+Pn+'" alt="image-20211129202147390" loading="lazy"></td></tr></tbody></table><h5 id="_7-4-2-jenkins\u914D\u7F6Esonar-qube" tabindex="-1"><a class="header-anchor" href="#_7-4-2-jenkins\u914D\u7F6Esonar-qube" aria-hidden="true">#</a> 7.4.2 Jenkins\u914D\u7F6ESonar Qube</h5><ul><li><p>\u5F00\u542FSonar Qube\u6743\u9650\u9A8C\u8BC1</p><table><thead><tr><th style="text-align:center;">\u5F00\u542FSonar Qube\u6743\u9650\u6821\u9A8C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+En+'" alt="image-20211130144850186" loading="lazy"></td></tr></tbody></table></li><li><p>\u83B7\u53D6Sonar Qube\u7684\u4EE4\u724C</p><table><thead><tr><th style="text-align:center;">\u83B7\u53D6\u4EE4\u724C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+jn+'" alt="image-20211129203102334" loading="lazy"></td></tr></tbody></table></li><li><p>\u914D\u7F6EJenkins\u7684Sonar Qube\u4FE1\u606F</p><table><thead><tr><th></th></tr></thead><tbody><tr><td><img src="'+qn+'" alt="image-20211129203235019" loading="lazy"></td></tr><tr><td><img src="'+Nn+'" alt="image-20211129203342171" loading="lazy"></td></tr><tr><td><img src="'+On+'" alt="image-20211129203457604" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_7-4-3-\u914D\u7F6Esonar-scanner" tabindex="-1"><a class="header-anchor" href="#_7-4-3-\u914D\u7F6Esonar-scanner" aria-hidden="true">#</a> 7.4.3 \u914D\u7F6ESonar-scanner</h5><ul><li><p>\u5C06Sonar-scaner\u6DFB\u52A0\u5230Jenkins\u6570\u636E\u5377\u4E2D\u5E76\u914D\u7F6E\u5168\u5C40\u914D\u7F6E</p><table><thead><tr><th style="text-align:center;">\u914D\u7F6ESonar-scanner</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+An+'" alt="image-20211130153628925" loading="lazy"></td></tr></tbody></table></li><li><p>\u914D\u7F6E\u4EFB\u52A1\u7684Sonar-scanner</p><table><thead><tr><th style="text-align:center;">\u914D\u7F6E\u4EFB\u52A1\u7684Sonar-scanner</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Mn+'" alt="image-20211130155849143" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_7-4-4-\u6784\u5EFA\u4EFB\u52A1" tabindex="-1"><a class="header-anchor" href="#_7-4-4-\u6784\u5EFA\u4EFB\u52A1" aria-hidden="true">#</a> 7.4.4 \u6784\u5EFA\u4EFB\u52A1</h5><table><thead><tr><th style="text-align:center;">\u6784\u5EFA\u4EFB\u52A1</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Bn+'" alt="image-20211130160017465" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+Rn+'" alt="image-20211130160047648" loading="lazy"></td></tr></tbody></table><h3 id="\u516B\u3001\u96C6\u6210harbor" tabindex="-1"><a class="header-anchor" href="#\u516B\u3001\u96C6\u6210harbor" aria-hidden="true">#</a> \u516B\u3001\u96C6\u6210Harbor</h3><h4 id="_8-1-harbor\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_8-1-harbor\u4ECB\u7ECD" aria-hidden="true">#</a> 8.1 Harbor\u4ECB\u7ECD</h4><p>\u524D\u9762\u5728\u90E8\u7F72\u9879\u76EE\u65F6\uFF0C\u6211\u4EEC\u4E3B\u8981\u91C7\u7528Jenkins\u63A8\u9001jar\u5305\u5230\u6307\u5B9A\u670D\u52A1\u5668\uFF0C\u518D\u901A\u8FC7\u811A\u672C\u547D\u4EE4\u8BA9\u76EE\u6807\u670D\u52A1\u5668\u5BF9\u5F53\u524Djar\u8FDB\u884C\u90E8\u7F72\uFF0C\u8FD9\u79CD\u65B9\u5F0F\u5728\u9879\u76EE\u8F83\u591A\u65F6\uFF0C\u6BCF\u4E2A\u76EE\u6807\u670D\u52A1\u5668\u90FD\u9700\u8981\u5C06jar\u5305\u5236\u4F5C\u6210\u81EA\u5B9A\u4E49\u955C\u50CF\u518D\u901A\u8FC7docker\u8FDB\u884C\u542F\u52A8\uFF0C\u91CD\u590D\u64CD\u4F5C\u6BD4\u8F83\u591A\uFF0C\u4F1A\u964D\u4F4E\u9879\u76EE\u90E8\u7F72\u65F6\u95F4\u3002</p><p>\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7Harbor\u4F5C\u4E3A\u79C1\u6709\u7684Docker\u955C\u50CF\u4ED3\u5E93\u3002\u8BA9Jenkins\u7EDF\u4E00\u5C06\u9879\u76EE\u6253\u5305\u5E76\u5236\u4F5C\u6210Docker\u955C\u50CF\u53D1\u5E03\u5230Harbor\u4ED3\u5E93\u4E2D\uFF0C\u53EA\u9700\u8981\u901A\u77E5\u76EE\u6807\u670D\u52A1\uFF0C\u8BA9\u76EE\u6807\u670D\u52A1\u7EDF\u4E00\u53BBHarbor\u4ED3\u5E93\u4E0A\u62C9\u53D6\u955C\u50CF\u5E76\u5728\u672C\u5730\u90E8\u7F72\u5373\u53EF\u3002</p><p>Docker\u5B98\u65B9\u63D0\u4F9B\u4E86Registry\u955C\u50CF\u4ED3\u5E93\uFF0C\u4F46\u662FRegistry\u7684\u529F\u80FD\u76F8\u5BF9\u7B80\u964B\u3002Harbor\u662FVMware\u516C\u53F8\u63D0\u4F9B\u7684\u4E00\u6B3E\u955C\u50CF\u4ED3\u5E93\uFF0C\u63D0\u4F9B\u4E86\u6743\u9650\u63A7\u5236\u3001\u5206\u5E03\u5F0F\u53D1\u5E03\u3001\u5F3A\u5927\u7684\u5B89\u5168\u626B\u63CF\u4E0E\u5BA1\u67E5\u673A\u5236\u7B49\u529F\u80FD</p><h4 id="_8-2-harbor\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#_8-2-harbor\u5B89\u88C5" aria-hidden="true">#</a> 8.2 Harbor\u5B89\u88C5</h4><p>\u8FD9\u91CC\u91C7\u7528\u539F\u751F\u7684\u65B9\u5F0F\u5B89\u88C5Harbor\u3002</p>',17),Na=s("\u4E0B\u8F7DHarbor\u5B89\u88C5\u5305\uFF1A"),Oa={href:"https://github.com/goharbor/harbor/releases/download/v2.3.4/harbor-offline-installer-v2.3.4.tgz",target:"_blank",rel:"noopener noreferrer"},Aa=s("https://github.com/goharbor/harbor/releases/download/v2.3.4/harbor-offline-installer-v2.3.4.tgz"),Ma=e(`<li><p>\u62D6\u62FD\u5230Linux\u5E76\u89E3\u538B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>tar -zxvf harbor-offline-installer-v2.3.4.tgz -C /usr/local/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u4FEE\u6539Harbor\u914D\u7F6E\u6587\u4EF6\uFF1A</p><ul><li><p>\u9996\u5148\u590D\u5236\u4E00\u4EFDharbor.yml\u914D\u7F6E</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">cp</span> harbor.yml.tmpl harbor.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u7F16\u8F91harbor.yml\u914D\u7F6E\u6587\u4EF6</p><table><thead><tr><th style="text-align:center;">\u914D\u7F6EHarbor\u6587\u4EF6</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+Cn+`" alt="image-20211130215555218" loading="lazy"></td></tr></tbody></table></li></ul></li><li><p>\u542F\u52A8Harbor</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./install.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">\u67E5\u770B\u65E5\u5FD7</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+Gn+'" alt="image-20211130215941857" loading="lazy"></td></tr></tbody></table></li><li><p>\u767B\u5F55Harbor</p><table><thead><tr><th style="text-align:center;">\u767B\u5F55Harbor</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+wn+'" alt="image-20211130220028840" loading="lazy"></td></tr></tbody></table></li><li><p>\u9996\u9875\u4FE1\u606F</p><table><thead><tr><th style="text-align:center;">\u9996\u9875\u4FE1\u606F</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+In+'" alt="image-20211130220111602" loading="lazy"></td></tr></tbody></table></li>',5),Ba=e('<h4 id="_8-3-harbor\u4F7F\u7528\u65B9\u5F0F" tabindex="-1"><a class="header-anchor" href="#_8-3-harbor\u4F7F\u7528\u65B9\u5F0F" aria-hidden="true">#</a> 8.3 Harbor\u4F7F\u7528\u65B9\u5F0F</h4><p>Harbor\u4F5C\u4E3A\u955C\u50CF\u4ED3\u5E93\uFF0C\u4E3B\u8981\u7684\u4EA4\u4E92\u65B9\u5F0F\u5C31\u662F\u5C06\u955C\u50CF\u4E0A\u4F20\u5230Harbor\u4E0A\uFF0C\u4EE5\u53CA\u4ECEHarbor\u4E0A\u4E0B\u8F7D\u6307\u5B9A\u955C\u50CF</p><p>\u5728\u4F20\u8F93\u955C\u50CF\u524D\uFF0C\u53EF\u4EE5\u5148\u4F7F\u7528Harbor\u63D0\u4F9B\u7684\u6743\u9650\u7BA1\u7406\uFF0C\u5C06\u9879\u76EE\u8BBE\u7F6E\u4E3A\u79C1\u6709\u9879\u76EE\uFF0C\u5E76\u5BF9\u4E0D\u540C\u7528\u6237\u8BBE\u7F6E\u4E0D\u540C\u89D2\u8272\uFF0C\u4ECE\u800C\u66F4\u65B9\u4FBF\u7BA1\u7406\u955C\u50CF\u3002</p><h5 id="_8-3-1-\u6DFB\u52A0\u7528\u6237\u6784\u5EFA\u9879\u76EE" tabindex="-1"><a class="header-anchor" href="#_8-3-1-\u6DFB\u52A0\u7528\u6237\u6784\u5EFA\u9879\u76EE" aria-hidden="true">#</a> 8.3.1 \u6DFB\u52A0\u7528\u6237\u6784\u5EFA\u9879\u76EE</h5><ul><li><p>\u521B\u5EFA\u7528\u6237</p><table><thead><tr><th style="text-align:center;">\u521B\u5EFA\u7528\u6237</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Kn+'" alt="image-20211201213427157" loading="lazy"></td></tr></tbody></table></li><li><p>\u6784\u5EFA\u9879\u76EE\uFF08\u8BBE\u7F6E\u4E3A\u79C1\u6709\uFF09</p><table><thead><tr><th style="text-align:center;">\u6784\u5EFA\u9879\u76EE</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Hn+'" alt="image-20211201213751780" loading="lazy"></td></tr></tbody></table></li><li><p>\u7ED9\u9879\u76EE\u8FFD\u52A0\u7528\u6237</p><table><thead><tr><th style="text-align:center;">\u8FFD\u52A0\u7528\u6237\u7BA1\u7406</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Ln+'" alt="image-20211201213832458" loading="lazy"></td></tr></tbody></table></li><li><p>\u5207\u6362\u6D4B\u8BD5\u7528\u6237</p><table><thead><tr><th style="text-align:center;">\u5207\u6362\u6D4B\u8BD5\u7528\u6237</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Tn+'" alt="image-20211201214008303" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_8-3-2-\u53D1\u5E03\u955C\u50CF\u5230harbor" tabindex="-1"><a class="header-anchor" href="#_8-3-2-\u53D1\u5E03\u955C\u50CF\u5230harbor" aria-hidden="true">#</a> 8.3.2 \u53D1\u5E03\u955C\u50CF\u5230Harbor</h5><ul><li><p>\u4FEE\u6539\u955C\u50CF\u540D\u79F0</p><p>\u540D\u79F0\u8981\u6C42\uFF1A<a href="">harbor\u5730\u5740/\u9879\u76EE\u540D/\u955C\u50CF\u540D:\u7248\u672C</a></p><table><thead><tr><th>\u4FEE\u6539\u955C\u50CF\u540D\u79F0</th></tr></thead><tbody><tr><td><img src="'+Qn+'" alt="image-20211201221040200" loading="lazy"></td></tr></tbody></table></li><li><p>\u4FEE\u6539daemon.json\uFF0C\u652F\u6301Docker\u4ED3\u5E93\uFF0C\u5E76\u91CD\u542FDocker</p><table><thead><tr><th style="text-align:center;">\u4FEE\u6539daemon.json\uFF0C\u652F\u6301Docker\u4ED3\u5E93</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Un+`" alt="image-20211201215931237" loading="lazy"></td></tr></tbody></table></li><li><p>\u8BBE\u7F6E\u767B\u5F55\u4ED3\u5E93\u4FE1\u606F</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> login -u \u7528\u6237\u540D -p \u5BC6\u7801 Harbor\u5730\u5740
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u63A8\u9001\u955C\u50CF\u5230Harbor</p><table><thead><tr><th style="text-align:center;">\u63A8\u9001\u955C\u50CF\u5230Harbor</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+Fn+'" alt="image-20211201221225196" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+Vn+`" alt="image-20211201221300055" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_8-3-3-\u4ECEharbor\u62C9\u53D6\u955C\u50CFls" tabindex="-1"><a class="header-anchor" href="#_8-3-3-\u4ECEharbor\u62C9\u53D6\u955C\u50CFls" aria-hidden="true">#</a> 8.3.3 \u4ECEHarbor\u62C9\u53D6\u955C\u50CFls</h5><p>\u8DDF\u4F20\u7EDF\u65B9\u5F0F\u4E00\u6837\uFF0C\u4E0D\u8FC7\u9700\u8981\u5148\u914D\u7F6E<a href="">/etc/docker/daemon.json</a>\u6587\u4EF6</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
        <span class="token property">&quot;registry-mirrors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://pee6w651.mirror.aliyuncs.com&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;insecure-registries&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.11.11:80&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">\u62C9\u53D6\u955C\u50CF</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+Wn+`" alt="image-20211201222450091" loading="lazy"></td></tr></tbody></table><h5 id="_8-3-4-jenkins\u5BB9\u5668\u4F7F\u7528\u5BBF\u4E3B\u673Adocker" tabindex="-1"><a class="header-anchor" href="#_8-3-4-jenkins\u5BB9\u5668\u4F7F\u7528\u5BBF\u4E3B\u673Adocker" aria-hidden="true">#</a> 8.3.4 Jenkins\u5BB9\u5668\u4F7F\u7528\u5BBF\u4E3B\u673ADocker</h5><p>\u6784\u5EFA\u955C\u50CF\u548C\u53D1\u5E03\u955C\u50CF\u5230harbor\u90FD\u9700\u8981\u4F7F\u7528\u5230docker\u547D\u4EE4\u3002\u800C\u5728Jenkins\u5BB9\u5668\u5185\u90E8\u5B89\u88C5Docker\u5B98\u65B9\u63A8\u8350\u76F4\u63A5\u91C7\u7528\u5BBF\u4E3B\u673A\u5E26\u7684Docker\u5373\u53EF\u3002</p><p>\u8BBE\u7F6EJenkins\u5BB9\u5668\u4F7F\u7528\u5BBF\u4E3B\u673ADocker</p><ul><li><p>\u8BBE\u7F6E\u5BBF\u4E3B\u673Adocker.sock\u6743\u9650\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">chown</span> root:root /var/run/docker.sock
<span class="token function">sudo</span> <span class="token function">chmod</span> o+rw /var/run/docker.sock
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u6DFB\u52A0\u6570\u636E\u5377</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.1&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">jenkins</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> jenkins/jenkins
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> jenkins
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 8080<span class="token punctuation">:</span><span class="token number">8080</span>
      <span class="token punctuation">-</span> 50000<span class="token punctuation">:</span><span class="token number">50000</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./data/<span class="token punctuation">:</span>/var/jenkins_home/
      <span class="token punctuation">-</span> /usr/bin/docker<span class="token punctuation">:</span>/usr/bin/docker
      <span class="token punctuation">-</span> /var/run/docker.sock<span class="token punctuation">:</span>/var/run/docker.sock
      <span class="token punctuation">-</span> /etc/docker/daemon.json<span class="token punctuation">:</span>/etc/docker/daemon.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h5 id="_8-3-5-\u6DFB\u52A0\u6784\u5EFA\u64CD\u4F5C" tabindex="-1"><a class="header-anchor" href="#_8-3-5-\u6DFB\u52A0\u6784\u5EFA\u64CD\u4F5C" aria-hidden="true">#</a> 8.3.5 \u6DFB\u52A0\u6784\u5EFA\u64CD\u4F5C</h5><table><thead><tr><th style="text-align:center;">\u5236\u4F5C\u81EA\u5B9A\u4E49\u955C\u50CF</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+Yn+`" alt="image-20211229155834500" loading="lazy"></td></tr></tbody></table><h5 id="_8-3-6-\u7F16\u5199\u90E8\u7F72\u811A\u672C" tabindex="-1"><a class="header-anchor" href="#_8-3-6-\u7F16\u5199\u90E8\u7F72\u811A\u672C" aria-hidden="true">#</a> 8.3.6 \u7F16\u5199\u90E8\u7F72\u811A\u672C</h5><p>\u90E8\u7F72\u9879\u76EE\u9700\u8981\u901A\u8FC7Publish Over SSH\u63D2\u4EF6\uFF0C\u8BA9\u76EE\u6807\u670D\u52A1\u5668\u6267\u884C\u547D\u4EE4\u3002\u4E3A\u4E86\u65B9\u4FBF\u4E00\u6B21\u6027\u5B9E\u73B0\u62C9\u53D6\u955C\u50CF\u548C\u542F\u52A8\u7684\u547D\u4EE4\uFF0C\u63A8\u8350\u91C7\u7528\u811A\u672C\u6587\u4EF6\u7684\u65B9\u5F0F\u3002</p><p>\u6DFB\u52A0\u811A\u672C\u6587\u4EF6\u5230\u76EE\u6807\u670D\u52A1\u5668\uFF0C\u518D\u901A\u8FC7Publish Over SSH\u63D2\u4EF6\u8BA9\u76EE\u6807\u670D\u52A1\u5668\u6267\u884C\u811A\u672C\u5373\u53EF\u3002</p><ul><li><p>\u7F16\u5199\u811A\u672C\u6587\u4EF6\uFF0C\u6DFB\u52A0\u5230\u76EE\u6807\u670D\u52A1\u5668</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">harbor_url</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token assign-left variable">harbor_project_name</span><span class="token operator">=</span><span class="token variable">$2</span>
<span class="token assign-left variable">project_name</span><span class="token operator">=</span><span class="token variable">$3</span>
<span class="token assign-left variable">tag</span><span class="token operator">=</span><span class="token variable">$4</span>
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token variable">$5</span>

<span class="token assign-left variable">imageName</span><span class="token operator">=</span><span class="token variable">$harbor_url</span>/<span class="token variable">$harbor_project_name</span>/<span class="token variable">$project_name</span><span class="token builtin class-name">:</span><span class="token variable">$tag</span>

<span class="token assign-left variable">containerId</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">docker</span> <span class="token function">ps</span> -a <span class="token operator">|</span> <span class="token function">grep</span> $<span class="token punctuation">{</span>project_name<span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $1}&#39;</span><span class="token variable">\`</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$containerId</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token function">docker</span> stop <span class="token variable">$containerId</span>
    <span class="token function">docker</span> <span class="token function">rm</span> <span class="token variable">$containerId</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Delete Container Success&quot;</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">imageId</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">docker</span> images <span class="token operator">|</span> <span class="token function">grep</span> $<span class="token punctuation">{</span>project_name<span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $3}&#39;</span><span class="token variable">\`</span></span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$imageId</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token function">docker</span> rmi -f <span class="token variable">$imageId</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Delete Image Success&quot;</span>
<span class="token keyword">fi</span>

<span class="token function">docker</span> login -u DevOps -p P@ssw0rd <span class="token variable">$harbor_url</span>

<span class="token function">docker</span> pull <span class="token variable">$imageName</span>

<span class="token function">docker</span> run -d -p <span class="token variable">$port</span><span class="token builtin class-name">:</span><span class="token variable">$port</span> --name <span class="token variable">$project_name</span> <span class="token variable">$imageName</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;Start Container Success&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$project_name</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5E76\u8BBE\u7F6E\u6743\u9650\u4E3A\u53EF\u6267\u884C</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>chmod a+x deploy.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">\u5982\u56FE</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+Xn+'" alt="image-20211203192047357" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_8-3-7-\u914D\u7F6E\u6784\u5EFA\u540E\u64CD\u4F5C" tabindex="-1"><a class="header-anchor" href="#_8-3-7-\u914D\u7F6E\u6784\u5EFA\u540E\u64CD\u4F5C" aria-hidden="true">#</a> 8.3.7 \u914D\u7F6E\u6784\u5EFA\u540E\u64CD\u4F5C</h5><table><thead><tr><th style="text-align:center;">\u6267\u884C\u811A\u672C\u6587\u4EF6</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Zn+'" alt="image-20211229155949038" loading="lazy"></td></tr></tbody></table><h3 id="\u4E5D\u3001jenkins\u6D41\u6C34\u7EBF" tabindex="-1"><a class="header-anchor" href="#\u4E5D\u3001jenkins\u6D41\u6C34\u7EBF" aria-hidden="true">#</a> \u4E5D\u3001Jenkins\u6D41\u6C34\u7EBF</h3><h4 id="_9-1-jenkins\u6D41\u6C34\u7EBF\u4EFB\u52A1\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_9-1-jenkins\u6D41\u6C34\u7EBF\u4EFB\u52A1\u4ECB\u7ECD" aria-hidden="true">#</a> 9.1 Jenkins\u6D41\u6C34\u7EBF\u4EFB\u52A1\u4ECB\u7ECD</h4><p>\u4E4B\u524D\u91C7\u7528Jenkins\u7684\u81EA\u7531\u98CE\u683C\u6784\u5EFA\u7684\u9879\u76EE\uFF0C\u6BCF\u4E2A\u6B65\u9AA4\u6D41\u7A0B\u90FD\u8981\u901A\u8FC7\u4E0D\u540C\u7684\u65B9\u5F0F\u8BBE\u7F6E\uFF0C\u5E76\u4E14\u6784\u5EFA\u8FC7\u7A0B\u4E2D\u6574\u4F53\u6D41\u7A0B\u662F\u4E0D\u53EF\u89C1\u7684\uFF0C\u65E0\u6CD5\u786E\u8BA4\u6BCF\u4E2A\u6D41\u7A0B\u82B1\u8D39\u7684\u65F6\u95F4\uFF0C\u5E76\u4E14\u95EE\u9898\u4E0D\u65B9\u4FBF\u5B9A\u4F4D\u95EE\u9898\u3002</p><p>Jenkins\u7684Pipeline\u53EF\u4EE5\u8BA9\u9879\u76EE\u7684\u53D1\u5E03\u6574\u4F53\u6D41\u7A0B\u53EF\u89C6\u5316\uFF0C\u660E\u786E\u6267\u884C\u7684\u9636\u6BB5\uFF0C\u53EF\u4EE5\u5FEB\u901F\u7684\u5B9A\u4F4D\u95EE\u9898\u3002\u5E76\u4E14\u6574\u4E2A\u9879\u76EE\u7684\u751F\u547D\u5468\u671F\u53EF\u4EE5\u901A\u8FC7\u4E00\u4E2AJenkinsfile\u6587\u4EF6\u7BA1\u7406\uFF0C\u800C\u4E14Jenkinsfile\u6587\u4EF6\u662F\u53EF\u4EE5\u653E\u5728\u9879\u76EE\u4E2D\u7EF4\u62A4\u3002</p><p>\u6240\u4EE5Pipeline\u76F8\u5BF9\u81EA\u7531\u98CE\u683C\u6216\u8005\u5176\u4ED6\u7684\u9879\u76EE\u98CE\u683C\u66F4\u5BB9\u6613\u64CD\u4F5C\u3002</p><h4 id="_9-2-jenkins\u6D41\u6C34\u7EBF\u4EFB\u52A1" tabindex="-1"><a class="header-anchor" href="#_9-2-jenkins\u6D41\u6C34\u7EBF\u4EFB\u52A1" aria-hidden="true">#</a> 9.2 Jenkins\u6D41\u6C34\u7EBF\u4EFB\u52A1</h4><h5 id="_9-2-1-\u6784\u5EFAjenkins\u6D41\u6C34\u7EBF\u4EFB\u52A1" tabindex="-1"><a class="header-anchor" href="#_9-2-1-\u6784\u5EFAjenkins\u6D41\u6C34\u7EBF\u4EFB\u52A1" aria-hidden="true">#</a> 9.2.1 \u6784\u5EFAJenkins\u6D41\u6C34\u7EBF\u4EFB\u52A1</h5><ul><li><p>\u6784\u5EFA\u4EFB\u52A1</p><table><thead><tr><th>\u6784\u5EFAJenkins\u6D41\u6C34\u7EBF\u4EFB\u52A1</th></tr></thead><tbody><tr><td><img src="'+ns+'" alt="image-20211202144429302" loading="lazy"></td></tr></tbody></table></li><li><p>\u751F\u6210Groovy\u811A\u672C</p><table><thead><tr><th style="text-align:center;">Hello World\u811A\u672C\u751F\u6210</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+ss+'" alt="image-20211202144531749" loading="lazy"></td></tr></tbody></table></li><li><p>\u6784\u5EFA\u540E\u67E5\u770B\u89C6\u56FE</p><table><thead><tr><th style="text-align:center;">\u6784\u5EFA\u540E\u67E5\u770B\u89C6\u56FE</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+as+`" alt="image-20211202144616117" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_9-2-2-groovy\u811A\u672C" tabindex="-1"><a class="header-anchor" href="#_9-2-2-groovy\u811A\u672C" aria-hidden="true">#</a> 9.2.2 Groovy\u811A\u672C</h5><ul><li><p>Groovy\u811A\u672C\u57FA\u7840\u8BED\u6CD5</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>// \u6240\u6709\u811A\u672C\u547D\u4EE4\u5305\u542B\u5728pipeline<span class="token punctuation">{</span><span class="token punctuation">}</span>\u4E2D
pipeline <span class="token punctuation">{</span>  
	// \u6307\u5B9A\u4EFB\u52A1\u5728\u54EA\u4E2A\u8282\u70B9\u6267\u884C\uFF08Jenkins\u652F\u6301\u5206\u5E03\u5F0F\uFF09
    agent any
    
    // \u914D\u7F6E\u5168\u5C40\u73AF\u5883\uFF0C\u6307\u5B9A\u53D8\u91CF\u540D<span class="token operator">=</span>\u53D8\u91CF\u503C\u4FE1\u606F
    environment<span class="token punctuation">{</span>
    	<span class="token function">host</span> <span class="token operator">=</span> <span class="token string">&#39;192.168.11.11&#39;</span>
    <span class="token punctuation">}</span>

    // \u5B58\u653E\u6240\u6709\u4EFB\u52A1\u7684\u5408\u96C6
    stages <span class="token punctuation">{</span>
    	// \u5355\u4E2A\u4EFB\u52A1
        stage<span class="token punctuation">(</span><span class="token string">&#39;\u4EFB\u52A11&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	// \u5B9E\u73B0\u4EFB\u52A1\u7684\u5177\u4F53\u6D41\u7A0B
            steps <span class="token punctuation">{</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&#39;do something&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
		// \u5355\u4E2A\u4EFB\u52A1
        stage<span class="token punctuation">(</span><span class="token string">&#39;\u4EFB\u52A12&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	// \u5B9E\u73B0\u4EFB\u52A1\u7684\u5177\u4F53\u6D41\u7A0B
            steps <span class="token punctuation">{</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&#39;do something&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        // \u2026\u2026
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u7F16\u5199\u4F8B\u5B50\u6D4B\u8BD5</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>pipeline <span class="token punctuation">{</span>
    agent any

    // \u5B58\u653E\u6240\u6709\u4EFB\u52A1\u7684\u5408\u96C6
    stages <span class="token punctuation">{</span>
        stage<span class="token punctuation">(</span><span class="token string">&#39;\u62C9\u53D6Git\u4EE3\u7801&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&#39;\u62C9\u53D6Git\u4EE3\u7801&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;\u68C0\u6D4B\u4EE3\u7801\u8D28\u91CF&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&#39;\u68C0\u6D4B\u4EE3\u7801\u8D28\u91CF&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;\u6784\u5EFA\u4EE3\u7801&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&#39;\u6784\u5EFA\u4EE3\u7801&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;\u5236\u4F5C\u81EA\u5B9A\u4E49\u955C\u50CF\u5E76\u53D1\u5E03Harbor&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&#39;\u5236\u4F5C\u81EA\u5B9A\u4E49\u955C\u50CF\u5E76\u53D1\u5E03Harbor&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;\u57FA\u4E8EHarbor\u90E8\u7F72\u5DE5\u7A0B&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&#39;\u57FA\u4E8EHarbor\u90E8\u7F72\u5DE5\u7A0B&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">\u914D\u7F6EGrovvy\u811A\u672C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+es+'" alt="image-20211202145155428" loading="lazy"></td></tr></tbody></table></li><li><p>\u67E5\u770B\u6548\u679C</p><table><thead><tr><th style="text-align:center;">\u67E5\u770B\u6548\u679C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+ts+'" alt="image-20211202145240166" loading="lazy"></td></tr></tbody></table></li></ul><p><a href="">Ps\uFF1A\u6D89\u53CA\u5230\u7279\u5B9A\u811A\u672C\uFF0CJenkins\u7ED9\u4E88\u4E86\u5145\u8DB3\u7684\u63D0\u793A\uFF0C\u53EF\u4EE5\u81EA\u52A8\u751F\u6210\u547D\u4EE4</a></p><table><thead><tr><th style="text-align:center;">\u751F\u6210\u547D\u4EE4\u4F4D\u7F6E</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+ls+'" alt="image-20211202145349043" loading="lazy"></td></tr></tbody></table><h5 id="_9-2-3-jenkinsfile\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_9-2-3-jenkinsfile\u5B9E\u73B0" aria-hidden="true">#</a> 9.2.3 Jenkinsfile\u5B9E\u73B0</h5><p>Jenkinsfile\u65B9\u5F0F\u9700\u8981\u5C06\u811A\u672C\u5185\u5BB9\u7F16\u5199\u5230\u9879\u76EE\u4E2D\u7684Jenkinsfile\u6587\u4EF6\u4E2D\uFF0C\u6BCF\u6B21\u6784\u5EFA\u4F1A\u81EA\u52A8\u62C9\u53D6\u9879\u76EE\u5E76\u4E14\u83B7\u53D6\u9879\u76EE\u4E2DJenkinsfile\u6587\u4EF6\u5BF9\u9879\u76EE\u8FDB\u884C\u6784\u5EFA</p><ul><li><p>\u914D\u7F6Epipeline</p><table><thead><tr><th style="text-align:center;">\u914D\u7F6Epipeline</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+is+'" alt="image-20211202151127254" loading="lazy"></td></tr></tbody></table></li><li><p>\u51C6\u5907Jenkinsfile</p><table><thead><tr><th style="text-align:center;">\u51C6\u5907Jenkinsfile\u6587\u4EF6</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+ps+'" alt="image-20211202151155145" loading="lazy"></td></tr></tbody></table></li><li><p>\u6D4B\u8BD5\u6548\u679C</p><table><thead><tr><th style="text-align:center;">\u6D4B\u8BD5\u6548\u679C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+cs+'" alt="image-20211202151225161" loading="lazy"></td></tr></tbody></table></li></ul><h4 id="_9-3-jenkins\u6D41\u6C34\u7EBF\u4EFB\u52A1\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_9-3-jenkins\u6D41\u6C34\u7EBF\u4EFB\u52A1\u5B9E\u73B0" aria-hidden="true">#</a> 9.3 Jenkins\u6D41\u6C34\u7EBF\u4EFB\u52A1\u5B9E\u73B0</h4><h5 id="_9-3-1-\u53C2\u6570\u5316\u6784\u5EFA" tabindex="-1"><a class="header-anchor" href="#_9-3-1-\u53C2\u6570\u5316\u6784\u5EFA" aria-hidden="true">#</a> 9.3.1 \u53C2\u6570\u5316\u6784\u5EFA</h5><p>\u6DFB\u52A0\u53C2\u6570\u5316\u6784\u5EFA\uFF0C\u65B9\u4FBF\u9009\u62E9\u4E0D\u7684\u9879\u76EE\u7248\u672C</p><table><thead><tr><th style="text-align:center;">Git\u53C2\u6570\u5316\u6784\u5EFA</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+os+'" alt="image-20211202191944277" loading="lazy"></td></tr></tbody></table><h5 id="_9-3-2-\u62C9\u53D6git\u4EE3\u7801" tabindex="-1"><a class="header-anchor" href="#_9-3-2-\u62C9\u53D6git\u4EE3\u7801" aria-hidden="true">#</a> 9.3.2 \u62C9\u53D6Git\u4EE3\u7801</h5><p>\u901A\u8FC7\u6D41\u6C34\u7EBF\u8BED\u6CD5\u751F\u6210Checkout\u4EE3\u7801\u7684\u811A\u672C</p><table><thead><tr><th style="text-align:center;">\u8BED\u6CD5\u751F\u6210</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+rs+'" alt="image-20211202192047619" loading="lazy"></td></tr></tbody></table><p><img src="'+ds+`" alt="image-20211202192129895" loading="lazy">\u5C06*/master\u66F4\u6539\u4E3A\u6807\u7B7E<a href="">\${tag}</a></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>pipeline <span class="token punctuation">{</span>
    agent any
    stages <span class="token punctuation">{</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;\u62C9\u53D6Git\u4EE3\u7801&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                checkout<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$class</span><span class="token builtin class-name">:</span> <span class="token string">&#39;GitSCM&#39;</span>, branches: <span class="token punctuation">[</span><span class="token punctuation">[</span>name: <span class="token string">&#39;\${tag}&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>, extensions: <span class="token punctuation">[</span><span class="token punctuation">]</span>, userRemoteConfigs: <span class="token punctuation">[</span><span class="token punctuation">[</span>url: <span class="token string">&#39;http://49.233.115.171:8929/root/test.git&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_9-3-3-\u6784\u5EFA\u4EE3\u7801" tabindex="-1"><a class="header-anchor" href="#_9-3-3-\u6784\u5EFA\u4EE3\u7801" aria-hidden="true">#</a> 9.3.3 \u6784\u5EFA\u4EE3\u7801</h5><p>\u901A\u8FC7\u811A\u672C\u6267\u884Cmvn\u7684\u6784\u5EFA\u547D\u4EE4</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>pipeline <span class="token punctuation">{</span>
    agent any

    stages <span class="token punctuation">{</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;\u62C9\u53D6Git\u4EE3\u7801&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                checkout<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$class</span><span class="token builtin class-name">:</span> <span class="token string">&#39;GitSCM&#39;</span>, branches: <span class="token punctuation">[</span><span class="token punctuation">[</span>name: <span class="token string">&#39;\${tag}&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>, extensions: <span class="token punctuation">[</span><span class="token punctuation">]</span>, userRemoteConfigs: <span class="token punctuation">[</span><span class="token punctuation">[</span>url: <span class="token string">&#39;http://49.233.115.171:8929/root/test.git&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;\u6784\u5EFA\u4EE3\u7801&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_9-3-4-\u4EE3\u7801\u8D28\u91CF\u68C0\u6D4B" tabindex="-1"><a class="header-anchor" href="#_9-3-4-\u4EE3\u7801\u8D28\u91CF\u68C0\u6D4B" aria-hidden="true">#</a> 9.3.4 \u4EE3\u7801\u8D28\u91CF\u68C0\u6D4B</h5><p>\u901A\u8FC7\u811A\u672C\u6267\u884Csonar-scanner\u547D\u4EE4\u5373\u53EF</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>pipeline <span class="token punctuation">{</span>
    agent any

    stages <span class="token punctuation">{</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;\u62C9\u53D6Git\u4EE3\u7801&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                checkout<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$class</span><span class="token builtin class-name">:</span> <span class="token string">&#39;GitSCM&#39;</span>, branches: <span class="token punctuation">[</span><span class="token punctuation">[</span>name: <span class="token string">&#39;\${tag}&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>, extensions: <span class="token punctuation">[</span><span class="token punctuation">]</span>, userRemoteConfigs: <span class="token punctuation">[</span><span class="token punctuation">[</span>url: <span class="token string">&#39;http://49.233.115.171:8929/root/test.git&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;\u6784\u5EFA\u4EE3\u7801&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;\u68C0\u6D4B\u4EE3\u7801\u8D28\u91CF&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;/var/jenkins_home/sonar-scanner/bin/sonar-scanner -Dsonar.sources=./ -Dsonar.projectname=\${JOB_NAME} -Dsonar.projectKey=\${JOB_NAME} -Dsonar.java.binaries=target/ -Dsonar.login=31388be45653876c1f51ec02f0d478e2d9d0e1fa&#39;</span> 
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_9-3-5-\u5236\u4F5C\u81EA\u5B9A\u4E49\u955C\u50CF\u5E76\u53D1\u5E03" tabindex="-1"><a class="header-anchor" href="#_9-3-5-\u5236\u4F5C\u81EA\u5B9A\u4E49\u955C\u50CF\u5E76\u53D1\u5E03" aria-hidden="true">#</a> 9.3.5 \u5236\u4F5C\u81EA\u5B9A\u4E49\u955C\u50CF\u5E76\u53D1\u5E03</h5><ul><li><p>\u751F\u6210\u81EA\u5B9A\u4E49\u955C\u50CF\u811A\u672C</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>pipeline <span class="token punctuation">{</span>
    agent any
    environment<span class="token punctuation">{</span>
        harborHost <span class="token operator">=</span> <span class="token string">&#39;192.168.11.11:80&#39;</span>
        harborRepo <span class="token operator">=</span> <span class="token string">&#39;repository&#39;</span>
        harborUser <span class="token operator">=</span> <span class="token string">&#39;DevOps&#39;</span>
        harborPasswd <span class="token operator">=</span> <span class="token string">&#39;P@ssw0rd&#39;</span>
    <span class="token punctuation">}</span>

    // \u5B58\u653E\u6240\u6709\u4EFB\u52A1\u7684\u5408\u96C6
    stages <span class="token punctuation">{</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;\u62C9\u53D6Git\u4EE3\u7801&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                checkout<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$class</span><span class="token builtin class-name">:</span> <span class="token string">&#39;GitSCM&#39;</span>, branches: <span class="token punctuation">[</span><span class="token punctuation">[</span>name: <span class="token string">&#39;\${tag}&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>, extensions: <span class="token punctuation">[</span><span class="token punctuation">]</span>, userRemoteConfigs: <span class="token punctuation">[</span><span class="token punctuation">[</span>url: <span class="token string">&#39;http://49.233.115.171:8929/root/test.git&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;\u6784\u5EFA\u4EE3\u7801&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;\u68C0\u6D4B\u4EE3\u7801\u8D28\u91CF&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;/var/jenkins_home/sonar-scanner/bin/sonar-scanner -Dsonar.sources=./ -Dsonar.projectname=\${JOB_NAME} -Dsonar.projectKey=\${JOB_NAME} -Dsonar.java.binaries=target/ -Dsonar.login=31388be45653876c1f51ec02f0d478e2d9d0e1fa&#39;</span> 
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;\u5236\u4F5C\u81EA\u5B9A\u4E49\u955C\u50CF\u5E76\u53D1\u5E03Harbor&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;&#39;</span>&#39;cp ./target/*.jar ./docker/
                <span class="token builtin class-name">cd</span> ./docker
                <span class="token function">docker</span> build -t <span class="token variable">\${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">\${tag}</span> ./<span class="token string">&#39;&#39;</span>&#39;

                <span class="token function">sh</span> <span class="token string">&#39;&#39;</span>&#39;docker login -u <span class="token variable">\${harborUser}</span> -p <span class="token variable">\${harborPasswd}</span> <span class="token variable">\${harborHost}</span>
                <span class="token function">docker</span> tag <span class="token variable">\${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">\${tag}</span> <span class="token variable">\${harborHost}</span>/<span class="token variable">\${harborRepo}</span>/<span class="token variable">\${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">\${tag}</span>
                <span class="token function">docker</span> push <span class="token variable">\${harborHost}</span>/<span class="token variable">\${harborRepo}</span>/<span class="token variable">\${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">\${tag}</span><span class="token string">&#39;&#39;</span>&#39;
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u751F\u6210Publish Over SSH\u811A\u672C</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>pipeline <span class="token punctuation">{</span>
    agent any
    environment<span class="token punctuation">{</span>
        harborHost <span class="token operator">=</span> <span class="token string">&#39;192.168.11.11:80&#39;</span>
        harborRepo <span class="token operator">=</span> <span class="token string">&#39;repository&#39;</span>
        harborUser <span class="token operator">=</span> <span class="token string">&#39;DevOps&#39;</span>
        harborPasswd <span class="token operator">=</span> <span class="token string">&#39;P@ssw0rd&#39;</span>
    <span class="token punctuation">}</span>

    // \u5B58\u653E\u6240\u6709\u4EFB\u52A1\u7684\u5408\u96C6
    stages <span class="token punctuation">{</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;\u62C9\u53D6Git\u4EE3\u7801&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                checkout<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$class</span><span class="token builtin class-name">:</span> <span class="token string">&#39;GitSCM&#39;</span>, branches: <span class="token punctuation">[</span><span class="token punctuation">[</span>name: <span class="token string">&#39;\${tag}&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>, extensions: <span class="token punctuation">[</span><span class="token punctuation">]</span>, userRemoteConfigs: <span class="token punctuation">[</span><span class="token punctuation">[</span>url: <span class="token string">&#39;http://49.233.115.171:8929/root/test.git&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;\u6784\u5EFA\u4EE3\u7801&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>docker

        stage<span class="token punctuation">(</span><span class="token string">&#39;\u68C0\u6D4B\u4EE3\u7801\u8D28\u91CF&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;/var/jenkins_home/sonar-scanner/bin/sonar-scanner -Dsonar.sources=./ -Dsonar.projectname=\${JOB_NAME} -Dsonar.projectKey=\${JOB_NAME} -Dsonar.java.binaries=target/ -Dsonar.login=7d66af4b39cfe4f52ac0a915d4c9d5c513207098&#39;</span> 
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;\u5236\u4F5C\u81EA\u5B9A\u4E49\u955C\u50CF\u5E76\u53D1\u5E03Harbor&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;&#39;</span>&#39;cp ./target/*.jar ./docker/
                <span class="token builtin class-name">cd</span> ./docker
                <span class="token function">docker</span> build -t <span class="token variable">\${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">\${tag}</span> ./<span class="token string">&#39;&#39;</span>&#39;

                <span class="token function">sh</span> <span class="token string">&#39;&#39;</span>&#39;docker login -u <span class="token variable">\${harborUser}</span> -p <span class="token variable">\${harborPasswd}</span> <span class="token variable">\${harborHost}</span>
                <span class="token function">docker</span> tag <span class="token variable">\${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">\${tag}</span> <span class="token variable">\${harborHost}</span>/<span class="token variable">\${harborRepo}</span>/<span class="token variable">\${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">\${tag}</span>
                <span class="token function">docker</span> push <span class="token variable">\${harborHost}</span>/<span class="token variable">\${harborRepo}</span>/<span class="token variable">\${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">\${tag}</span><span class="token string">&#39;&#39;</span>&#39;
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        
        stage<span class="token punctuation">(</span><span class="token string">&#39;\u76EE\u6807\u670D\u52A1\u5668\u62C9\u53D6\u955C\u50CF\u5E76\u8FD0\u884C&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                sshPublisher<span class="token punctuation">(</span>publishers: <span class="token punctuation">[</span>sshPublisherDesc<span class="token punctuation">(</span>configName: <span class="token string">&#39;testEnvironment&#39;</span>, transfers: <span class="token punctuation">[</span>sshTransfer<span class="token punctuation">(</span>cleanRemote: false, excludes: <span class="token string">&#39;&#39;</span>, execCommand: <span class="token string">&quot;/usr/bin/deploy.sh <span class="token variable">$harborHost</span> <span class="token variable">$harborRepo</span> <span class="token variable">$JOB_NAME</span> <span class="token variable">$tag</span> <span class="token variable">$port</span> &quot;</span>, execTimeout: <span class="token number">120000</span>, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: <span class="token string">&#39;[, ]+&#39;</span>, remoteDirectory: <span class="token string">&#39;&#39;</span>, remoteDirectorySDF: false, removePrefix: <span class="token string">&#39;&#39;</span>, sourceFiles: <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>, usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p><a href="">Ps\uFF1A\u7531\u4E8E\u91C7\u7528\u53D8\u91CF\uFF0C\u8BB0\u5F97\u4F7F\u7528\u53CC\u5F15\u53F7</a></p><h4 id="_9-4-jenkins\u6D41\u6C34\u7EBF\u6574\u5408\u9489\u9489" tabindex="-1"><a class="header-anchor" href="#_9-4-jenkins\u6D41\u6C34\u7EBF\u6574\u5408\u9489\u9489" aria-hidden="true">#</a> 9.4 Jenkins\u6D41\u6C34\u7EBF\u6574\u5408\u9489\u9489</h4><p>\u5728\u7A0B\u5E8F\u90E8\u7F72\u6210\u529F\u540E\uFF0C\u53EF\u4EE5\u901A\u8FC7\u9489\u9489\u7684\u673A\u5668\u4EBA\u53CA\u65F6\u5411\u7FA4\u4F17\u53D1\u9001\u90E8\u7F72\u7684\u6700\u7EC8\u7ED3\u679C\u901A\u77E5</p><ul><li><p>\u5B89\u88C5\u63D2\u4EF6</p><table><thead><tr><th style="text-align:center;">\u5B89\u88C5\u63D2\u4EF6</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+us+'" alt="image-20211209151549412" loading="lazy"></td></tr></tbody></table></li><li><p>\u9489\u9489\u5185\u90E8\u521B\u5EFA\u7FA4\u7EC4\u5E76\u6784\u5EFA\u673A\u5668\u4EBA</p><table><thead><tr><th style="text-align:center;">\u9489\u9489\u5185\u90E8\u521B\u5EFA\u7FA4\u7EC4\u5E76\u6784\u5EFA\u673A\u5668\u4EBA</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+vs+'" alt="image-20211209152217433" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+ks+'" alt="image-20211209152252050" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+bs+`" alt="image-20211209152403312" loading="lazy"></td></tr></tbody></table><p>\u6700\u7EC8\u6216\u83B7\u53D6\u5230Webhook\u4FE1\u606F</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>https://oapi.dingtalk.com/robot/send?access_token=kej4ehkj34gjhg34jh5bh5jb34hj53b4
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u7CFB\u7EDF\u914D\u7F6E\u6DFB\u52A0\u9489\u9489\u901A\u77E5</p><table><thead><tr><th style="text-align:center;">\u914D\u7F6E\u9489\u9489\u901A\u77E5</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+ms+`" alt="image-20211209162923440" loading="lazy"></td></tr></tbody></table></li><li><p>\u4EFB\u52A1\u4E2D\u8FFD\u52A0\u6D41\u6C34\u7EBF\u914D\u7F6E</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>pipeline <span class="token punctuation">{</span>
    agent any

    environment <span class="token punctuation">{</span>
        sonarLogin <span class="token operator">=</span> <span class="token string">&#39;2bab7bf7d5af25e2c2ca2f178af2c3c55c64d5d8&#39;</span>
        harborUser <span class="token operator">=</span> <span class="token string">&#39;admin&#39;</span>
        harborPassword <span class="token operator">=</span> <span class="token string">&#39;Harbor12345&#39;</span>
        harborHost <span class="token operator">=</span> <span class="token string">&#39;192.168.11.12:8888&#39;</span>
        harborRepo <span class="token operator">=</span> <span class="token string">&#39;repository&#39;</span>
    <span class="token punctuation">}</span>

    stages <span class="token punctuation">{</span>
        stage<span class="token punctuation">(</span><span class="token string">&#39;\u62C9\u53D6Git\u4EE3\u7801&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                checkout<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$class</span><span class="token builtin class-name">:</span> <span class="token string">&#39;GitSCM&#39;</span>, branches: <span class="token punctuation">[</span><span class="token punctuation">[</span>name: <span class="token string">&#39;$tag&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>, extensions: <span class="token punctuation">[</span><span class="token punctuation">]</span>, userRemoteConfigs: <span class="token punctuation">[</span><span class="token punctuation">[</span>url: <span class="token string">&#39;http://49.233.115.171:8929/root/lsx.git&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        stage<span class="token punctuation">(</span><span class="token string">&#39;Maven\u6784\u5EFA\u4EE3\u7801&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        stage<span class="token punctuation">(</span><span class="token string">&#39;SonarQube\u68C0\u6D4B\u4EE3\u7801&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;/var/jenkins_home/sonar-scanner/bin/sonar-scanner -Dsonar.sources=./ -Dsonar.projectname=\${JOB_NAME} -Dsonar.projectKey=\${JOB_NAME} -Dsonar.java.binaries=target/ -Dsonar.login=\${sonarLogin}&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        stage<span class="token punctuation">(</span><span class="token string">&#39;\u5236\u4F5C\u81EA\u5B9A\u4E49\u955C\u50CF&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;&#39;</span>&#39;cd <span class="token function">docker</span>
                <span class="token function">mv</span> <span class="token punctuation">..</span>/target/*.jar ./
                <span class="token function">docker</span> build -t <span class="token variable">\${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">$tag</span> <span class="token builtin class-name">.</span>
                <span class="token string">&#39;&#39;</span>&#39;
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;\u63A8\u9001\u81EA\u5B9A\u4E49\u955C\u50CF&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;&#39;</span>&#39;docker login -u <span class="token variable">\${harborUser}</span> -p <span class="token variable">\${harborPassword}</span> <span class="token variable">\${harborHost}</span>
                <span class="token function">docker</span> tag <span class="token variable">\${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">$tag</span> <span class="token variable">\${harborHost}</span>/<span class="token variable">\${harborRepo}</span>/<span class="token variable">\${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">$tag</span>
                <span class="token function">docker</span> push <span class="token variable">\${harborHost}</span>/<span class="token variable">\${harborRepo}</span>/<span class="token variable">\${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">$tag</span><span class="token string">&#39;&#39;</span>&#39;
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;\u901A\u77E5\u76EE\u6807\u670D\u52A1\u5668&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                sshPublisher<span class="token punctuation">(</span>publishers: <span class="token punctuation">[</span>sshPublisherDesc<span class="token punctuation">(</span>configName: <span class="token string">&#39;centos-docker&#39;</span>, transfers: <span class="token punctuation">[</span>sshTransfer<span class="token punctuation">(</span>cleanRemote: false, excludes: <span class="token string">&#39;&#39;</span>, execCommand: <span class="token string">&quot;/usr/bin/deploy.sh <span class="token variable">$harborHost</span> <span class="token variable">$harborRepo</span> <span class="token variable">$JOB_NAME</span> <span class="token variable">$tag</span> <span class="token variable">$port</span>&quot;</span>, execTimeout: <span class="token number">120000</span>, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: <span class="token string">&#39;[, ]+&#39;</span>, remoteDirectory: <span class="token string">&#39;&#39;</span>, remoteDirectorySDF: false, removePrefix: <span class="token string">&#39;&#39;</span>, sourceFiles: <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>, usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>  
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    post <span class="token punctuation">{</span>
        success <span class="token punctuation">{</span>
            dingtalk <span class="token punctuation">(</span>
                robot: <span class="token string">&#39;Jenkins-DingDing&#39;</span>,
                type:<span class="token string">&#39;MARKDOWN&#39;</span>,
                title: <span class="token string">&quot;success: <span class="token variable">\${JOB_NAME}</span>&quot;</span>,
                text: <span class="token punctuation">[</span><span class="token string">&quot;- \u6210\u529F\u6784\u5EFA:<span class="token variable">\${JOB_NAME}</span>\u9879\u76EE!<span class="token entity" title="\\n">\\n</span>- \u7248\u672C:<span class="token variable">\${tag}</span><span class="token entity" title="\\n">\\n</span>- \u6301\u7EED\u65F6\u95F4:<span class="token variable">\${currentBuild.durationString}</span><span class="token entity" title="\\n">\\n</span>- \u4EFB\u52A1:#<span class="token variable">\${JOB_NAME}</span>&quot;</span><span class="token punctuation">]</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        failure <span class="token punctuation">{</span>
            dingtalk <span class="token punctuation">(</span>
                robot: <span class="token string">&#39;Jenkins-DingDing&#39;</span>,
                type:<span class="token string">&#39;MARKDOWN&#39;</span>,
                title: <span class="token string">&quot;fail: <span class="token variable">\${JOB_NAME}</span>&quot;</span>,
                text: <span class="token punctuation">[</span><span class="token string">&quot;- \u5931\u8D25\u6784\u5EFA:<span class="token variable">\${JOB_NAME}</span>\u9879\u76EE!<span class="token entity" title="\\n">\\n</span>- \u7248\u672C:<span class="token variable">\${tag}</span><span class="token entity" title="\\n">\\n</span>- \u6301\u7EED\u65F6\u95F4:<span class="token variable">\${currentBuild.durationString}</span><span class="token entity" title="\\n">\\n</span>- \u4EFB\u52A1:#<span class="token variable">\${JOB_NAME}</span>&quot;</span><span class="token punctuation">]</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u67E5\u770B\u6548\u679C</p><table><thead><tr><th style="text-align:center;">\u9489\u9489\u901A\u77E5\u6548\u679C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+gs+'" alt="image-20211209163021396" loading="lazy"></td></tr></tbody></table></li></ul><h3 id="\u5341\u3001kubernetes\u7F16\u6392\u5DE5\u5177" tabindex="-1"><a class="header-anchor" href="#\u5341\u3001kubernetes\u7F16\u6392\u5DE5\u5177" aria-hidden="true">#</a> \u5341\u3001Kubernetes\u7F16\u6392\u5DE5\u5177</h3><h4 id="_10-1-kubernetes\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#_10-1-kubernetes\u4ECB\u7ECD" aria-hidden="true">#</a> 10.1 Kubernetes\u4ECB\u7ECD</h4><p>Kubernetes\u662F\u4E00\u4E2A\u5F00\u6E90\u7684\uFF0C\u7528\u4E8E\u7BA1\u7406\u4E91\u5E73\u53F0\u4E2D\u591A\u4E2A\u4E3B\u673A\u4E0A\u7684\u5BB9\u5668\u5316\u7684\u5E94\u7528\uFF0CKubernetes\u7684\u76EE\u6807\u662F\u8BA9\u90E8\u7F72\u5BB9\u5668\u5316\u7684\u5E94\u7528\u7B80\u5355\u5E76\u4E14\u9AD8\u6548\uFF08powerful\uFF09\uFF0CKubernetes\u63D0\u4F9B\u4E86\u5E94\u7528\u90E8\u7F72\uFF0C\u89C4\u5212\uFF0C\u66F4\u65B0\uFF0C\u7EF4\u62A4\u7684\u4E00\u79CD\u673A\u5236\u3002</p><p>Kubernetes\u4E00\u4E2A\u6838\u5FC3\u7684\u7279\u70B9\u5C31\u662F\u80FD\u591F\u81EA\u4E3B\u7684\u7BA1\u7406\u5BB9\u5668\u6765\u4FDD\u8BC1\u4E91\u5E73\u53F0\u4E2D\u7684\u5BB9\u5668\u6309\u7167\u7528\u6237\u7684\u671F\u671B\u72B6\u6001\u8FD0\u884C\u7740\uFF0C\u7BA1\u7406\u5458\u53EF\u4EE5\u52A0\u8F7D\u4E00\u4E2A\u5FAE\u578B\u670D\u52A1\uFF0C\u8BA9\u89C4\u5212\u5668\u6765\u627E\u5230\u5408\u9002\u7684\u4F4D\u7F6E\uFF0C\u540C\u65F6\uFF0CKubernetes\u4E5F\u7CFB\u7EDF\u63D0\u5347\u5DE5\u5177\u4EE5\u53CA\u4EBA\u6027\u5316\u65B9\u9762\uFF0C\u8BA9\u7528\u6237\u80FD\u591F\u65B9\u4FBF\u7684\u90E8\u7F72\u81EA\u5DF1\u7684\u5E94\u7528\u3002</p><p>Kubernetes\u4E3B\u8981\u80FD\u5E2E\u52A9\u6211\u4EEC\u5B8C\u6210\uFF1A</p><ul><li><p>\u670D\u52A1\u53D1\u73B0\u548C\u8D1F\u8F7D\u5747\u8861</p><p>Kubernetes \u53EF\u4EE5\u4F7F\u7528 DNS \u540D\u79F0\u6216\u81EA\u5DF1\u7684 IP \u5730\u5740\u516C\u5F00\u5BB9\u5668\uFF0C\u5982\u679C\u8FDB\u5165\u5BB9\u5668\u7684\u6D41\u91CF\u5F88\u5927\uFF0C Kubernetes \u53EF\u4EE5\u8D1F\u8F7D\u5747\u8861\u5E76\u5206\u914D\u7F51\u7EDC\u6D41\u91CF\uFF0C\u4ECE\u800C\u4F7F\u90E8\u7F72\u7A33\u5B9A\u3002</p></li><li><p>\u5B58\u50A8\u7F16\u6392</p><p>Kubernetes \u5141\u8BB8\u4F60\u81EA\u52A8\u6302\u8F7D\u4F60\u9009\u62E9\u7684\u5B58\u50A8\u7CFB\u7EDF\uFF0C\u6BD4\u5982\u672C\u5730\u5B58\u50A8\uFF0C\u7C7B\u4F3CDocker\u7684\u6570\u636E\u5377\u3002</p></li><li><p>\u81EA\u52A8\u90E8\u7F72\u548C\u56DE\u6EDA</p><p>\u4F60\u53EF\u4EE5\u4F7F\u7528 Kubernetes \u63CF\u8FF0\u5DF2\u90E8\u7F72\u5BB9\u5668\u7684\u6240\u9700\u72B6\u6001\uFF0C\u5B83\u53EF\u4EE5\u4EE5\u53D7\u63A7\u7684\u901F\u7387\u5C06\u5B9E\u9645\u72B6\u6001 \u66F4\u6539\u4E3A\u671F\u671B\u72B6\u6001\u3002Kubernetes \u4F1A\u81EA\u52A8\u5E2E\u4F60\u6839\u636E\u60C5\u51B5\u90E8\u7F72\u521B\u5EFA\u65B0\u5BB9\u5668\uFF0C\u5E76\u5220\u9664\u73B0\u6709\u5BB9\u5668\u7ED9\u65B0\u5BB9\u5668\u63D0\u4F9B\u8D44\u6E90\u3002</p></li><li><p>\u81EA\u52A8\u5B8C\u6210\u88C5\u7BB1\u8BA1\u7B97</p><p>Kubernetes \u5141\u8BB8\u4F60\u8BBE\u7F6E\u6BCF\u4E2A\u5BB9\u5668\u7684\u8D44\u6E90\uFF0C\u6BD4\u5982CPU\u548C\u5185\u5B58\u3002</p></li><li><p>\u81EA\u6211\u4FEE\u590D</p><p>Kubernetes \u91CD\u65B0\u542F\u52A8\u5931\u8D25\u7684\u5BB9\u5668\u3001\u66FF\u6362\u5BB9\u5668\u3001\u6740\u6B7B\u4E0D\u54CD\u5E94\u7528\u6237\u5B9A\u4E49\u7684\u5BB9\u5668\uFF0C\u5E76\u8FD0\u884C\u72B6\u51B5\u68C0\u67E5\u7684\u5BB9\u5668\u3002</p></li><li><p>\u79D8\u94A5\u4E0E\u914D\u7F6E\u7BA1\u7406</p><p>Kubernetes \u5141\u8BB8\u4F60\u5B58\u50A8\u548C\u7BA1\u7406\u654F\u611F\u4FE1\u606F\uFF0C\u4F8B\u5982\u5BC6\u7801\u3001OAuth \u4EE4\u724C\u548C ssh \u5BC6\u94A5\u3002\u4F60\u53EF\u4EE5\u5728\u4E0D\u91CD\u5EFA\u5BB9\u5668\u955C\u50CF\u7684\u60C5\u51B5\u4E0B\u90E8\u7F72\u548C\u66F4\u65B0\u5BC6\u94A5\u548C\u5E94\u7528\u7A0B\u5E8F\u914D\u7F6E\uFF0C\u4E5F\u65E0\u9700\u5728\u5806\u6808\u914D\u7F6E\u4E2D\u66B4\u9732\u5BC6\u94A5\u3002</p></li></ul><h4 id="_10-2-kubernetes\u67B6\u6784" tabindex="-1"><a class="header-anchor" href="#_10-2-kubernetes\u67B6\u6784" aria-hidden="true">#</a> 10.2 Kubernetes\u67B6\u6784</h4><p>Kubernetes \u642D\u5EFA\u9700\u8981\u81F3\u5C11\u4E24\u4E2A\u8282\u70B9\uFF0C\u4E00\u4E2AMaster\u8D1F\u8D23\u7BA1\u7406\uFF0C\u4E00\u4E2ASlave\u642D\u5EFA\u5728\u5DE5\u4F5C\u670D\u52A1\u5668\u4E0A\u8D1F\u8D23\u5206\u914D\u3002</p><table><thead><tr><th style="text-align:center;">kubernetes\u67B6\u6784</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+hs+'" alt="image-20211210114507638" loading="lazy"></td></tr></tbody></table><p>\u4ECE\u56FE\u4E2D\u53EF\u4EE5\u770B\u5230\u5404\u4E2A\u7EC4\u4EF6\u7684\u57FA\u672C\u529F\u80FD\uFF1A</p><ul><li>API Server\uFF1A\u4F5C\u4E3AK8s\u901A\u8BAF\u7684\u6838\u5FC3\u7EC4\u4EF6\uFF0CK8s\u5185\u90E8\u4EA4\u4E92\u4EE5\u53CA\u63A5\u6536\u53D1\u9001\u6307\u4EE4\u7684\u7EC4\u4EF6\u3002</li><li>controller-manager\uFF1A\u4F5C\u4E3AK8s\u7684\u6838\u5FC3\u7EC4\u4EF6\uFF0C\u4E3B\u8981\u505A\u8D44\u6E90\u8C03\u5EA6\uFF0C\u6839\u636E\u96C6\u7FA4\u60C5\u51B5\u5206\u914D\u8D44\u6E90</li><li>etcd\uFF1A\u4E00\u4E2Akey-value\u7684\u6570\u636E\u5E93\uFF0C\u5B58\u50A8\u5B58\u50A8\u96C6\u7FA4\u7684\u72B6\u6001\u4FE1\u606F</li><li>scheduler\uFF1A\u8D1F\u8D23\u8C03\u5EA6\u6BCF\u4E2A\u5DE5\u4F5C\u8282\u70B9</li><li>cloud-controller-manager\uFF1A\u8D1F\u8D23\u8C03\u5EA6\u5176\u4ED6\u4E91\u670D\u52A1\u4EA7\u54C1</li><li>kubelet\uFF1A\u7BA1\u7406Pods\u4E0A\u9762\u7684\u5BB9\u5668\u3002</li><li>kube-proxy\uFF1A\u8D1F\u8D23\u5904\u7406\u5176\u4ED6Slave\u6216\u5BA2\u6237\u7AEF\u7684\u8BF7\u6C42\u3002</li><li>Pod\uFF1A\u53EF\u4EE5\u7406\u89E3\u4E3A\u5C31\u662F\u8FD0\u884C\u7684\u5BB9\u5668</li></ul><h4 id="_10-3-kubernetes\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#_10-3-kubernetes\u5B89\u88C5" aria-hidden="true">#</a> 10.3 Kubernetes\u5B89\u88C5</h4>',71),Ra=s("\u8FD9\u91CC\u4F1A\u91C7\u7528"),Ca={href:"https://kuboard.cn/%E6%8F%90%E4%BE%9B%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85K8s%EF%BC%8C%E5%AE%89%E8%A3%85%E5%8D%95Master%E8%8A%82%E7%82%B9",target:"_blank",rel:"noopener noreferrer"},Ga=s("https://kuboard.cn/\u63D0\u4F9B\u7684\u65B9\u5F0F\u5B89\u88C5K8s\uFF0C\u5B89\u88C5\u5355Master\u8282\u70B9"),wa=s("\u8981\u6C42\u4F7F\u7528Centos7.8\u7248\u672C\uFF1A"),Ia={href:"https://vault.centos.org/7.8.2003/isos/x86_64/CentOS-7-x86_64-Minimal-2003.iso",target:"_blank",rel:"noopener noreferrer"},Ka=s("https://vault.centos.org/7.8.2003/isos/x86_64/CentOS-7-x86_64-Minimal-2003.iso"),Ha=n("li",null,[s("\u81F3\u5C112\u53F0 "),n("strong",null,"2\u68384G"),s(" \u7684\u670D\u52A1\u5668")],-1),La=e('<p>\u5B89\u88C5\u6D41\u7A0B</p><table><thead><tr><th style="text-align:center;">\u5B89\u88C5\u6D41\u7A0B</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+ys+`" alt="image-20211210190653687" loading="lazy"></td></tr></tbody></table><p>\u51C6\u5907\u597D\u670D\u52A1\u5668\u540E\u5F00\u59CB\u5B89\u88C5</p><ul><li><p>\u91CD\u65B0\u8BBE\u7F6Ehostname\uFF0C\u4E0D\u5141\u8BB8\u4E3Alocalhost</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u4FEE\u6539 hostname\uFF0C\u540D\u5B57\u4E0D\u5141\u8BB8\u4F7F\u7528\u4E0B\u5212\u7EBF\u3001\u5C0F\u6570\u70B9\u3001\u5927\u5199\u5B57\u6BCD\uFF0C\u4E0D\u80FD\u53EBmaster</span>
hostnamectl set-hostname your-new-host-name
<span class="token comment"># \u67E5\u770B\u4FEE\u6539\u7ED3\u679C</span>
hostnamectl status
<span class="token comment"># \u8BBE\u7F6E hostname \u89E3\u6790</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;127.0.0.1   <span class="token variable"><span class="token variable">$(</span><span class="token function">hostname</span><span class="token variable">)</span></span>&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u8981\u6C422\u53F0\u670D\u52A1\u4E4B\u95F4\u53EF\u4EE5\u76F8\u4E92\u901A\u8BAF</p></li><li><p>\u5B89\u88C5\u8F6F\u4EF6</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u963F\u91CC\u4E91 docker hub \u955C\u50CF</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">REGISTRY_MIRROR</span><span class="token operator">=</span>https://registry.cn-hangzhou.aliyuncs.com
<span class="token function">curl</span> -sSL https://kuboard.cn/install-script/v1.19.x/install_kubelet.sh <span class="token operator">|</span> <span class="token function">sh</span> -s <span class="token number">1.19</span>.5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>\u9996\u5148\u521D\u59CB\u5316Master\u8282\u70B9</p>`,5),Ta=n("p",null,"\u5173\u4E8E\u521D\u59CB\u5316\u65F6\u7528\u5230\u7684\u73AF\u5883\u53D8\u91CF",-1),Qa=n("li",null,[n("strong",null,"APISERVER_NAME"),s(" \u4E0D\u80FD\u662F master \u7684 hostname")],-1),Ua=n("li",null,[n("strong",null,"APISERVER_NAME"),s(" \u5FC5\u987B\u5168\u4E3A\u5C0F\u5199\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u5C0F\u6570\u70B9\uFF0C\u4E0D\u80FD\u5305\u542B\u51CF\u53F7")],-1),Fa=n("strong",null,"POD_SUBNET",-1),Va=s(" \u6240\u4F7F\u7528\u7684\u7F51\u6BB5\u4E0D\u80FD\u4E0E "),Wa=n("em",null,[n("strong",null,"master\u8282\u70B9/worker\u8282\u70B9")],-1),Ya=s(" \u6240\u5728\u7684\u7F51\u6BB5\u91CD\u53E0\u3002\u8BE5\u5B57\u6BB5\u7684\u53D6\u503C\u4E3A\u4E00\u4E2A "),Xa={href:"https://kuboard.cn/glossary/cidr.html",target:"_blank",rel:"noopener noreferrer"},Za=s("CIDR"),ne=s(" \u503C\uFF0C\u5982\u679C\u60A8\u5BF9 CIDR \u8FD9\u4E2A\u6982\u5FF5\u8FD8\u4E0D\u719F\u6089\uFF0C\u8BF7\u4ECD\u7136\u6267\u884C export POD_SUBNET=10.100.0.0/16 \u547D\u4EE4\uFF0C\u4E0D\u505A\u4FEE\u6539"),se=e(`<ul><li><p>\u8BBE\u7F6Eip\uFF0C\u57DF\u540D\uFF0C\u7F51\u6BB5\u5E76\u6267\u884C\u521D\u59CB\u5316\u64CD\u4F5C</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u53EA\u5728 master \u8282\u70B9\u6267\u884C</span>
<span class="token comment"># \u66FF\u6362 x.x.x.x \u4E3A master \u8282\u70B9\u5B9E\u9645 IP\uFF08\u8BF7\u4F7F\u7528\u5185\u7F51 IP\uFF09</span>
<span class="token comment"># export \u547D\u4EE4\u53EA\u5728\u5F53\u524D shell \u4F1A\u8BDD\u4E2D\u6709\u6548\uFF0C\u5F00\u542F\u65B0\u7684 shell \u7A97\u53E3\u540E\uFF0C\u5982\u679C\u8981\u7EE7\u7EED\u5B89\u88C5\u8FC7\u7A0B\uFF0C\u8BF7\u91CD\u65B0\u6267\u884C\u6B64\u5904\u7684 export \u547D\u4EE4</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">MASTER_IP</span><span class="token operator">=</span><span class="token number">192.168</span>.11.32
<span class="token comment"># \u66FF\u6362 apiserver.demo \u4E3A \u60A8\u60F3\u8981\u7684 dnsName</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">APISERVER_NAME</span><span class="token operator">=</span>apiserver.demo
<span class="token comment"># Kubernetes \u5BB9\u5668\u7EC4\u6240\u5728\u7684\u7F51\u6BB5\uFF0C\u8BE5\u7F51\u6BB5\u5B89\u88C5\u5B8C\u6210\u540E\uFF0C\u7531 kubernetes \u521B\u5EFA\uFF0C\u4E8B\u5148\u5E76\u4E0D\u5B58\u5728\u4E8E\u60A8\u7684\u7269\u7406\u7F51\u7EDC\u4E2D</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">POD_SUBNET</span><span class="token operator">=</span><span class="token number">10.100</span>.0.1/16
<span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">\${MASTER_IP}</span>    <span class="token variable">\${APISERVER_NAME}</span>&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
<span class="token function">curl</span> -sSL https://kuboard.cn/install-script/v1.19.x/init_master.sh <span class="token operator">|</span> <span class="token function">sh</span> -s <span class="token number">1.19</span>.5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u68C0\u67E5Master\u542F\u52A8\u72B6\u6001</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u53EA\u5728 master \u8282\u70B9\u6267\u884C</span>

<span class="token comment"># \u6267\u884C\u5982\u4E0B\u547D\u4EE4\uFF0C\u7B49\u5F85 3-10 \u5206\u949F\uFF0C\u76F4\u5230\u6240\u6709\u7684\u5BB9\u5668\u7EC4\u5904\u4E8E Running \u72B6\u6001</span>
<span class="token function">watch</span> kubectl get pod -n kube-system -o wide

<span class="token comment"># \u67E5\u770B master \u8282\u70B9\u521D\u59CB\u5316\u7ED3\u679C</span>
kubectl get nodes -o wide
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p><code>Ps\uFF1A\u5982\u679C\u51FA\u73B0NotReady\u7684\u60C5\u51B5\u6267\u884C\uFF08\u6700\u65B0\u7248\u672C\u7684BUG\uFF0C1.19\u4E00\u822C\u6CA1\u6709\uFF09</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> pull quay.io/coreos/flannel:v0.10.0-amd64 
<span class="token function">mkdir</span> -p /etc/cni/net.d/
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF<span class="token operator">&gt;</span> /etc/cni/net.d/10-flannel.conf
<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;cbr0&quot;</span>,<span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;flannel&quot;</span>,<span class="token string">&quot;delegate&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;isDefaultGateway&quot;</span><span class="token builtin class-name">:</span> true<span class="token punctuation">}</span><span class="token punctuation">}</span>
EOF
<span class="token function">mkdir</span> /usr/share/oci-umount/oci-umount.d -p
<span class="token function">mkdir</span> /run/flannel/
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF<span class="token operator">&gt;</span> /run/flannel/subnet.env
<span class="token assign-left variable">FLANNEL_NETWORK</span><span class="token operator">=</span><span class="token number">172.100</span>.0.0/16
<span class="token assign-left variable">FLANNEL_SUBNET</span><span class="token operator">=</span><span class="token number">172.100</span>.1.0/24
<span class="token assign-left variable">FLANNEL_MTU</span><span class="token operator">=</span><span class="token number">1450</span>
<span class="token assign-left variable">FLANNEL_IPMASQ</span><span class="token operator">=</span>true
EOF
kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/v0.9.1/Documentation/kube-flannel.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5B89\u88C5\u7F51\u7EDC\u670D\u52A1\u63D2\u4EF6</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">POD_SUBNET</span><span class="token operator">=</span><span class="token number">10.100</span>.0.0/16
kubectl apply -f https://kuboard.cn/install-script/v1.22.x/calico-operator.yaml
<span class="token function">wget</span> https://kuboard.cn/install-script/v1.22.x/calico-custom-resources.yaml
<span class="token function">sed</span> -i <span class="token string">&quot;s#192.168.0.0/16#<span class="token variable">\${POD_SUBNET}</span>#&quot;</span> calico-custom-resources.yaml
kubectl apply -f calico-custom-resources.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u521D\u59CB\u5316worker\u8282\u70B9</p><ul><li><p>\u83B7\u53D6Join\u547D\u4EE4\u53C2\u6570\uFF0C\u5728Master\u8282\u70B9\u6267\u884C</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u53EA\u5728 master \u8282\u70B9\u6267\u884C</span>
kubeadm token create --print-join-command
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">\u83B7\u53D6\u547D\u4EE4</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+_s+`" alt="image-20211213183025291" loading="lazy"></td></tr></tbody></table></li><li><p>\u5728worker\u8282\u70B9\u521D\u59CB\u5316</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u53EA\u5728 worker \u8282\u70B9\u6267\u884C</span>
<span class="token comment"># \u66FF\u6362 x.x.x.x \u4E3A master \u8282\u70B9\u7684\u5185\u7F51 IP</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">MASTER_IP</span><span class="token operator">=</span><span class="token number">192.168</span>.11.32
<span class="token comment"># \u66FF\u6362 apiserver.demo \u4E3A\u521D\u59CB\u5316 master \u8282\u70B9\u65F6\u6240\u4F7F\u7528\u7684 APISERVER_NAME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">APISERVER_NAME</span><span class="token operator">=</span>apiserver.demo
<span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">\${MASTER_IP}</span>    <span class="token variable">\${APISERVER_NAME}</span>&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/hosts

<span class="token comment"># \u66FF\u6362\u4E3A master \u8282\u70B9\u4E0A kubeadm token create \u547D\u4EE4\u7684\u8F93\u51FA</span>
kubeadm <span class="token function">join</span> apiserver.demo:6443 --token vwfilu.3nhndohc5gn1jv9k     --discovery-token-ca-cert-hash sha256:22ff15cabfe87ab48a7db39b3bbf986fee92ec92eb8efc7fe9b0abe2175ff0c2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>\u68C0\u67E5\u6700\u7EC8\u8FD0\u884C\u6548\u679C</p><ul><li><p>\u5728 master \u8282\u70B9\u4E0A\u6267\u884C</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u53EA\u5728 master \u8282\u70B9\u6267\u884C</span>
kubectl get nodes -o wide
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p><code>Ps\uFF1A\u5982\u679C\u51FA\u73B0NotReady\u7684\u60C5\u51B5\u6267\u884C\uFF08\u6700\u65B0\u7248\u672C\u7684BUG\uFF0C1.19\u4E00\u822C\u6CA1\u6709\uFF09</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> pull quay.io/coreos/flannel:v0.10.0-amd64 
<span class="token function">mkdir</span> -p /etc/cni/net.d/
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF<span class="token operator">&gt;</span> /etc/cni/net.d/10-flannel.conf
<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;cbr0&quot;</span>,<span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;flannel&quot;</span>,<span class="token string">&quot;delegate&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;isDefaultGateway&quot;</span><span class="token builtin class-name">:</span> true<span class="token punctuation">}</span><span class="token punctuation">}</span>
EOF
<span class="token function">mkdir</span> /usr/share/oci-umount/oci-umount.d -p
<span class="token function">mkdir</span> /run/flannel/
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF<span class="token operator">&gt;</span> /run/flannel/subnet.env
<span class="token assign-left variable">FLANNEL_NETWORK</span><span class="token operator">=</span><span class="token number">172.100</span>.0.0/16
<span class="token assign-left variable">FLANNEL_SUBNET</span><span class="token operator">=</span><span class="token number">172.100</span>.1.0/24
<span class="token assign-left variable">FLANNEL_MTU</span><span class="token operator">=</span><span class="token number">1450</span>
<span class="token assign-left variable">FLANNEL_IPMASQ</span><span class="token operator">=</span>true
EOF
kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/v0.9.1/Documentation/kube-flannel.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>\u8F93\u51FA\u7ED3\u679C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8smaster ~<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">\u642D\u5EFA\u6210\u529F\u6548\u679C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+xs+'" alt="image-20211210184851810" loading="lazy"></td></tr></tbody></table></li></ul><p>\u5B89\u88C5Kuboard\u7BA1\u7406K8s\u96C6\u7FA4</p>',13),ae=e(`<li><p>\u5B89\u88C5Kuboard</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>kubectl apply <span class="token punctuation">-</span>f https<span class="token punctuation">:</span>//addons.kuboard.cn/kuboard/kuboard<span class="token punctuation">-</span>v3.yaml
<span class="token comment"># \u60A8\u4E5F\u53EF\u4EE5\u4F7F\u7528\u4E0B\u9762\u7684\u6307\u4EE4\uFF0C\u552F\u4E00\u7684\u533A\u522B\u662F\uFF0C\u8BE5\u6307\u4EE4\u4F7F\u7528\u534E\u4E3A\u4E91\u7684\u955C\u50CF\u4ED3\u5E93\u66FF\u4EE3 docker hub \u5206\u53D1 Kuboard \u6240\u9700\u8981\u7684\u955C\u50CF</span>
<span class="token comment"># kubectl apply -f https://addons.kuboard.cn/kuboard/kuboard-v3-swr.yaml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u67E5\u770B\u542F\u52A8\u60C5\u51B5</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>watch kubectl get pods -n kuboard
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">\u67E5\u770B\u6548\u679C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+fs+'" alt="image-20211213184701784" loading="lazy"></td></tr></tbody></table></li>',2),ee=s("\u5728\u6D4F\u89C8\u5668\u4E2D\u6253\u5F00\u94FE\u63A5 "),te={href:"http://your-node-ip-address:30080",target:"_blank",rel:"noopener noreferrer"},le=s("http://your-node-ip-address:30080"),ie=n("table",null,[n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"center"}},"\u9996\u9875")])]),n("tbody",null,[n("tr",null,[n("td",{style:{"text-align":"center"}},[n("img",{src:Ds,alt:"image-20211213184742709",loading:"lazy"})])])])],-1),pe=e('<li><p>\u8F93\u5165\u521D\u59CB\u7528\u6237\u540D\u548C\u5BC6\u7801\uFF0C\u5E76\u767B\u5F55</p><ul><li>\u7528\u6237\u540D\uFF1A <code>admin</code></li><li>\u5BC6\u7801\uFF1A <code>Kuboard123</code></li></ul><table><thead><tr><th style="text-align:center;">\u9996\u9875\u6548\u679C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+zs+'" alt="image-20211213184840120" loading="lazy"></td></tr></tbody></table></li>',1),ce=e(`<h4 id="_10-4-kubernetes\u64CD\u4F5C" tabindex="-1"><a class="header-anchor" href="#_10-4-kubernetes\u64CD\u4F5C" aria-hidden="true">#</a> 10.4 Kubernetes\u64CD\u4F5C</h4><p>\u9996\u5148\u6211\u4EEC\u8981\u4E86\u89E3Kubernetes\u5728\u8FD0\u884C\u6211\u4EEC\u7684\u8D44\u6E90\u65F6\uFF0C\u5173\u8054\u5230\u4E86\u54EA\u4E9B\u5185\u5BB9</p><ul><li><p>\u8D44\u6E90\u7684\u6784\u5EFA\u65B9\u5F0F\uFF1A</p><ul><li>\u91C7\u7528kubectl\u7684\u547D\u4EE4\u65B9\u5F0F</li><li>yaml\u6587\u4EF6\u65B9\u5F0F</li></ul></li></ul><h5 id="_10-4-1-namespace" tabindex="-1"><a class="header-anchor" href="#_10-4-1-namespace" aria-hidden="true">#</a> 10.4.1 Namespace</h5><ul><li><p>\u547D\u540D\u7A7A\u95F4\uFF1A\u4E3B\u8981\u662F\u4E3A\u4E86\u5BF9Kubernetes\u4E2D\u8FD0\u884C\u7684\u8D44\u6E90\u8FDB\u884C\u8FC7\u9694\u79BB\uFF0C \u4F46\u662F\u7F51\u7EDC\u662F\u4E92\u901A\u7684\uFF0C\u7C7B\u4F3CDocker\u7684\u5BB9\u5668\uFF0C\u53EF\u4EE5\u5C06\u591A\u4E2A\u8D44\u6E90\u914D\u7F6E\u5230\u4E00\u4E2ANameSpace\u4E2D\u3002\u800CNameSpace\u53EF\u4EE5\u5BF9\u4E0D\u540C\u73AF\u5883\u8FDB\u884C\u8D44\u6E90\u9694\u79BB\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0BKubernetes\u63D0\u4F9B\u4E86default\u547D\u540D\u7A7A\u95F4\uFF0C\u5728\u6784\u5EFA\u8D44\u6E90\u65F6\uFF0C\u5982\u679C\u4E0D\u6307\u5B9A\u8D44\u6E90\uFF0C\u9ED8\u8BA4\u91C7\u7528default\u8D44\u6E90\u3002 \u547D\u4EE4\u65B9\u5F0F\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u67E5\u770B\u73B0\u6709\u7684\u5168\u90E8\u547D\u540D\u7A7A\u95F4</span>
kubectl get ns

<span class="token comment"># \u6784\u5EFA\u547D\u540D\u7A7A\u95F4</span>
kubectl create ns \u547D\u540D\u7A7A\u95F4\u540D\u79F0

<span class="token comment"># \u5220\u9664\u73B0\u6709\u547D\u540D\u7A7A\u95F4\uFF0C \u5E76\u4E14\u4F1A\u5220\u9664\u7A7A\u95F4\u4E0B\u7684\u5168\u90E8\u8D44\u6E90</span>
kubectl delete ns \u547D\u540D\u7A7A\u95F4\u540D\u79F0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>yaml\u6587\u4EF6\u65B9\u5F0F\uFF1A\uFF08\u6784\u5EFA\u8D44\u6E90\u65F6\uFF0C\u8BBE\u7F6E\u547D\u540D\u7A7A\u95F4\uFF09</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Namespace
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h5 id="_10-4-2-pod" tabindex="-1"><a class="header-anchor" href="#_10-4-2-pod" aria-hidden="true">#</a> 10.4.2 Pod</h5><ul><li><p>Pod\uFF1AKubernetes\u8FD0\u884C\u7684\u4E00\u7EC4\u5BB9\u5668\uFF0CPod\u662FKubernetes\u7684\u6700\u5C0F\u5355\u4F4D\uFF0C\u4F46\u662F\u5BF9\u4E8EDocker\u800C\u7136\uFF0CPod\u4E2D\u4F1A\u8FD0\u884C\u591A\u4E2ADocker\u5BB9\u5668</p><ul><li><p>\u547D\u4EE4\u65B9\u5F0F\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u67E5\u770B\u6240\u6709\u8FD0\u884C\u7684pod</span>
kubectl get pods -A

<span class="token comment"># \u67E5\u770B\u6307\u5B9ANamespace\u4E0B\u7684Pod</span>
kubectl get pod <span class="token punctuation">[</span>-n \u547D\u540D\u7A7A\u95F4<span class="token punctuation">]</span>  <span class="token comment">#\uFF08\u9ED8\u8BA4default\uFF09</span>

<span class="token comment"># \u521B\u5EFAPod</span>
kubectl run pod\u540D\u79F0 --image<span class="token operator">=</span>\u955C\u50CF\u540D\u79F0

<span class="token comment"># \u67E5\u770BPod\u8BE6\u7EC6\u4FE1\u606F</span>
kubectl describe pod pod\u540D\u79F0

<span class="token comment"># \u5220\u9664pod</span>
kubectl delete pod pod\u540D\u79F0 <span class="token punctuation">[</span>-n \u547D\u540D\u7A7A\u95F4<span class="token punctuation">]</span>  <span class="token comment">#\uFF08\u9ED8\u8BA4default\uFF09</span>

<span class="token comment"># \u67E5\u770Bpod\u8F93\u51FA\u7684\u65E5\u5FD7</span>
kubectl logs -f pod\u540D\u79F0

<span class="token comment"># \u8FDB\u53BBpod\u5BB9\u5668\u5185\u90E8</span>
kubectl <span class="token builtin class-name">exec</span> -it pod\u540D\u79F0 -- <span class="token function">bash</span>

<span class="token comment"># \u67E5\u770Bkubernetes\u7ED9Pod\u5206\u914D\u7684ip\u4FE1\u606F\uFF0C\u5E76\u4E14\u901A\u8FC7ip\u548C\u5BB9\u5668\u7684\u7AEF\u53E3\uFF0C\u53EF\u4EE5\u76F4\u63A5\u8BBF\u95EE</span>
kubectl get pod -owide
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>yaml\u65B9\u5F0F\uFF08\u63A8\u8350\uFF09</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">run</span><span class="token punctuation">:</span> \u8FD0\u884C\u7684pod\u540D\u79F0
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pod\u540D\u79F0
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> \u547D\u540D\u7A7A\u95F4
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> \u955C\u50CF\u540D\u79F0
    <span class="token key atrule">name</span><span class="token punctuation">:</span> \u5BB9\u5668\u540D\u79F0

<span class="token comment"># \u542F\u52A8Pod\uFF1Akubectl apply -f yaml\u6587\u4EF6\u540D\u79F0</span>
<span class="token comment"># \u5220\u9664Pod\uFF1Akubectl delete -f yaml\u6587\u4EF6\u540D\u79F0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Pod\u4E2D\u8FD0\u884C\u591A\u4E2A\u5BB9\u5668</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">run</span><span class="token punctuation">:</span> \u8FD0\u884C\u7684pod\u540D\u79F0
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pod\u540D\u79F0
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> \u547D\u540D\u7A7A\u95F4
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> \u955C\u50CF\u540D\u79F0
    <span class="token key atrule">name</span><span class="token punctuation">:</span> \u5BB9\u5668\u540D\u79F0
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> \u955C\u50CF\u540D\u79F0
    <span class="token key atrule">name</span><span class="token punctuation">:</span> \u5BB9\u5668\u540D\u79F0
\u2026\u2026\u2026\u2026    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u542F\u52A8\u540E\u53EF\u4EE5\u67E5\u770B\u5230</p><table><thead><tr><th style="text-align:center;">Kuboard\u6548\u679C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+Ss+'" alt="image-20220104203155749" loading="lazy"></td></tr></tbody></table></li></ul></li></ul><h5 id="_10-4-3-deployment" tabindex="-1"><a class="header-anchor" href="#_10-4-3-deployment" aria-hidden="true">#</a> 10.4.3 Deployment</h5><p>\u90E8\u7F72\u65F6\uFF0C\u53EF\u4EE5\u901A\u8FC7Deployment\u7BA1\u7406\u548C\u7F16\u6392Pod</p><p>Deployment\u90E8\u7F72\u5B9E\u73B0</p>',10),oe=e(`<li><p>\u547D\u4EE4\u65B9\u5F0F</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u57FA\u4E8EDeployment\u542F\u52A8\u5BB9\u5668</span>
kubectl create deployment deployment\u540D\u79F0 --image<span class="token operator">=</span>\u955C\u50CF\u540D\u79F0
<span class="token comment"># \u7528deployment\u542F\u52A8\u7684\u5BB9\u5668\u4F1A\u5728\u88AB\u5220\u9664\u540E\u81EA\u52A8\u518D\u6B21\u521B\u5EFA\uFF0C\u8FBE\u5230\u6545\u969C\u6F02\u79FB\u7684\u6548\u679C</span>
<span class="token comment"># \u9700\u8981\u4F7F\u7528deploy\u7684\u65B9\u5F0F\u5220\u9664deploy</span>
<span class="token comment"># \u67E5\u770B\u73B0\u5728\u7684deployment</span>
kubectl get deployment

<span class="token comment"># \u5220\u9664deployment</span>
kubectl delete deployment deployment\u540D\u79F0

<span class="token comment"># \u57FA\u4E8EDeployment\u542F\u52A8\u5BB9\u5668\u5E76\u8BBE\u7F6EPod\u96C6\u7FA4\u6570</span>
kubectl create deployment deployment\u540D\u79F0 --image<span class="token operator">=</span>\u955C\u50CF\u540D\u79F0 --replicas \u96C6\u7FA4\u4E2A\u6570
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>`,1),re={href:"https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/",target:"_blank",rel:"noopener noreferrer"},de=s("\u914D\u7F6E\u6587\u4EF6\u65B9\u5F0F"),ue=e(`<div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
       <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
       <span class="token key atrule">ports</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6B63\u5E38\u4F7F\u7528kubectl\u8FD0\u884Cyaml\u5373\u53EF</p>`,2),ve=e(`<p>\u5F39\u6027\u4F38\u7F29\u529F\u80FD</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u57FA\u4E8Escale\u5B9E\u73B0\u5F39\u6027\u4F38\u7F29</span>
kubectl scale deploy/Deployment\u540D\u79F0 --replicas \u96C6\u7FA4\u4E2A\u6570
<span class="token comment"># \u6216\u8005\u4FEE\u6539yaml\u6587\u4EF6</span>
kubectl edit deploy Deployment\u540D\u79F0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">\u56FE\u5F62\u5316\u9875\u9762\u4FEE\u6539</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+Js+`" alt="image-20220104210823057" loading="lazy"></td></tr></tbody></table><p>\u7070\u5EA6\u53D1\u5E03</p><p>Deploy\u53EF\u4EE5\u5728\u90E8\u7F72\u65B0\u7248\u672C\u6570\u636E\u65F6\uFF0C\u6210\u529F\u542F\u52A8\u4E00\u4E2Apod\uFF0C\u624D\u4F1A\u4E0B\u7EBF\u4E00\u4E2A\u8001\u7248\u672C\u7684Pod</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl <span class="token builtin class-name">set</span> image deployment/Deployment\u540D\u79F0 \u5BB9\u5668\u540D<span class="token operator">=</span>\u955C\u50CF:\u7248\u672C
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="_10-4-4-service" tabindex="-1"><a class="header-anchor" href="#_10-4-4-service" aria-hidden="true">#</a> 10.4.4 Service</h5><p>\u53EF\u4EE5\u5C06\u591A\u4E2APod\u5BF9\u5916\u66B4\u9732\u4E00\u4E2AService\uFF0C\u8BA9\u5BA2\u6237\u7AEF\u53EF\u4EE5\u901A\u8FC7Service\u8BBF\u95EE\u5230\u8FD9\u4E00\u7EC4Pod\uFF0C\u5E76\u4E14\u53EF\u4EE5\u5B9E\u73B0\u8D1F\u8F7D\u5747\u8861</p><p>ClusterIP\u65B9\u5F0F\uFF1A</p><p>ClusterIP\u662F\u96C6\u7FA4\u5185\u90E8Pod\u4E4B\u95F4\u7684\u8BBF\u95EE\u65B9\u5F0F</p><ul><li><p>\u547D\u4EE4\u5B9E\u73B0\u6548\u679C</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u901A\u8FC7\u751F\u6210service\u6620\u5C04\u4E00\u4E2ADeployment\u4E0B\u7684\u6240\u6709pod\u4E2D\u7684\u67D0\u4E00\u4E2A\u7AEF\u53E3\u7684\u5BB9\u5668</span>
kubectl expose deployment Deployment\u540D\u79F0 --port<span class="token operator">=</span>Service\u7AEF\u53E3\u53F7 --target-port<span class="token operator">=</span>Pod\u5185\u5BB9\u5668\u7AEF\u53E3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E4B\u540E\u901A\u8FC7<code>kubectl get service</code>\u67E5\u770BService\u63D0\u4F9B\u7684ip\uFF0C\u5373\u53EF\u8BBF\u95EE</p><table><thead><tr><th style="text-align:center;">kubectl get service</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+$s+'" alt="image-20220104214659229" loading="lazy"></td></tr></tbody></table><p>\u4E5F\u53EF\u4EE5\u901A\u8FC7<code>Deployment\u540D\u79F0.namespace\u540D\u79F0.svc</code>\u4F5C\u4E3A\u57DF\u540D\u8BBF\u95EE</p><table><thead><tr><th style="text-align:center;">\u5728\u670D\u52A1\u5BB9\u5668\u5185\u6267\u884C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Ps+`" alt="image-20220104215030265" loading="lazy"></td></tr></tbody></table></li></ul><p>NodePort\u65B9\u5F0F</p><p>ClusterIP\u7684\u65B9\u5F0F\u53EA\u80FD\u5728Pod\u5185\u90E8\u5B9E\u73B0\u8BBF\u95EE\uFF0C\u4F46\u662F\u4E00\u822C\u9700\u8981\u5BF9\u5916\u66B4\u9732\u7F51\u5173\uFF0C\u6240\u4EE5\u9700\u8981NodePort\u7684\u65B9\u5F0FPod\u5916\u66B4\u9732\u8BBF\u95EE</p><ul><li><p>\u547D\u4EE4\u5B9E\u73B0\u65B9\u5F0F</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u901A\u8FC7\u751F\u6210service\u6620\u5C04\u4E00\u4E2ADeployment\u4E0B\u7684\u6240\u6709pod\u4E2D\u7684\u67D0\u4E00\u4E2A\u7AEF\u53E3\u7684\u5BB9\u5668</span>
kubectl expose deployment Deployment\u540D\u79F0 --port<span class="token operator">=</span>Service\u7AEF\u53E3\u53F7 --target-port<span class="token operator">=</span>Pod\u5185\u5BB9\u5668\u7AEF\u53E3 --type<span class="token operator">=</span>NodePort
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">\u67E5\u770BService\u6548\u679C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+Es+'" alt="image-20220104222750733" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+js+`" alt="image-20220104222819455" loading="lazy"></td></tr></tbody></table></li></ul><p>Service\u4E5F\u53EF\u4EE5\u901A\u8FC7yaml\u6587\u4EF6\u5B9E\u73B0</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  labels
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">spec</span><span class="token punctuation">:</span>
    <span class="token key atrule">selector</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8888</span>
     <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
     <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u901A\u8FC7apply\u542F\u52A8\u5C31\u4E5F\u53EF\u4EE5\u521B\u5EFAService</p><p>\u6D4B\u8BD5\u6548\u679C-Deployment\u90E8\u7F72\uFF0C\u901A\u8FC7Service\u66B4\u9732</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>service
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>service
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8888</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u67E5\u770B\u5230\u66B4\u9732\u7684\u4FE1\u606F</p><table><thead><tr><th style="text-align:center;">Service\u4FE1\u606F</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+qs+'" alt="image-20220105205334996" loading="lazy"></td></tr></tbody></table><h5 id="_10-4-5-ingress" tabindex="-1"><a class="header-anchor" href="#_10-4-5-ingress" aria-hidden="true">#</a> 10.4.5 Ingress</h5><p>Kubernetes\u63A8\u8350\u5C06Ingress\u4F5C\u4E3A\u6240\u6709Service\u7684\u5165\u53E3\uFF0C\u63D0\u4F9B\u7EDF\u4E00\u7684\u5165\u53E3\uFF0C\u907F\u514D\u591A\u4E2A\u670D\u52A1\u4E4B\u95F4\u9700\u8981\u8BB0\u5F55\u5927\u91CF\u7684IP\u6216\u8005\u57DF\u540D\uFF0C\u6BD5\u7ADFIP\u53EF\u80FD\u6539\u53D8\uFF0C\u670D\u52A1\u592A\u591A\u57DF\u540D\u8BB0\u5F55\u4E0D\u65B9\u4FBF\u3002</p><p>Ingress\u5E95\u5C42\u5176\u5B9E\u5C31\u662F\u4E00\u4E2ANginx\uFF0C \u53EF\u4EE5\u5728Kuboard\u4E0A\u76F4\u63A5\u70B9\u51FB\u5B89\u88C5</p><table><thead><tr><th style="text-align:center;">Kuboard\u5B89\u88C5</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Ns+'" alt="image-20220105153343642" loading="lazy"></td></tr><tr><td style="text-align:center;"><strong><img src="'+Os+'" alt="image-20220105153416367" loading="lazy"></strong></td></tr></tbody></table><p>\u56E0\u4E3A\u526F\u672C\u6570\u9ED8\u8BA4\u4E3A1\uFF0C\u4F46\u662Fk8s\u6574\u4F53\u96C6\u7FA4\u5C312\u4E2A\u8282\u70B9\uFF0C\u6240\u4EE5\u663E\u793A\u4E0B\u9762\u5373\u4E3A\u5B89\u88C5\u6210\u529F</p><table><thead><tr><th style="text-align:center;">\u5B89\u88C5\u6210\u529F</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+As+`" alt="image-20220105153502619" loading="lazy"></td></tr></tbody></table><p>\u53EF\u4EE5\u5C06Ingress\u63A5\u6536\u5230\u7684\u8BF7\u6C42\u8F6C\u53D1\u5230\u4E0D\u540C\u7684Service\u4E2D\u3002</p><p>\u63A8\u8350\u4F7F\u7528yaml\u6587\u4EF6\u65B9\u5F0F</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ingressClassName</span><span class="token punctuation">:</span> ingress
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> nginx.mashibing.com
    <span class="token key atrule">http</span><span class="token punctuation">:</span>
      <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
        <span class="token key atrule">pathType</span><span class="token punctuation">:</span> Prefix
        <span class="token key atrule">backend</span><span class="token punctuation">:</span>
          <span class="token key atrule">service</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>service
            <span class="token key atrule">port</span><span class="token punctuation">:</span>
              <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">8888</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">\u542F\u52A8\u65F6\u95EE\u9898</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+Ms+'" alt="image-20220105203819715" loading="lazy"></td></tr></tbody></table><p>Kuboard\u5B89\u88C5\u7684Ingress\u6709admission\u7684\u6821\u9A8C\u914D\u7F6E\uFF0C\u9700\u8981\u5148\u5220\u9664\u914D\u7F6E\u518D\u542F\u52A8</p><p>\u627E\u5230\u6307\u5B9A\u7684ingress\u7684\u6821\u9A8C\u4FE1\u606F\uFF0C\u5220\u9664\u5373\u53EF</p><table><thead><tr><th style="text-align:center;">\u5220\u9664\u4FE1\u606F</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Bs+`" alt="image-20220105204434044" loading="lazy"></td></tr></tbody></table><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u67E5\u770B\u6821\u9A8Cwebhook\u7684\u914D\u7F6E</span>
kubectl get -A ValidatingWebhookConfiguration

<span class="token comment"># \u5220\u9664\u6307\u5B9A\u7684\u6821\u9A8C</span>
kubectl delete ValidatingWebhookConfiguration ingress-nginx-admission-my-ingress-controller
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u914D\u7F6E\u672C\u5730hosts\u6587\u4EF6</p><table><thead><tr><th style="text-align:center;">\u914D\u7F6Ehosts</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+Rs+'" alt="image-20220105204921272" loading="lazy"></td></tr></tbody></table><p>\u8BB0\u4E0B\u6765\u65E2\u53EF\u4EE5\u8BBF\u95EE\u5728Service\u4E2D\u66B4\u9732\u7684Nginx\u4FE1\u606F</p><table><thead><tr><th style="text-align:center;">\u670D\u901A\u8FC7Ingress\u8BBF\u95EE</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Cs+`" alt="image-20220105205407393" loading="lazy"></td></tr></tbody></table><h4 id="_10-5-jenkins\u96C6\u6210kubernetes" tabindex="-1"><a class="header-anchor" href="#_10-5-jenkins\u96C6\u6210kubernetes" aria-hidden="true">#</a> 10.5 Jenkins\u96C6\u6210Kubernetes</h4><h5 id="_10-5-1-\u51C6\u5907\u90E8\u7F72\u7684yml\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#_10-5-1-\u51C6\u5907\u90E8\u7F72\u7684yml\u6587\u4EF6" aria-hidden="true">#</a> 10.5.1 \u51C6\u5907\u90E8\u7F72\u7684yml\u6587\u4EF6</h5><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> test
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pipeline
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> pipeline
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> pipeline
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> pipeline    
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> pipeline
        <span class="token key atrule">image</span><span class="token punctuation">:</span> 192.168.11.102<span class="token punctuation">:</span>80/repo/pipeline<span class="token punctuation">:</span>v4.0.0
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> test
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> pipeline
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pipeline  
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> pipeline
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8081</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> test
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pipeline
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ingressClassName</span><span class="token punctuation">:</span> ingress
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> mashibing.pipeline.com
    <span class="token key atrule">http</span><span class="token punctuation">:</span>
      <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
        <span class="token key atrule">pathType</span><span class="token punctuation">:</span> Prefix
        <span class="token key atrule">backend</span><span class="token punctuation">:</span>
          <span class="token key atrule">service</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> pipeline
            <span class="token key atrule">port</span><span class="token punctuation">:</span>
              <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">8081</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_10-5-2-harbor\u79C1\u670D\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_10-5-2-harbor\u79C1\u670D\u914D\u7F6E" aria-hidden="true">#</a> 10.5.2 Harbor\u79C1\u670D\u914D\u7F6E</h5><p>\u5728\u5C1D\u8BD5\u7528kubernetes\u7684yml\u6587\u4EF6\u542F\u52A8pipeline\u670D\u52A1\u65F6\uFF0C\u4F1A\u51FA\u73B0Kubernetes\u65E0\u6CD5\u62C9\u53D6\u955C\u50CF\u7684\u95EE\u9898\uFF0C\u8FD9\u91CC\u9700\u8981\u5728kubernetes\u6240\u5728\u7684Linux\u4E2D\u914D\u7F6EHarbor\u670D\u52A1\u4FE1\u606F\uFF0C\u5E76\u4E14\u4FDD\u8BC1Kubernetes\u53EF\u4EE5\u62C9\u53D6Harbor\u4E0A\u7684\u955C\u50CF</p><ul><li><p>\u8BBE\u7F6EMaster\u548CWorker\u7684\u79C1\u670D\u5730\u5740\u4FE1\u606F</p><table><thead><tr><th style="text-align:center;">\u8BBE\u7F6EHarbor\u79C1\u670D\u5730\u5740</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+Gs+'" alt="1642498962716" loading="lazy"></td></tr></tbody></table></li><li><p>\u5728Kuboard\u4E0A\u8BBE\u7F6E\u79C1\u670D\u5BC6\u6587\u4FE1\u606F</p><table><thead><tr><th style="text-align:center;">\u8BBE\u7F6E\u5BC6\u6587\u5E76\u6D4B\u8BD5</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+ws+'" alt="1642498994935" loading="lazy"></td></tr></tbody></table><p>\u6309\u7167\u590D\u5236\u6307\u4EE4\u7684\u4F4D\u7F6E\u6D4B\u8BD5\u8BA4\u8BC1\uFF0C\u6548\u679C\u5982\u4E0B</p><table><thead><tr><th style="text-align:center;">\u6D4B\u8BD5\u6548\u679C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Is+'" alt="1642499172789" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_10-5-3-\u6D4B\u8BD5\u4F7F\u7528\u6548\u679C" tabindex="-1"><a class="header-anchor" href="#_10-5-3-\u6D4B\u8BD5\u4F7F\u7528\u6548\u679C" aria-hidden="true">#</a> 10.5.3 \u6D4B\u8BD5\u4F7F\u7528\u6548\u679C</h5><p>\u6267\u884Ckubectl\u547D\u4EE4\uFF0C\u57FA\u4E8Eyml\u542F\u52A8\u670D\u52A1\uFF0C\u5E76\u4E14\u57FA\u4E8E\u90E8\u7F72\u540E\u670D\u52A1\u7684\u63D0\u793A\u4FE1\u606F\u4EE5\u53CAIngress\u7684\u8BBE\u7F6E\uFF0C\u76F4\u63A5\u8BBF\u95EE</p><table><thead><tr><th></th></tr></thead><tbody><tr><td><img src="'+Ks+'" alt="1642499368121" loading="lazy"></td></tr><tr><td><img src="'+Hs+'" alt="1642499788199" loading="lazy"></td></tr></tbody></table><h5 id="_10-5-3-jenkins\u8FDC\u7A0B\u8C03\u7528" tabindex="-1"><a class="header-anchor" href="#_10-5-3-jenkins\u8FDC\u7A0B\u8C03\u7528" aria-hidden="true">#</a> 10.5.3 Jenkins\u8FDC\u7A0B\u8C03\u7528</h5><ul><li><p>\u5C06pipeline.yml\u914D\u7F6E\u5230Gitlab\u4E2D</p><table><thead><tr><th style="text-align:center;">\u914D\u7F6Eyml\u6587\u4EF6</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Ls+'" alt="1642499885324" loading="lazy"></td></tr></tbody></table></li><li><p>\u914D\u7F6EJenkins\u7684\u76EE\u6807\u670D\u52A1\u5668\uFF0C\u53EF\u4EE5\u5C06yml\u6587\u4EF6\u4F20\u8F93\u5230K8s\u7684Master\u4E0A</p><table><thead><tr><th style="text-align:center;">\u8BBE\u7F6E\u76EE\u6807\u670D\u52A1\u5668</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Ts+'" alt="1642499992148" loading="lazy"></td></tr></tbody></table></li><li><p>\u4FEE\u6539Jenkinsfile\uFF0C\u91CD\u65B0\u8BBE\u7F6E\u6D41\u6C34\u7EBF\u4EFB\u52A1\u811A\u672C\uFF0C\u5E76\u6D4B\u8BD5\u6548\u679C</p><table><thead><tr><th style="text-align:center;">\u4F20\u9012yml\u6587\u4EF6\u811A\u672C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Qs+'" alt="1642500061153" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+Us+'" alt="1642500102996" loading="lazy"></td></tr></tbody></table></li><li><p>\u8BBE\u7F6EJenkins\u65E0\u5BC6\u7801\u767B\u5F55k8s-master</p><p>\u5C06Jenkins\u4E2D\u516C\u94A5\u4FE1\u606F\u590D\u5236\u5230k8s-master\u7684~/.ssh/authorized_keysz\u4E2D\uFF0C\u4FDD\u8BC1\u8FDC\u7A0B\u8FDE\u63A5\u65E0\u5BC6\u7801</p><table><thead><tr><th style="text-align:center;">\u8FDC\u7A0B\u6267\u884C\u547D\u4EE4\u65E0\u9700\u5BC6\u7801</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Fs+'" alt="1642500239406" loading="lazy"></td></tr></tbody></table></li><li><p>\u8BBE\u7F6E\u6267\u884Ckubectl\u7684\u811A\u672C\u5230Jenkinsfile</p><table><thead><tr><th style="text-align:center;">\u8BBE\u7F6EJenkinsfile</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Vs+'" alt="1642500378788" loading="lazy"></td></tr></tbody></table></li><li><p>\u6267\u884C\u67E5\u770B\u6548\u679C</p><table><thead><tr><th style="text-align:center;">\u6267\u884C\u6D41\u6C34\u7EBF</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Ws+'" alt="1642500413802" loading="lazy"></td></tr></tbody></table><p>\u53EF\u4EE5\u67E5\u770B\u5230yml\u6587\u4EF6\u662F\u7531\u53D8\u5316\u7684\uFF0C \u8FD9\u6837k8s\u5C31\u4F1A\u91CD\u65B0\u52A0\u8F7D</p></li><li><p>\u67E5\u770B\u6548\u679C</p><table><thead><tr><th style="text-align:center;">\u6548\u679C</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Ys+'" alt="1642500474036" loading="lazy"></td></tr></tbody></table></li></ul><p><a href="">Ps\uFF1A\u8FD9\u79CD\u65B9\u5F0F\u66F4\u9002\u5E94\u4E0ECD\u64CD\u4F5C\uFF0C\u5C06\u9879\u76EE\u5C06\u57FA\u4E8E\u67D0\u4E2A\u7248\u672C\u90E8\u7F72\u5230\u6307\u5B9A\u7684\u76EE\u6807\u670D\u52A1\u5668</a></p><h4 id="_10-6-\u57FA\u4E8Egitlab\u7684webhooks" tabindex="-1"><a class="header-anchor" href="#_10-6-\u57FA\u4E8Egitlab\u7684webhooks" aria-hidden="true">#</a> 10.6 \u57FA\u4E8EGitLab\u7684WebHooks</h4><p>\u8FD9\u91CC\u8981\u5B9E\u73B0\u81EA\u52A8\u5316\u7684\u4E00\u4E2ACI\u64CD\u4F5C\uFF0C\u4E5F\u5C31\u662F\u5F00\u53D1\u4EBA\u5458Push\u4EE3\u7801\u5230Git\u4ED3\u5E93\u540E\uFF0CJenkins\u4F1A\u81EA\u52A8\u7684\u6784\u5EFA\u9879\u76EE\uFF0C\u5C06\u6700\u65B0\u7684\u63D0\u4EA4\u70B9\u4EE3\u7801\u6784\u5EFA\u5E76\u8FDB\u884C\u6253\u5305\u90E8\u7F72\uFF0C\u8FD9\u91CC\u533A\u522B\u53BB\u4E0A\u8FF0\u7684CD\u64CD\u4F5C\uFF0CCD\u64CD\u4F5C\u9700\u8981\u57FA\u4E8E\u67D0\u4E2A\u7248\u672C\u8FDB\u884C\u90E8\u7F72\uFF0C\u800C\u8FD9\u91CC\u6BCF\u6B21\u90FD\u662F\u5C06\u6700\u65B0\u7684\u63D0\u4EA4\u70B9\u96C6\u6210\u5230\u4E3B\u5E72\u4E0A\u5E76\u6D4B\u8BD5\u3002</p><h5 id="_10-6-1-webhooks\u901A\u77E5" tabindex="-1"><a class="header-anchor" href="#_10-6-1-webhooks\u901A\u77E5" aria-hidden="true">#</a> 10.6.1 WebHooks\u901A\u77E5</h5><p>\u5F00\u542FJenkins\u7684\u81EA\u52A8\u6784\u5EFA</p><table><thead><tr><th style="text-align:center;">\u6784\u5EFA\u89E6\u53D1\u5668</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Xs+'" alt="1642500817131" loading="lazy"></td></tr></tbody></table><p>\u8BBE\u7F6EGitlab\u7684Webhooks</p><table><thead><tr><th style="text-align:center;">\u8BBE\u7F6EGitlab\u7684Webhooks</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+Zs+'" alt="1642500933316" loading="lazy"></td></tr></tbody></table><p>\u9700\u8981\u5173\u95EDJenkins\u7684Gitlab\u8BA4\u8BC1</p><table><thead><tr><th style="text-align:center;">\u5173\u95EDJenkins\u7684Gitlab\u8BA4\u8BC1</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+na+'" alt="1642501016474" loading="lazy"></td></tr></tbody></table><p>\u518D\u6B21\u6D4B\u8BD5Gitlab</p><table><thead><tr><th style="text-align:center;">\u518D\u6B21\u6D4B\u8BD5</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="'+sa+`" alt="1642501065243" loading="lazy"></td></tr></tbody></table><h5 id="_10-6-2-\u4FEE\u6539\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_10-6-2-\u4FEE\u6539\u914D\u7F6E" aria-hidden="true">#</a> 10.6.2 \u4FEE\u6539\u914D\u7F6E</h5><p>\u4FEE\u6539Jenkinsfile\u5B9E\u73B0\u57FA\u4E8E\u6700\u65B0\u63D0\u4EA4\u70B9\u5B9E\u73B0\u6301\u7EED\u96C6\u6210\u6548\u679C\uFF0C\u5C06\u4E4B\u524D\u5F15\u7528\${tag}\u7684\u5168\u90E8\u53BB\u6389</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// \u6240\u6709\u7684\u811A\u672C\u547D\u4EE4\u90FD\u653E\u5728pipeline\u4E2D</span>
pipeline<span class="token punctuation">{</span>
	<span class="token comment">// \u6307\u5B9A\u4EFB\u52A1\u518D\u54EA\u4E2A\u96C6\u7FA4\u8282\u70B9\u4E2D\u6267\u884C</span>
	agent any

	<span class="token comment">// \u58F0\u660E\u5168\u5C40\u53D8\u91CF\uFF0C\u65B9\u4FBF\u540E\u9762\u4F7F\u7528</span>
	environment <span class="token punctuation">{</span>
		harborUser = &#39;admin&#39;
        harborPasswd = &#39;Harbor12345&#39;
        harborAddress = &#39;<span class="token number">192.168</span>.<span class="token number">11.102</span><span class="token operator">:</span><span class="token number">80</span>&#39;
        harborRepo = &#39;repo&#39;
	<span class="token punctuation">}</span>

    stages <span class="token punctuation">{</span>
        stage(&#39;\u62C9\u53D6git\u4ED3\u5E93\u4EE3\u7801&#39;) <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                checkout(<span class="token punctuation">[</span>$class<span class="token operator">:</span> &#39;GitSCM&#39;<span class="token punctuation">,</span> branches<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>name<span class="token operator">:</span> &#39;*/master&#39;<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> userRemoteConfigs<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>url<span class="token operator">:</span> &#39;http<span class="token operator">:</span><span class="token comment">//192.168.11.101:8929/root/mytest.git&#39;]]])</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        stage(&#39;\u901A\u8FC7maven\u6784\u5EFA\u9879\u76EE&#39;) <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                sh &#39;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#39;
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        stage(&#39;\u901A\u8FC7SonarQube\u505A\u4EE3\u7801\u8D28\u91CF\u68C0\u6D4B&#39;) <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                sh &#39;/var/jenkins_home/sonar-scanner/bin/sonar-scanner -Dsonar.source=./ -Dsonar.projectname=$<span class="token punctuation">{</span>JOB_NAME<span class="token punctuation">}</span> -Dsonar.projectKey=$<span class="token punctuation">{</span>JOB_NAME<span class="token punctuation">}</span> -Dsonar.java.binaries=./target/ -Dsonar.login=40306ae8ea69a4792df2ceb4d9d25fe8a6ab1701&#39;
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        stage(&#39;\u901A\u8FC7Docker\u5236\u4F5C\u81EA\u5B9A\u4E49\u955C\u50CF&#39;) <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                sh &#39;&#39;&#39;mv ./target<span class="token comment">/*.jar ./docker/
                docker build -t \${JOB_NAME}:latest ./docker/&#39;&#39;&#39;
            }
        }
        stage(&#39;\u5C06\u81EA\u5B9A\u4E49\u955C\u50CF\u63A8\u9001\u5230Harbor&#39;) {
            steps {
                sh &#39;&#39;&#39;docker login -u \${harborUser} -p \${harborPasswd} \${harborAddress}
                docker tag \${JOB_NAME}:latest  \${harborAddress}/\${harborRepo}/\${JOB_NAME}:latest
                docker push \${harborAddress}/\${harborRepo}/\${JOB_NAME}:latest &#39;&#39;&#39;
            }
        }
        stage(&#39;\u5C06yml\u6587\u4EF6\u4F20\u5230k8s-master\u4E0A&#39;) {
            steps {
                sshPublisher(publishers: [sshPublisherDesc(configName: &#39;k8s&#39;, transfers: [sshTransfer(cleanRemote: false, excludes: &#39;&#39;, execCommand: &#39;&#39;, execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: &#39;[, ]+&#39;, remoteDirectory: &#39;&#39;, remoteDirectorySDF: false, removePrefix: &#39;&#39;, sourceFiles: &#39;pipeline.yml&#39;)], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])
            }
        }
        stage(&#39;\u8FDC\u7A0B\u6267\u884Ck8s-master\u7684kubectl\u547D\u4EE4&#39;) {
            steps {
               sh &#39;&#39;&#39;ssh root@192.168.11.201 kubectl apply -f /usr/local/k8s/pipeline.yml
                ssh root@192.168.11.201 kubectl rollout restart deployment pipeline -n test&#39;&#39;&#39;
            }
        }

    }
    post {
        success {
            dingtalk(
                robot: &#39;Jenkins-DingDing&#39;,
                type: &#39;MARKDOWN&#39;,
                title: &quot;success: \${JOB_NAME}&quot;,
                text: [&quot;- \u6210\u529F\u6784\u5EFA\uFF1A\${JOB_NAME}! \\n- \u7248\u672C\uFF1Alatest \\n- \u6301\u7EED\u65F6\u95F4\uFF1A\${currentBuild.durationString}&quot; ]
            )
        }
        failure {
            dingtalk(
                robot: &#39;Jenkins-DingDing&#39;,
                type: &#39;MARKDOWN&#39;,
                title: &quot;success: \${JOB_NAME}&quot;,
                text: [&quot;- \u6784\u5EFA\u5931\u8D25\uFF1A\${JOB_NAME}! \\n- \u7248\u672C\uFF1Alatest \\n- \u6301\u7EED\u65F6\u95F4\uFF1A\${currentBuild.durationString}&quot; ]
            )
        }
    }
}

</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4FEE\u6539pipeline.yml\uFF0C\u66F4\u6539\u955C\u50CF\u7248\u672C</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> test
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pipeline
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> pipeline
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> pipeline
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> pipeline    
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> pipeline
        <span class="token key atrule">image</span><span class="token punctuation">:</span> 192.168.11.102<span class="token punctuation">:</span>80/repo/pipeline<span class="token punctuation">:</span>latest   <span class="token comment"># \u8FD9\u91CC</span>
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
<span class="token comment"># \u7701\u7565\u5176\u4ED6\u5185\u5BB9\u2026\u2026\u2026\u2026</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_10-6-3-\u6EDA\u52A8\u66F4\u65B0" tabindex="-1"><a class="header-anchor" href="#_10-6-3-\u6EDA\u52A8\u66F4\u65B0" aria-hidden="true">#</a> 10.6.3 \u6EDA\u52A8\u66F4\u65B0</h5><p>\u56E0\u4E3Apipeline\u6CA1\u6709\u6539\u53D8\u65F6\uFF0C\u6BCF\u6B21\u4E0D\u4F1A\u91CD\u65B0\u52A0\u8F7D\uFF0C\u8FD9\u6837\u4F1A\u5BFC\u81F4Pod\u4E2D\u7684\u5BB9\u5668\u4E0D\u4F1A\u52A8\u6001\u66F4\u65B0\uFF0C\u8FD9\u91CC\u9700\u8981\u4F7F\u7528kubectl\u7684rollout restart\u547D\u4EE4\u6EDA\u52A8\u66F4\u65B0</p><table><thead><tr><th style="text-align:center;">\u8BBE\u7F6EJenkinsfle</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="`+aa+'" alt="1642501521065" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="'+ea+'" alt="1642501549176" loading="lazy"></td></tr></tbody></table>',70);function ke(be,me){const t=p("RouterLink"),i=p("ExternalLinkIcon");return r(),d("div",null,[la,n("nav",ia,[n("ul",null,[n("li",null,[a(t,{to:"#\u4E00\u3001devops\u4ECB\u7ECD"},{default:l(()=>[pa]),_:1})]),n("li",null,[a(t,{to:"#\u4E8C\u3001code\u9636\u6BB5\u5DE5\u5177"},{default:l(()=>[ca]),_:1})]),n("li",null,[a(t,{to:"#\u4E09\u3001build\u9636\u6BB5\u5DE5\u5177"},{default:l(()=>[oa]),_:1})]),n("li",null,[a(t,{to:"#\u56DB\u3001operate\u9636\u6BB5\u5DE5\u5177"},{default:l(()=>[ra]),_:1})]),n("li",null,[a(t,{to:"#\u4E94\u3001integrate\u5DE5\u5177"},{default:l(()=>[da]),_:1})]),n("li",null,[a(t,{to:"#\u516D\u3001ci\u3001cd\u5165\u95E8\u64CD\u4F5C"},{default:l(()=>[ua]),_:1})]),n("li",null,[a(t,{to:"#\u4E03\u3001\u96C6\u6210sonar-qube"},{default:l(()=>[va]),_:1})]),n("li",null,[a(t,{to:"#\u516B\u3001\u96C6\u6210harbor"},{default:l(()=>[ka]),_:1})]),n("li",null,[a(t,{to:"#\u4E5D\u3001jenkins\u6D41\u6C34\u7EBF"},{default:l(()=>[ba]),_:1})]),n("li",null,[a(t,{to:"#\u5341\u3001kubernetes\u7F16\u6392\u5DE5\u5177"},{default:l(()=>[ma]),_:1})])])]),ga,n("p",null,[n("a",ha,[ya,a(i)])]),_a,n("ul",null,[n("li",null,[n("p",null,[xa,n("a",fa,[Da,a(i)])])]),za]),Sa,n("ul",null,[n("li",null,[n("p",null,[Ja,n("a",$a,[Pa,a(i)])]),Ea]),ja]),qa,n("ul",null,[n("li",null,[n("p",null,[Na,n("a",Oa,[Aa,a(i)])])]),Ma]),Ba,n("p",null,[Ra,n("a",Ca,[Ga,a(i)])]),n("ul",null,[n("li",null,[wa,n("a",Ia,[Ka,a(i)])]),Ha]),La,n("blockquote",null,[Ta,n("ul",null,[Qa,Ua,n("li",null,[Fa,Va,Wa,Ya,n("a",Xa,[Za,a(i)]),ne])])]),se,n("ul",null,[ae,n("li",null,[n("p",null,[ee,n("a",te,[le,a(i)])]),ie]),pe]),ce,n("ul",null,[oe,n("li",null,[n("p",null,[n("a",re,[de,a(i)])]),ue])]),ve])}var ye=o(ta,[["render",ke],["__file","devops.html.vue"]]);export{ye as default};
