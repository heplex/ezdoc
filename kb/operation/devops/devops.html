<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.61" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://doc.ezfri.com/kb/operation/devops/devops.html"><meta property="og:site_name" content="è½»æ¾æ˜ŸæœŸäº”"><meta property="og:title" content="DevOps"><meta property="og:description" content="[[toc]] ä¸€ã€DevOpsä»‹ç» è½¯ä»¶å¼€å‘æœ€å¼€å§‹æ˜¯ç”±ä¸¤ä¸ªå›¢é˜Ÿç»„æˆï¼š å¼€å‘è®¡åˆ’ç”±å¼€å‘å›¢é˜Ÿ ()ä»å¤´å¼€å§‹è®¾è®¡å’Œæ•´ä½“ç³»ç»Ÿçš„æ„å»ºã€‚éœ€è¦ç³»ç»Ÿä¸åœçš„è¿­ä»£æ›´æ–°ã€‚; è¿ç»´å›¢é˜Ÿ ()å°†å¼€å‘å›¢é˜Ÿçš„Codeè¿›è¡Œæµ‹è¯•åéƒ¨ç½²ä¸Šçº¿ã€‚å¸Œæœ›ç³»ç»Ÿç¨³å®šå®‰å…¨è¿è¡Œã€‚; è¿™çœ‹ä¼¼ä¸¤ä¸ªç›®æ ‡ä¸åŒçš„å›¢é˜Ÿéœ€è¦ååŒå®Œæˆä¸€ä¸ªè½¯ä»¶çš„å¼€å‘ã€‚ åœ¨å¼€å‘å›¢é˜ŸæŒ‡å®šå¥½è®¡åˆ’å¹¶å®Œæˆcodingåï¼Œéœ€è¦æä¾›åˆ°è¿ç»´å›¢é˜Ÿã€‚ è¿..."><meta property="og:type" content="article"><meta property="og:image" content="https://doc.ezfri.com/"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-04-03T03:06:39.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="DevOps"><meta property="article:author" content="è½»æ¾æ˜ŸæœŸäº”"><meta property="article:modified_time" content="2023-04-03T03:06:39.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"DevOps","image":["https://doc.ezfri.com/"],"dateModified":"2023-04-03T03:06:39.000Z","author":[{"@type":"Person","name":"è½»æ¾æ˜ŸæœŸäº”","url":"https://doc.ezfri.com"}]}</script><meta name="robots" content="all"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Expires" content="0"><meta name="keywords" content="JavaåŸºç¡€, å¤šçº¿ç¨‹, JVM, è™šæ‹Ÿæœº, æ•°æ®åº“, MySQL, Spring, Redis, MyBatis, ç³»ç»Ÿè®¾è®¡, åˆ†å¸ƒå¼, RPC, é«˜å¯ç”¨, é«˜å¹¶å‘"><meta name="apple-mobile-web-app-capable" content="yes"><link rel="stylesheet" href="/iconfont/iconfont.css"><title>DevOps | è½»æ¾æ˜ŸæœŸäº”</title><meta name="description" content="[[toc]] ä¸€ã€DevOpsä»‹ç» è½¯ä»¶å¼€å‘æœ€å¼€å§‹æ˜¯ç”±ä¸¤ä¸ªå›¢é˜Ÿç»„æˆï¼š å¼€å‘è®¡åˆ’ç”±å¼€å‘å›¢é˜Ÿ ()ä»å¤´å¼€å§‹è®¾è®¡å’Œæ•´ä½“ç³»ç»Ÿçš„æ„å»ºã€‚éœ€è¦ç³»ç»Ÿä¸åœçš„è¿­ä»£æ›´æ–°ã€‚; è¿ç»´å›¢é˜Ÿ ()å°†å¼€å‘å›¢é˜Ÿçš„Codeè¿›è¡Œæµ‹è¯•åéƒ¨ç½²ä¸Šçº¿ã€‚å¸Œæœ›ç³»ç»Ÿç¨³å®šå®‰å…¨è¿è¡Œã€‚; è¿™çœ‹ä¼¼ä¸¤ä¸ªç›®æ ‡ä¸åŒçš„å›¢é˜Ÿéœ€è¦ååŒå®Œæˆä¸€ä¸ªè½¯ä»¶çš„å¼€å‘ã€‚ åœ¨å¼€å‘å›¢é˜ŸæŒ‡å®šå¥½è®¡åˆ’å¹¶å®Œæˆcodingåï¼Œéœ€è¦æä¾›åˆ°è¿ç»´å›¢é˜Ÿã€‚ è¿...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-dcc7cde4.css" as="style"><link rel="stylesheet" href="/assets/style-dcc7cde4.css">
    <link rel="modulepreload" href="/assets/app-52ae57e5.js"><link rel="modulepreload" href="/assets/framework-b609eea8.js"><link rel="modulepreload" href="/assets/devops.html-761369c3.js"><link rel="modulepreload" href="/assets/devops.html-18b50e5c.js"><link rel="prefetch" href="/assets/index.html-2acc5daa.js" as="script"><link rel="prefetch" href="/assets/slides.html-cb6580a9.js" as="script"><link rel="prefetch" href="/assets/index.html-70738097.js" as="script"><link rel="prefetch" href="/assets/index.html-9132375b.js" as="script"><link rel="prefetch" href="/assets/index.html-28fe6193.js" as="script"><link rel="prefetch" href="/assets/unit-test.html-5f3f892c.js" as="script"><link rel="prefetch" href="/assets/index.html-00a6ffb0.js" as="script"><link rel="prefetch" href="/assets/index.html-280b773a.js" as="script"><link rel="prefetch" href="/assets/index.html-0a267c32.js" as="script"><link rel="prefetch" href="/assets/index.html-ddd3473c.js" as="script"><link rel="prefetch" href="/assets/index.html-5586a00e.js" as="script"><link rel="prefetch" href="/assets/index.html-cd5a1ce4.js" as="script"><link rel="prefetch" href="/assets/md-editor.html-efe1fda3.js" as="script"><link rel="prefetch" href="/assets/plugin-tools.html-e5647bbc.js" as="script"><link rel="prefetch" href="/assets/index.html-71948bf1.js" as="script"><link rel="prefetch" href="/assets/index.html-4c5f4f55.js" as="script"><link rel="prefetch" href="/assets/basis.html-294c1fb4.js" as="script"><link rel="prefetch" href="/assets/character-set.html-34767ce2.js" as="script"><link rel="prefetch" href="/assets/index.html-6381ea91.js" as="script"><link rel="prefetch" href="/assets/api-gateway.html-b677deb9.js" as="script"><link rel="prefetch" href="/assets/distributed-id.html-2aaf68b9.js" as="script"><link rel="prefetch" href="/assets/distributed-transaction.html-4c41afc8.js" as="script"><link rel="prefetch" href="/assets/index.html-790631eb.js" as="script"><link rel="prefetch" href="/assets/cluster.html-38b53a0b.js" as="script"><link rel="prefetch" href="/assets/disaster-recoveryANDremote-live.html-4abc74d4.js" as="script"><link rel="prefetch" href="/assets/fallbackANDcircuit-breaker.html-93de0374.js" as="script"><link rel="prefetch" href="/assets/high-availability-system-design.html-101acb5f.js" as="script"><link rel="prefetch" href="/assets/limit-request.html-49df11c1.js" as="script"><link rel="prefetch" href="/assets/performance-test.html-cf4ef09a.js" as="script"><link rel="prefetch" href="/assets/timeout-and-retry.html-3e6aa23c.js" as="script"><link rel="prefetch" href="/assets/index.html-6cbd3780.js" as="script"><link rel="prefetch" href="/assets/load-balancing.html-de9d3f36.js" as="script"><link rel="prefetch" href="/assets/read-and-write-separation-and-library-subtable.html-a53fb619.js" as="script"><link rel="prefetch" href="/assets/J2EEåŸºç¡€çŸ¥è¯†.html-b18ed577.js" as="script"><link rel="prefetch" href="/assets/index.html-a8f0ecb7.js" as="script"><link rel="prefetch" href="/assets/design-pattern.html-0116baae.js" as="script"><link rel="prefetch" href="/assets/schedule-task.html-c877cdf4.js" as="script"><link rel="prefetch" href="/assets/system-design-questions.html-9792d371.js" as="script"><link rel="prefetch" href="/assets/index.html-a47566d0.js" as="script"><link rel="prefetch" href="/assets/cluster.html-af82d682.js" as="script"><link rel="prefetch" href="/assets/index.html-1c923e57.js" as="script"><link rel="prefetch" href="/assets/container-dep.html-2d93c3c3.js" as="script"><link rel="prefetch" href="/assets/docker-install.html-e7ef92ba.js" as="script"><link rel="prefetch" href="/assets/git-intro.html-3a5429dc.js" as="script"><link rel="prefetch" href="/assets/github-tips.html-e882e424.js" as="script"><link rel="prefetch" href="/assets/10-classical-sorting-algorithms.html-9f7faa81.js" as="script"><link rel="prefetch" href="/assets/index.html-2b57d9f9.js" as="script"><link rel="prefetch" href="/assets/linkedlist-algorithm-problems.html-b695d65c.js" as="script"><link rel="prefetch" href="/assets/string-algorithm-problems.html-a5bbf1e9.js" as="script"><link rel="prefetch" href="/assets/the-sword-refers-to-offer.html-023b05d8.js" as="script"><link rel="prefetch" href="/assets/index.html-1b8bfb8b.js" as="script"><link rel="prefetch" href="/assets/bloom-filter.html-89344c3c.js" as="script"><link rel="prefetch" href="/assets/graph.html-2adbd24e.js" as="script"><link rel="prefetch" href="/assets/heap.html-b0f1f298.js" as="script"><link rel="prefetch" href="/assets/linear-data-structure.html-ff337f91.js" as="script"><link rel="prefetch" href="/assets/red-black-tree.html-36d0ee40.js" as="script"><link rel="prefetch" href="/assets/tree.html-6c329dcd.js" as="script"><link rel="prefetch" href="/assets/index.html-0e3e806d.js" as="script"><link rel="prefetch" href="/assets/http-prot.html-48c59e53.js" as="script"><link rel="prefetch" href="/assets/http-version.html-435bea24.js" as="script"><link rel="prefetch" href="/assets/net-model.html-288f08e7.js" as="script"><link rel="prefetch" href="/assets/other-network-questions.html-05595321.js" as="script"><link rel="prefetch" href="/assets/è®¡ç®—æœºç½‘ç»œå†…å®¹æ€»ç»“.html-ed668bef.js" as="script"><link rel="prefetch" href="/assets/index.html-a53e0d54.js" as="script"><link rel="prefetch" href="/assets/linux-intro.html-8f8433e6.js" as="script"><link rel="prefetch" href="/assets/operating-system-basic-questions-01.html-472df893.js" as="script"><link rel="prefetch" href="/assets/shell-intro.html-a9ba4942.js" as="script"><link rel="prefetch" href="/assets/a-thousand-lines-of-mysql-study-notes.html-e8a59500.js" as="script"><link rel="prefetch" href="/assets/how-sql-executed-in-mysql.html-f88bd62e.js" as="script"><link rel="prefetch" href="/assets/index-invalidation-caused-by-implicit-conversion.html-ef535b12.js" as="script"><link rel="prefetch" href="/assets/innodb-implementation-of-mvcc.html-684e9b38.js" as="script"><link rel="prefetch" href="/assets/mysql-high-performance-optimization-specification-recommendations.html-c05d75e5.js" as="script"><link rel="prefetch" href="/assets/mysql-index.html-fd371924.js" as="script"><link rel="prefetch" href="/assets/mysql-logs.html-acb5b4de.js" as="script"><link rel="prefetch" href="/assets/mysql-questions-01.html-79f4244f.js" as="script"><link rel="prefetch" href="/assets/some-thoughts-on-database-storage-time.html-88c118aa.js" as="script"><link rel="prefetch" href="/assets/transaction-isolation-level.html-4079e15a.js" as="script"><link rel="prefetch" href="/assets/3-commonly-used-cache-read-and-write-strategies.html-75ea89e3.js" as="script"><link rel="prefetch" href="/assets/cache-basics.html-157c3794.js" as="script"><link rel="prefetch" href="/assets/redis-cluster.html-2fe7137d.js" as="script"><link rel="prefetch" href="/assets/redis-memory-fragmentation.html-4c4a5c9b.js" as="script"><link rel="prefetch" href="/assets/redis-questions-01.html-ba45d44e.js" as="script"><link rel="prefetch" href="/assets/index.html-aefc1618.js" as="script"><link rel="prefetch" href="/assets/dubbo.html-3a174656.js" as="script"><link rel="prefetch" href="/assets/why-use-rpc.html-1085ef25.js" as="script"><link rel="prefetch" href="/assets/index.html-053da21c.js" as="script"><link rel="prefetch" href="/assets/capANDbase-theorem.html-f2ab30fc.js" as="script"><link rel="prefetch" href="/assets/gossip.html-e54b9048.js" as="script"><link rel="prefetch" href="/assets/paxos-algorithm.html-bb085bd7.js" as="script"><link rel="prefetch" href="/assets/raft-algorithm.html-4c78b787.js" as="script"><link rel="prefetch" href="/assets/index.html-b3c3f40f.js" as="script"><link rel="prefetch" href="/assets/kafka-questions-01.html-70e53658.js" as="script"><link rel="prefetch" href="/assets/message-queue.html-8b8cfac9.js" as="script"><link rel="prefetch" href="/assets/rabbitmq-intro.html-fc4b2563.js" as="script"><link rel="prefetch" href="/assets/rocketmq-intro.html-730d47d2.js" as="script"><link rel="prefetch" href="/assets/rocketmq-questions.html-6b367a0e.js" as="script"><link rel="prefetch" href="/assets/index.html-422b13da.js" as="script"><link rel="prefetch" href="/assets/bigdecimal.html-9d13622b.js" as="script"><link rel="prefetch" href="/assets/io.html-64ea22ce.js" as="script"><link rel="prefetch" href="/assets/java-basic-01.html-24654562.js" as="script"><link rel="prefetch" href="/assets/java-basic-02.html-618fff73.js" as="script"><link rel="prefetch" href="/assets/java-basic-03.html-5b12cfe8.js" as="script"><link rel="prefetch" href="/assets/proxy.html-c56e9420.js" as="script"><link rel="prefetch" href="/assets/reflection.html-f0835c75.js" as="script"><link rel="prefetch" href="/assets/serialization.html-f21da77d.js" as="script"><link rel="prefetch" href="/assets/why-there-only-value-passing-in-java.html-9a97e4bc.js" as="script"><link rel="prefetch" href="/assets/index.html-737c106f.js" as="script"><link rel="prefetch" href="/assets/java-collection-precautions-for-use.html-eb5f6a9f.js" as="script"><link rel="prefetch" href="/assets/java-collection-questions-01.html-e47bdf38.js" as="script"><link rel="prefetch" href="/assets/java-collection-questions-02.html-a08d27fa.js" as="script"><link rel="prefetch" href="/assets/index.html-dcc28405.js" as="script"><link rel="prefetch" href="/assets/aqs.html-1f510b5b.js" as="script"><link rel="prefetch" href="/assets/atomic-classes.html-4cdacb41.js" as="script"><link rel="prefetch" href="/assets/completablefuture-intro.html-9a73b262.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-collections.html-1da6c616.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-questions-01.html-846d0560.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-questions-02.html-228053a5.js" as="script"><link rel="prefetch" href="/assets/java-thread-pool-best-practices.html-7cfdf83c.js" as="script"><link rel="prefetch" href="/assets/java-thread-pool-summary.html-2b13c455.js" as="script"><link rel="prefetch" href="/assets/reentrantlock.html-bbbb5b0f.js" as="script"><link rel="prefetch" href="/assets/threadlocal.html-d1a7ca41.js" as="script"><link rel="prefetch" href="/assets/index.html-f38ff24c.js" as="script"><link rel="prefetch" href="/assets/classloader.html-093a4587.js" as="script"><link rel="prefetch" href="/assets/java-jvm-questions-01.html-d8323a2f.js" as="script"><link rel="prefetch" href="/assets/jvm-intro.html-e248f560.js" as="script"><link rel="prefetch" href="/assets/jvm-parameters-intro.html-0b644232.js" as="script"><link rel="prefetch" href="/assets/index.html-666ab3d2.js" as="script"><link rel="prefetch" href="/assets/java10.html-a8cbf960.js" as="script"><link rel="prefetch" href="/assets/java11.html-4e3400ba.js" as="script"><link rel="prefetch" href="/assets/java12-13.html-eaf73d5f.js" as="script"><link rel="prefetch" href="/assets/java14-15.html-c011c6a5.js" as="script"><link rel="prefetch" href="/assets/java8-common-new-features.html-4dd242bd.js" as="script"><link rel="prefetch" href="/assets/java8-tutorial-translate.html-2890e127.js" as="script"><link rel="prefetch" href="/assets/java9.html-c9cbd1e4.js" as="script"><link rel="prefetch" href="/assets/RESTfulAPI.html-a2216e0e.js" as="script"><link rel="prefetch" href="/assets/naming.html-f1da87fa.js" as="script"><link rel="prefetch" href="/assets/refactoring.html-1dfaab3a.js" as="script"><link rel="prefetch" href="/assets/index.html-1a99a0b0.js" as="script"><link rel="prefetch" href="/assets/netty.html-9634ad19.js" as="script"><link rel="prefetch" href="/assets/index.html-fb10e683.js" as="script"><link rel="prefetch" href="/assets/advantagesANDdisadvantages-of-jwt.html-6607a53d.js" as="script"><link rel="prefetch" href="/assets/basis-of-authority-certification.html-c9cb545f.js" as="script"><link rel="prefetch" href="/assets/data-desensitization.html-edb80c9b.js" as="script"><link rel="prefetch" href="/assets/jwt-intro.html-cc65c81a.js" as="script"><link rel="prefetch" href="/assets/sentive-words-filter.html-e615322f.js" as="script"><link rel="prefetch" href="/assets/sso-intro.html-99e1c18b.js" as="script"><link rel="prefetch" href="/assets/zookeeper-in-action.html-c41f1605.js" as="script"><link rel="prefetch" href="/assets/zookeeper-intro.html-c82c3cc9.js" as="script"><link rel="prefetch" href="/assets/zookeeper-plus.html-ef391187.js" as="script"><link rel="prefetch" href="/assets/arraylist-source-code.html-e090f1e4.js" as="script"><link rel="prefetch" href="/assets/concurrent-hash-map-source-code.html-5499c5b4.js" as="script"><link rel="prefetch" href="/assets/hashmap-source-code.html-b14e5bc5.js" as="script"><link rel="prefetch" href="/assets/page.html-5a758574.js" as="script"><link rel="prefetch" href="/assets/page.html-1f37af65.js" as="script"><link rel="prefetch" href="/assets/page.html-ac021c3d.js" as="script"><link rel="prefetch" href="/assets/jmeter.html-c0c34870.js" as="script"><link rel="prefetch" href="/assets/page.html-f8cce66b.js" as="script"><link rel="prefetch" href="/assets/page.html-834dfbe9.js" as="script"><link rel="prefetch" href="/assets/mybatis-interview.html-fceb40d6.js" as="script"><link rel="prefetch" href="/assets/home.html-98309d33.js" as="script"><link rel="prefetch" href="/assets/spring-boot-auto-assembly-principles.html-dcd1ce46.js" as="script"><link rel="prefetch" href="/assets/spring-common-annotations.html-aa932eb7.js" as="script"><link rel="prefetch" href="/assets/spring-design-patterns-summary.html-6ab6a955.js" as="script"><link rel="prefetch" href="/assets/spring-knowledge-and-questions-summary.html-1c62a2d0.js" as="script"><link rel="prefetch" href="/assets/spring-transaction.html-511b81d8.js" as="script"><link rel="prefetch" href="/assets/springcloud-intro.html-cccc3391.js" as="script"><link rel="prefetch" href="/assets/404.html-dace0b59.js" as="script"><link rel="prefetch" href="/assets/index.html-3d7c31d2.js" as="script"><link rel="prefetch" href="/assets/index.html-10537d52.js" as="script"><link rel="prefetch" href="/assets/index.html-d52cfba9.js" as="script"><link rel="prefetch" href="/assets/index.html-04ff42ba.js" as="script"><link rel="prefetch" href="/assets/index.html-ba2715df.js" as="script"><link rel="prefetch" href="/assets/index.html-425f9ff6.js" as="script"><link rel="prefetch" href="/assets/index.html-a5e20d12.js" as="script"><link rel="prefetch" href="/assets/index.html-ed82d9ef.js" as="script"><link rel="prefetch" href="/assets/index.html-ca092b48.js" as="script"><link rel="prefetch" href="/assets/index.html-828fa323.js" as="script"><link rel="prefetch" href="/assets/index.html-5cd74f49.js" as="script"><link rel="prefetch" href="/assets/index.html-f06626ad.js" as="script"><link rel="prefetch" href="/assets/index.html-60f42455.js" as="script"><link rel="prefetch" href="/assets/index.html-b35e16b5.js" as="script"><link rel="prefetch" href="/assets/index.html-a70a22c0.js" as="script"><link rel="prefetch" href="/assets/index.html-c0110800.js" as="script"><link rel="prefetch" href="/assets/index.html-407fc630.js" as="script"><link rel="prefetch" href="/assets/index.html-d5b70c4b.js" as="script"><link rel="prefetch" href="/assets/index.html-36223a22.js" as="script"><link rel="prefetch" href="/assets/index.html-525f1e3c.js" as="script"><link rel="prefetch" href="/assets/slides.html-f897cd77.js" as="script"><link rel="prefetch" href="/assets/index.html-d586bb07.js" as="script"><link rel="prefetch" href="/assets/index.html-7a629ac5.js" as="script"><link rel="prefetch" href="/assets/index.html-0db35a88.js" as="script"><link rel="prefetch" href="/assets/unit-test.html-cb9c949b.js" as="script"><link rel="prefetch" href="/assets/index.html-1c582d16.js" as="script"><link rel="prefetch" href="/assets/index.html-9526c5e1.js" as="script"><link rel="prefetch" href="/assets/index.html-bee7a83f.js" as="script"><link rel="prefetch" href="/assets/index.html-31398a59.js" as="script"><link rel="prefetch" href="/assets/index.html-871703ef.js" as="script"><link rel="prefetch" href="/assets/index.html-d927d933.js" as="script"><link rel="prefetch" href="/assets/md-editor.html-90629000.js" as="script"><link rel="prefetch" href="/assets/plugin-tools.html-b8642d26.js" as="script"><link rel="prefetch" href="/assets/index.html-605e778b.js" as="script"><link rel="prefetch" href="/assets/index.html-72f49d57.js" as="script"><link rel="prefetch" href="/assets/basis.html-4ffdbaea.js" as="script"><link rel="prefetch" href="/assets/character-set.html-2065c25c.js" as="script"><link rel="prefetch" href="/assets/index.html-38b7d6e0.js" as="script"><link rel="prefetch" href="/assets/api-gateway.html-966e57c5.js" as="script"><link rel="prefetch" href="/assets/distributed-id.html-14c35e14.js" as="script"><link rel="prefetch" href="/assets/distributed-transaction.html-9a4eb767.js" as="script"><link rel="prefetch" href="/assets/index.html-1cdd09c4.js" as="script"><link rel="prefetch" href="/assets/cluster.html-24143319.js" as="script"><link rel="prefetch" href="/assets/disaster-recoveryANDremote-live.html-3b7df490.js" as="script"><link rel="prefetch" href="/assets/fallbackANDcircuit-breaker.html-eeff7866.js" as="script"><link rel="prefetch" href="/assets/high-availability-system-design.html-b3be667d.js" as="script"><link rel="prefetch" href="/assets/limit-request.html-f614e105.js" as="script"><link rel="prefetch" href="/assets/performance-test.html-6ebe012c.js" as="script"><link rel="prefetch" href="/assets/timeout-and-retry.html-ea5a1411.js" as="script"><link rel="prefetch" href="/assets/index.html-cc7a6715.js" as="script"><link rel="prefetch" href="/assets/load-balancing.html-1d0a4789.js" as="script"><link rel="prefetch" href="/assets/read-and-write-separation-and-library-subtable.html-a080b04e.js" as="script"><link rel="prefetch" href="/assets/J2EEåŸºç¡€çŸ¥è¯†.html-4d49204e.js" as="script"><link rel="prefetch" href="/assets/index.html-e2ad0dcc.js" as="script"><link rel="prefetch" href="/assets/design-pattern.html-069057a6.js" as="script"><link rel="prefetch" href="/assets/schedule-task.html-27be2293.js" as="script"><link rel="prefetch" href="/assets/system-design-questions.html-9387bfee.js" as="script"><link rel="prefetch" href="/assets/index.html-14ba3254.js" as="script"><link rel="prefetch" href="/assets/cluster.html-bb567bff.js" as="script"><link rel="prefetch" href="/assets/index.html-bfebbab9.js" as="script"><link rel="prefetch" href="/assets/container-dep.html-7cd681ab.js" as="script"><link rel="prefetch" href="/assets/docker-install.html-34f71668.js" as="script"><link rel="prefetch" href="/assets/git-intro.html-3c0f3d9d.js" as="script"><link rel="prefetch" href="/assets/github-tips.html-95b5bd86.js" as="script"><link rel="prefetch" href="/assets/10-classical-sorting-algorithms.html-dd31c84d.js" as="script"><link rel="prefetch" href="/assets/index.html-2a6b7138.js" as="script"><link rel="prefetch" href="/assets/linkedlist-algorithm-problems.html-b4c5040b.js" as="script"><link rel="prefetch" href="/assets/string-algorithm-problems.html-b568ecf9.js" as="script"><link rel="prefetch" href="/assets/the-sword-refers-to-offer.html-36bf0c0d.js" as="script"><link rel="prefetch" href="/assets/index.html-4580197d.js" as="script"><link rel="prefetch" href="/assets/bloom-filter.html-37e503e3.js" as="script"><link rel="prefetch" href="/assets/graph.html-c4a4cece.js" as="script"><link rel="prefetch" href="/assets/heap.html-ff794e78.js" as="script"><link rel="prefetch" href="/assets/linear-data-structure.html-37e867b9.js" as="script"><link rel="prefetch" href="/assets/red-black-tree.html-3f1c9bec.js" as="script"><link rel="prefetch" href="/assets/tree.html-0f1ade7b.js" as="script"><link rel="prefetch" href="/assets/index.html-5d3f2877.js" as="script"><link rel="prefetch" href="/assets/http-prot.html-13f07646.js" as="script"><link rel="prefetch" href="/assets/http-version.html-8e842220.js" as="script"><link rel="prefetch" href="/assets/net-model.html-e012bfc5.js" as="script"><link rel="prefetch" href="/assets/other-network-questions.html-88af7735.js" as="script"><link rel="prefetch" href="/assets/è®¡ç®—æœºç½‘ç»œå†…å®¹æ€»ç»“.html-fc79d8e1.js" as="script"><link rel="prefetch" href="/assets/index.html-79e1c3b5.js" as="script"><link rel="prefetch" href="/assets/linux-intro.html-8967c52c.js" as="script"><link rel="prefetch" href="/assets/operating-system-basic-questions-01.html-9f945679.js" as="script"><link rel="prefetch" href="/assets/shell-intro.html-42479a34.js" as="script"><link rel="prefetch" href="/assets/a-thousand-lines-of-mysql-study-notes.html-ee11f31d.js" as="script"><link rel="prefetch" href="/assets/how-sql-executed-in-mysql.html-b1af8a24.js" as="script"><link rel="prefetch" href="/assets/index-invalidation-caused-by-implicit-conversion.html-2b08b7b5.js" as="script"><link rel="prefetch" href="/assets/innodb-implementation-of-mvcc.html-82610c44.js" as="script"><link rel="prefetch" href="/assets/mysql-high-performance-optimization-specification-recommendations.html-f4064d29.js" as="script"><link rel="prefetch" href="/assets/mysql-index.html-72368cd2.js" as="script"><link rel="prefetch" href="/assets/mysql-logs.html-59d81164.js" as="script"><link rel="prefetch" href="/assets/mysql-questions-01.html-549efd05.js" as="script"><link rel="prefetch" href="/assets/some-thoughts-on-database-storage-time.html-7d36f865.js" as="script"><link rel="prefetch" href="/assets/transaction-isolation-level.html-b7039563.js" as="script"><link rel="prefetch" href="/assets/3-commonly-used-cache-read-and-write-strategies.html-4fb675b1.js" as="script"><link rel="prefetch" href="/assets/cache-basics.html-879b08bc.js" as="script"><link rel="prefetch" href="/assets/redis-cluster.html-127c786d.js" as="script"><link rel="prefetch" href="/assets/redis-memory-fragmentation.html-32c412be.js" as="script"><link rel="prefetch" href="/assets/redis-questions-01.html-da32e730.js" as="script"><link rel="prefetch" href="/assets/index.html-f42b91c6.js" as="script"><link rel="prefetch" href="/assets/dubbo.html-c8d7299f.js" as="script"><link rel="prefetch" href="/assets/why-use-rpc.html-5c39fb6a.js" as="script"><link rel="prefetch" href="/assets/index.html-ea26879c.js" as="script"><link rel="prefetch" href="/assets/capANDbase-theorem.html-e1df6aa6.js" as="script"><link rel="prefetch" href="/assets/gossip.html-a05e370f.js" as="script"><link rel="prefetch" href="/assets/paxos-algorithm.html-4b760923.js" as="script"><link rel="prefetch" href="/assets/raft-algorithm.html-ab6999a0.js" as="script"><link rel="prefetch" href="/assets/index.html-30614db3.js" as="script"><link rel="prefetch" href="/assets/kafka-questions-01.html-b0cbf96f.js" as="script"><link rel="prefetch" href="/assets/message-queue.html-dbf4715a.js" as="script"><link rel="prefetch" href="/assets/rabbitmq-intro.html-9a9c39a5.js" as="script"><link rel="prefetch" href="/assets/rocketmq-intro.html-7460e487.js" as="script"><link rel="prefetch" href="/assets/rocketmq-questions.html-7aa30ec3.js" as="script"><link rel="prefetch" href="/assets/index.html-bb5dc50a.js" as="script"><link rel="prefetch" href="/assets/bigdecimal.html-82757960.js" as="script"><link rel="prefetch" href="/assets/io.html-034e1b72.js" as="script"><link rel="prefetch" href="/assets/java-basic-01.html-ec19cd19.js" as="script"><link rel="prefetch" href="/assets/java-basic-02.html-5b76d830.js" as="script"><link rel="prefetch" href="/assets/java-basic-03.html-87c7cf7b.js" as="script"><link rel="prefetch" href="/assets/proxy.html-e874fd74.js" as="script"><link rel="prefetch" href="/assets/reflection.html-10b1b391.js" as="script"><link rel="prefetch" href="/assets/serialization.html-c174fa8f.js" as="script"><link rel="prefetch" href="/assets/why-there-only-value-passing-in-java.html-8767553b.js" as="script"><link rel="prefetch" href="/assets/index.html-d03710a7.js" as="script"><link rel="prefetch" href="/assets/java-collection-precautions-for-use.html-6232fa5e.js" as="script"><link rel="prefetch" href="/assets/java-collection-questions-01.html-2004c72d.js" as="script"><link rel="prefetch" href="/assets/java-collection-questions-02.html-1fbd69cb.js" as="script"><link rel="prefetch" href="/assets/index.html-88103f20.js" as="script"><link rel="prefetch" href="/assets/aqs.html-b4d105a4.js" as="script"><link rel="prefetch" href="/assets/atomic-classes.html-77e285fb.js" as="script"><link rel="prefetch" href="/assets/completablefuture-intro.html-a5f40037.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-collections.html-9a4f7995.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-questions-01.html-9df61a8a.js" as="script"><link rel="prefetch" href="/assets/java-concurrent-questions-02.html-8f28e062.js" as="script"><link rel="prefetch" href="/assets/java-thread-pool-best-practices.html-95cd1dc9.js" as="script"><link rel="prefetch" href="/assets/java-thread-pool-summary.html-bf8688e3.js" as="script"><link rel="prefetch" href="/assets/reentrantlock.html-fa14c7eb.js" as="script"><link rel="prefetch" href="/assets/threadlocal.html-4356699c.js" as="script"><link rel="prefetch" href="/assets/index.html-218f212d.js" as="script"><link rel="prefetch" href="/assets/classloader.html-30a871c2.js" as="script"><link rel="prefetch" href="/assets/java-jvm-questions-01.html-13f80fe2.js" as="script"><link rel="prefetch" href="/assets/jvm-intro.html-c62e6764.js" as="script"><link rel="prefetch" href="/assets/jvm-parameters-intro.html-969ccf0c.js" as="script"><link rel="prefetch" href="/assets/index.html-c8e29b77.js" as="script"><link rel="prefetch" href="/assets/java10.html-8dbf441e.js" as="script"><link rel="prefetch" href="/assets/java11.html-91be4f20.js" as="script"><link rel="prefetch" href="/assets/java12-13.html-3988c8ea.js" as="script"><link rel="prefetch" href="/assets/java14-15.html-56f5577e.js" as="script"><link rel="prefetch" href="/assets/java8-common-new-features.html-587a0d91.js" as="script"><link rel="prefetch" href="/assets/java8-tutorial-translate.html-fb49d8f6.js" as="script"><link rel="prefetch" href="/assets/java9.html-d7318134.js" as="script"><link rel="prefetch" href="/assets/RESTfulAPI.html-3645e0d2.js" as="script"><link rel="prefetch" href="/assets/naming.html-dfc0cbb7.js" as="script"><link rel="prefetch" href="/assets/refactoring.html-fbe06c40.js" as="script"><link rel="prefetch" href="/assets/index.html-1e2f6032.js" as="script"><link rel="prefetch" href="/assets/netty.html-e2b2f6c8.js" as="script"><link rel="prefetch" href="/assets/index.html-a8d3c868.js" as="script"><link rel="prefetch" href="/assets/advantagesANDdisadvantages-of-jwt.html-8a22932f.js" as="script"><link rel="prefetch" href="/assets/basis-of-authority-certification.html-b0bbcf68.js" as="script"><link rel="prefetch" href="/assets/data-desensitization.html-5fbbb3fe.js" as="script"><link rel="prefetch" href="/assets/jwt-intro.html-f78215ee.js" as="script"><link rel="prefetch" href="/assets/sentive-words-filter.html-70c0342c.js" as="script"><link rel="prefetch" href="/assets/sso-intro.html-96c785b0.js" as="script"><link rel="prefetch" href="/assets/zookeeper-in-action.html-e3721581.js" as="script"><link rel="prefetch" href="/assets/zookeeper-intro.html-5266d94c.js" as="script"><link rel="prefetch" href="/assets/zookeeper-plus.html-8d47f518.js" as="script"><link rel="prefetch" href="/assets/arraylist-source-code.html-306fc9b2.js" as="script"><link rel="prefetch" href="/assets/concurrent-hash-map-source-code.html-75183624.js" as="script"><link rel="prefetch" href="/assets/hashmap-source-code.html-21eceaad.js" as="script"><link rel="prefetch" href="/assets/page.html-ffa182ac.js" as="script"><link rel="prefetch" href="/assets/page.html-e2c3658e.js" as="script"><link rel="prefetch" href="/assets/page.html-dba162f0.js" as="script"><link rel="prefetch" href="/assets/jmeter.html-e0db2b0d.js" as="script"><link rel="prefetch" href="/assets/page.html-6c969f8e.js" as="script"><link rel="prefetch" href="/assets/page.html-6159e61f.js" as="script"><link rel="prefetch" href="/assets/mybatis-interview.html-89bc3847.js" as="script"><link rel="prefetch" href="/assets/home.html-f9bd39db.js" as="script"><link rel="prefetch" href="/assets/spring-boot-auto-assembly-principles.html-ee4948dd.js" as="script"><link rel="prefetch" href="/assets/spring-common-annotations.html-8a6d047c.js" as="script"><link rel="prefetch" href="/assets/spring-design-patterns-summary.html-61a9124d.js" as="script"><link rel="prefetch" href="/assets/spring-knowledge-and-questions-summary.html-38716c93.js" as="script"><link rel="prefetch" href="/assets/spring-transaction.html-34f5b557.js" as="script"><link rel="prefetch" href="/assets/springcloud-intro.html-ddce26ea.js" as="script"><link rel="prefetch" href="/assets/404.html-e8996780.js" as="script"><link rel="prefetch" href="/assets/index.html-f8a230a4.js" as="script"><link rel="prefetch" href="/assets/index.html-b620fa9c.js" as="script"><link rel="prefetch" href="/assets/index.html-65ae818b.js" as="script"><link rel="prefetch" href="/assets/index.html-aa0f614e.js" as="script"><link rel="prefetch" href="/assets/index.html-7eec84d5.js" as="script"><link rel="prefetch" href="/assets/index.html-617d2515.js" as="script"><link rel="prefetch" href="/assets/index.html-3e6ca8b7.js" as="script"><link rel="prefetch" href="/assets/index.html-8b56c661.js" as="script"><link rel="prefetch" href="/assets/index.html-c0e3a684.js" as="script"><link rel="prefetch" href="/assets/index.html-60d3cc3c.js" as="script"><link rel="prefetch" href="/assets/index.html-c136b280.js" as="script"><link rel="prefetch" href="/assets/index.html-5cc69572.js" as="script"><link rel="prefetch" href="/assets/index.html-ebfe6880.js" as="script"><link rel="prefetch" href="/assets/index.html-2890bae0.js" as="script"><link rel="prefetch" href="/assets/index.html-7dffdbca.js" as="script"><link rel="prefetch" href="/assets/index.html-254d4379.js" as="script"><link rel="prefetch" href="/assets/index.html-ebb83c84.js" as="script"><link rel="prefetch" href="/assets/index.html-ad1a59af.js" as="script"><link rel="prefetch" href="/assets/index.html-f9c0b904.js" as="script"><link rel="prefetch" href="/assets/auto-ba5ecab5.js" as="script"><link rel="prefetch" href="/assets/index-b03bef79.js" as="script"><link rel="prefetch" href="/assets/flowchart-35969cab.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-b0d0223b.js" as="script"><link rel="prefetch" href="/assets/highlight.esm-a794bb63.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-d92a2fc9.js" as="script"><link rel="prefetch" href="/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/assets/notes.esm-224f94d9.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-e5069ce0.js" as="script"><link rel="prefetch" href="/assets/search.esm-2c3fba7d.js" as="script"><link rel="prefetch" href="/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/assets/VuePlayground-d7b8a481.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-6e6cbe40.js" as="script"><link rel="prefetch" href="/assets/SearchResult-bd58b92b.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button type="button" class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.png" alt="è½»æ¾æ˜ŸæœŸäº”"><!----><span class="site-name hide-in-pad">è½»æ¾æ˜ŸæœŸäº”</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="çŸ¥è¯†åº“"><span class="title"><span class="font-icon icon iconfont icon-knowledge" style=""></span>çŸ¥è¯†åº“</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/kb/bakend/" class="nav-link" aria-label="åç«¯"><span class="font-icon icon iconfont icon-houduankaifa" style=""></span>åç«¯<!----></a></li><li class="dropdown-item"><a href="/kb/frontend/" class="nav-link" aria-label="å‰ç«¯"><span class="font-icon icon iconfont icon-qianduankaifa" style=""></span>å‰ç«¯<!----></a></li><li class="dropdown-item"><a href="/kb/operation/" class="nav-link active" aria-label="è¿ç»´"><span class="font-icon icon iconfont icon-yunwei" style=""></span>è¿ç»´<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/dev-tips/" class="nav-link" aria-label="å¼€å‘æŠ€å·§"><span class="font-icon icon iconfont icon-tips" style=""></span>å¼€å‘æŠ€å·§<!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/heplex/ezfri-docs" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" role="search" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="placeholder">æœç´¢</div><div class="key-hints"><kbd class="key">Ctrl</kbd><kbd class="key">K</kbd></div></button><!--]--><!--[--><!----><!--]--><button type="button" class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable active" type="button"><!----><span class="title">åŸºç¡€çŸ¥è¯†</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a aria-current="page" href="/kb/operation/devops/devops.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="DevOps"><!---->DevOps<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/kb/operation/devops/devops.html#ä¸€ã€devopsä»‹ç»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¸€ã€DevOpsä»‹ç»"><!---->ä¸€ã€DevOpsä»‹ç»<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/kb/operation/devops/devops.html#äºŒã€codeé˜¶æ®µå·¥å…·" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="äºŒã€Codeé˜¶æ®µå·¥å…·"><!---->äºŒã€Codeé˜¶æ®µå·¥å…·<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/kb/operation/devops/devops.html#ä¸‰ã€buildé˜¶æ®µå·¥å…·" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¸‰ã€Buildé˜¶æ®µå·¥å…·"><!---->ä¸‰ã€Buildé˜¶æ®µå·¥å…·<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/kb/operation/devops/devops.html#å››ã€operateé˜¶æ®µå·¥å…·" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å››ã€Operateé˜¶æ®µå·¥å…·"><!---->å››ã€Operateé˜¶æ®µå·¥å…·<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/kb/operation/devops/devops.html#äº”ã€integrateå·¥å…·" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="äº”ã€Integrateå·¥å…·"><!---->äº”ã€Integrateå·¥å…·<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/kb/operation/devops/devops.html#å…­ã€ciã€cdå…¥é—¨æ“ä½œ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å…­ã€CIã€CDå…¥é—¨æ“ä½œ"><!---->å…­ã€CIã€CDå…¥é—¨æ“ä½œ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/kb/operation/devops/devops.html#ä¸ƒã€é›†æˆsonar-qube" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¸ƒã€é›†æˆSonar Qube"><!---->ä¸ƒã€é›†æˆSonar Qube<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/kb/operation/devops/devops.html#å…«ã€é›†æˆharbor" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å…«ã€é›†æˆHarbor"><!---->å…«ã€é›†æˆHarbor<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/kb/operation/devops/devops.html#ä¹ã€jenkinsæµæ°´çº¿" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ä¹ã€Jenkinsæµæ°´çº¿"><!---->ä¹ã€Jenkinsæµæ°´çº¿<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/kb/operation/devops/devops.html#åã€kubernetesç¼–æ’å·¥å…·" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åã€Kubernetesç¼–æ’å·¥å…·"><!---->åã€Kubernetesç¼–æ’å·¥å…·<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">åº”ç”¨éƒ¨ç½²</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">Docker</span><span class="arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->DevOps</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://doc.ezfri.com" target="_blank" rel="noopener noreferrer">è½»æ¾æ˜ŸæœŸäº”</a></span><span property="author" content="è½»æ¾æ˜ŸæœŸäº”"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-04-03T03:06:39.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 38 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT38M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/kb/operation/devops/devops.html#ä¸€ã€devopsä»‹ç»" class="router-link-active router-link-exact-active toc-link level3">ä¸€ã€DevOpsä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/kb/operation/devops/devops.html#äºŒã€codeé˜¶æ®µå·¥å…·" class="router-link-active router-link-exact-active toc-link level3">äºŒã€Codeé˜¶æ®µå·¥å…·</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/kb/operation/devops/devops.html#ä¸‰ã€buildé˜¶æ®µå·¥å…·" class="router-link-active router-link-exact-active toc-link level3">ä¸‰ã€Buildé˜¶æ®µå·¥å…·</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/kb/operation/devops/devops.html#å››ã€operateé˜¶æ®µå·¥å…·" class="router-link-active router-link-exact-active toc-link level3">å››ã€Operateé˜¶æ®µå·¥å…·</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/kb/operation/devops/devops.html#äº”ã€integrateå·¥å…·" class="router-link-active router-link-exact-active toc-link level3">äº”ã€Integrateå·¥å…·</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/kb/operation/devops/devops.html#å…­ã€ciã€cdå…¥é—¨æ“ä½œ" class="router-link-active router-link-exact-active toc-link level3">å…­ã€CIã€CDå…¥é—¨æ“ä½œ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/kb/operation/devops/devops.html#ä¸ƒã€é›†æˆsonar-qube" class="router-link-active router-link-exact-active toc-link level3">ä¸ƒã€é›†æˆSonar Qube</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/kb/operation/devops/devops.html#å…«ã€é›†æˆharbor" class="router-link-active router-link-exact-active toc-link level3">å…«ã€é›†æˆHarbor</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/kb/operation/devops/devops.html#ä¹ã€jenkinsæµæ°´çº¿" class="router-link-active router-link-exact-active toc-link level3">ä¹ã€Jenkinsæµæ°´çº¿</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/kb/operation/devops/devops.html#åã€kubernetesç¼–æ’å·¥å…·" class="router-link-active router-link-exact-active toc-link level3">åã€Kubernetesç¼–æ’å·¥å…·</a></li><!----><!--]--></ul></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h1 id="devops" tabindex="-1"><a class="header-anchor" href="#devops" aria-hidden="true">#</a> DevOps</h1><nav class="table-of-contents"><ul><li><a aria-current="page" href="/kb/operation/devops/devops.html#ä¸€ã€devopsä»‹ç»" class="router-link-active router-link-exact-active">ä¸€ã€DevOpsä»‹ç»</a></li><li><a aria-current="page" href="/kb/operation/devops/devops.html#äºŒã€codeé˜¶æ®µå·¥å…·" class="router-link-active router-link-exact-active">äºŒã€Codeé˜¶æ®µå·¥å…·</a></li><li><a aria-current="page" href="/kb/operation/devops/devops.html#ä¸‰ã€buildé˜¶æ®µå·¥å…·" class="router-link-active router-link-exact-active">ä¸‰ã€Buildé˜¶æ®µå·¥å…·</a></li><li><a aria-current="page" href="/kb/operation/devops/devops.html#å››ã€operateé˜¶æ®µå·¥å…·" class="router-link-active router-link-exact-active">å››ã€Operateé˜¶æ®µå·¥å…·</a></li><li><a aria-current="page" href="/kb/operation/devops/devops.html#äº”ã€integrateå·¥å…·" class="router-link-active router-link-exact-active">äº”ã€Integrateå·¥å…·</a></li><li><a aria-current="page" href="/kb/operation/devops/devops.html#å…­ã€ciã€cdå…¥é—¨æ“ä½œ" class="router-link-active router-link-exact-active">å…­ã€CIã€CDå…¥é—¨æ“ä½œ</a></li><li><a aria-current="page" href="/kb/operation/devops/devops.html#ä¸ƒã€é›†æˆsonar-qube" class="router-link-active router-link-exact-active">ä¸ƒã€é›†æˆSonar Qube</a></li><li><a aria-current="page" href="/kb/operation/devops/devops.html#å…«ã€é›†æˆharbor" class="router-link-active router-link-exact-active">å…«ã€é›†æˆHarbor</a></li><li><a aria-current="page" href="/kb/operation/devops/devops.html#ä¹ã€jenkinsæµæ°´çº¿" class="router-link-active router-link-exact-active">ä¹ã€Jenkinsæµæ°´çº¿</a></li><li><a aria-current="page" href="/kb/operation/devops/devops.html#åã€kubernetesç¼–æ’å·¥å…·" class="router-link-active router-link-exact-active">åã€Kubernetesç¼–æ’å·¥å…·</a></li></ul></nav><h3 id="ä¸€ã€devopsä»‹ç»" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€devopsä»‹ç»" aria-hidden="true">#</a> ä¸€ã€DevOpsä»‹ç»</h3><p>è½¯ä»¶å¼€å‘æœ€å¼€å§‹æ˜¯ç”±ä¸¤ä¸ªå›¢é˜Ÿç»„æˆï¼š</p><ul><li>å¼€å‘è®¡åˆ’ç”±<a href="">å¼€å‘å›¢é˜Ÿ</a>ä»å¤´å¼€å§‹è®¾è®¡å’Œæ•´ä½“ç³»ç»Ÿçš„æ„å»ºã€‚éœ€è¦ç³»ç»Ÿä¸åœçš„è¿­ä»£æ›´æ–°ã€‚</li><li><a href="">è¿ç»´å›¢é˜Ÿ</a>å°†å¼€å‘å›¢é˜Ÿçš„Codeè¿›è¡Œæµ‹è¯•åéƒ¨ç½²ä¸Šçº¿ã€‚å¸Œæœ›ç³»ç»Ÿç¨³å®šå®‰å…¨è¿è¡Œã€‚</li></ul><p>è¿™çœ‹ä¼¼ä¸¤ä¸ªç›®æ ‡ä¸åŒçš„å›¢é˜Ÿéœ€è¦ååŒå®Œæˆä¸€ä¸ªè½¯ä»¶çš„å¼€å‘ã€‚</p><p>åœ¨å¼€å‘å›¢é˜ŸæŒ‡å®šå¥½è®¡åˆ’å¹¶å®Œæˆcodingåï¼Œéœ€è¦æä¾›åˆ°è¿ç»´å›¢é˜Ÿã€‚</p><p>è¿ç»´å›¢é˜Ÿå‘å¼€å‘å›¢é˜Ÿåé¦ˆéœ€è¦ä¿®å¤çš„BUGä»¥åŠä¸€äº›éœ€è¦è¿”å·¥çš„ä»»åŠ¡ã€‚</p><p>è¿™æ—¶å¼€å‘å›¢é˜Ÿéœ€è¦ç»å¸¸ç­‰å¾…è¿ç»´å›¢é˜Ÿçš„åé¦ˆã€‚è¿™æ— ç–‘å»¶é•¿äº†äº‹ä»¶å¹¶æ¨è¿Ÿäº†æ•´ä¸ªè½¯ä»¶å¼€å‘çš„å‘¨æœŸã€‚</p><p>ä¼šæœ‰ä¸€ç§æ–¹å¼ï¼Œåœ¨å¼€å‘å›¢é˜Ÿç­‰å¾…çš„æ—¶å€™ï¼Œè®©å¼€å‘å›¢é˜Ÿè½¬ç§»åˆ°ä¸‹ä¸€ä¸ªé¡¹ç›®ä¸­ã€‚ç­‰å¾…è¿ç»´å›¢é˜Ÿä¸ºä¹‹å‰çš„ä»£ç æä¾›åé¦ˆã€‚</p><p>å¯æ˜¯è¿™æ ·å°±æ„å‘³ç€ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®éœ€è¦ä¸€ä¸ªæ›´é•¿çš„å‘¨æœŸæ‰å¯ä»¥å¼€å‘å‡ºæœ€ç»ˆä»£ç ã€‚</p><hr><p>åŸºäºç°åœ¨çš„äº’è”ç½‘ç°çŠ¶ï¼Œæ›´æ¨å´‡æ•æ·å¼å¼€å‘ï¼Œè¿™æ ·å°±å¯¼è‡´é¡¹ç›®çš„è¿­ä»£é€Ÿåº¦æ›´å¿«ï¼Œä½†æ˜¯ç”±äºå¼€å‘å›¢é˜Ÿä¸è¿ç»´å›¢é˜Ÿçš„æ²Ÿé€šé—®é¢˜ï¼Œä¼šå¯¼è‡´æ–°ç‰ˆæœ¬ä¸Šçº¿çš„æ—¶é—´æˆæœ¬å¾ˆé«˜ã€‚è¿™åˆè¿èƒŒçš„æ•æ·å¼å¼€å‘çš„æœ€åˆçš„ç›®çš„ã€‚</p><p>é‚£ä¹ˆå¦‚æœè®©å¼€å‘å›¢é˜Ÿå’Œè¿ç»´å›¢é˜Ÿæ•´åˆåˆ°æˆä¸€ä¸ªå›¢é˜Ÿï¼ŒååŒåº”å¯¹ä¸€å¥—è½¯ä»¶å‘¢ï¼Ÿè¿™å°±è¢«ç§°ä¸º<a href="">DevOps</a>ã€‚</p><p><a href="">DevOps</a>ï¼Œå­—é¢æ„æ€æ˜¯Development &amp;Operationsçš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯å¼€å‘&amp;è¿ç»´ã€‚</p><p>è™½ç„¶å­—é¢æ„æ€åªæ¶‰åŠåˆ°äº†å¼€å‘å›¢é˜Ÿå’Œè¿ç»´å›¢é˜Ÿï¼Œå…¶å®QAæµ‹è¯•å›¢é˜Ÿä¹Ÿæ˜¯å‚ä¸å…¶ä¸­çš„ã€‚</p><p>ç½‘ä¸Šå¯ä»¥æŸ¥çœ‹åˆ°<a href="">DevOps</a>çš„ç¬¦å·ç±»ä¼¼äºä¸€ä¸ªæ— ç©·å¤§çš„ç¬¦å·</p><table><thead><tr><th style="text-align:center;"><a href="">DevOps</a></th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211124130409521-1ec9bfb6.png" alt="image-20211124130409521" loading="lazy"></td></tr></tbody></table><p>è¿™è¡¨æ˜<a href="">DevOps</a>æ˜¯ä¸€ä¸ªä¸æ–­æé«˜æ•ˆç‡å¹¶ä¸”æŒç»­ä¸æ–­å·¥ä½œçš„è¿‡ç¨‹</p><p><a href="">DevOps</a>çš„æ–¹å¼å¯ä»¥è®©å…¬å¸èƒ½å¤Ÿæ›´å¿«åœ°åº”å¯¹æ›´æ–°å’Œå¸‚åœºå‘å±•å˜åŒ–ï¼Œå¼€å‘å¯ä»¥å¿«é€Ÿäº¤ä»˜ï¼Œéƒ¨ç½²ä¹Ÿæ›´åŠ ç¨³å®šã€‚</p><p>æ ¸å¿ƒå°±åœ¨äº<a href="">ç®€åŒ–Devå’ŒOpså›¢é˜Ÿä¹‹é—´çš„æµç¨‹ï¼Œä½¿æ•´ä½“è½¯ä»¶å¼€å‘è¿‡ç¨‹æ›´å¿«é€Ÿã€‚</a></p><p>æ•´ä½“çš„è½¯ä»¶å¼€å‘æµç¨‹åŒ…æ‹¬ï¼š</p><ul><li>PLANï¼šå¼€å‘å›¢é˜Ÿæ ¹æ®å®¢æˆ·çš„ç›®æ ‡åˆ¶å®šå¼€å‘è®¡åˆ’</li><li>CODEï¼šæ ¹æ®PLANå¼€å§‹ç¼–ç è¿‡ç¨‹ï¼Œéœ€è¦å°†ä¸åŒç‰ˆæœ¬çš„ä»£ç å­˜å‚¨åœ¨ä¸€ä¸ªåº“ä¸­ã€‚</li><li>BUILDï¼šç¼–ç å®Œæˆåï¼Œéœ€è¦å°†ä»£ç æ„å»ºå¹¶ä¸”è¿è¡Œã€‚</li><li>TESTï¼šæˆåŠŸæ„å»ºé¡¹ç›®åï¼Œéœ€è¦æµ‹è¯•ä»£ç æ˜¯å¦å­˜åœ¨BUGæˆ–é”™è¯¯ã€‚</li><li>DEPLOYï¼šä»£ç ç»è¿‡æ‰‹åŠ¨æµ‹è¯•å’Œè‡ªåŠ¨åŒ–æµ‹è¯•åï¼Œè®¤å®šä»£ç å·²ç»å‡†å¤‡å¥½éƒ¨ç½²å¹¶ä¸”äº¤ç»™è¿ç»´å›¢é˜Ÿã€‚</li><li>OPERATEï¼šè¿ç»´å›¢é˜Ÿå°†ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚</li><li>MONITORï¼šé¡¹ç›®éƒ¨ç½²ä¸Šçº¿åï¼Œéœ€è¦æŒç»­çš„ç›‘æ§äº§å“ã€‚</li><li>INTEGRATEï¼šç„¶åå°†ç›‘æ§é˜¶æ®µæ”¶åˆ°çš„åé¦ˆå‘é€å›PLANé˜¶æ®µï¼Œæ•´ä½“åå¤çš„æµç¨‹å°±æ˜¯<a href="">DevOps</a>çš„æ ¸å¿ƒï¼Œå³æŒç»­é›†æˆã€æŒç»­éƒ¨ç½²ã€‚</li></ul><p>ä¸ºäº†ä¿è¯æ•´ä½“æµç¨‹å¯ä»¥é«˜æ•ˆçš„å®Œæˆï¼Œå„ä¸ªé˜¶æ®µéƒ½æœ‰æ¯”è¾ƒå¸¸è§çš„å·¥å…·ï¼Œå¦‚ä¸‹å›¾ï¼š</p><table><thead><tr><th style="text-align:center;">è½¯ä»¶å¼€å‘è¿‡ç¨‹&amp;æ¶‰åŠå·¥å…·</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/2021-11-23_175935-1c1433c5.png" alt="2021-11-23_175935" loading="lazy"></td></tr></tbody></table><p>æœ€ç»ˆå¯ä»¥ç»™<a href="">DevOps</a>ä¸‹ä¸€ä¸ªå®šä¹‰ï¼š<a href="">DevOps å¼ºè°ƒçš„æ˜¯é«˜æ•ˆç»„ç»‡å›¢é˜Ÿä¹‹é—´å¦‚ä½•é€šè¿‡è‡ªåŠ¨åŒ–çš„å·¥å…·åä½œå’Œæ²Ÿé€šæ¥å®Œæˆè½¯ä»¶çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œä»è€Œæ›´å¿«ã€æ›´é¢‘ç¹åœ°äº¤ä»˜æ›´ç¨³å®šçš„è½¯ä»¶ã€‚</a></p><p>è‡ªåŠ¨åŒ–çš„å·¥å…·åä½œå’Œæ²Ÿé€šæ¥å®Œæˆè½¯ä»¶çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†</p><h3 id="äºŒã€codeé˜¶æ®µå·¥å…·" tabindex="-1"><a class="header-anchor" href="#äºŒã€codeé˜¶æ®µå·¥å…·" aria-hidden="true">#</a> äºŒã€Codeé˜¶æ®µå·¥å…·</h3><p>åœ¨codeé˜¶æ®µï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸åŒç‰ˆæœ¬çš„ä»£ç å­˜å‚¨åˆ°ä¸€ä¸ªä»“åº“ä¸­ï¼Œå¸¸è§çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·å°±æ˜¯SVNæˆ–è€…Gitï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨Gitä½œä¸ºç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼ŒGitLabä½œä¸ºè¿œç¨‹ä»“åº“ã€‚</p><h4 id="_2-1-gitå®‰è£…" tabindex="-1"><a class="header-anchor" href="#_2-1-gitå®‰è£…" aria-hidden="true">#</a> 2.1 Gitå®‰è£…</h4><p><a href="https://git-scm.com/%EF%BC%88%E5%82%BB%E7%93%9C%E5%BC%8F%E5%AE%89%E8%A3%85%EF%BC%89" target="_blank" rel="noopener noreferrer">https://git-scm.com/ï¼ˆå‚»ç“œå¼å®‰è£…ï¼‰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="_2-2-gitlabå®‰è£…" tabindex="-1"><a class="header-anchor" href="#_2-2-gitlabå®‰è£…" aria-hidden="true">#</a> 2.2 GitLabå®‰è£…</h4><p>å•ç‹¬å‡†å¤‡æœåŠ¡å™¨ï¼Œé‡‡ç”¨Dockerå®‰è£…</p><ul><li><p>æŸ¥çœ‹GitLabé•œåƒ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> search gitlab
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æ‹‰å–GitLabé•œåƒ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull gitlab/gitlab-ce
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å‡†å¤‡docker-compose.ymlæ–‡ä»¶</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3.1&#39;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">gitlab</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&#39;gitlab/gitlab-ce:latest&#39;</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> gitlab
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">GITLAB_OMNIBUS_CONFIG</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        external_url &#39;http://192.168.11.11:8929&#39;
        gitlab_rails[&#39;gitlab_shell_ssh_port&#39;] = 2224</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&#39;8929:8929&#39;</span>
      <span class="token punctuation">-</span> <span class="token string">&#39;2224:2224&#39;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&#39;./config:/etc/gitlab&#39;</span>
      <span class="token punctuation">-</span> <span class="token string">&#39;./logs:/var/log/gitlab&#39;</span>
      <span class="token punctuation">-</span> <span class="token string">&#39;./data:/var/opt/gitlab&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å¯åŠ¨å®¹å™¨ï¼ˆéœ€è¦ç¨ç­‰ä¸€å°ä¼šâ€¦â€¦ï¼‰</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>è®¿é—®GitLabé¦–é¡µ</p><table><thead><tr><th style="text-align:center;">é¦–é¡µ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211124182140596-51c359d2.png" alt="image-20211124182140596" loading="lazy"></td></tr></tbody></table></li><li><p>æŸ¥çœ‹rootç”¨æˆ·åˆå§‹å¯†ç </p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> gitlab <span class="token function">cat</span> /etc/gitlab/initial_root_password
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">åˆå§‹å¯†ç </th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211124182921234-0b030161.png" alt="image-20211124182921234" loading="lazy"></td></tr></tbody></table></li><li><p>ç™»å½•rootç”¨æˆ·</p><table><thead><tr><th style="text-align:center;">ç™»å½•æˆåŠŸåè·³è½¬é¡µé¢</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211124183003858-8870457b.png" alt="image-20211124183003858" loading="lazy"></td></tr></tbody></table></li><li><p>ç¬¬ä¸€æ¬¡ç™»å½•åéœ€è¦ä¿®æ”¹å¯†ç </p><table><thead><tr><th style="text-align:center;">ä¿®æ”¹å¯†ç </th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211124193444561-a8e10538.png" alt="image-20211124193444561" loading="lazy"></td></tr></tbody></table></li></ul><p>æå®šåï¼Œå³å¯åƒGiteeã€GitHubä¸€æ ·ä½¿ç”¨ã€‚</p><h3 id="ä¸‰ã€buildé˜¶æ®µå·¥å…·" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€buildé˜¶æ®µå·¥å…·" aria-hidden="true">#</a> ä¸‰ã€Buildé˜¶æ®µå·¥å…·</h3><p>æ„å»ºJavaé¡¹ç›®çš„å·¥å…·ä¸€èˆ¬æœ‰ä¸¤ç§é€‰æ‹©ï¼Œä¸€ä¸ªæ˜¯Mavenï¼Œä¸€ä¸ªæ˜¯Gradleã€‚</p><p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©Mavenä½œä¸ºé¡¹ç›®çš„ç¼–è¯‘å·¥å…·ã€‚</p><p>å…·ä½“å®‰è£…Mavenæµç¨‹ä¸åšé˜è¿°ï¼Œä½†æ˜¯éœ€è¦ç¡®ä¿é…ç½®å¥½Mavenä»“åº“ç§æœä»¥åŠJDKç¼–è¯‘ç‰ˆæœ¬ã€‚</p><h3 id="å››ã€operateé˜¶æ®µå·¥å…·" tabindex="-1"><a class="header-anchor" href="#å››ã€operateé˜¶æ®µå·¥å…·" aria-hidden="true">#</a> å››ã€Operateé˜¶æ®µå·¥å…·</h3><p>éƒ¨ç½²è¿‡ç¨‹ï¼Œä¼šé‡‡ç”¨Dockerè¿›è¡Œéƒ¨ç½²ï¼Œæš‚æ—¶åªå®‰è£…Dockerå³å¯ï¼Œåç»­è¿˜éœ€å®‰è£…Kubenetes</p><h4 id="_4-1-dockerå®‰è£…" tabindex="-1"><a class="header-anchor" href="#_4-1-dockerå®‰è£…" aria-hidden="true">#</a> 4.1 Dockerå®‰è£…</h4><ul><li><p>å‡†å¤‡æµ‹è¯•ç¯å¢ƒ&amp;ç”Ÿäº§ç¯å¢ƒ</p></li><li><p>ä¸‹è½½Dockerä¾èµ–ç»„ä»¶</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token parameter variable">-y</span> <span class="token function">install</span> yum-utils device-mapper-persistent-data lvm2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>è®¾ç½®ä¸‹è½½Dockerçš„é•œåƒæºä¸ºé˜¿é‡Œäº‘</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å®‰è£…DockeræœåŠ¡</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token parameter variable">-y</span> <span class="token function">install</span> docker-ce
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å®‰è£…æˆåŠŸåï¼Œå¯åŠ¨Dockerå¹¶è®¾ç½®å¼€æœºè‡ªå¯</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># å¯åŠ¨DockeræœåŠ¡</span>
systemctl start <span class="token function">docker</span>
<span class="token comment"># è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨</span>
systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æµ‹è¯•å®‰è£…æˆåŠŸ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">æ•ˆæœ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211124200317795-f594762e.png" alt="image-20211124200317795" loading="lazy"></td></tr></tbody></table></li></ul><h4 id="_4-2-docker-composeå®‰è£…" tabindex="-1"><a class="header-anchor" href="#_4-2-docker-composeå®‰è£…" aria-hidden="true">#</a> 4.2 Docker-Composeå®‰è£…</h4><ul><li><p>ä¸‹è½½Docker/Composeï¼š<a href="https://github.com/docker/compose" target="_blank" rel="noopener noreferrer">https://github.com/docker/compose<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p>å°†ä¸‹è½½å¥½çš„<a href="">docker-compose-Linux-x86_64</a>æ–‡ä»¶ç§»åŠ¨åˆ°Linuxæ“ä½œç³»ç»Ÿï¼šâ€¦â€¦</p></li><li><p>è®¾ç½®<a href="">docker-compose-Linux-x86_64</a>æ–‡ä»¶æƒé™ï¼Œå¹¶ç§»åŠ¨åˆ°$PATHç›®å½•ä¸­</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># è®¾ç½®æ–‡ä»¶æƒé™</span>
<span class="token function">chmod</span> a+x docker-compose-Linux-x86_64
<span class="token comment"># ç§»åŠ¨åˆ°/usr/binç›®å½•ä¸‹ï¼Œå¹¶é‡å‘½åä¸ºdocker-compose</span>
<span class="token function">mv</span> docker-compose-Linux-x86_64 /usr/bin/docker-compose
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æµ‹è¯•å®‰è£…æˆåŠŸ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker-compose</span> version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">æ•ˆæœ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211124200658107-1086228d.png" alt="image-20211124200658107" loading="lazy"></td></tr></tbody></table></li></ul><h3 id="äº”ã€integrateå·¥å…·" tabindex="-1"><a class="header-anchor" href="#äº”ã€integrateå·¥å…·" aria-hidden="true">#</a> äº”ã€Integrateå·¥å…·</h3><p>æŒç»­é›†æˆã€æŒç»­éƒ¨ç½²çš„å·¥å…·å¾ˆå¤šï¼Œå…¶ä¸­Jenkinsæ˜¯ä¸€ä¸ªå¼€æºçš„æŒç»­é›†æˆå¹³å°ã€‚</p><p>Jenkinsæ¶‰åŠåˆ°å°†ç¼–å†™å®Œæ¯•çš„ä»£ç å‘å¸ƒåˆ°æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„ä»»åŠ¡ï¼Œå¹¶ä¸”è¿˜æ¶‰åŠåˆ°äº†æ„å»ºé¡¹ç›®ç­‰ä»»åŠ¡ã€‚</p><p>Jenkinséœ€è¦å¤§é‡çš„æ’ä»¶ä¿è¯å·¥ä½œï¼Œå®‰è£…æˆæœ¬è¾ƒé«˜ï¼Œä¸‹é¢ä¼šåŸºäºDockeræ­å»ºJenkinsã€‚</p><h4 id="_5-1-jenkinsä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_5-1-jenkinsä»‹ç»" aria-hidden="true">#</a> 5.1 Jenkinsä»‹ç»</h4><p>Jenkinsæ˜¯ä¸€ä¸ªå¼€æºè½¯ä»¶é¡¹ç›®ï¼Œæ˜¯åŸºäºJavaå¼€å‘çš„ä¸€ç§æŒç»­é›†æˆå·¥å…·</p><p>Jenkinsåº”ç”¨å¹¿æ³›ï¼Œå¤§å¤šæ•°äº’è”ç½‘å…¬å¸éƒ½é‡‡ç”¨Jenkinsé…åˆGitLabã€Dockerã€K8sä½œä¸ºå®ç°<a href="">DevOps</a>çš„æ ¸å¿ƒå·¥å…·ã€‚</p><p>Jenkinsæœ€å¼ºå¤§çš„å°±åœ¨äºæ’ä»¶ï¼ŒJenkinså®˜æ–¹æä¾›äº†å¤§é‡çš„æ’ä»¶åº“ï¼Œæ¥è‡ªåŠ¨åŒ–CI/CDè¿‡ç¨‹ä¸­çš„å„ç§çç¢åŠŸèƒ½ã€‚</p><table><thead><tr><th style="text-align:center;"></th><th style="text-align:center;"></th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211125141950900-bad3091b.png" alt="image-20211125141950900" loading="lazy"></td><td style="text-align:center;"><img src="/assets/image-20211125141701495-824e0cba.png" alt="image-20211124200317795" loading="lazy"></td></tr></tbody></table><p>Jenkinsæœ€ä¸»è¦çš„å·¥ä½œå°±æ˜¯å°†GitLabä¸Šå¯ä»¥æ„å»ºçš„å·¥ç¨‹ä»£ç æ‹‰å–å¹¶ä¸”è¿›è¡Œæ„å»ºï¼Œå†æ ¹æ®æµç¨‹å¯ä»¥é€‰æ‹©å‘å¸ƒåˆ°æµ‹è¯•ç¯å¢ƒæˆ–æ˜¯ç”Ÿäº§ç¯å¢ƒã€‚</p><p>ä¸€èˆ¬æ˜¯GitLabä¸Šçš„ä»£ç ç»è¿‡å¤§é‡çš„æµ‹è¯•åï¼Œç¡®å®šå‘è¡Œç‰ˆæœ¬ï¼Œå†å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒã€‚</p><p>CI/CDå¯ä»¥ç†è§£ä¸ºï¼š</p><ul><li>CIè¿‡ç¨‹å³æ˜¯é€šè¿‡Jenkinså°†ä»£ç æ‹‰å–ã€æ„å»ºã€åˆ¶ä½œé•œåƒäº¤ç»™æµ‹è¯•äººå‘˜æµ‹è¯•ã€‚ <ul><li>æŒç»­é›†æˆï¼šè®©è½¯ä»¶ä»£ç å¯ä»¥æŒç»­çš„é›†æˆåˆ°ä¸»å¹²ä¸Šï¼Œå¹¶è‡ªåŠ¨æ„å»ºå’Œæµ‹è¯•ã€‚</li></ul></li><li>CDè¿‡ç¨‹å³æ˜¯é€šè¿‡Jenkinså°†æ‰“å¥½æ ‡ç­¾çš„å‘è¡Œç‰ˆæœ¬ä»£ç æ‹‰å–ã€æ„å»ºã€åˆ¶ä½œé•œåƒäº¤ç»™è¿ç»´äººå‘˜éƒ¨ç½²ã€‚ <ul><li>æŒç»­äº¤ä»˜ï¼šè®©ç»è¿‡æŒç»­é›†æˆçš„ä»£ç å¯ä»¥è¿›è¡Œæ‰‹åŠ¨éƒ¨ç½²ã€‚</li><li>æŒç»­éƒ¨ç½²ï¼šè®©å¯ä»¥æŒç»­äº¤ä»˜çš„ä»£ç éšæ—¶éšåœ°çš„è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚</li></ul></li></ul><table><thead><tr><th style="text-align:center;">CIã€CD</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211125154112097-cdbb92ef.png" alt="image-20211125154112097" loading="lazy"></td></tr></tbody></table><h4 id="_5-2-jenkinså®‰è£…" tabindex="-1"><a class="header-anchor" href="#_5-2-jenkinså®‰è£…" aria-hidden="true">#</a> 5.2 Jenkinså®‰è£…</h4><ul><li><p>æ‹‰å–Jenkinsé•œåƒ</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker pull jenkins/jenkins
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ç¼–å†™docker-compose.yml</p><ul><li>docker-compose up -d</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.1&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">jenkins</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> jenkins/jenkins<span class="token punctuation">:</span>2.319.3<span class="token punctuation">-</span>lts
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> jenkins
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 8090<span class="token punctuation">:</span><span class="token number">8080</span>
      <span class="token punctuation">-</span> 50000<span class="token punctuation">:</span><span class="token number">50000</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /home/data/jenkins/jenkins_home/<span class="token punctuation">:</span>/var/jenkins_home/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>é¦–æ¬¡å¯åŠ¨ä¼šå› ä¸ºæ•°æ®å·dataç›®å½•æ²¡æœ‰æƒé™å¯¼è‡´å¯åŠ¨å¤±è´¥ï¼Œè®¾ç½®dataç›®å½•å†™æƒé™</p><table><thead><tr><th style="text-align:center;">é”™è¯¯æ—¥å¿—</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211124202610243-4c33dcee.png" alt="image-20211124202610243" loading="lazy"></td></tr></tbody></table><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">chmod</span> <span class="token parameter variable">-R</span> a+w data/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>é‡æ–°å¯åŠ¨Jenkinså®¹å™¨åï¼Œç”±äºJenkinséœ€è¦ä¸‹è½½å¤§é‡å†…å®¹ï¼Œä½†æ˜¯ç”±äºé»˜è®¤ä¸‹è½½åœ°å€ä¸‹è½½é€Ÿåº¦è¾ƒæ…¢ï¼Œéœ€è¦é‡æ–°è®¾ç½®ä¸‹è½½åœ°å€ä¸ºå›½å†…é•œåƒç«™</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># ä¿®æ”¹æ•°æ®å·ä¸­çš„hudson.model.UpdateCenter.xmlæ–‡ä»¶</span>
<span class="token operator">&lt;</span>?xml <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token string">&#39;1.1&#39;</span> <span class="token assign-left variable">encoding</span><span class="token operator">=</span><span class="token string">&#39;UTF-8&#39;</span>?<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>sites<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>site<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>id<span class="token operator">&gt;</span>default<span class="token operator">&lt;</span>/id<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>url<span class="token operator">&gt;</span>https://updates.jenkins.io/update-center.json<span class="token operator">&lt;</span>/url<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/site<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/sites<span class="token operator">&gt;</span>
<span class="token comment"># å°†ä¸‹è½½åœ°å€æ›¿æ¢ä¸ºhttp://mirror.esuni.jp/jenkins/updates/update-center.json</span>
<span class="token operator">&lt;</span>?xml <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token string">&#39;1.1&#39;</span> <span class="token assign-left variable">encoding</span><span class="token operator">=</span><span class="token string">&#39;UTF-8&#39;</span>?<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>sites<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>site<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>id<span class="token operator">&gt;</span>default<span class="token operator">&lt;</span>/id<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>url<span class="token operator">&gt;</span>http://mirror.esuni.jp/jenkins/updates/update-center.json<span class="token operator">&lt;</span>/url<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>/site<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/sites<span class="token operator">&gt;</span>
<span class="token comment"># æ¸…åå¤§å­¦çš„æ’ä»¶æºä¹Ÿå¯ä»¥https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å†æ¬¡é‡å¯Jenkinså®¹å™¨ï¼Œè®¿é—®Jenkinsï¼ˆéœ€è¦ç¨å¾®ç­‰ä¼šï¼‰</p><table><thead><tr><th style="text-align:center;">Jenkinsé¦–é¡µ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211124204517433-695250fb.png" alt="image-20211124204517433" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/image-20211124203336300-798ef059.png" alt="image-20211124203336300" loading="lazy"></td></tr></tbody></table></li><li><p>æŸ¥çœ‹å¯†ç ç™»å½•Jenkinsï¼Œå¹¶ç™»å½•ä¸‹è½½æ’ä»¶</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> jenkins <span class="token function">cat</span> /var/jenkins_home/secrets/initialAdminPassword
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">ç™»å½•å¹¶ä¸‹è½½æ’ä»¶</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211124205050484-4d3a6c36.png" alt="image-20211124205050484" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/image-20211124205513465-80bc108c.png" alt="image-20211124205513465" loading="lazy"></td></tr></tbody></table></li><li><p>é€‰æ‹©éœ€è¦å®‰è£…çš„æ’ä»¶</p><table><thead><tr><th style="text-align:center;">é€‰æ‹©éœ€è¦å®‰è£…çš„æ’ä»¶</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211124205854418-3509a77a.png" alt="image-20211124205854418" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/image-20211124205858730-2ad37b53.png" alt="image-20211124205858730" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/image-20211124205917317-00cd1396.png" alt="image-20211124205917317" loading="lazy"></td></tr></tbody></table></li><li><p>ä¸‹è½½å®Œæ¯•è®¾ç½®ä¿¡æ¯è¿›å…¥é¦–é¡µï¼ˆå¯èƒ½ä¼šå‡ºç°ä¸‹è½½å¤±è´¥çš„æ’ä»¶ï¼‰</p><table><thead><tr><th></th></tr></thead><tbody><tr><td><img src="/assets/image-20211124211635550-2104cab6.png" alt="image-20211124211635550" loading="lazy"></td></tr><tr><td><img src="/assets/image-20211124211700999-0f6c98c9.png" alt="image-20211124211700999" loading="lazy"></td></tr><tr><td><img src="/assets/image-20211124211720836-a25c8162.png" alt="image-20211124211720836" loading="lazy"></td></tr></tbody></table></li></ul><h4 id="_5-3-jenkinså…¥é—¨é…ç½®" tabindex="-1"><a class="header-anchor" href="#_5-3-jenkinså…¥é—¨é…ç½®" aria-hidden="true">#</a> 5.3 Jenkinså…¥é—¨é…ç½®</h4><p>ç”±äºJenkinséœ€è¦ä»Gitæ‹‰å–ä»£ç ã€éœ€è¦æœ¬åœ°æ„å»ºã€ç”šè‡³éœ€è¦ç›´æ¥å‘å¸ƒè‡ªå®šä¹‰é•œåƒåˆ°Dockerä»“åº“ï¼Œæ‰€ä»¥Jenkinséœ€è¦é…ç½®å¤§é‡å†…å®¹ã€‚</p><h5 id="_5-3-1-æ„å»ºä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#_5-3-1-æ„å»ºä»»åŠ¡" aria-hidden="true">#</a> 5.3.1 æ„å»ºä»»åŠ¡</h5><p>å‡†å¤‡å¥½GitLabä»“åº“ä¸­çš„é¡¹ç›®ï¼Œå¹¶ä¸”é€šè¿‡Jenkinsé…ç½®é¡¹ç›®çš„å®ç°å½“å‰é¡¹ç›®çš„<a href="">DevOps</a>åŸºæœ¬æµç¨‹ã€‚</p><ul><li><p>æ„å»ºMavenå·¥ç¨‹å‘å¸ƒåˆ°GitLabï¼ˆGiteeã€Githubå‡å¯ï¼‰</p><table><thead><tr><th style="text-align:center;">GitLabæŸ¥çœ‹é¡¹ç›®</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211125195818670-b1da3858.png" alt="image-20211125195818670" loading="lazy"></td></tr></tbody></table></li><li><p>Jenkinsç‚¹å‡»å·¦ä¾§å¯¼èˆªæ–°å»ºä»»åŠ¡</p><table><thead><tr><th style="text-align:center;">æ–°å»ºä»»åŠ¡</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211125163541645-f9a13515.png" alt="image-20211125163541645" loading="lazy"></td></tr></tbody></table></li><li><p>é€‰æ‹©è‡ªç”±é£æ ¼æ„å»ºä»»åŠ¡</p><table><thead><tr><th style="text-align:center;">æ„å»ºä»»åŠ¡</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211125170350811-529b9a17.png" alt="image-20211125170350811" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_5-3-1-é…ç½®æºç æ‹‰å–åœ°å€" tabindex="-1"><a class="header-anchor" href="#_5-3-1-é…ç½®æºç æ‹‰å–åœ°å€" aria-hidden="true">#</a> 5.3.1 é…ç½®æºç æ‹‰å–åœ°å€</h5><p>Jenkinséœ€è¦å°†Gitä¸Šå­˜æ”¾çš„æºç å­˜å‚¨åˆ°JenkinsæœåŠ¡æ‰€åœ¨ç£ç›˜çš„æœ¬åœ°</p><ul><li><p>é…ç½®ä»»åŠ¡æºç æ‹‰å–çš„åœ°å€</p><table><thead><tr><th style="text-align:center;">æºç ç®¡ç†</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211125170418337-9431bb24.png" alt="image-20211125170418337" loading="lazy"></td></tr></tbody></table></li><li><p>Jenkinsç«‹å³æ„å»º</p><table><thead><tr><th style="text-align:center;">ç‚¹å‡»ä»»åŠ¡testä¸­çš„ç«‹å³æ„å»º</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211125200218093-b4b8f3b1.png" alt="image-20211125200218093" loading="lazy"></td></tr></tbody></table></li><li><p>æŸ¥çœ‹æ„å»ºå·¥ç¨‹çš„æ—¥å¿—ï¼Œç‚¹å‡»ä¸Šè¿°â‘¢çš„ä»»åŠ¡æ¡å³å¯</p><table><thead><tr><th style="text-align:center;">æŸ¥çœ‹ä»»åŠ¡æ‹‰å–Gitæºç æ—¥å¿—</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211125201701443-b5c3485b.png" alt="image-20211125201701443" loading="lazy"></td></tr></tbody></table><p>å¯ä»¥çœ‹åˆ°æºç å·²ç»æ‹‰å–å¸¦Jenkinsæœ¬åœ°ï¼Œå¯ä»¥æ ¹æ®ç¬¬ä¸‰è¡Œæ—¥å¿—ä¿¡æ¯ï¼ŒæŸ¥çœ‹Jenkinsæœ¬åœ°æ‹‰å–åˆ°çš„æºç ã€‚</p></li><li><p>æŸ¥çœ‹Jenkinså®¹å™¨ä¸­<a href="">/var/jenkins_home/workspace/test</a>çš„æºç </p><table><thead><tr><th style="text-align:center;">æºç å­˜æ”¾ä½ç½®</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211125201919108-5752ffed.png" alt="image-20211125201919108" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_5-3-2-é…ç½®mavenæ„å»ºä»£ç " tabindex="-1"><a class="header-anchor" href="#_5-3-2-é…ç½®mavenæ„å»ºä»£ç " aria-hidden="true">#</a> 5.3.2 é…ç½®Mavenæ„å»ºä»£ç </h5><p>ä»£ç æ‹‰å–åˆ°Jenkinsæœ¬åœ°åï¼Œéœ€è¦åœ¨Jenkinsä¸­å¯¹ä»£ç è¿›è¡Œæ„å»ºï¼Œè¿™é‡Œéœ€è¦Mavençš„ç¯å¢ƒï¼Œè€ŒMavenéœ€è¦Javaçš„ç¯å¢ƒï¼Œæ¥ä¸‹æ¥éœ€è¦åœ¨Jenkinsä¸­å®‰è£…JDKå’ŒMavenï¼Œå¹¶ä¸”é…ç½®åˆ°JenkinsæœåŠ¡ã€‚</p><ul><li><p>å‡†å¤‡JDKã€Mavenå‹ç¼©åŒ…é€šè¿‡æ•°æ®å·æ˜ å°„åˆ°Jenkinså®¹å™¨å†…éƒ¨</p><table><thead><tr><th style="text-align:center;">æ•°æ®å·å­˜æ”¾ä½ç½®</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211125203757232-7b76e652.png" alt="image-20211125203757232" loading="lazy"></td></tr></tbody></table></li><li><p>è§£å‹å‹ç¼©åŒ…ï¼Œå¹¶é…ç½®Mavençš„settings.xml</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- é˜¿é‡Œäº‘é•œåƒåœ°å€ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirror</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>alimaven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>aliyun maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>http://maven.aliyun.com/nexus/content/groups/public/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrorOf</span><span class="token punctuation">&gt;</span></span>central<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrorOf</span><span class="token punctuation">&gt;</span></span>          
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirror</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- JDK1.8ç¼–è¯‘æ’ä»¶ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>jdk-1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activation</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeByDefault</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeByDefault</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jdk</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jdk</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activation</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.compilerVersion</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.compilerVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>        
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Jenkinsé…ç½®JDK&amp;Mavenå¹¶ä¿å­˜</p><table><thead><tr><th></th></tr></thead><tbody><tr><td><img src="/assets/image-20211125204811759-a6de0efc.png" alt="image-20211125204811759" loading="lazy"></td></tr><tr><td><img src="/assets/image-20211125204818869-07643679.png" alt="image-20211125204818869" loading="lazy"></td></tr></tbody></table></li><li><p>é…ç½®Jenkinsä»»åŠ¡æ„å»ºä»£ç </p><table><thead><tr><th style="text-align:center;">é…ç½®Mavenæ„å»ºä»£ç </th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211125205027013-fe637cb0.png" alt="image-20211125205027013" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/image-20211125205020738-b142d8ee.png" alt="image-20211125205020738" loading="lazy"></td></tr></tbody></table></li><li><p>ç«‹å³æ„å»ºæµ‹è¯•ï¼ŒæŸ¥çœ‹targetä¸‹çš„jaråŒ…</p><table><thead><tr><th style="text-align:center;">æ„å»ºæºç </th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211125205240208-91a5f7c0.png" alt="image-20211125205240208" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/image-20211125205725948-e9165f0a.png" alt="image-20211125205725948" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_5-3-3-é…ç½®publishå‘å¸ƒ-è¿œç¨‹æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#_5-3-3-é…ç½®publishå‘å¸ƒ-è¿œç¨‹æ“ä½œ" aria-hidden="true">#</a> 5.3.3 é…ç½®Publishå‘å¸ƒ&amp;è¿œç¨‹æ“ä½œ</h5><p>jaråŒ…æ„å»ºå¥½ä¹‹åï¼Œå°±å¯ä»¥æ ¹æ®æƒ…å†µå‘å¸ƒåˆ°æµ‹è¯•æˆ–ç”Ÿäº§ç¯å¢ƒï¼Œè¿™é‡Œéœ€è¦ç”¨åˆ°ä¹‹å‰ä¸‹è½½å¥½çš„æ’ä»¶Publish Over SSHã€‚</p><ul><li><p>é…ç½®Publish Over SSHè¿æ¥æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒ</p><table><thead><tr><th style="text-align:center;">Publish Over SSHé…ç½®</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211125210148202-f47bd7af.png" alt="image-20211125210148202" loading="lazy"></td></tr></tbody></table></li><li><p>é…ç½®ä»»åŠ¡çš„æ„å»ºåæ“ä½œï¼Œå‘å¸ƒjaråŒ…åˆ°ç›®æ ‡æœåŠ¡</p><table><thead><tr><th style="text-align:center;">é…ç½®æ„å»ºåæ“ä½œ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211125205027013-fe637cb0.png" alt="image-20211125205027013" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/image-20211125210424346-7f8fc3b1.png" alt="image-20211125210424346" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/image-20211125210626631-c7ba46b3.png" alt="image-20211125210626631" loading="lazy"></td></tr></tbody></table></li><li><p>ç«‹å³æ„å»ºä»»åŠ¡ï¼Œå¹¶å»ç›®æ ‡æœåŠ¡æŸ¥çœ‹</p><table><thead><tr><th style="text-align:center;">ç«‹å³æ„å»º</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211125210755556-4ee02c71.png" alt="image-20211125210755556" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/image-20211125210826057-dcdf4a09.png" alt="image-20211125210826057" loading="lazy"></td></tr></tbody></table></li></ul><h3 id="å…­ã€ciã€cdå…¥é—¨æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#å…­ã€ciã€cdå…¥é—¨æ“ä½œ" aria-hidden="true">#</a> å…­ã€CIã€CDå…¥é—¨æ“ä½œ</h3><p>åŸºäºJenkinsæ‹‰å–GitLabçš„SpringBootä»£ç è¿›è¡Œæ„å»ºå‘å¸ƒåˆ°æµ‹è¯•ç¯å¢ƒå®ç°æŒç»­é›†æˆ</p><p>åŸºäºJenkinsæ‹‰å–GitLabæŒ‡å®šå‘è¡Œç‰ˆæœ¬çš„SpringBootä»£ç è¿›è¡Œæ„å»ºå‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒå®ç°CDå®ç°æŒç»­éƒ¨ç½²</p><h4 id="_6-1-æŒç»­é›†æˆ" tabindex="-1"><a class="header-anchor" href="#_6-1-æŒç»­é›†æˆ" aria-hidden="true">#</a> 6.1 æŒç»­é›†æˆ</h4><p>ä¸ºäº†è®©ç¨‹åºä»£ç å¯ä»¥è‡ªåŠ¨æ¨é€åˆ°æµ‹è¯•ç¯å¢ƒåŸºäºDockeræœåŠ¡è¿è¡Œï¼Œéœ€è¦æ·»åŠ Dockeré…ç½®å’Œè„šæœ¬æ–‡ä»¶è®©ç¨‹åºå¯ä»¥åœ¨é›†æˆåˆ°ä¸»å¹²çš„åŒæ—¶è¿è¡Œèµ·æ¥ã€‚</p><ul><li><p>æ·»åŠ Dockerfileæ–‡ä»¶</p><table><thead><tr><th style="text-align:center;">æ„å»ºè‡ªå®šä¹‰é•œåƒ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211126161304485-efec3a6f.png" alt="image-20211126161304485" loading="lazy"></td></tr></tbody></table></li><li><p>æ·»åŠ docker-compose.ymlæ–‡ä»¶</p><table><thead><tr><th style="text-align:center;">åŠ è½½è‡ªå®šä¹‰é•œåƒå¯åŠ¨å®¹å™¨</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211126161331991-8e395970.png" alt="image-20211126161331991" loading="lazy"></td></tr></tbody></table></li><li><p>è¿½åŠ Jenkinsæ„å»ºåæ“ä½œè„šæœ¬å‘½ä»¤</p><table><thead><tr><th style="text-align:center;">æ„å»ºåå‘å¸ƒå¹¶æ‰§è¡Œè„šæœ¬å‘½ä»¤</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211126161408514-8600972f.png" alt="image-20211126161408514" loading="lazy"></td></tr></tbody></table></li><li><p>å‘å¸ƒåˆ°GitLabåç”±Jenkinsç«‹å³æ„å»ºå¹¶æ‰˜é€åˆ°ç›®æ ‡æœåŠ¡å™¨</p><table><thead><tr><th style="text-align:center;">æ„å»ºæ—¥å¿—</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211126161448527-5e41a1f4.png" alt="image-20211126161448527" loading="lazy"></td></tr></tbody></table></li><li><p>æµ‹è¯•éƒ¨ç½²åˆ°ç›®æ ‡æœåŠ¡å™¨ç¨‹åº</p><table><thead><tr><th style="text-align:center;">æŸ¥çœ‹ç›®æ ‡æœåŠ¡å™¨å¹¶æµ‹è¯•æ¥å£</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211126161504715-68313e38.png" alt="image-20211126161504715" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/image-20211126161509411-7609aed1.png" alt="image-20211126161509411" loading="lazy"></td></tr></tbody></table></li></ul><h4 id="_6-2-æŒç»­äº¤ä»˜ã€éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#_6-2-æŒç»­äº¤ä»˜ã€éƒ¨ç½²" aria-hidden="true">#</a> 6.2 æŒç»­äº¤ä»˜ã€éƒ¨ç½²</h4><p>ç¨‹åºä»£ç åœ¨ç»è¿‡å¤šæ¬¡é›†æˆæ“ä½œåˆ°è¾¾æœ€ç»ˆå¯ä»¥äº¤ä»˜ï¼ŒæŒç»­äº¤ä»˜æ•´ä½“æµç¨‹å’ŒæŒç»­é›†æˆç±»ä¼¼ï¼Œä¸è¿‡éœ€è¦é€‰å–æŒ‡å®šçš„å‘è¡Œç‰ˆæœ¬</p><ul><li><p>ä¸‹è½½Git Parameteræ’ä»¶</p><table><thead><tr><th style="text-align:center;">ä¸‹è½½Git Parameter</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211126165209057-ad5fca94.png" alt="image-20211126165209057" loading="lazy"></td></tr></tbody></table></li><li><p>è®¾ç½®é¡¹ç›®å‚æ•°åŒ–æ„å»º</p><table><thead><tr><th style="text-align:center;">åŸºäºGitæ ‡ç­¾æ„å»º</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211126165444124-927f9697.png" alt="image-20211126165444124" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/image-20211126172828266-246a76f0.png" alt="image-20211126172828266" loading="lazy"></td></tr></tbody></table></li><li><p>ç»™é¡¹ç›®æ·»åŠ tagç‰ˆæœ¬</p><table><thead><tr><th style="text-align:center;">æ·»åŠ tagç‰ˆæœ¬</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211126165639286-6988de7b.png" alt="image-20211126165639286" loading="lazy"></td></tr></tbody></table></li><li><p>ä»»åŠ¡æ„å»ºæ—¶ï¼Œé‡‡ç”¨Shellæ–¹å¼æ„å»ºï¼Œæ‹‰å–æŒ‡å®štagç‰ˆæœ¬ä»£ç </p><table><thead><tr><th style="text-align:center;">åˆ‡æ¢æŒ‡å®šæ ‡ç­¾å¹¶æ„å»ºé¡¹ç›®</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211126174715028-c0d7ed4d.png" alt="image-20211126174715028" loading="lazy"></td></tr></tbody></table></li><li><p>åŸºäºParameteræ„å»ºä»»åŠ¡ï¼Œä»»åŠ¡å‘å¸ƒåˆ°ç›®æ ‡æœåŠ¡å™¨</p><table><thead><tr><th style="text-align:center;">æ„å»ºä»»åŠ¡</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211126174159487-6486c796.png" alt="image-20211126174159487" loading="lazy"></td></tr></tbody></table></li></ul><h3 id="ä¸ƒã€é›†æˆsonar-qube" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€é›†æˆsonar-qube" aria-hidden="true">#</a> ä¸ƒã€é›†æˆSonar Qube</h3><h4 id="_7-1-sonar-qubeä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_7-1-sonar-qubeä»‹ç»" aria-hidden="true">#</a> 7.1 Sonar Qubeä»‹ç»</h4><p>Sonar Qubeæ˜¯ä¸€ä¸ªå¼€æºçš„ä»£ç åˆ†æå¹³å°ï¼Œæ”¯æŒJavaã€Pythonã€PHPã€JavaScriptã€CSSç­‰25ç§ä»¥ä¸Šçš„è¯­è¨€ï¼Œå¯ä»¥æ£€æµ‹å‡ºé‡å¤ä»£ç ã€ä»£ç æ¼æ´ã€ä»£ç è§„èŒƒå’Œå®‰å…¨æ€§æ¼æ´çš„é—®é¢˜ã€‚</p><p>Sonar Qubeå¯ä»¥ä¸å¤šç§è½¯ä»¶æ•´åˆè¿›è¡Œä»£ç æ‰«æï¼Œæ¯”å¦‚Mavenï¼ŒGradleï¼ŒGitï¼ŒJenkinsç­‰ï¼Œå¹¶ä¸”ä¼šå°†ä»£ç æ£€æµ‹ç»“æœæ¨é€å›Sonar Qubeå¹¶ä¸”åœ¨ç³»ç»Ÿæä¾›çš„UIç•Œé¢ä¸Šæ˜¾ç¤ºå‡ºæ¥</p><table><thead><tr><th style="text-align:center;">Sonar Qubeçš„UIç•Œé¢</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211129190039986-c86fdd82.png" alt="image-20211129190039986" loading="lazy"></td></tr></tbody></table><h4 id="_7-2-sonar-qubeç¯å¢ƒæ­å»º" tabindex="-1"><a class="header-anchor" href="#_7-2-sonar-qubeç¯å¢ƒæ­å»º" aria-hidden="true">#</a> 7.2 Sonar Qubeç¯å¢ƒæ­å»º</h4><h5 id="_7-2-1-sonar-qubeå®‰è£…" tabindex="-1"><a class="header-anchor" href="#_7-2-1-sonar-qubeå®‰è£…" aria-hidden="true">#</a> 7.2.1 Sonar Qubeå®‰è£…</h5><p>Sonar Qubeåœ¨7.9ç‰ˆæœ¬ä¸­å·²ç»æ”¾å¼ƒäº†å¯¹MySQLçš„æ”¯æŒï¼Œå¹¶ä¸”å»ºè®®åœ¨å•†ä¸šç¯å¢ƒä¸­é‡‡ç”¨PostgreSQLï¼Œé‚£ä¹ˆå®‰è£…Sonar Qubeæ—¶éœ€è¦ä¾èµ–PostgreSQLã€‚</p><p>å¹¶ä¸”è¿™é‡Œä¼šå®‰è£…Sonar Qubeçš„é•¿æœŸæ”¯æŒç‰ˆæœ¬<a href="">8.9</a></p><ul><li><p>æ‹‰å–é•œåƒ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull postgres
<span class="token function">docker</span> pull sonarqube:8.9.6-community
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ç¼–å†™docker-compose.yml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.1&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">db</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> postgres
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> db
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 5432<span class="token punctuation">:</span><span class="token number">5432</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /etc/localtime<span class="token punctuation">:</span>/etc/localtime
      <span class="token punctuation">-</span> /home/data/sonarqube/postgre/PostgreSqlData<span class="token punctuation">:</span>/var/lib/postgresql/data
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> sonarnet
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">POSTGRES_USER</span><span class="token punctuation">:</span> sonar
      <span class="token key atrule">POSTGRES_PASSWORD</span><span class="token punctuation">:</span> sonar
  <span class="token key atrule">sonarqube</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> sonarqube<span class="token punctuation">:</span>8.9.6<span class="token punctuation">-</span>community
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> sonarqube
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> db
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;9000:9000&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /etc/localtime<span class="token punctuation">:</span>/etc/localtime
      <span class="token punctuation">-</span> /home/data/sonarqube/data<span class="token punctuation">:</span>/opt/sonarqube/data
      <span class="token punctuation">-</span> /home/data/sonarqube/extensions<span class="token punctuation">:</span>/opt/sonarqube/extensions
      <span class="token punctuation">-</span> /home/data/sonarqube/logs<span class="token punctuation">:</span>/opt/sonarqube/logs
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> sonarnet
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">SONAR_JDBC_URL</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>postgresql<span class="token punctuation">:</span>//db<span class="token punctuation">:</span>5432/sonar
      <span class="token key atrule">SONAR_JDBC_USERNAME</span><span class="token punctuation">:</span> sonar
      <span class="token key atrule">SONAR_JDBC_PASSWORD</span><span class="token punctuation">:</span> sonar
<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">sonarnet</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å¯åŠ¨å®¹å™¨</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker-compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>éœ€è¦è®¾ç½®sysctl.confæ–‡ä»¶ä¿¡æ¯</p><table><thead><tr><th style="text-align:center;">è®¾ç½®vm.max_map_count</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211207145215817-ea69b262.png" alt="image-20211207145215817" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/image-20211207145342350-785f39e1.png" alt="image-20211207145342350" loading="lazy"></td></tr></tbody></table><p>å¹¶æ‰§è¡Œå‘½ä»¤åˆ·æ–°</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>sysctl -p
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>é‡æ–°å¯åŠ¨éœ€è¦ä¸€å®šæ—¶é—´å¯åŠ¨ï¼Œå¯ä»¥å¯ä»¥æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼Œçœ‹åˆ°å¦‚ä¸‹å†…å®¹ä»£è¡¨å¯åŠ¨æˆåŠŸ</p><table><thead><tr><th style="text-align:center;">å®¹å™¨æ—¥å¿—</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211129191426344-48b8211e.png" alt="image-20211129191426344" loading="lazy"></td></tr></tbody></table></li><li><p>è®¿é—®Sonar Qubeé¦–é¡µ</p><table><thead><tr><th style="text-align:center;">ç™»å½•</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211129191537050-236caf2f.png" alt="image-20211129191537050" loading="lazy"></td></tr></tbody></table></li><li><p>è¿˜éœ€è¦é‡æ–°è®¾ç½®ä¸€æ¬¡å¯†ç </p><table><thead><tr><th style="text-align:center;">é‡æ–°è®¾ç½®å¯†ç </th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211129193824428-610ccbb0.png" alt="image-20211129193824428" loading="lazy"></td></tr></tbody></table></li><li><p>Sonar Qubeé¦–é¡µ</p><table><thead><tr><th style="text-align:center;">Sonar Qubeé¦–é¡µ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211129194148239-331822e3.png" alt="image-20211129194148239" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_7-2-2-å®‰è£…ä¸­æ–‡æ’ä»¶" tabindex="-1"><a class="header-anchor" href="#_7-2-2-å®‰è£…ä¸­æ–‡æ’ä»¶" aria-hidden="true">#</a> 7.2.2 å®‰è£…ä¸­æ–‡æ’ä»¶</h5><table><thead><tr><th style="text-align:center;">å®‰è£…ä¸­æ–‡æ’ä»¶</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211129194621820-c7e4f7ad.png" alt="image-20211129194621820" loading="lazy"></td></tr></tbody></table><p>å®‰è£…æˆåŠŸåéœ€è¦é‡å¯ï¼Œå®‰è£…å¤±è´¥é‡æ–°ç‚¹å‡»installé‡è£…å³å¯ã€‚</p><p>å®‰è£…æˆåŠŸåï¼Œä¼šæŸ¥çœ‹åˆ°é‡å¯æŒ‰é’®ï¼Œç‚¹å‡»å³å¯</p><table><thead><tr><th style="text-align:center;">é‡å¯æŒ‰é’®</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211129194748765-b48b6712.png" alt="image-20211129194748765" loading="lazy"></td></tr></tbody></table><p>é‡å¯åæŸ¥çœ‹æ•ˆæœ</p><table><thead><tr><th style="text-align:center;">é¦–é¡µæ•ˆæœ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211129194931944-81e391ac.png" alt="image-20211129194931944" loading="lazy"></td></tr></tbody></table><h4 id="_7-3-sonar-qubeåŸºæœ¬ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#_7-3-sonar-qubeåŸºæœ¬ä½¿ç”¨" aria-hidden="true">#</a> 7.3 Sonar QubeåŸºæœ¬ä½¿ç”¨</h4><p>Sonar Qubeçš„ä½¿ç”¨æ–¹å¼å¾ˆå¤šï¼ŒMavenå¯ä»¥æ•´åˆï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨sonar-scannerçš„æ–¹å¼ï¼Œå†æŸ¥çœ‹Sonar Qubeçš„æ£€æµ‹æ•ˆæœ</p><h5 id="_7-3-1-mavenå®ç°ä»£ç æ£€æµ‹" tabindex="-1"><a class="header-anchor" href="#_7-3-1-mavenå®ç°ä»£ç æ£€æµ‹" aria-hidden="true">#</a> 7.3.1 Mavenå®ç°ä»£ç æ£€æµ‹</h5><ul><li><p>ä¿®æ”¹Mavençš„settings.xmlæ–‡ä»¶é…ç½®Sonar Qubeä¿¡æ¯</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>sonar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activation</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeByDefault</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeByDefault</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activation</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sonar.login</span><span class="token punctuation">&gt;</span></span>admin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sonar.login</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sonar.password</span><span class="token punctuation">&gt;</span></span>123456789<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sonar.password</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sonar.host.url</span><span class="token punctuation">&gt;</span></span>http://192.168.11.11:9000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sonar.host.url</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åœ¨ä»£ç ä½ç½®æ‰§è¡Œå‘½ä»¤ï¼šmvn sonar:sonar</p><table><thead><tr><th style="text-align:center;">æ‰§è¡Œä»£ç æ£€æµ‹</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211129195430146-3e5f1476.png" alt="image-20211129195430146" loading="lazy"></td></tr></tbody></table></li><li><p>æŸ¥çœ‹Sonar Qubeç•Œé¢æ£€æµ‹ç»“æœ</p><table><thead><tr><th style="text-align:center;">Sonar Qubeæ£€æµ‹ç»“æœ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211129195503762-13f3efbd.png" alt="image-20211129195503762" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_7-3-2-sonar-scannerå®ç°ä»£ç æ£€æµ‹" tabindex="-1"><a class="header-anchor" href="#_7-3-2-sonar-scannerå®ç°ä»£ç æ£€æµ‹" aria-hidden="true">#</a> 7.3.2 Sonar-scannerå®ç°ä»£ç æ£€æµ‹</h5><ul><li><p>ä¸‹è½½Sonar-scannerï¼š<a href="https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/" target="_blank" rel="noopener noreferrer">https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>ä¸‹è½½4.6.xç‰ˆæœ¬å³å¯ï¼Œè¦æ±‚Linuxç‰ˆæœ¬</p></li><li><p>è§£å‹å¹¶é…ç½®sonaræœåŠ¡ç«¯ä¿¡æ¯</p><ul><li><p>ç”±äºæ˜¯zipå‹ç¼©åŒ…ï¼Œéœ€è¦å®‰è£…unzipè§£å‹æ’ä»¶</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token parameter variable">-y</span> <span class="token function">install</span> <span class="token function">unzip</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>è§£å‹å‹ç¼©åŒ…</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">unzip</span> sonar-scanner-cli/sonar-scanner-cli-4.6.0.2311-linux.zip
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>é…ç½®sonarQubeæœåŠ¡ç«¯åœ°å€ï¼Œä¿®æ”¹confä¸‹çš„sonar-scanner.properties</p><table><thead><tr><th style="text-align:center;">é…ç½®æœåŠ¡ç«¯ä¿¡æ¯</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211130140043382-40b21e48.png" alt="image-20211130140043382" loading="lazy"></td></tr></tbody></table></li></ul></li><li><p>æ‰§è¡Œå‘½ä»¤æ£€æµ‹ä»£ç </p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># åœ¨é¡¹ç›®æ‰€åœ¨ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</span>
~/sonar-scanner/bin/sonar-scanner <span class="token parameter variable">-Dsonar.sources</span><span class="token operator">=</span>./ <span class="token parameter variable">-Dsonar.projectname</span><span class="token operator">=</span>demo <span class="token parameter variable">-Dsonar.projectKey</span><span class="token operator">=</span>java <span class="token parameter variable">-Dsonar.java.binaries</span><span class="token operator">=</span>target/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="">Psï¼šä¸»è¦æŸ¥çœ‹æˆ‘çš„sonar-scanneræ‰§è¡Œå‘½ä»¤çš„ä½ç½®</a></p><table><thead><tr><th style="text-align:center;">æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211130141303457-ec2d4b57.png" alt="image-20211130141303457" loading="lazy"></td></tr></tbody></table></li><li><p>æŸ¥çœ‹SonarQubeç•Œé¢æ£€æµ‹ç»“æœ</p><table><thead><tr><th style="text-align:center;">æ£€æµ‹ç»“æœ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211130144608025-f69f9464.png" alt="image-20211130144608025" loading="lazy"></td></tr></tbody></table></li></ul><h4 id="_7-4-jenkinsé›†æˆsonar-qube" tabindex="-1"><a class="header-anchor" href="#_7-4-jenkinsé›†æˆsonar-qube" aria-hidden="true">#</a> 7.4 Jenkinsé›†æˆSonar Qube</h4><p>Jenkinsç»§æ‰¿Sonar Qubeå®ç°ä»£ç æ‰«æéœ€è¦å…ˆä¸‹è½½æ•´åˆæ’ä»¶</p><h5 id="_7-4-1-jenkinså®‰è£…æ’ä»¶" tabindex="-1"><a class="header-anchor" href="#_7-4-1-jenkinså®‰è£…æ’ä»¶" aria-hidden="true">#</a> 7.4.1 Jenkinså®‰è£…æ’ä»¶</h5><table><thead><tr><th style="text-align:center;">ä¸‹è½½Sonar Qubeæ’ä»¶</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211129201625561-b27b8a4a.png" alt="image-20211129201625561" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/image-20211129201607240-17e58822.png" alt="image-20211129201607240" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/image-20211129202147390-40299a87.png" alt="image-20211129202147390" loading="lazy"></td></tr></tbody></table><h5 id="_7-4-2-jenkinsé…ç½®sonar-qube" tabindex="-1"><a class="header-anchor" href="#_7-4-2-jenkinsé…ç½®sonar-qube" aria-hidden="true">#</a> 7.4.2 Jenkinsé…ç½®Sonar Qube</h5><ul><li><p>å¼€å¯Sonar Qubeæƒé™éªŒè¯</p><table><thead><tr><th style="text-align:center;">å¼€å¯Sonar Qubeæƒé™æ ¡éªŒ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211130144850186-54972640.png" alt="image-20211130144850186" loading="lazy"></td></tr></tbody></table></li><li><p>è·å–Sonar Qubeçš„ä»¤ç‰Œ</p><table><thead><tr><th style="text-align:center;">è·å–ä»¤ç‰Œ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211129203102334-717620e3.png" alt="image-20211129203102334" loading="lazy"></td></tr></tbody></table></li><li><p>é…ç½®Jenkinsçš„Sonar Qubeä¿¡æ¯</p><table><thead><tr><th></th></tr></thead><tbody><tr><td><img src="/assets/image-20211129203235019-ae2b4790.png" alt="image-20211129203235019" loading="lazy"></td></tr><tr><td><img src="/assets/image-20211129203342171-1c03ddd5.png" alt="image-20211129203342171" loading="lazy"></td></tr><tr><td><img src="/assets/image-20211129203457604-6b33be4e.png" alt="image-20211129203457604" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_7-4-3-é…ç½®sonar-scanner" tabindex="-1"><a class="header-anchor" href="#_7-4-3-é…ç½®sonar-scanner" aria-hidden="true">#</a> 7.4.3 é…ç½®Sonar-scanner</h5><ul><li><p>å°†Sonar-scaneræ·»åŠ åˆ°Jenkinsæ•°æ®å·ä¸­å¹¶é…ç½®å…¨å±€é…ç½®</p><table><thead><tr><th style="text-align:center;">é…ç½®Sonar-scanner</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211130153628925-2497c3fe.png" alt="image-20211130153628925" loading="lazy"></td></tr></tbody></table></li><li><p>é…ç½®ä»»åŠ¡çš„Sonar-scanner</p><table><thead><tr><th style="text-align:center;">é…ç½®ä»»åŠ¡çš„Sonar-scanner</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211130155849143-688c6061.png" alt="image-20211130155849143" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_7-4-4-æ„å»ºä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#_7-4-4-æ„å»ºä»»åŠ¡" aria-hidden="true">#</a> 7.4.4 æ„å»ºä»»åŠ¡</h5><table><thead><tr><th style="text-align:center;">æ„å»ºä»»åŠ¡</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211130160017465-947a2406.png" alt="image-20211130160017465" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/image-20211130160047648-6cf5e10d.png" alt="image-20211130160047648" loading="lazy"></td></tr></tbody></table><h3 id="å…«ã€é›†æˆharbor" tabindex="-1"><a class="header-anchor" href="#å…«ã€é›†æˆharbor" aria-hidden="true">#</a> å…«ã€é›†æˆHarbor</h3><h4 id="_8-1-harborä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_8-1-harborä»‹ç»" aria-hidden="true">#</a> 8.1 Harborä»‹ç»</h4><p>å‰é¢åœ¨éƒ¨ç½²é¡¹ç›®æ—¶ï¼Œæˆ‘ä»¬ä¸»è¦é‡‡ç”¨Jenkinsæ¨é€jaråŒ…åˆ°æŒ‡å®šæœåŠ¡å™¨ï¼Œå†é€šè¿‡è„šæœ¬å‘½ä»¤è®©ç›®æ ‡æœåŠ¡å™¨å¯¹å½“å‰jarè¿›è¡Œéƒ¨ç½²ï¼Œè¿™ç§æ–¹å¼åœ¨é¡¹ç›®è¾ƒå¤šæ—¶ï¼Œæ¯ä¸ªç›®æ ‡æœåŠ¡å™¨éƒ½éœ€è¦å°†jaråŒ…åˆ¶ä½œæˆè‡ªå®šä¹‰é•œåƒå†é€šè¿‡dockerè¿›è¡Œå¯åŠ¨ï¼Œé‡å¤æ“ä½œæ¯”è¾ƒå¤šï¼Œä¼šé™ä½é¡¹ç›®éƒ¨ç½²æ—¶é—´ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡Harborä½œä¸ºç§æœ‰çš„Dockeré•œåƒä»“åº“ã€‚è®©Jenkinsç»Ÿä¸€å°†é¡¹ç›®æ‰“åŒ…å¹¶åˆ¶ä½œæˆDockeré•œåƒå‘å¸ƒåˆ°Harborä»“åº“ä¸­ï¼Œåªéœ€è¦é€šçŸ¥ç›®æ ‡æœåŠ¡ï¼Œè®©ç›®æ ‡æœåŠ¡ç»Ÿä¸€å»Harborä»“åº“ä¸Šæ‹‰å–é•œåƒå¹¶åœ¨æœ¬åœ°éƒ¨ç½²å³å¯ã€‚</p><p>Dockerå®˜æ–¹æä¾›äº†Registryé•œåƒä»“åº“ï¼Œä½†æ˜¯Registryçš„åŠŸèƒ½ç›¸å¯¹ç®€é™‹ã€‚Harboræ˜¯VMwareå…¬å¸æä¾›çš„ä¸€æ¬¾é•œåƒä»“åº“ï¼Œæä¾›äº†æƒé™æ§åˆ¶ã€åˆ†å¸ƒå¼å‘å¸ƒã€å¼ºå¤§çš„å®‰å…¨æ‰«æä¸å®¡æŸ¥æœºåˆ¶ç­‰åŠŸèƒ½</p><h4 id="_8-2-harborå®‰è£…" tabindex="-1"><a class="header-anchor" href="#_8-2-harborå®‰è£…" aria-hidden="true">#</a> 8.2 Harborå®‰è£…</h4><p>è¿™é‡Œé‡‡ç”¨åŸç”Ÿçš„æ–¹å¼å®‰è£…Harborã€‚</p><ul><li><p>ä¸‹è½½Harborå®‰è£…åŒ…ï¼š<a href="https://github.com/goharbor/harbor/releases/download/v2.3.4/harbor-offline-installer-v2.3.4.tgz" target="_blank" rel="noopener noreferrer">https://github.com/goharbor/harbor/releases/download/v2.3.4/harbor-offline-installer-v2.3.4.tgz<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p>æ‹–æ‹½åˆ°Linuxå¹¶è§£å‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>tar -zxvf harbor-offline-installer-v2.3.4.tgz -C /usr/local/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ä¿®æ”¹Harboré…ç½®æ–‡ä»¶ï¼š</p><ul><li><p>é¦–å…ˆå¤åˆ¶ä¸€ä»½harbor.ymlé…ç½®</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cp</span> harbor.yml.tmpl harbor.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ç¼–è¾‘harbor.ymlé…ç½®æ–‡ä»¶</p><table><thead><tr><th style="text-align:center;">é…ç½®Harboræ–‡ä»¶</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211130215555218-63bd5e9b.png" alt="image-20211130215555218" loading="lazy"></td></tr></tbody></table></li></ul></li><li><p>å¯åŠ¨Harbor</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>./install.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">æŸ¥çœ‹æ—¥å¿—</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211130215941857-1e7d3128.png" alt="image-20211130215941857" loading="lazy"></td></tr></tbody></table></li><li><p>ç™»å½•Harbor</p><table><thead><tr><th style="text-align:center;">ç™»å½•Harbor</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211130220028840-66cc2269.png" alt="image-20211130220028840" loading="lazy"></td></tr></tbody></table></li><li><p>é¦–é¡µä¿¡æ¯</p><table><thead><tr><th style="text-align:center;">é¦–é¡µä¿¡æ¯</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211130220111602-468444c6.png" alt="image-20211130220111602" loading="lazy"></td></tr></tbody></table></li></ul><h4 id="_8-3-harborä½¿ç”¨æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_8-3-harborä½¿ç”¨æ–¹å¼" aria-hidden="true">#</a> 8.3 Harborä½¿ç”¨æ–¹å¼</h4><p>Harborä½œä¸ºé•œåƒä»“åº“ï¼Œä¸»è¦çš„äº¤äº’æ–¹å¼å°±æ˜¯å°†é•œåƒä¸Šä¼ åˆ°Harborä¸Šï¼Œä»¥åŠä»Harborä¸Šä¸‹è½½æŒ‡å®šé•œåƒ</p><p>åœ¨ä¼ è¾“é•œåƒå‰ï¼Œå¯ä»¥å…ˆä½¿ç”¨Harboræä¾›çš„æƒé™ç®¡ç†ï¼Œå°†é¡¹ç›®è®¾ç½®ä¸ºç§æœ‰é¡¹ç›®ï¼Œå¹¶å¯¹ä¸åŒç”¨æˆ·è®¾ç½®ä¸åŒè§’è‰²ï¼Œä»è€Œæ›´æ–¹ä¾¿ç®¡ç†é•œåƒã€‚</p><h5 id="_8-3-1-æ·»åŠ ç”¨æˆ·æ„å»ºé¡¹ç›®" tabindex="-1"><a class="header-anchor" href="#_8-3-1-æ·»åŠ ç”¨æˆ·æ„å»ºé¡¹ç›®" aria-hidden="true">#</a> 8.3.1 æ·»åŠ ç”¨æˆ·æ„å»ºé¡¹ç›®</h5><ul><li><p>åˆ›å»ºç”¨æˆ·</p><table><thead><tr><th style="text-align:center;">åˆ›å»ºç”¨æˆ·</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211201213427157-d1bb6dc0.png" alt="image-20211201213427157" loading="lazy"></td></tr></tbody></table></li><li><p>æ„å»ºé¡¹ç›®ï¼ˆè®¾ç½®ä¸ºç§æœ‰ï¼‰</p><table><thead><tr><th style="text-align:center;">æ„å»ºé¡¹ç›®</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211201213751780-19fcfc2b.png" alt="image-20211201213751780" loading="lazy"></td></tr></tbody></table></li><li><p>ç»™é¡¹ç›®è¿½åŠ ç”¨æˆ·</p><table><thead><tr><th style="text-align:center;">è¿½åŠ ç”¨æˆ·ç®¡ç†</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211201213832458-3beb8795.png" alt="image-20211201213832458" loading="lazy"></td></tr></tbody></table></li><li><p>åˆ‡æ¢æµ‹è¯•ç”¨æˆ·</p><table><thead><tr><th style="text-align:center;">åˆ‡æ¢æµ‹è¯•ç”¨æˆ·</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211201214008303-ccd48722.png" alt="image-20211201214008303" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_8-3-2-å‘å¸ƒé•œåƒåˆ°harbor" tabindex="-1"><a class="header-anchor" href="#_8-3-2-å‘å¸ƒé•œåƒåˆ°harbor" aria-hidden="true">#</a> 8.3.2 å‘å¸ƒé•œåƒåˆ°Harbor</h5><ul><li><p>ä¿®æ”¹é•œåƒåç§°</p><p>åç§°è¦æ±‚ï¼š<a href="">harboråœ°å€/é¡¹ç›®å/é•œåƒå:ç‰ˆæœ¬</a></p><table><thead><tr><th>ä¿®æ”¹é•œåƒåç§°</th></tr></thead><tbody><tr><td><img src="/assets/image-20211201221040200-082e240a.png" alt="image-20211201221040200" loading="lazy"></td></tr></tbody></table></li><li><p>ä¿®æ”¹daemon.jsonï¼Œæ”¯æŒDockerä»“åº“ï¼Œå¹¶é‡å¯Docker</p><table><thead><tr><th style="text-align:center;">ä¿®æ”¹daemon.jsonï¼Œæ”¯æŒDockerä»“åº“</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211201215931237-9078b7d2.png" alt="image-20211201215931237" loading="lazy"></td></tr></tbody></table></li><li><p>è®¾ç½®ç™»å½•ä»“åº“ä¿¡æ¯</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> login <span class="token parameter variable">-u</span> ç”¨æˆ·å <span class="token parameter variable">-p</span> å¯†ç  Harboråœ°å€
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æ¨é€é•œåƒåˆ°Harbor</p><table><thead><tr><th style="text-align:center;">æ¨é€é•œåƒåˆ°Harbor</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211201221225196-763a84d2.png" alt="image-20211201221225196" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/image-20211201221300055-0a35a1bb.png" alt="image-20211201221300055" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_8-3-3-ä»harboræ‹‰å–é•œåƒls" tabindex="-1"><a class="header-anchor" href="#_8-3-3-ä»harboræ‹‰å–é•œåƒls" aria-hidden="true">#</a> 8.3.3 ä»Harboræ‹‰å–é•œåƒls</h5><p>è·Ÿä¼ ç»Ÿæ–¹å¼ä¸€æ ·ï¼Œä¸è¿‡éœ€è¦å…ˆé…ç½®<a href="">/etc/docker/daemon.json</a>æ–‡ä»¶</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
        <span class="token property">&quot;registry-mirrors&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://pee6w651.mirror.aliyuncs.com&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;insecure-registries&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.11.11:80&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">æ‹‰å–é•œåƒ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211201222450091-0fd7f373.png" alt="image-20211201222450091" loading="lazy"></td></tr></tbody></table><h5 id="_8-3-4-jenkinså®¹å™¨ä½¿ç”¨å®¿ä¸»æœºdocker" tabindex="-1"><a class="header-anchor" href="#_8-3-4-jenkinså®¹å™¨ä½¿ç”¨å®¿ä¸»æœºdocker" aria-hidden="true">#</a> 8.3.4 Jenkinså®¹å™¨ä½¿ç”¨å®¿ä¸»æœºDocker</h5><p>æ„å»ºé•œåƒå’Œå‘å¸ƒé•œåƒåˆ°harboréƒ½éœ€è¦ä½¿ç”¨åˆ°dockerå‘½ä»¤ã€‚è€Œåœ¨Jenkinså®¹å™¨å†…éƒ¨å®‰è£…Dockerå®˜æ–¹æ¨èç›´æ¥é‡‡ç”¨å®¿ä¸»æœºå¸¦çš„Dockerå³å¯ã€‚</p><p>è®¾ç½®Jenkinså®¹å™¨ä½¿ç”¨å®¿ä¸»æœºDocker</p><ul><li><p>è®¾ç½®å®¿ä¸»æœºdocker.sockæƒé™ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">chown</span> root:root /var/run/docker.sock
<span class="token function">sudo</span> <span class="token function">chmod</span> o+rw /var/run/docker.sock
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ·»åŠ æ•°æ®å·</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.1&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">jenkins</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> jenkins/jenkins
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> jenkins
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 8080<span class="token punctuation">:</span><span class="token number">8080</span>
      <span class="token punctuation">-</span> 50000<span class="token punctuation">:</span><span class="token number">50000</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./data/<span class="token punctuation">:</span>/var/jenkins_home/
      <span class="token punctuation">-</span> /usr/bin/docker<span class="token punctuation">:</span>/usr/bin/docker
      <span class="token punctuation">-</span> /var/run/docker.sock<span class="token punctuation">:</span>/var/run/docker.sock
      <span class="token punctuation">-</span> /etc/docker/daemon.json<span class="token punctuation">:</span>/etc/docker/daemon.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h5 id="_8-3-5-æ·»åŠ æ„å»ºæ“ä½œ" tabindex="-1"><a class="header-anchor" href="#_8-3-5-æ·»åŠ æ„å»ºæ“ä½œ" aria-hidden="true">#</a> 8.3.5 æ·»åŠ æ„å»ºæ“ä½œ</h5><table><thead><tr><th style="text-align:center;">åˆ¶ä½œè‡ªå®šä¹‰é•œåƒ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211229155834500-ec4b87c2.png" alt="image-20211229155834500" loading="lazy"></td></tr></tbody></table><h5 id="_8-3-6-ç¼–å†™éƒ¨ç½²è„šæœ¬" tabindex="-1"><a class="header-anchor" href="#_8-3-6-ç¼–å†™éƒ¨ç½²è„šæœ¬" aria-hidden="true">#</a> 8.3.6 ç¼–å†™éƒ¨ç½²è„šæœ¬</h5><p>éƒ¨ç½²é¡¹ç›®éœ€è¦é€šè¿‡Publish Over SSHæ’ä»¶ï¼Œè®©ç›®æ ‡æœåŠ¡å™¨æ‰§è¡Œå‘½ä»¤ã€‚ä¸ºäº†æ–¹ä¾¿ä¸€æ¬¡æ€§å®ç°æ‹‰å–é•œåƒå’Œå¯åŠ¨çš„å‘½ä»¤ï¼Œæ¨èé‡‡ç”¨è„šæœ¬æ–‡ä»¶çš„æ–¹å¼ã€‚</p><p>æ·»åŠ è„šæœ¬æ–‡ä»¶åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œå†é€šè¿‡Publish Over SSHæ’ä»¶è®©ç›®æ ‡æœåŠ¡å™¨æ‰§è¡Œè„šæœ¬å³å¯ã€‚</p><ul><li><p>ç¼–å†™è„šæœ¬æ–‡ä»¶ï¼Œæ·»åŠ åˆ°ç›®æ ‡æœåŠ¡å™¨</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">harbor_url</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token assign-left variable">harbor_project_name</span><span class="token operator">=</span><span class="token variable">$2</span>
<span class="token assign-left variable">project_name</span><span class="token operator">=</span><span class="token variable">$3</span>
<span class="token assign-left variable">tag</span><span class="token operator">=</span><span class="token variable">$4</span>
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token variable">$5</span>

<span class="token assign-left variable">imageName</span><span class="token operator">=</span><span class="token variable">$harbor_url</span>/<span class="token variable">$harbor_project_name</span>/<span class="token variable">$project_name</span><span class="token builtin class-name">:</span><span class="token variable">$tag</span>

<span class="token assign-left variable">containerId</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> <span class="token operator">|</span> <span class="token function">grep</span> $<span class="token punctuation">{</span>project_name<span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $1}&#39;</span><span class="token variable">`</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$containerId</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token function">docker</span> stop <span class="token variable">$containerId</span>
    <span class="token function">docker</span> <span class="token function">rm</span> <span class="token variable">$containerId</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Delete Container Success&quot;</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">imageId</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">docker</span> images <span class="token operator">|</span> <span class="token function">grep</span> $<span class="token punctuation">{</span>project_name<span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $3}&#39;</span><span class="token variable">`</span></span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$imageId</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token function">docker</span> rmi <span class="token parameter variable">-f</span> <span class="token variable">$imageId</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;Delete Image Success&quot;</span>
<span class="token keyword">fi</span>

<span class="token function">docker</span> login <span class="token parameter variable">-u</span> DevOps <span class="token parameter variable">-p</span> P@ssw0rd <span class="token variable">$harbor_url</span>

<span class="token function">docker</span> pull <span class="token variable">$imageName</span>

<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token variable">$port</span><span class="token builtin class-name">:</span><span class="token variable">$port</span> <span class="token parameter variable">--name</span> <span class="token variable">$project_name</span> <span class="token variable">$imageName</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;Start Container Success&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$project_name</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¹¶è®¾ç½®æƒé™ä¸ºå¯æ‰§è¡Œ</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>chmod a+x deploy.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">å¦‚å›¾</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211203192047357-905cf619.png" alt="image-20211203192047357" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_8-3-7-é…ç½®æ„å»ºåæ“ä½œ" tabindex="-1"><a class="header-anchor" href="#_8-3-7-é…ç½®æ„å»ºåæ“ä½œ" aria-hidden="true">#</a> 8.3.7 é…ç½®æ„å»ºåæ“ä½œ</h5><table><thead><tr><th style="text-align:center;">æ‰§è¡Œè„šæœ¬æ–‡ä»¶</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211229155949038-cd22740a.png" alt="image-20211229155949038" loading="lazy"></td></tr></tbody></table><h3 id="ä¹ã€jenkinsæµæ°´çº¿" tabindex="-1"><a class="header-anchor" href="#ä¹ã€jenkinsæµæ°´çº¿" aria-hidden="true">#</a> ä¹ã€Jenkinsæµæ°´çº¿</h3><h4 id="_9-1-jenkinsæµæ°´çº¿ä»»åŠ¡ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_9-1-jenkinsæµæ°´çº¿ä»»åŠ¡ä»‹ç»" aria-hidden="true">#</a> 9.1 Jenkinsæµæ°´çº¿ä»»åŠ¡ä»‹ç»</h4><p>ä¹‹å‰é‡‡ç”¨Jenkinsçš„è‡ªç”±é£æ ¼æ„å»ºçš„é¡¹ç›®ï¼Œæ¯ä¸ªæ­¥éª¤æµç¨‹éƒ½è¦é€šè¿‡ä¸åŒçš„æ–¹å¼è®¾ç½®ï¼Œå¹¶ä¸”æ„å»ºè¿‡ç¨‹ä¸­æ•´ä½“æµç¨‹æ˜¯ä¸å¯è§çš„ï¼Œæ— æ³•ç¡®è®¤æ¯ä¸ªæµç¨‹èŠ±è´¹çš„æ—¶é—´ï¼Œå¹¶ä¸”é—®é¢˜ä¸æ–¹ä¾¿å®šä½é—®é¢˜ã€‚</p><p>Jenkinsçš„Pipelineå¯ä»¥è®©é¡¹ç›®çš„å‘å¸ƒæ•´ä½“æµç¨‹å¯è§†åŒ–ï¼Œæ˜ç¡®æ‰§è¡Œçš„é˜¶æ®µï¼Œå¯ä»¥å¿«é€Ÿçš„å®šä½é—®é¢˜ã€‚å¹¶ä¸”æ•´ä¸ªé¡¹ç›®çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥é€šè¿‡ä¸€ä¸ªJenkinsfileæ–‡ä»¶ç®¡ç†ï¼Œè€Œä¸”Jenkinsfileæ–‡ä»¶æ˜¯å¯ä»¥æ”¾åœ¨é¡¹ç›®ä¸­ç»´æŠ¤ã€‚</p><p>æ‰€ä»¥Pipelineç›¸å¯¹è‡ªç”±é£æ ¼æˆ–è€…å…¶ä»–çš„é¡¹ç›®é£æ ¼æ›´å®¹æ˜“æ“ä½œã€‚</p><h4 id="_9-2-jenkinsæµæ°´çº¿ä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#_9-2-jenkinsæµæ°´çº¿ä»»åŠ¡" aria-hidden="true">#</a> 9.2 Jenkinsæµæ°´çº¿ä»»åŠ¡</h4><h5 id="_9-2-1-æ„å»ºjenkinsæµæ°´çº¿ä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#_9-2-1-æ„å»ºjenkinsæµæ°´çº¿ä»»åŠ¡" aria-hidden="true">#</a> 9.2.1 æ„å»ºJenkinsæµæ°´çº¿ä»»åŠ¡</h5><ul><li><p>æ„å»ºä»»åŠ¡</p><table><thead><tr><th>æ„å»ºJenkinsæµæ°´çº¿ä»»åŠ¡</th></tr></thead><tbody><tr><td><img src="/assets/image-20211202144429302-cb0f2ae2.png" alt="image-20211202144429302" loading="lazy"></td></tr></tbody></table></li><li><p>ç”ŸæˆGroovyè„šæœ¬</p><table><thead><tr><th style="text-align:center;">Hello Worldè„šæœ¬ç”Ÿæˆ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211202144531749-6a0ca02a.png" alt="image-20211202144531749" loading="lazy"></td></tr></tbody></table></li><li><p>æ„å»ºåæŸ¥çœ‹è§†å›¾</p><table><thead><tr><th style="text-align:center;">æ„å»ºåæŸ¥çœ‹è§†å›¾</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211202144616117-54273e80.png" alt="image-20211202144616117" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_9-2-2-groovyè„šæœ¬" tabindex="-1"><a class="header-anchor" href="#_9-2-2-groovyè„šæœ¬" aria-hidden="true">#</a> 9.2.2 Groovyè„šæœ¬</h5><ul><li><p>Groovyè„šæœ¬åŸºç¡€è¯­æ³•</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>// æ‰€æœ‰è„šæœ¬å‘½ä»¤åŒ…å«åœ¨pipeline<span class="token punctuation">{</span><span class="token punctuation">}</span>ä¸­
pipeline <span class="token punctuation">{</span>  
	// æŒ‡å®šä»»åŠ¡åœ¨å“ªä¸ªèŠ‚ç‚¹æ‰§è¡Œï¼ˆJenkinsæ”¯æŒåˆ†å¸ƒå¼ï¼‰
    agent any
    
    // é…ç½®å…¨å±€ç¯å¢ƒï¼ŒæŒ‡å®šå˜é‡å<span class="token operator">=</span>å˜é‡å€¼ä¿¡æ¯
    environment<span class="token punctuation">{</span>
    	<span class="token function">host</span> <span class="token operator">=</span> <span class="token string">&#39;192.168.11.11&#39;</span>
    <span class="token punctuation">}</span>

    // å­˜æ”¾æ‰€æœ‰ä»»åŠ¡çš„åˆé›†
    stages <span class="token punctuation">{</span>
    	// å•ä¸ªä»»åŠ¡
        stage<span class="token punctuation">(</span><span class="token string">&#39;ä»»åŠ¡1&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	// å®ç°ä»»åŠ¡çš„å…·ä½“æµç¨‹
            steps <span class="token punctuation">{</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&#39;do something&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
		// å•ä¸ªä»»åŠ¡
        stage<span class="token punctuation">(</span><span class="token string">&#39;ä»»åŠ¡2&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	// å®ç°ä»»åŠ¡çš„å…·ä½“æµç¨‹
            steps <span class="token punctuation">{</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&#39;do something&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        // â€¦â€¦
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ç¼–å†™ä¾‹å­æµ‹è¯•</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>pipeline <span class="token punctuation">{</span>
    agent any

    // å­˜æ”¾æ‰€æœ‰ä»»åŠ¡çš„åˆé›†
    stages <span class="token punctuation">{</span>
        stage<span class="token punctuation">(</span><span class="token string">&#39;æ‹‰å–Gitä»£ç &#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&#39;æ‹‰å–Gitä»£ç &#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;æ£€æµ‹ä»£ç è´¨é‡&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&#39;æ£€æµ‹ä»£ç è´¨é‡&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;æ„å»ºä»£ç &#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&#39;æ„å»ºä»£ç &#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;åˆ¶ä½œè‡ªå®šä¹‰é•œåƒå¹¶å‘å¸ƒHarbor&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&#39;åˆ¶ä½œè‡ªå®šä¹‰é•œåƒå¹¶å‘å¸ƒHarbor&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;åŸºäºHarboréƒ¨ç½²å·¥ç¨‹&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&#39;åŸºäºHarboréƒ¨ç½²å·¥ç¨‹&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">é…ç½®Grovvyè„šæœ¬</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211202145155428-b971937d.png" alt="image-20211202145155428" loading="lazy"></td></tr></tbody></table></li><li><p>æŸ¥çœ‹æ•ˆæœ</p><table><thead><tr><th style="text-align:center;">æŸ¥çœ‹æ•ˆæœ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211202145240166-35ace642.png" alt="image-20211202145240166" loading="lazy"></td></tr></tbody></table></li></ul><p><a href="">Psï¼šæ¶‰åŠåˆ°ç‰¹å®šè„šæœ¬ï¼ŒJenkinsç»™äºˆäº†å……è¶³çš„æç¤ºï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆå‘½ä»¤</a></p><table><thead><tr><th style="text-align:center;">ç”Ÿæˆå‘½ä»¤ä½ç½®</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211202145349043-a3e35491.png" alt="image-20211202145349043" loading="lazy"></td></tr></tbody></table><h5 id="_9-2-3-jenkinsfileå®ç°" tabindex="-1"><a class="header-anchor" href="#_9-2-3-jenkinsfileå®ç°" aria-hidden="true">#</a> 9.2.3 Jenkinsfileå®ç°</h5><p>Jenkinsfileæ–¹å¼éœ€è¦å°†è„šæœ¬å†…å®¹ç¼–å†™åˆ°é¡¹ç›®ä¸­çš„Jenkinsfileæ–‡ä»¶ä¸­ï¼Œæ¯æ¬¡æ„å»ºä¼šè‡ªåŠ¨æ‹‰å–é¡¹ç›®å¹¶ä¸”è·å–é¡¹ç›®ä¸­Jenkinsfileæ–‡ä»¶å¯¹é¡¹ç›®è¿›è¡Œæ„å»º</p><ul><li><p>é…ç½®pipeline</p><table><thead><tr><th style="text-align:center;">é…ç½®pipeline</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211202151127254-9f780249.png" alt="image-20211202151127254" loading="lazy"></td></tr></tbody></table></li><li><p>å‡†å¤‡Jenkinsfile</p><table><thead><tr><th style="text-align:center;">å‡†å¤‡Jenkinsfileæ–‡ä»¶</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211202151155145-c051da27.png" alt="image-20211202151155145" loading="lazy"></td></tr></tbody></table></li><li><p>æµ‹è¯•æ•ˆæœ</p><table><thead><tr><th style="text-align:center;">æµ‹è¯•æ•ˆæœ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211202151225161-1a1f10cc.png" alt="image-20211202151225161" loading="lazy"></td></tr></tbody></table></li></ul><h4 id="_9-3-jenkinsæµæ°´çº¿ä»»åŠ¡å®ç°" tabindex="-1"><a class="header-anchor" href="#_9-3-jenkinsæµæ°´çº¿ä»»åŠ¡å®ç°" aria-hidden="true">#</a> 9.3 Jenkinsæµæ°´çº¿ä»»åŠ¡å®ç°</h4><h5 id="_9-3-1-å‚æ•°åŒ–æ„å»º" tabindex="-1"><a class="header-anchor" href="#_9-3-1-å‚æ•°åŒ–æ„å»º" aria-hidden="true">#</a> 9.3.1 å‚æ•°åŒ–æ„å»º</h5><p>æ·»åŠ å‚æ•°åŒ–æ„å»ºï¼Œæ–¹ä¾¿é€‰æ‹©ä¸çš„é¡¹ç›®ç‰ˆæœ¬</p><table><thead><tr><th style="text-align:center;">Gitå‚æ•°åŒ–æ„å»º</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211202191944277-1805d471.png" alt="image-20211202191944277" loading="lazy"></td></tr></tbody></table><h5 id="_9-3-2-æ‹‰å–gitä»£ç " tabindex="-1"><a class="header-anchor" href="#_9-3-2-æ‹‰å–gitä»£ç " aria-hidden="true">#</a> 9.3.2 æ‹‰å–Gitä»£ç </h5><p>é€šè¿‡æµæ°´çº¿è¯­æ³•ç”ŸæˆCheckoutä»£ç çš„è„šæœ¬</p><table><thead><tr><th style="text-align:center;">è¯­æ³•ç”Ÿæˆ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211202192047619-11fc617e.png" alt="image-20211202192047619" loading="lazy"></td></tr></tbody></table><p><img src="/assets/image-20211202192129895-33645673.png" alt="image-20211202192129895" loading="lazy">å°†*/masteræ›´æ”¹ä¸ºæ ‡ç­¾<a href="">${tag}</a></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>pipeline <span class="token punctuation">{</span>
    agent any
    stages <span class="token punctuation">{</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;æ‹‰å–Gitä»£ç &#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                checkout<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$class</span><span class="token builtin class-name">:</span> <span class="token string">&#39;GitSCM&#39;</span>, branches: <span class="token punctuation">[</span><span class="token punctuation">[</span>name: <span class="token string">&#39;${tag}&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>, extensions: <span class="token punctuation">[</span><span class="token punctuation">]</span>, userRemoteConfigs: <span class="token punctuation">[</span><span class="token punctuation">[</span>url: <span class="token string">&#39;http://49.233.115.171:8929/root/test.git&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_9-3-3-æ„å»ºä»£ç " tabindex="-1"><a class="header-anchor" href="#_9-3-3-æ„å»ºä»£ç " aria-hidden="true">#</a> 9.3.3 æ„å»ºä»£ç </h5><p>é€šè¿‡è„šæœ¬æ‰§è¡Œmvnçš„æ„å»ºå‘½ä»¤</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>pipeline <span class="token punctuation">{</span>
    agent any

    stages <span class="token punctuation">{</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;æ‹‰å–Gitä»£ç &#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                checkout<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$class</span><span class="token builtin class-name">:</span> <span class="token string">&#39;GitSCM&#39;</span>, branches: <span class="token punctuation">[</span><span class="token punctuation">[</span>name: <span class="token string">&#39;${tag}&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>, extensions: <span class="token punctuation">[</span><span class="token punctuation">]</span>, userRemoteConfigs: <span class="token punctuation">[</span><span class="token punctuation">[</span>url: <span class="token string">&#39;http://49.233.115.171:8929/root/test.git&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;æ„å»ºä»£ç &#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_9-3-4-ä»£ç è´¨é‡æ£€æµ‹" tabindex="-1"><a class="header-anchor" href="#_9-3-4-ä»£ç è´¨é‡æ£€æµ‹" aria-hidden="true">#</a> 9.3.4 ä»£ç è´¨é‡æ£€æµ‹</h5><p>é€šè¿‡è„šæœ¬æ‰§è¡Œsonar-scannerå‘½ä»¤å³å¯</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>pipeline <span class="token punctuation">{</span>
    agent any

    stages <span class="token punctuation">{</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;æ‹‰å–Gitä»£ç &#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                checkout<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$class</span><span class="token builtin class-name">:</span> <span class="token string">&#39;GitSCM&#39;</span>, branches: <span class="token punctuation">[</span><span class="token punctuation">[</span>name: <span class="token string">&#39;${tag}&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>, extensions: <span class="token punctuation">[</span><span class="token punctuation">]</span>, userRemoteConfigs: <span class="token punctuation">[</span><span class="token punctuation">[</span>url: <span class="token string">&#39;http://49.233.115.171:8929/root/test.git&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;æ„å»ºä»£ç &#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;æ£€æµ‹ä»£ç è´¨é‡&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;/var/jenkins_home/sonar-scanner/bin/sonar-scanner -Dsonar.sources=./ -Dsonar.projectname=${JOB_NAME} -Dsonar.projectKey=${JOB_NAME} -Dsonar.java.binaries=target/ -Dsonar.login=31388be45653876c1f51ec02f0d478e2d9d0e1fa&#39;</span> 
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_9-3-5-åˆ¶ä½œè‡ªå®šä¹‰é•œåƒå¹¶å‘å¸ƒ" tabindex="-1"><a class="header-anchor" href="#_9-3-5-åˆ¶ä½œè‡ªå®šä¹‰é•œåƒå¹¶å‘å¸ƒ" aria-hidden="true">#</a> 9.3.5 åˆ¶ä½œè‡ªå®šä¹‰é•œåƒå¹¶å‘å¸ƒ</h5><ul><li><p>ç”Ÿæˆè‡ªå®šä¹‰é•œåƒè„šæœ¬</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>pipeline <span class="token punctuation">{</span>
    agent any
    environment<span class="token punctuation">{</span>
        harborHost <span class="token operator">=</span> <span class="token string">&#39;192.168.11.11:80&#39;</span>
        harborRepo <span class="token operator">=</span> <span class="token string">&#39;repository&#39;</span>
        harborUser <span class="token operator">=</span> <span class="token string">&#39;DevOps&#39;</span>
        harborPasswd <span class="token operator">=</span> <span class="token string">&#39;P@ssw0rd&#39;</span>
    <span class="token punctuation">}</span>

    // å­˜æ”¾æ‰€æœ‰ä»»åŠ¡çš„åˆé›†
    stages <span class="token punctuation">{</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;æ‹‰å–Gitä»£ç &#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                checkout<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$class</span><span class="token builtin class-name">:</span> <span class="token string">&#39;GitSCM&#39;</span>, branches: <span class="token punctuation">[</span><span class="token punctuation">[</span>name: <span class="token string">&#39;${tag}&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>, extensions: <span class="token punctuation">[</span><span class="token punctuation">]</span>, userRemoteConfigs: <span class="token punctuation">[</span><span class="token punctuation">[</span>url: <span class="token string">&#39;http://49.233.115.171:8929/root/test.git&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;æ„å»ºä»£ç &#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;æ£€æµ‹ä»£ç è´¨é‡&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;/var/jenkins_home/sonar-scanner/bin/sonar-scanner -Dsonar.sources=./ -Dsonar.projectname=${JOB_NAME} -Dsonar.projectKey=${JOB_NAME} -Dsonar.java.binaries=target/ -Dsonar.login=31388be45653876c1f51ec02f0d478e2d9d0e1fa&#39;</span> 
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;åˆ¶ä½œè‡ªå®šä¹‰é•œåƒå¹¶å‘å¸ƒHarbor&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;&#39;</span>&#39;cp ./target/*.jar ./docker/
                <span class="token builtin class-name">cd</span> ./docker
                <span class="token function">docker</span> build <span class="token parameter variable">-t</span> <span class="token variable">${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">${tag}</span> ./<span class="token string">&#39;&#39;</span>&#39;

                <span class="token function">sh</span> <span class="token string">&#39;&#39;</span>&#39;docker login <span class="token parameter variable">-u</span> <span class="token variable">${harborUser}</span> <span class="token parameter variable">-p</span> <span class="token variable">${harborPasswd}</span> <span class="token variable">${harborHost}</span>
                <span class="token function">docker</span> tag <span class="token variable">${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">${tag}</span> <span class="token variable">${harborHost}</span>/<span class="token variable">${harborRepo}</span>/<span class="token variable">${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">${tag}</span>
                <span class="token function">docker</span> push <span class="token variable">${harborHost}</span>/<span class="token variable">${harborRepo}</span>/<span class="token variable">${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">${tag}</span><span class="token string">&#39;&#39;</span>&#39;
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ç”ŸæˆPublish Over SSHè„šæœ¬</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>pipeline <span class="token punctuation">{</span>
    agent any
    environment<span class="token punctuation">{</span>
        harborHost <span class="token operator">=</span> <span class="token string">&#39;192.168.11.11:80&#39;</span>
        harborRepo <span class="token operator">=</span> <span class="token string">&#39;repository&#39;</span>
        harborUser <span class="token operator">=</span> <span class="token string">&#39;DevOps&#39;</span>
        harborPasswd <span class="token operator">=</span> <span class="token string">&#39;P@ssw0rd&#39;</span>
    <span class="token punctuation">}</span>

    // å­˜æ”¾æ‰€æœ‰ä»»åŠ¡çš„åˆé›†
    stages <span class="token punctuation">{</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;æ‹‰å–Gitä»£ç &#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                checkout<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$class</span><span class="token builtin class-name">:</span> <span class="token string">&#39;GitSCM&#39;</span>, branches: <span class="token punctuation">[</span><span class="token punctuation">[</span>name: <span class="token string">&#39;${tag}&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>, extensions: <span class="token punctuation">[</span><span class="token punctuation">]</span>, userRemoteConfigs: <span class="token punctuation">[</span><span class="token punctuation">[</span>url: <span class="token string">&#39;http://49.233.115.171:8929/root/test.git&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;æ„å»ºä»£ç &#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>docker

        stage<span class="token punctuation">(</span><span class="token string">&#39;æ£€æµ‹ä»£ç è´¨é‡&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;/var/jenkins_home/sonar-scanner/bin/sonar-scanner -Dsonar.sources=./ -Dsonar.projectname=${JOB_NAME} -Dsonar.projectKey=${JOB_NAME} -Dsonar.java.binaries=target/ -Dsonar.login=7d66af4b39cfe4f52ac0a915d4c9d5c513207098&#39;</span> 
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;åˆ¶ä½œè‡ªå®šä¹‰é•œåƒå¹¶å‘å¸ƒHarbor&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;&#39;</span>&#39;cp ./target/*.jar ./docker/
                <span class="token builtin class-name">cd</span> ./docker
                <span class="token function">docker</span> build <span class="token parameter variable">-t</span> <span class="token variable">${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">${tag}</span> ./<span class="token string">&#39;&#39;</span>&#39;

                <span class="token function">sh</span> <span class="token string">&#39;&#39;</span>&#39;docker login <span class="token parameter variable">-u</span> <span class="token variable">${harborUser}</span> <span class="token parameter variable">-p</span> <span class="token variable">${harborPasswd}</span> <span class="token variable">${harborHost}</span>
                <span class="token function">docker</span> tag <span class="token variable">${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">${tag}</span> <span class="token variable">${harborHost}</span>/<span class="token variable">${harborRepo}</span>/<span class="token variable">${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">${tag}</span>
                <span class="token function">docker</span> push <span class="token variable">${harborHost}</span>/<span class="token variable">${harborRepo}</span>/<span class="token variable">${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">${tag}</span><span class="token string">&#39;&#39;</span>&#39;
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        
        stage<span class="token punctuation">(</span><span class="token string">&#39;ç›®æ ‡æœåŠ¡å™¨æ‹‰å–é•œåƒå¹¶è¿è¡Œ&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                sshPublisher<span class="token punctuation">(</span>publishers: <span class="token punctuation">[</span>sshPublisherDesc<span class="token punctuation">(</span>configName: <span class="token string">&#39;testEnvironment&#39;</span>, transfers: <span class="token punctuation">[</span>sshTransfer<span class="token punctuation">(</span>cleanRemote: false, excludes: <span class="token string">&#39;&#39;</span>, execCommand: <span class="token string">&quot;/usr/bin/deploy.sh <span class="token variable">$harborHost</span> <span class="token variable">$harborRepo</span> <span class="token variable">$JOB_NAME</span> <span class="token variable">$tag</span> <span class="token variable">$port</span> &quot;</span>, execTimeout: <span class="token number">120000</span>, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: <span class="token string">&#39;[, ]+&#39;</span>, remoteDirectory: <span class="token string">&#39;&#39;</span>, remoteDirectorySDF: false, removePrefix: <span class="token string">&#39;&#39;</span>, sourceFiles: <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>, usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p><a href="">Psï¼šç”±äºé‡‡ç”¨å˜é‡ï¼Œè®°å¾—ä½¿ç”¨åŒå¼•å·</a></p><h4 id="_9-4-jenkinsæµæ°´çº¿æ•´åˆé’‰é’‰" tabindex="-1"><a class="header-anchor" href="#_9-4-jenkinsæµæ°´çº¿æ•´åˆé’‰é’‰" aria-hidden="true">#</a> 9.4 Jenkinsæµæ°´çº¿æ•´åˆé’‰é’‰</h4><p>åœ¨ç¨‹åºéƒ¨ç½²æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡é’‰é’‰çš„æœºå™¨äººåŠæ—¶å‘ç¾¤ä¼—å‘é€éƒ¨ç½²çš„æœ€ç»ˆç»“æœé€šçŸ¥</p><ul><li><p>å®‰è£…æ’ä»¶</p><table><thead><tr><th style="text-align:center;">å®‰è£…æ’ä»¶</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211209151549412-9a250335.png" alt="image-20211209151549412" loading="lazy"></td></tr></tbody></table></li><li><p>é’‰é’‰å†…éƒ¨åˆ›å»ºç¾¤ç»„å¹¶æ„å»ºæœºå™¨äºº</p><table><thead><tr><th style="text-align:center;">é’‰é’‰å†…éƒ¨åˆ›å»ºç¾¤ç»„å¹¶æ„å»ºæœºå™¨äºº</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211209152217433-296496a6.png" alt="image-20211209152217433" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/image-20211209152252050-d7ad26b9.png" alt="image-20211209152252050" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/image-20211209152403312-18f36afe.png" alt="image-20211209152403312" loading="lazy"></td></tr></tbody></table><p>æœ€ç»ˆæˆ–è·å–åˆ°Webhookä¿¡æ¯</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>https://oapi.dingtalk.com/robot/send?access_token=kej4ehkj34gjhg34jh5bh5jb34hj53b4
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ç³»ç»Ÿé…ç½®æ·»åŠ é’‰é’‰é€šçŸ¥</p><table><thead><tr><th style="text-align:center;">é…ç½®é’‰é’‰é€šçŸ¥</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211209162923440-00e92b47.png" alt="image-20211209162923440" loading="lazy"></td></tr></tbody></table></li><li><p>ä»»åŠ¡ä¸­è¿½åŠ æµæ°´çº¿é…ç½®</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>pipeline <span class="token punctuation">{</span>
    agent any

    environment <span class="token punctuation">{</span>
        sonarLogin <span class="token operator">=</span> <span class="token string">&#39;2bab7bf7d5af25e2c2ca2f178af2c3c55c64d5d8&#39;</span>
        harborUser <span class="token operator">=</span> <span class="token string">&#39;admin&#39;</span>
        harborPassword <span class="token operator">=</span> <span class="token string">&#39;Harbor12345&#39;</span>
        harborHost <span class="token operator">=</span> <span class="token string">&#39;192.168.11.12:8888&#39;</span>
        harborRepo <span class="token operator">=</span> <span class="token string">&#39;repository&#39;</span>
    <span class="token punctuation">}</span>

    stages <span class="token punctuation">{</span>
        stage<span class="token punctuation">(</span><span class="token string">&#39;æ‹‰å–Gitä»£ç &#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                checkout<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$class</span><span class="token builtin class-name">:</span> <span class="token string">&#39;GitSCM&#39;</span>, branches: <span class="token punctuation">[</span><span class="token punctuation">[</span>name: <span class="token string">&#39;$tag&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>, extensions: <span class="token punctuation">[</span><span class="token punctuation">]</span>, userRemoteConfigs: <span class="token punctuation">[</span><span class="token punctuation">[</span>url: <span class="token string">&#39;http://49.233.115.171:8929/root/lsx.git&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        stage<span class="token punctuation">(</span><span class="token string">&#39;Mavenæ„å»ºä»£ç &#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        stage<span class="token punctuation">(</span><span class="token string">&#39;SonarQubeæ£€æµ‹ä»£ç &#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;/var/jenkins_home/sonar-scanner/bin/sonar-scanner -Dsonar.sources=./ -Dsonar.projectname=${JOB_NAME} -Dsonar.projectKey=${JOB_NAME} -Dsonar.java.binaries=target/ -Dsonar.login=${sonarLogin}&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        stage<span class="token punctuation">(</span><span class="token string">&#39;åˆ¶ä½œè‡ªå®šä¹‰é•œåƒ&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;&#39;</span>&#39;cd <span class="token function">docker</span>
                <span class="token function">mv</span> <span class="token punctuation">..</span>/target/*.jar ./
                <span class="token function">docker</span> build <span class="token parameter variable">-t</span> <span class="token variable">${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">$tag</span> <span class="token builtin class-name">.</span>
                <span class="token string">&#39;&#39;</span>&#39;
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;æ¨é€è‡ªå®šä¹‰é•œåƒ&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">&#39;&#39;</span>&#39;docker login <span class="token parameter variable">-u</span> <span class="token variable">${harborUser}</span> <span class="token parameter variable">-p</span> <span class="token variable">${harborPassword}</span> <span class="token variable">${harborHost}</span>
                <span class="token function">docker</span> tag <span class="token variable">${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">$tag</span> <span class="token variable">${harborHost}</span>/<span class="token variable">${harborRepo}</span>/<span class="token variable">${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">$tag</span>
                <span class="token function">docker</span> push <span class="token variable">${harborHost}</span>/<span class="token variable">${harborRepo}</span>/<span class="token variable">${JOB_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">$tag</span><span class="token string">&#39;&#39;</span>&#39;
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        stage<span class="token punctuation">(</span><span class="token string">&#39;é€šçŸ¥ç›®æ ‡æœåŠ¡å™¨&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                sshPublisher<span class="token punctuation">(</span>publishers: <span class="token punctuation">[</span>sshPublisherDesc<span class="token punctuation">(</span>configName: <span class="token string">&#39;centos-docker&#39;</span>, transfers: <span class="token punctuation">[</span>sshTransfer<span class="token punctuation">(</span>cleanRemote: false, excludes: <span class="token string">&#39;&#39;</span>, execCommand: <span class="token string">&quot;/usr/bin/deploy.sh <span class="token variable">$harborHost</span> <span class="token variable">$harborRepo</span> <span class="token variable">$JOB_NAME</span> <span class="token variable">$tag</span> <span class="token variable">$port</span>&quot;</span>, execTimeout: <span class="token number">120000</span>, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: <span class="token string">&#39;[, ]+&#39;</span>, remoteDirectory: <span class="token string">&#39;&#39;</span>, remoteDirectorySDF: false, removePrefix: <span class="token string">&#39;&#39;</span>, sourceFiles: <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>, usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>  
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    post <span class="token punctuation">{</span>
        success <span class="token punctuation">{</span>
            dingtalk <span class="token punctuation">(</span>
                robot: <span class="token string">&#39;Jenkins-DingDing&#39;</span>,
                type:<span class="token string">&#39;MARKDOWN&#39;</span>,
                title: <span class="token string">&quot;success: <span class="token variable">${JOB_NAME}</span>&quot;</span>,
                text: <span class="token punctuation">[</span><span class="token string">&quot;- æˆåŠŸæ„å»º:<span class="token variable">${JOB_NAME}</span>é¡¹ç›®!<span class="token entity" title="\n">\n</span>- ç‰ˆæœ¬:<span class="token variable">${tag}</span><span class="token entity" title="\n">\n</span>- æŒç»­æ—¶é—´:<span class="token variable">${currentBuild.durationString}</span><span class="token entity" title="\n">\n</span>- ä»»åŠ¡:#<span class="token variable">${JOB_NAME}</span>&quot;</span><span class="token punctuation">]</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        failure <span class="token punctuation">{</span>
            dingtalk <span class="token punctuation">(</span>
                robot: <span class="token string">&#39;Jenkins-DingDing&#39;</span>,
                type:<span class="token string">&#39;MARKDOWN&#39;</span>,
                title: <span class="token string">&quot;fail: <span class="token variable">${JOB_NAME}</span>&quot;</span>,
                text: <span class="token punctuation">[</span><span class="token string">&quot;- å¤±è´¥æ„å»º:<span class="token variable">${JOB_NAME}</span>é¡¹ç›®!<span class="token entity" title="\n">\n</span>- ç‰ˆæœ¬:<span class="token variable">${tag}</span><span class="token entity" title="\n">\n</span>- æŒç»­æ—¶é—´:<span class="token variable">${currentBuild.durationString}</span><span class="token entity" title="\n">\n</span>- ä»»åŠ¡:#<span class="token variable">${JOB_NAME}</span>&quot;</span><span class="token punctuation">]</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥çœ‹æ•ˆæœ</p><table><thead><tr><th style="text-align:center;">é’‰é’‰é€šçŸ¥æ•ˆæœ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211209163021396-59fd0557.png" alt="image-20211209163021396" loading="lazy"></td></tr></tbody></table></li></ul><h3 id="åã€kubernetesç¼–æ’å·¥å…·" tabindex="-1"><a class="header-anchor" href="#åã€kubernetesç¼–æ’å·¥å…·" aria-hidden="true">#</a> åã€Kubernetesç¼–æ’å·¥å…·</h3><h4 id="_10-1-kubernetesä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_10-1-kubernetesä»‹ç»" aria-hidden="true">#</a> 10.1 Kubernetesä»‹ç»</h4><p>Kubernetesæ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œç”¨äºç®¡ç†äº‘å¹³å°ä¸­å¤šä¸ªä¸»æœºä¸Šçš„å®¹å™¨åŒ–çš„åº”ç”¨ï¼ŒKubernetesçš„ç›®æ ‡æ˜¯è®©éƒ¨ç½²å®¹å™¨åŒ–çš„åº”ç”¨ç®€å•å¹¶ä¸”é«˜æ•ˆï¼ˆpowerfulï¼‰ï¼ŒKubernetesæä¾›äº†åº”ç”¨éƒ¨ç½²ï¼Œè§„åˆ’ï¼Œæ›´æ–°ï¼Œç»´æŠ¤çš„ä¸€ç§æœºåˆ¶ã€‚</p><p>Kubernetesä¸€ä¸ªæ ¸å¿ƒçš„ç‰¹ç‚¹å°±æ˜¯èƒ½å¤Ÿè‡ªä¸»çš„ç®¡ç†å®¹å™¨æ¥ä¿è¯äº‘å¹³å°ä¸­çš„å®¹å™¨æŒ‰ç…§ç”¨æˆ·çš„æœŸæœ›çŠ¶æ€è¿è¡Œç€ï¼Œç®¡ç†å‘˜å¯ä»¥åŠ è½½ä¸€ä¸ªå¾®å‹æœåŠ¡ï¼Œè®©è§„åˆ’å™¨æ¥æ‰¾åˆ°åˆé€‚çš„ä½ç½®ï¼ŒåŒæ—¶ï¼ŒKubernetesä¹Ÿç³»ç»Ÿæå‡å·¥å…·ä»¥åŠäººæ€§åŒ–æ–¹é¢ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿæ–¹ä¾¿çš„éƒ¨ç½²è‡ªå·±çš„åº”ç”¨ã€‚</p><p>Kubernetesä¸»è¦èƒ½å¸®åŠ©æˆ‘ä»¬å®Œæˆï¼š</p><ul><li><p>æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡</p><p>Kubernetes å¯ä»¥ä½¿ç”¨ DNS åç§°æˆ–è‡ªå·±çš„ IP åœ°å€å…¬å¼€å®¹å™¨ï¼Œå¦‚æœè¿›å…¥å®¹å™¨çš„æµé‡å¾ˆå¤§ï¼Œ Kubernetes å¯ä»¥è´Ÿè½½å‡è¡¡å¹¶åˆ†é…ç½‘ç»œæµé‡ï¼Œä»è€Œä½¿éƒ¨ç½²ç¨³å®šã€‚</p></li><li><p>å­˜å‚¨ç¼–æ’</p><p>Kubernetes å…è®¸ä½ è‡ªåŠ¨æŒ‚è½½ä½ é€‰æ‹©çš„å­˜å‚¨ç³»ç»Ÿï¼Œæ¯”å¦‚æœ¬åœ°å­˜å‚¨ï¼Œç±»ä¼¼Dockerçš„æ•°æ®å·ã€‚</p></li><li><p>è‡ªåŠ¨éƒ¨ç½²å’Œå›æ»š</p><p>ä½ å¯ä»¥ä½¿ç”¨ Kubernetes æè¿°å·²éƒ¨ç½²å®¹å™¨çš„æ‰€éœ€çŠ¶æ€ï¼Œå®ƒå¯ä»¥ä»¥å—æ§çš„é€Ÿç‡å°†å®é™…çŠ¶æ€ æ›´æ”¹ä¸ºæœŸæœ›çŠ¶æ€ã€‚Kubernetes ä¼šè‡ªåŠ¨å¸®ä½ æ ¹æ®æƒ…å†µéƒ¨ç½²åˆ›å»ºæ–°å®¹å™¨ï¼Œå¹¶åˆ é™¤ç°æœ‰å®¹å™¨ç»™æ–°å®¹å™¨æä¾›èµ„æºã€‚</p></li><li><p>è‡ªåŠ¨å®Œæˆè£…ç®±è®¡ç®—</p><p>Kubernetes å…è®¸ä½ è®¾ç½®æ¯ä¸ªå®¹å™¨çš„èµ„æºï¼Œæ¯”å¦‚CPUå’Œå†…å­˜ã€‚</p></li><li><p>è‡ªæˆ‘ä¿®å¤</p><p>Kubernetes é‡æ–°å¯åŠ¨å¤±è´¥çš„å®¹å™¨ã€æ›¿æ¢å®¹å™¨ã€æ€æ­»ä¸å“åº”ç”¨æˆ·å®šä¹‰çš„å®¹å™¨ï¼Œå¹¶è¿è¡ŒçŠ¶å†µæ£€æŸ¥çš„å®¹å™¨ã€‚</p></li><li><p>ç§˜é’¥ä¸é…ç½®ç®¡ç†</p><p>Kubernetes å…è®¸ä½ å­˜å‚¨å’Œç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€OAuth ä»¤ç‰Œå’Œ ssh å¯†é’¥ã€‚ä½ å¯ä»¥åœ¨ä¸é‡å»ºå®¹å™¨é•œåƒçš„æƒ…å†µä¸‹éƒ¨ç½²å’Œæ›´æ–°å¯†é’¥å’Œåº”ç”¨ç¨‹åºé…ç½®ï¼Œä¹Ÿæ— éœ€åœ¨å †æ ˆé…ç½®ä¸­æš´éœ²å¯†é’¥ã€‚</p></li></ul><h4 id="_10-2-kubernetesæ¶æ„" tabindex="-1"><a class="header-anchor" href="#_10-2-kubernetesæ¶æ„" aria-hidden="true">#</a> 10.2 Kubernetesæ¶æ„</h4><p>Kubernetes æ­å»ºéœ€è¦è‡³å°‘ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªMasterè´Ÿè´£ç®¡ç†ï¼Œä¸€ä¸ªSlaveæ­å»ºåœ¨å·¥ä½œæœåŠ¡å™¨ä¸Šè´Ÿè´£åˆ†é…ã€‚</p><table><thead><tr><th style="text-align:center;">kubernetesæ¶æ„</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211210114507638-6321ee83.png" alt="image-20211210114507638" loading="lazy"></td></tr></tbody></table><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°å„ä¸ªç»„ä»¶çš„åŸºæœ¬åŠŸèƒ½ï¼š</p><ul><li>API Serverï¼šä½œä¸ºK8sé€šè®¯çš„æ ¸å¿ƒç»„ä»¶ï¼ŒK8så†…éƒ¨äº¤äº’ä»¥åŠæ¥æ”¶å‘é€æŒ‡ä»¤çš„ç»„ä»¶ã€‚</li><li>controller-managerï¼šä½œä¸ºK8sçš„æ ¸å¿ƒç»„ä»¶ï¼Œä¸»è¦åšèµ„æºè°ƒåº¦ï¼Œæ ¹æ®é›†ç¾¤æƒ…å†µåˆ†é…èµ„æº</li><li>etcdï¼šä¸€ä¸ªkey-valueçš„æ•°æ®åº“ï¼Œå­˜å‚¨å­˜å‚¨é›†ç¾¤çš„çŠ¶æ€ä¿¡æ¯</li><li>schedulerï¼šè´Ÿè´£è°ƒåº¦æ¯ä¸ªå·¥ä½œèŠ‚ç‚¹</li><li>cloud-controller-managerï¼šè´Ÿè´£è°ƒåº¦å…¶ä»–äº‘æœåŠ¡äº§å“</li><li>kubeletï¼šç®¡ç†Podsä¸Šé¢çš„å®¹å™¨ã€‚</li><li>kube-proxyï¼šè´Ÿè´£å¤„ç†å…¶ä»–Slaveæˆ–å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚</li><li>Podï¼šå¯ä»¥ç†è§£ä¸ºå°±æ˜¯è¿è¡Œçš„å®¹å™¨</li></ul><h4 id="_10-3-kuberneteså®‰è£…" tabindex="-1"><a class="header-anchor" href="#_10-3-kuberneteså®‰è£…" aria-hidden="true">#</a> 10.3 Kuberneteså®‰è£…</h4><p>è¿™é‡Œä¼šé‡‡ç”¨<a href="https://kuboard.cn/%E6%8F%90%E4%BE%9B%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85K8s%EF%BC%8C%E5%AE%89%E8%A3%85%E5%8D%95Master%E8%8A%82%E7%82%B9" target="_blank" rel="noopener noreferrer">https://kuboard.cn/æä¾›çš„æ–¹å¼å®‰è£…K8sï¼Œå®‰è£…å•MasterèŠ‚ç‚¹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><ul><li>è¦æ±‚ä½¿ç”¨Centos7.8ç‰ˆæœ¬ï¼š<a href="https://vault.centos.org/7.8.2003/isos/x86_64/CentOS-7-x86_64-Minimal-2003.iso" target="_blank" rel="noopener noreferrer">https://vault.centos.org/7.8.2003/isos/x86_64/CentOS-7-x86_64-Minimal-2003.iso<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>è‡³å°‘2å° <strong>2æ ¸4G</strong> çš„æœåŠ¡å™¨</li></ul><p>å®‰è£…æµç¨‹</p><table><thead><tr><th style="text-align:center;">å®‰è£…æµç¨‹</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211210190653687-e08576af.png" alt="image-20211210190653687" loading="lazy"></td></tr></tbody></table><p>å‡†å¤‡å¥½æœåŠ¡å™¨åå¼€å§‹å®‰è£…</p><ul><li><p>é‡æ–°è®¾ç½®hostnameï¼Œä¸å…è®¸ä¸ºlocalhost</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># ä¿®æ”¹ hostnameï¼Œåå­—ä¸å…è®¸ä½¿ç”¨ä¸‹åˆ’çº¿ã€å°æ•°ç‚¹ã€å¤§å†™å­—æ¯ï¼Œä¸èƒ½å«master</span>
hostnamectl set-hostname your-new-host-name
<span class="token comment"># æŸ¥çœ‹ä¿®æ”¹ç»“æœ</span>
hostnamectl status
<span class="token comment"># è®¾ç½® hostname è§£æ</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;127.0.0.1   <span class="token variable"><span class="token variable">$(</span><span class="token function">hostname</span><span class="token variable">)</span></span>&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>è¦æ±‚2å°æœåŠ¡ä¹‹é—´å¯ä»¥ç›¸äº’é€šè®¯</p></li><li><p>å®‰è£…è½¯ä»¶</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># é˜¿é‡Œäº‘ docker hub é•œåƒ</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">REGISTRY_MIRROR</span><span class="token operator">=</span>https://registry.cn-hangzhou.aliyuncs.com
<span class="token function">curl</span> <span class="token parameter variable">-sSL</span> https://kuboard.cn/install-script/v1.19.x/install_kubelet.sh <span class="token operator">|</span> <span class="token function">sh</span> <span class="token parameter variable">-s</span> <span class="token number">1.19</span>.5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>é¦–å…ˆåˆå§‹åŒ–MasterèŠ‚ç‚¹</p><blockquote><p>å…³äºåˆå§‹åŒ–æ—¶ç”¨åˆ°çš„ç¯å¢ƒå˜é‡</p><ul><li><strong>APISERVER_NAME</strong> ä¸èƒ½æ˜¯ master çš„ hostname</li><li><strong>APISERVER_NAME</strong> å¿…é¡»å…¨ä¸ºå°å†™å­—æ¯ã€æ•°å­—ã€å°æ•°ç‚¹ï¼Œä¸èƒ½åŒ…å«å‡å·</li><li><strong>POD_SUBNET</strong> æ‰€ä½¿ç”¨çš„ç½‘æ®µä¸èƒ½ä¸ <em><strong>masterèŠ‚ç‚¹/workerèŠ‚ç‚¹</strong></em> æ‰€åœ¨çš„ç½‘æ®µé‡å ã€‚è¯¥å­—æ®µçš„å–å€¼ä¸ºä¸€ä¸ª <a href="https://kuboard.cn/glossary/cidr.html" target="_blank" rel="noopener noreferrer">CIDR<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> å€¼ï¼Œå¦‚æœæ‚¨å¯¹ CIDR è¿™ä¸ªæ¦‚å¿µè¿˜ä¸ç†Ÿæ‚‰ï¼Œè¯·ä»ç„¶æ‰§è¡Œ export POD_SUBNET=10.100.0.0/16 å‘½ä»¤ï¼Œä¸åšä¿®æ”¹</li></ul></blockquote><ul><li><p>è®¾ç½®ipï¼ŒåŸŸåï¼Œç½‘æ®µå¹¶æ‰§è¡Œåˆå§‹åŒ–æ“ä½œ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ</span>
<span class="token comment"># æ›¿æ¢ x.x.x.x ä¸º master èŠ‚ç‚¹å®é™… IPï¼ˆè¯·ä½¿ç”¨å†…ç½‘ IPï¼‰</span>
<span class="token comment"># export å‘½ä»¤åªåœ¨å½“å‰ shell ä¼šè¯ä¸­æœ‰æ•ˆï¼Œå¼€å¯æ–°çš„ shell çª—å£åï¼Œå¦‚æœè¦ç»§ç»­å®‰è£…è¿‡ç¨‹ï¼Œè¯·é‡æ–°æ‰§è¡Œæ­¤å¤„çš„ export å‘½ä»¤</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">MASTER_IP</span><span class="token operator">=</span><span class="token number">192.168</span>.11.32
<span class="token comment"># æ›¿æ¢ apiserver.demo ä¸º æ‚¨æƒ³è¦çš„ dnsName</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">APISERVER_NAME</span><span class="token operator">=</span>apiserver.demo
<span class="token comment"># Kubernetes å®¹å™¨ç»„æ‰€åœ¨çš„ç½‘æ®µï¼Œè¯¥ç½‘æ®µå®‰è£…å®Œæˆåï¼Œç”± kubernetes åˆ›å»ºï¼Œäº‹å…ˆå¹¶ä¸å­˜åœ¨äºæ‚¨çš„ç‰©ç†ç½‘ç»œä¸­</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">POD_SUBNET</span><span class="token operator">=</span><span class="token number">10.100</span>.0.1/16
<span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${MASTER_IP}</span>    <span class="token variable">${APISERVER_NAME}</span>&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
<span class="token function">curl</span> <span class="token parameter variable">-sSL</span> https://kuboard.cn/install-script/v1.19.x/init_master.sh <span class="token operator">|</span> <span class="token function">sh</span> <span class="token parameter variable">-s</span> <span class="token number">1.19</span>.5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ£€æŸ¥Masterå¯åŠ¨çŠ¶æ€</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ</span>

<span class="token comment"># æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œç­‰å¾… 3-10 åˆ†é’Ÿï¼Œç›´åˆ°æ‰€æœ‰çš„å®¹å™¨ç»„å¤„äº Running çŠ¶æ€</span>
<span class="token function">watch</span> kubectl get pod <span class="token parameter variable">-n</span> kube-system <span class="token parameter variable">-o</span> wide

<span class="token comment"># æŸ¥çœ‹ master èŠ‚ç‚¹åˆå§‹åŒ–ç»“æœ</span>
kubectl get nodes <span class="token parameter variable">-o</span> wide
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p><code>Psï¼šå¦‚æœå‡ºç°NotReadyçš„æƒ…å†µæ‰§è¡Œï¼ˆæœ€æ–°ç‰ˆæœ¬çš„BUGï¼Œ1.19ä¸€èˆ¬æ²¡æœ‰ï¼‰</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull quay.io/coreos/flannel:v0.10.0-amd64 
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/cni/net.d/
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF<span class="token operator">&gt;</span> /etc/cni/net.d/10-flannel.conf
<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;cbr0&quot;</span>,<span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;flannel&quot;</span>,<span class="token string">&quot;delegate&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;isDefaultGateway&quot;</span><span class="token builtin class-name">:</span> true<span class="token punctuation">}</span><span class="token punctuation">}</span>
EOF
<span class="token function">mkdir</span> /usr/share/oci-umount/oci-umount.d <span class="token parameter variable">-p</span>
<span class="token function">mkdir</span> /run/flannel/
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF<span class="token operator">&gt;</span> /run/flannel/subnet.env
<span class="token assign-left variable">FLANNEL_NETWORK</span><span class="token operator">=</span><span class="token number">172.100</span>.0.0/16
<span class="token assign-left variable">FLANNEL_SUBNET</span><span class="token operator">=</span><span class="token number">172.100</span>.1.0/24
<span class="token assign-left variable">FLANNEL_MTU</span><span class="token operator">=</span><span class="token number">1450</span>
<span class="token assign-left variable">FLANNEL_IPMASQ</span><span class="token operator">=</span>true
EOF
kubectl apply <span class="token parameter variable">-f</span> https://raw.githubusercontent.com/coreos/flannel/v0.9.1/Documentation/kube-flannel.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®‰è£…ç½‘ç»œæœåŠ¡æ’ä»¶</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">POD_SUBNET</span><span class="token operator">=</span><span class="token number">10.100</span>.0.0/16
kubectl apply <span class="token parameter variable">-f</span> https://kuboard.cn/install-script/v1.22.x/calico-operator.yaml
<span class="token function">wget</span> https://kuboard.cn/install-script/v1.22.x/calico-custom-resources.yaml
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;s#192.168.0.0/16#<span class="token variable">${POD_SUBNET}</span>#&quot;</span> calico-custom-resources.yaml
kubectl apply <span class="token parameter variable">-f</span> calico-custom-resources.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆå§‹åŒ–workerèŠ‚ç‚¹</p><ul><li><p>è·å–Joinå‘½ä»¤å‚æ•°ï¼Œåœ¨MasterèŠ‚ç‚¹æ‰§è¡Œ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ</span>
kubeadm token create --print-join-command
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">è·å–å‘½ä»¤</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211213183025291-b888595f.png" alt="image-20211213183025291" loading="lazy"></td></tr></tbody></table></li><li><p>åœ¨workerèŠ‚ç‚¹åˆå§‹åŒ–</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># åªåœ¨ worker èŠ‚ç‚¹æ‰§è¡Œ</span>
<span class="token comment"># æ›¿æ¢ x.x.x.x ä¸º master èŠ‚ç‚¹çš„å†…ç½‘ IP</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">MASTER_IP</span><span class="token operator">=</span><span class="token number">192.168</span>.11.32
<span class="token comment"># æ›¿æ¢ apiserver.demo ä¸ºåˆå§‹åŒ– master èŠ‚ç‚¹æ—¶æ‰€ä½¿ç”¨çš„ APISERVER_NAME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">APISERVER_NAME</span><span class="token operator">=</span>apiserver.demo
<span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">${MASTER_IP}</span>    <span class="token variable">${APISERVER_NAME}</span>&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/hosts

<span class="token comment"># æ›¿æ¢ä¸º master èŠ‚ç‚¹ä¸Š kubeadm token create å‘½ä»¤çš„è¾“å‡º</span>
kubeadm <span class="token function">join</span> apiserver.demo:6443 <span class="token parameter variable">--token</span> vwfilu.3nhndohc5gn1jv9k     --discovery-token-ca-cert-hash sha256:22ff15cabfe87ab48a7db39b3bbf986fee92ec92eb8efc7fe9b0abe2175ff0c2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>æ£€æŸ¥æœ€ç»ˆè¿è¡Œæ•ˆæœ</p><ul><li><p>åœ¨ master èŠ‚ç‚¹ä¸Šæ‰§è¡Œ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ</span>
kubectl get nodes <span class="token parameter variable">-o</span> wide
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p><code>Psï¼šå¦‚æœå‡ºç°NotReadyçš„æƒ…å†µæ‰§è¡Œï¼ˆæœ€æ–°ç‰ˆæœ¬çš„BUGï¼Œ1.19ä¸€èˆ¬æ²¡æœ‰ï¼‰</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull quay.io/coreos/flannel:v0.10.0-amd64 
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/cni/net.d/
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF<span class="token operator">&gt;</span> /etc/cni/net.d/10-flannel.conf
<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;cbr0&quot;</span>,<span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;flannel&quot;</span>,<span class="token string">&quot;delegate&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;isDefaultGateway&quot;</span><span class="token builtin class-name">:</span> true<span class="token punctuation">}</span><span class="token punctuation">}</span>
EOF
<span class="token function">mkdir</span> /usr/share/oci-umount/oci-umount.d <span class="token parameter variable">-p</span>
<span class="token function">mkdir</span> /run/flannel/
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF<span class="token operator">&gt;</span> /run/flannel/subnet.env
<span class="token assign-left variable">FLANNEL_NETWORK</span><span class="token operator">=</span><span class="token number">172.100</span>.0.0/16
<span class="token assign-left variable">FLANNEL_SUBNET</span><span class="token operator">=</span><span class="token number">172.100</span>.1.0/24
<span class="token assign-left variable">FLANNEL_MTU</span><span class="token operator">=</span><span class="token number">1450</span>
<span class="token assign-left variable">FLANNEL_IPMASQ</span><span class="token operator">=</span>true
EOF
kubectl apply <span class="token parameter variable">-f</span> https://raw.githubusercontent.com/coreos/flannel/v0.9.1/Documentation/kube-flannel.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8smaster ~<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">æ­å»ºæˆåŠŸæ•ˆæœ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211210184851810-8b677bc0.png" alt="image-20211210184851810" loading="lazy"></td></tr></tbody></table></li></ul><p>å®‰è£…Kuboardç®¡ç†K8sé›†ç¾¤</p><ul><li><p>å®‰è£…Kuboard</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code>kubectl apply <span class="token punctuation">-</span>f https<span class="token punctuation">:</span>//addons.kuboard.cn/kuboard/kuboard<span class="token punctuation">-</span>v3.yaml
<span class="token comment"># æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æŒ‡ä»¤ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œè¯¥æŒ‡ä»¤ä½¿ç”¨åä¸ºäº‘çš„é•œåƒä»“åº“æ›¿ä»£ docker hub åˆ†å‘ Kuboard æ‰€éœ€è¦çš„é•œåƒ</span>
<span class="token comment"># kubectl apply -f https://addons.kuboard.cn/kuboard/kuboard-v3-swr.yaml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥çœ‹å¯åŠ¨æƒ…å†µ</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>watch kubectl get pods -n kuboard
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">æŸ¥çœ‹æ•ˆæœ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211213184701784-d4b6d7dc.png" alt="image-20211213184701784" loading="lazy"></td></tr></tbody></table></li><li><p>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€é“¾æ¥ <a href="http://your-node-ip-address:30080" target="_blank" rel="noopener noreferrer">http://your-node-ip-address:30080<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><table><thead><tr><th style="text-align:center;">é¦–é¡µ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211213184742709-8be9e29d.png" alt="image-20211213184742709" loading="lazy"></td></tr></tbody></table></li><li><p>è¾“å…¥åˆå§‹ç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ç™»å½•</p><ul><li>ç”¨æˆ·åï¼š <code>admin</code></li><li>å¯†ç ï¼š <code>Kuboard123</code></li></ul><table><thead><tr><th style="text-align:center;">é¦–é¡µæ•ˆæœ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20211213184840120-8c3762e0.png" alt="image-20211213184840120" loading="lazy"></td></tr></tbody></table></li></ul><h4 id="_10-4-kubernetesæ“ä½œ" tabindex="-1"><a class="header-anchor" href="#_10-4-kubernetesæ“ä½œ" aria-hidden="true">#</a> 10.4 Kubernetesæ“ä½œ</h4><p>é¦–å…ˆæˆ‘ä»¬è¦äº†è§£Kubernetesåœ¨è¿è¡Œæˆ‘ä»¬çš„èµ„æºæ—¶ï¼Œå…³è”åˆ°äº†å“ªäº›å†…å®¹</p><ul><li><p>èµ„æºçš„æ„å»ºæ–¹å¼ï¼š</p><ul><li>é‡‡ç”¨kubectlçš„å‘½ä»¤æ–¹å¼</li><li>yamlæ–‡ä»¶æ–¹å¼</li></ul></li></ul><h5 id="_10-4-1-namespace" tabindex="-1"><a class="header-anchor" href="#_10-4-1-namespace" aria-hidden="true">#</a> 10.4.1 Namespace</h5><ul><li><p>å‘½åç©ºé—´ï¼šä¸»è¦æ˜¯ä¸ºäº†å¯¹Kubernetesä¸­è¿è¡Œçš„èµ„æºè¿›è¡Œè¿‡éš”ç¦»ï¼Œ ä½†æ˜¯ç½‘ç»œæ˜¯äº’é€šçš„ï¼Œç±»ä¼¼Dockerçš„å®¹å™¨ï¼Œå¯ä»¥å°†å¤šä¸ªèµ„æºé…ç½®åˆ°ä¸€ä¸ªNameSpaceä¸­ã€‚è€ŒNameSpaceå¯ä»¥å¯¹ä¸åŒç¯å¢ƒè¿›è¡Œèµ„æºéš”ç¦»ï¼Œé»˜è®¤æƒ…å†µä¸‹Kubernetesæä¾›äº†defaultå‘½åç©ºé—´ï¼Œåœ¨æ„å»ºèµ„æºæ—¶ï¼Œå¦‚æœä¸æŒ‡å®šèµ„æºï¼Œé»˜è®¤é‡‡ç”¨defaultèµ„æºã€‚ å‘½ä»¤æ–¹å¼ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æŸ¥çœ‹ç°æœ‰çš„å…¨éƒ¨å‘½åç©ºé—´</span>
kubectl get ns

<span class="token comment"># æ„å»ºå‘½åç©ºé—´</span>
kubectl create ns å‘½åç©ºé—´åç§°

<span class="token comment"># åˆ é™¤ç°æœ‰å‘½åç©ºé—´ï¼Œ å¹¶ä¸”ä¼šåˆ é™¤ç©ºé—´ä¸‹çš„å…¨éƒ¨èµ„æº</span>
kubectl delete ns å‘½åç©ºé—´åç§°
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>yamlæ–‡ä»¶æ–¹å¼ï¼šï¼ˆæ„å»ºèµ„æºæ—¶ï¼Œè®¾ç½®å‘½åç©ºé—´ï¼‰</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Namespace
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h5 id="_10-4-2-pod" tabindex="-1"><a class="header-anchor" href="#_10-4-2-pod" aria-hidden="true">#</a> 10.4.2 Pod</h5><ul><li><p>Podï¼šKubernetesè¿è¡Œçš„ä¸€ç»„å®¹å™¨ï¼ŒPodæ˜¯Kubernetesçš„æœ€å°å•ä½ï¼Œä½†æ˜¯å¯¹äºDockerè€Œç„¶ï¼ŒPodä¸­ä¼šè¿è¡Œå¤šä¸ªDockerå®¹å™¨</p><ul><li><p>å‘½ä»¤æ–¹å¼ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æŸ¥çœ‹æ‰€æœ‰è¿è¡Œçš„pod</span>
kubectl get pods <span class="token parameter variable">-A</span>

<span class="token comment"># æŸ¥çœ‹æŒ‡å®šNamespaceä¸‹çš„Pod</span>
kubectl get pod <span class="token punctuation">[</span>-n å‘½åç©ºé—´<span class="token punctuation">]</span>  <span class="token comment">#ï¼ˆé»˜è®¤defaultï¼‰</span>

<span class="token comment"># åˆ›å»ºPod</span>
kubectl run podåç§° <span class="token parameter variable">--image</span><span class="token operator">=</span>é•œåƒåç§°

<span class="token comment"># æŸ¥çœ‹Podè¯¦ç»†ä¿¡æ¯</span>
kubectl describe pod podåç§°

<span class="token comment"># åˆ é™¤pod</span>
kubectl delete pod podåç§° <span class="token punctuation">[</span>-n å‘½åç©ºé—´<span class="token punctuation">]</span>  <span class="token comment">#ï¼ˆé»˜è®¤defaultï¼‰</span>

<span class="token comment"># æŸ¥çœ‹podè¾“å‡ºçš„æ—¥å¿—</span>
kubectl logs <span class="token parameter variable">-f</span> podåç§°

<span class="token comment"># è¿›å»podå®¹å™¨å†…éƒ¨</span>
kubectl <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> podåç§° -- <span class="token function">bash</span>

<span class="token comment"># æŸ¥çœ‹kubernetesç»™Podåˆ†é…çš„ipä¿¡æ¯ï¼Œå¹¶ä¸”é€šè¿‡ipå’Œå®¹å™¨çš„ç«¯å£ï¼Œå¯ä»¥ç›´æ¥è®¿é—®</span>
kubectl get pod <span class="token parameter variable">-owide</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>yamlæ–¹å¼ï¼ˆæ¨èï¼‰</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">run</span><span class="token punctuation">:</span> è¿è¡Œçš„podåç§°
  <span class="token key atrule">name</span><span class="token punctuation">:</span> podåç§°
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> å‘½åç©ºé—´
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> é•œåƒåç§°
    <span class="token key atrule">name</span><span class="token punctuation">:</span> å®¹å™¨åç§°

<span class="token comment"># å¯åŠ¨Podï¼škubectl apply -f yamlæ–‡ä»¶åç§°</span>
<span class="token comment"># åˆ é™¤Podï¼škubectl delete -f yamlæ–‡ä»¶åç§°</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Podä¸­è¿è¡Œå¤šä¸ªå®¹å™¨</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">run</span><span class="token punctuation">:</span> è¿è¡Œçš„podåç§°
  <span class="token key atrule">name</span><span class="token punctuation">:</span> podåç§°
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> å‘½åç©ºé—´
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> é•œåƒåç§°
    <span class="token key atrule">name</span><span class="token punctuation">:</span> å®¹å™¨åç§°
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> é•œåƒåç§°
    <span class="token key atrule">name</span><span class="token punctuation">:</span> å®¹å™¨åç§°
â€¦â€¦â€¦â€¦    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨åå¯ä»¥æŸ¥çœ‹åˆ°</p><table><thead><tr><th style="text-align:center;">Kuboardæ•ˆæœ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20220104203155749-4a74704a.png" alt="image-20220104203155749" loading="lazy"></td></tr></tbody></table></li></ul></li></ul><h5 id="_10-4-3-deployment" tabindex="-1"><a class="header-anchor" href="#_10-4-3-deployment" aria-hidden="true">#</a> 10.4.3 Deployment</h5><p>éƒ¨ç½²æ—¶ï¼Œå¯ä»¥é€šè¿‡Deploymentç®¡ç†å’Œç¼–æ’Pod</p><p>Deploymentéƒ¨ç½²å®ç°</p><ul><li><p>å‘½ä»¤æ–¹å¼</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># åŸºäºDeploymentå¯åŠ¨å®¹å™¨</span>
kubectl create deployment deploymentåç§° <span class="token parameter variable">--image</span><span class="token operator">=</span>é•œåƒåç§°
<span class="token comment"># ç”¨deploymentå¯åŠ¨çš„å®¹å™¨ä¼šåœ¨è¢«åˆ é™¤åè‡ªåŠ¨å†æ¬¡åˆ›å»ºï¼Œè¾¾åˆ°æ•…éšœæ¼‚ç§»çš„æ•ˆæœ</span>
<span class="token comment"># éœ€è¦ä½¿ç”¨deployçš„æ–¹å¼åˆ é™¤deploy</span>
<span class="token comment"># æŸ¥çœ‹ç°åœ¨çš„deployment</span>
kubectl get deployment

<span class="token comment"># åˆ é™¤deployment</span>
kubectl delete deployment deploymentåç§°

<span class="token comment"># åŸºäºDeploymentå¯åŠ¨å®¹å™¨å¹¶è®¾ç½®Podé›†ç¾¤æ•°</span>
kubectl create deployment deploymentåç§° <span class="token parameter variable">--image</span><span class="token operator">=</span>é•œåƒåç§° <span class="token parameter variable">--replicas</span> é›†ç¾¤ä¸ªæ•°
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener noreferrer">é…ç½®æ–‡ä»¶æ–¹å¼<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
       <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
       <span class="token key atrule">ports</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­£å¸¸ä½¿ç”¨kubectlè¿è¡Œyamlå³å¯</p></li></ul><p>å¼¹æ€§ä¼¸ç¼©åŠŸèƒ½</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># åŸºäºscaleå®ç°å¼¹æ€§ä¼¸ç¼©</span>
kubectl scale deploy/Deploymentåç§° <span class="token parameter variable">--replicas</span> é›†ç¾¤ä¸ªæ•°
<span class="token comment"># æˆ–è€…ä¿®æ”¹yamlæ–‡ä»¶</span>
kubectl edit deploy Deploymentåç§°
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">å›¾å½¢åŒ–é¡µé¢ä¿®æ”¹</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20220104210823057-1c742161.png" alt="image-20220104210823057" loading="lazy"></td></tr></tbody></table><p>ç°åº¦å‘å¸ƒ</p><p>Deployå¯ä»¥åœ¨éƒ¨ç½²æ–°ç‰ˆæœ¬æ•°æ®æ—¶ï¼ŒæˆåŠŸå¯åŠ¨ä¸€ä¸ªpodï¼Œæ‰ä¼šä¸‹çº¿ä¸€ä¸ªè€ç‰ˆæœ¬çš„Pod</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl <span class="token builtin class-name">set</span> image deployment/Deploymentåç§° å®¹å™¨å<span class="token operator">=</span>é•œåƒ:ç‰ˆæœ¬
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="_10-4-4-service" tabindex="-1"><a class="header-anchor" href="#_10-4-4-service" aria-hidden="true">#</a> 10.4.4 Service</h5><p>å¯ä»¥å°†å¤šä¸ªPodå¯¹å¤–æš´éœ²ä¸€ä¸ªServiceï¼Œè®©å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡Serviceè®¿é—®åˆ°è¿™ä¸€ç»„Podï¼Œå¹¶ä¸”å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡</p><p>ClusterIPæ–¹å¼ï¼š</p><p>ClusterIPæ˜¯é›†ç¾¤å†…éƒ¨Podä¹‹é—´çš„è®¿é—®æ–¹å¼</p><ul><li><p>å‘½ä»¤å®ç°æ•ˆæœ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># é€šè¿‡ç”Ÿæˆserviceæ˜ å°„ä¸€ä¸ªDeploymentä¸‹çš„æ‰€æœ‰podä¸­çš„æŸä¸€ä¸ªç«¯å£çš„å®¹å™¨</span>
kubectl expose deployment Deploymentåç§° <span class="token parameter variable">--port</span><span class="token operator">=</span>Serviceç«¯å£å· --target-port<span class="token operator">=</span>Podå†…å®¹å™¨ç«¯å£
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹‹åé€šè¿‡<code>kubectl get service</code>æŸ¥çœ‹Serviceæä¾›çš„ipï¼Œå³å¯è®¿é—®</p><table><thead><tr><th style="text-align:center;">kubectl get service</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20220104214659229-096698d9.png" alt="image-20220104214659229" loading="lazy"></td></tr></tbody></table><p>ä¹Ÿå¯ä»¥é€šè¿‡<code>Deploymentåç§°.namespaceåç§°.svc</code>ä½œä¸ºåŸŸåè®¿é—®</p><table><thead><tr><th style="text-align:center;">åœ¨æœåŠ¡å®¹å™¨å†…æ‰§è¡Œ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20220104215030265-638e2d1b.png" alt="image-20220104215030265" loading="lazy"></td></tr></tbody></table></li></ul><p>NodePortæ–¹å¼</p><p>ClusterIPçš„æ–¹å¼åªèƒ½åœ¨Podå†…éƒ¨å®ç°è®¿é—®ï¼Œä½†æ˜¯ä¸€èˆ¬éœ€è¦å¯¹å¤–æš´éœ²ç½‘å…³ï¼Œæ‰€ä»¥éœ€è¦NodePortçš„æ–¹å¼Podå¤–æš´éœ²è®¿é—®</p><ul><li><p>å‘½ä»¤å®ç°æ–¹å¼</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># é€šè¿‡ç”Ÿæˆserviceæ˜ å°„ä¸€ä¸ªDeploymentä¸‹çš„æ‰€æœ‰podä¸­çš„æŸä¸€ä¸ªç«¯å£çš„å®¹å™¨</span>
kubectl expose deployment Deploymentåç§° <span class="token parameter variable">--port</span><span class="token operator">=</span>Serviceç«¯å£å· --target-port<span class="token operator">=</span>Podå†…å®¹å™¨ç«¯å£ <span class="token parameter variable">--type</span><span class="token operator">=</span>NodePort
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">æŸ¥çœ‹Serviceæ•ˆæœ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20220104222750733-1d6fd00f.png" alt="image-20220104222750733" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/image-20220104222819455-3070b4a5.png" alt="image-20220104222819455" loading="lazy"></td></tr></tbody></table></li></ul><p>Serviceä¹Ÿå¯ä»¥é€šè¿‡yamlæ–‡ä»¶å®ç°</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  labels
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">spec</span><span class="token punctuation">:</span>
    <span class="token key atrule">selector</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8888</span>
     <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
     <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡applyå¯åŠ¨å°±ä¹Ÿå¯ä»¥åˆ›å»ºService</p><p>æµ‹è¯•æ•ˆæœ-Deploymentéƒ¨ç½²ï¼Œé€šè¿‡Serviceæš´éœ²</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>service
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>service
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8888</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥æŸ¥çœ‹åˆ°æš´éœ²çš„ä¿¡æ¯</p><table><thead><tr><th style="text-align:center;">Serviceä¿¡æ¯</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20220105205334996-573bd34f.png" alt="image-20220105205334996" loading="lazy"></td></tr></tbody></table><h5 id="_10-4-5-ingress" tabindex="-1"><a class="header-anchor" href="#_10-4-5-ingress" aria-hidden="true">#</a> 10.4.5 Ingress</h5><p>Kubernetesæ¨èå°†Ingressä½œä¸ºæ‰€æœ‰Serviceçš„å…¥å£ï¼Œæä¾›ç»Ÿä¸€çš„å…¥å£ï¼Œé¿å…å¤šä¸ªæœåŠ¡ä¹‹é—´éœ€è¦è®°å½•å¤§é‡çš„IPæˆ–è€…åŸŸåï¼Œæ¯•ç«ŸIPå¯èƒ½æ”¹å˜ï¼ŒæœåŠ¡å¤ªå¤šåŸŸåè®°å½•ä¸æ–¹ä¾¿ã€‚</p><p>Ingressåº•å±‚å…¶å®å°±æ˜¯ä¸€ä¸ªNginxï¼Œ å¯ä»¥åœ¨Kuboardä¸Šç›´æ¥ç‚¹å‡»å®‰è£…</p><table><thead><tr><th style="text-align:center;">Kuboardå®‰è£…</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20220105153343642-00dd37cc.png" alt="image-20220105153343642" loading="lazy"></td></tr><tr><td style="text-align:center;"><strong><img src="/assets/image-20220105153416367-5a1aa334.png" alt="image-20220105153416367" loading="lazy"></strong></td></tr></tbody></table><p>å› ä¸ºå‰¯æœ¬æ•°é»˜è®¤ä¸º1ï¼Œä½†æ˜¯k8sæ•´ä½“é›†ç¾¤å°±2ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥æ˜¾ç¤ºä¸‹é¢å³ä¸ºå®‰è£…æˆåŠŸ</p><table><thead><tr><th style="text-align:center;">å®‰è£…æˆåŠŸ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20220105153502619-264e8f8d.png" alt="image-20220105153502619" loading="lazy"></td></tr></tbody></table><p>å¯ä»¥å°†Ingressæ¥æ”¶åˆ°çš„è¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„Serviceä¸­ã€‚</p><p>æ¨èä½¿ç”¨yamlæ–‡ä»¶æ–¹å¼</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ingressClassName</span><span class="token punctuation">:</span> ingress
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> nginx.mashibing.com
    <span class="token key atrule">http</span><span class="token punctuation">:</span>
      <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
        <span class="token key atrule">pathType</span><span class="token punctuation">:</span> Prefix
        <span class="token key atrule">backend</span><span class="token punctuation">:</span>
          <span class="token key atrule">service</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>service
            <span class="token key atrule">port</span><span class="token punctuation">:</span>
              <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">8888</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">å¯åŠ¨æ—¶é—®é¢˜</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20220105203819715-7c2b695f.png" alt="image-20220105203819715" loading="lazy"></td></tr></tbody></table><p>Kuboardå®‰è£…çš„Ingressæœ‰admissionçš„æ ¡éªŒé…ç½®ï¼Œéœ€è¦å…ˆåˆ é™¤é…ç½®å†å¯åŠ¨</p><p>æ‰¾åˆ°æŒ‡å®šçš„ingressçš„æ ¡éªŒä¿¡æ¯ï¼Œåˆ é™¤å³å¯</p><table><thead><tr><th style="text-align:center;">åˆ é™¤ä¿¡æ¯</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20220105204434044-65d7c471.png" alt="image-20220105204434044" loading="lazy"></td></tr></tbody></table><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æŸ¥çœ‹æ ¡éªŒwebhookçš„é…ç½®</span>
kubectl get <span class="token parameter variable">-A</span> ValidatingWebhookConfiguration

<span class="token comment"># åˆ é™¤æŒ‡å®šçš„æ ¡éªŒ</span>
kubectl delete ValidatingWebhookConfiguration ingress-nginx-admission-my-ingress-controller
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®æœ¬åœ°hostsæ–‡ä»¶</p><table><thead><tr><th style="text-align:center;">é…ç½®hosts</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20220105204921272-37c99ddf.png" alt="image-20220105204921272" loading="lazy"></td></tr></tbody></table><p>è®°ä¸‹æ¥æ—¢å¯ä»¥è®¿é—®åœ¨Serviceä¸­æš´éœ²çš„Nginxä¿¡æ¯</p><table><thead><tr><th style="text-align:center;">æœé€šè¿‡Ingressè®¿é—®</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/image-20220105205407393-bbcc392b.png" alt="image-20220105205407393" loading="lazy"></td></tr></tbody></table><h4 id="_10-5-jenkinsé›†æˆkubernetes" tabindex="-1"><a class="header-anchor" href="#_10-5-jenkinsé›†æˆkubernetes" aria-hidden="true">#</a> 10.5 Jenkinsé›†æˆKubernetes</h4><h5 id="_10-5-1-å‡†å¤‡éƒ¨ç½²çš„ymlæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_10-5-1-å‡†å¤‡éƒ¨ç½²çš„ymlæ–‡ä»¶" aria-hidden="true">#</a> 10.5.1 å‡†å¤‡éƒ¨ç½²çš„ymlæ–‡ä»¶</h5><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> test
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pipeline
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> pipeline
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> pipeline
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> pipeline    
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> pipeline
        <span class="token key atrule">image</span><span class="token punctuation">:</span> 192.168.11.102<span class="token punctuation">:</span>80/repo/pipeline<span class="token punctuation">:</span>v4.0.0
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> test
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> pipeline
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pipeline  
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> pipeline
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8081</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> test
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pipeline
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ingressClassName</span><span class="token punctuation">:</span> ingress
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> mashibing.pipeline.com
    <span class="token key atrule">http</span><span class="token punctuation">:</span>
      <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
        <span class="token key atrule">pathType</span><span class="token punctuation">:</span> Prefix
        <span class="token key atrule">backend</span><span class="token punctuation">:</span>
          <span class="token key atrule">service</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> pipeline
            <span class="token key atrule">port</span><span class="token punctuation">:</span>
              <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">8081</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_10-5-2-harborç§æœé…ç½®" tabindex="-1"><a class="header-anchor" href="#_10-5-2-harborç§æœé…ç½®" aria-hidden="true">#</a> 10.5.2 Harborç§æœé…ç½®</h5><p>åœ¨å°è¯•ç”¨kubernetesçš„ymlæ–‡ä»¶å¯åŠ¨pipelineæœåŠ¡æ—¶ï¼Œä¼šå‡ºç°Kubernetesæ— æ³•æ‹‰å–é•œåƒçš„é—®é¢˜ï¼Œè¿™é‡Œéœ€è¦åœ¨kubernetesæ‰€åœ¨çš„Linuxä¸­é…ç½®HarboræœåŠ¡ä¿¡æ¯ï¼Œå¹¶ä¸”ä¿è¯Kuberneteså¯ä»¥æ‹‰å–Harborä¸Šçš„é•œåƒ</p><ul><li><p>è®¾ç½®Masterå’ŒWorkerçš„ç§æœåœ°å€ä¿¡æ¯</p><table><thead><tr><th style="text-align:center;">è®¾ç½®Harborç§æœåœ°å€</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/1642498962716-11174107.png" alt="1642498962716" loading="lazy"></td></tr></tbody></table></li><li><p>åœ¨Kuboardä¸Šè®¾ç½®ç§æœå¯†æ–‡ä¿¡æ¯</p><table><thead><tr><th style="text-align:center;">è®¾ç½®å¯†æ–‡å¹¶æµ‹è¯•</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/1642498994935-4ba5c8c3.png" alt="1642498994935" loading="lazy"></td></tr></tbody></table><p>æŒ‰ç…§å¤åˆ¶æŒ‡ä»¤çš„ä½ç½®æµ‹è¯•è®¤è¯ï¼Œæ•ˆæœå¦‚ä¸‹</p><table><thead><tr><th style="text-align:center;">æµ‹è¯•æ•ˆæœ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/1642499172789-2ef980e4.png" alt="1642499172789" loading="lazy"></td></tr></tbody></table></li></ul><h5 id="_10-5-3-æµ‹è¯•ä½¿ç”¨æ•ˆæœ" tabindex="-1"><a class="header-anchor" href="#_10-5-3-æµ‹è¯•ä½¿ç”¨æ•ˆæœ" aria-hidden="true">#</a> 10.5.3 æµ‹è¯•ä½¿ç”¨æ•ˆæœ</h5><p>æ‰§è¡Œkubectlå‘½ä»¤ï¼ŒåŸºäºymlå¯åŠ¨æœåŠ¡ï¼Œå¹¶ä¸”åŸºäºéƒ¨ç½²åæœåŠ¡çš„æç¤ºä¿¡æ¯ä»¥åŠIngressçš„è®¾ç½®ï¼Œç›´æ¥è®¿é—®</p><table><thead><tr><th></th></tr></thead><tbody><tr><td><img src="/assets/1642499368121-75276a05.png" alt="1642499368121" loading="lazy"></td></tr><tr><td><img src="/assets/1642499788199-4b819e53.png" alt="1642499788199" loading="lazy"></td></tr></tbody></table><h5 id="_10-5-3-jenkinsè¿œç¨‹è°ƒç”¨" tabindex="-1"><a class="header-anchor" href="#_10-5-3-jenkinsè¿œç¨‹è°ƒç”¨" aria-hidden="true">#</a> 10.5.3 Jenkinsè¿œç¨‹è°ƒç”¨</h5><ul><li><p>å°†pipeline.ymlé…ç½®åˆ°Gitlabä¸­</p><table><thead><tr><th style="text-align:center;">é…ç½®ymlæ–‡ä»¶</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/1642499885324-8feec779.png" alt="1642499885324" loading="lazy"></td></tr></tbody></table></li><li><p>é…ç½®Jenkinsçš„ç›®æ ‡æœåŠ¡å™¨ï¼Œå¯ä»¥å°†ymlæ–‡ä»¶ä¼ è¾“åˆ°K8sçš„Masterä¸Š</p><table><thead><tr><th style="text-align:center;">è®¾ç½®ç›®æ ‡æœåŠ¡å™¨</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/1642499992148-40f600de.png" alt="1642499992148" loading="lazy"></td></tr></tbody></table></li><li><p>ä¿®æ”¹Jenkinsfileï¼Œé‡æ–°è®¾ç½®æµæ°´çº¿ä»»åŠ¡è„šæœ¬ï¼Œå¹¶æµ‹è¯•æ•ˆæœ</p><table><thead><tr><th style="text-align:center;">ä¼ é€’ymlæ–‡ä»¶è„šæœ¬</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/1642500061153-1735d55a.png" alt="1642500061153" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/1642500102996-f9909f9c.png" alt="1642500102996" loading="lazy"></td></tr></tbody></table></li><li><p>è®¾ç½®Jenkinsæ— å¯†ç ç™»å½•k8s-master</p><p>å°†Jenkinsä¸­å…¬é’¥ä¿¡æ¯å¤åˆ¶åˆ°k8s-masterçš„~/.ssh/authorized_keyszä¸­ï¼Œä¿è¯è¿œç¨‹è¿æ¥æ— å¯†ç </p><table><thead><tr><th style="text-align:center;">è¿œç¨‹æ‰§è¡Œå‘½ä»¤æ— éœ€å¯†ç </th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/1642500239406-4411351a.png" alt="1642500239406" loading="lazy"></td></tr></tbody></table></li><li><p>è®¾ç½®æ‰§è¡Œkubectlçš„è„šæœ¬åˆ°Jenkinsfile</p><table><thead><tr><th style="text-align:center;">è®¾ç½®Jenkinsfile</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/1642500378788-f81cff44.png" alt="1642500378788" loading="lazy"></td></tr></tbody></table></li><li><p>æ‰§è¡ŒæŸ¥çœ‹æ•ˆæœ</p><table><thead><tr><th style="text-align:center;">æ‰§è¡Œæµæ°´çº¿</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/1642500413802-a718cfbd.png" alt="1642500413802" loading="lazy"></td></tr></tbody></table><p>å¯ä»¥æŸ¥çœ‹åˆ°ymlæ–‡ä»¶æ˜¯ç”±å˜åŒ–çš„ï¼Œ è¿™æ ·k8så°±ä¼šé‡æ–°åŠ è½½</p></li><li><p>æŸ¥çœ‹æ•ˆæœ</p><table><thead><tr><th style="text-align:center;">æ•ˆæœ</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/1642500474036-2da4e790.png" alt="1642500474036" loading="lazy"></td></tr></tbody></table></li></ul><p><a href="">Psï¼šè¿™ç§æ–¹å¼æ›´é€‚åº”ä¸CDæ“ä½œï¼Œå°†é¡¹ç›®å°†åŸºäºæŸä¸ªç‰ˆæœ¬éƒ¨ç½²åˆ°æŒ‡å®šçš„ç›®æ ‡æœåŠ¡å™¨</a></p><h4 id="_10-6-åŸºäºgitlabçš„webhooks" tabindex="-1"><a class="header-anchor" href="#_10-6-åŸºäºgitlabçš„webhooks" aria-hidden="true">#</a> 10.6 åŸºäºGitLabçš„WebHooks</h4><p>è¿™é‡Œè¦å®ç°è‡ªåŠ¨åŒ–çš„ä¸€ä¸ªCIæ“ä½œï¼Œä¹Ÿå°±æ˜¯å¼€å‘äººå‘˜Pushä»£ç åˆ°Gitä»“åº“åï¼ŒJenkinsä¼šè‡ªåŠ¨çš„æ„å»ºé¡¹ç›®ï¼Œå°†æœ€æ–°çš„æäº¤ç‚¹ä»£ç æ„å»ºå¹¶è¿›è¡Œæ‰“åŒ…éƒ¨ç½²ï¼Œè¿™é‡ŒåŒºåˆ«å»ä¸Šè¿°çš„CDæ“ä½œï¼ŒCDæ“ä½œéœ€è¦åŸºäºæŸä¸ªç‰ˆæœ¬è¿›è¡Œéƒ¨ç½²ï¼Œè€Œè¿™é‡Œæ¯æ¬¡éƒ½æ˜¯å°†æœ€æ–°çš„æäº¤ç‚¹é›†æˆåˆ°ä¸»å¹²ä¸Šå¹¶æµ‹è¯•ã€‚</p><h5 id="_10-6-1-webhooksé€šçŸ¥" tabindex="-1"><a class="header-anchor" href="#_10-6-1-webhooksé€šçŸ¥" aria-hidden="true">#</a> 10.6.1 WebHooksé€šçŸ¥</h5><p>å¼€å¯Jenkinsçš„è‡ªåŠ¨æ„å»º</p><table><thead><tr><th style="text-align:center;">æ„å»ºè§¦å‘å™¨</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/1642500817131-c9bbddb4.png" alt="1642500817131" loading="lazy"></td></tr></tbody></table><p>è®¾ç½®Gitlabçš„Webhooks</p><table><thead><tr><th style="text-align:center;">è®¾ç½®Gitlabçš„Webhooks</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/1642500933316-0fa77a09.png" alt="1642500933316" loading="lazy"></td></tr></tbody></table><p>éœ€è¦å…³é—­Jenkinsçš„Gitlabè®¤è¯</p><table><thead><tr><th style="text-align:center;">å…³é—­Jenkinsçš„Gitlabè®¤è¯</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/1642501016474-b9e70b5c.png" alt="1642501016474" loading="lazy"></td></tr></tbody></table><p>å†æ¬¡æµ‹è¯•Gitlab</p><table><thead><tr><th style="text-align:center;">å†æ¬¡æµ‹è¯•</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/1642501065243-86c49932.png" alt="1642501065243" loading="lazy"></td></tr></tbody></table><h5 id="_10-6-2-ä¿®æ”¹é…ç½®" tabindex="-1"><a class="header-anchor" href="#_10-6-2-ä¿®æ”¹é…ç½®" aria-hidden="true">#</a> 10.6.2 ä¿®æ”¹é…ç½®</h5><p>ä¿®æ”¹Jenkinsfileå®ç°åŸºäºæœ€æ–°æäº¤ç‚¹å®ç°æŒç»­é›†æˆæ•ˆæœï¼Œå°†ä¹‹å‰å¼•ç”¨${tag}çš„å…¨éƒ¨å»æ‰</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token comment">// æ‰€æœ‰çš„è„šæœ¬å‘½ä»¤éƒ½æ”¾åœ¨pipelineä¸­</span>
pipeline<span class="token punctuation">{</span>
	<span class="token comment">// æŒ‡å®šä»»åŠ¡å†å“ªä¸ªé›†ç¾¤èŠ‚ç‚¹ä¸­æ‰§è¡Œ</span>
	agent any

	<span class="token comment">// å£°æ˜å…¨å±€å˜é‡ï¼Œæ–¹ä¾¿åé¢ä½¿ç”¨</span>
	environment <span class="token punctuation">{</span>
		harborUser = &#39;admin&#39;
        harborPasswd = &#39;Harbor12345&#39;
        harborAddress = &#39;<span class="token number">192.168</span>.<span class="token number">11.102</span><span class="token operator">:</span><span class="token number">80</span>&#39;
        harborRepo = &#39;repo&#39;
	<span class="token punctuation">}</span>

    stages <span class="token punctuation">{</span>
        stage(&#39;æ‹‰å–gitä»“åº“ä»£ç &#39;) <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                checkout(<span class="token punctuation">[</span>$class<span class="token operator">:</span> &#39;GitSCM&#39;<span class="token punctuation">,</span> branches<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>name<span class="token operator">:</span> &#39;*/master&#39;<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> userRemoteConfigs<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>url<span class="token operator">:</span> &#39;http<span class="token operator">:</span><span class="token comment">//192.168.11.101:8929/root/mytest.git&#39;]]])</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        stage(&#39;é€šè¿‡mavenæ„å»ºé¡¹ç›®&#39;) <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                sh &#39;/var/jenkins_home/maven/bin/mvn clean package -DskipTests&#39;
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        stage(&#39;é€šè¿‡SonarQubeåšä»£ç è´¨é‡æ£€æµ‹&#39;) <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                sh &#39;/var/jenkins_home/sonar-scanner/bin/sonar-scanner -Dsonar.source=./ -Dsonar.projectname=$<span class="token punctuation">{</span>JOB_NAME<span class="token punctuation">}</span> -Dsonar.projectKey=$<span class="token punctuation">{</span>JOB_NAME<span class="token punctuation">}</span> -Dsonar.java.binaries=./target/ -Dsonar.login=40306ae8ea69a4792df2ceb4d9d25fe8a6ab1701&#39;
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        stage(&#39;é€šè¿‡Dockeråˆ¶ä½œè‡ªå®šä¹‰é•œåƒ&#39;) <span class="token punctuation">{</span>
            steps <span class="token punctuation">{</span>
                sh &#39;&#39;&#39;mv ./target<span class="token comment">/*.jar ./docker/
                docker build -t ${JOB_NAME}:latest ./docker/&#39;&#39;&#39;
            }
        }
        stage(&#39;å°†è‡ªå®šä¹‰é•œåƒæ¨é€åˆ°Harbor&#39;) {
            steps {
                sh &#39;&#39;&#39;docker login -u ${harborUser} -p ${harborPasswd} ${harborAddress}
                docker tag ${JOB_NAME}:latest  ${harborAddress}/${harborRepo}/${JOB_NAME}:latest
                docker push ${harborAddress}/${harborRepo}/${JOB_NAME}:latest &#39;&#39;&#39;
            }
        }
        stage(&#39;å°†ymlæ–‡ä»¶ä¼ åˆ°k8s-masterä¸Š&#39;) {
            steps {
                sshPublisher(publishers: [sshPublisherDesc(configName: &#39;k8s&#39;, transfers: [sshTransfer(cleanRemote: false, excludes: &#39;&#39;, execCommand: &#39;&#39;, execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: &#39;[, ]+&#39;, remoteDirectory: &#39;&#39;, remoteDirectorySDF: false, removePrefix: &#39;&#39;, sourceFiles: &#39;pipeline.yml&#39;)], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])
            }
        }
        stage(&#39;è¿œç¨‹æ‰§è¡Œk8s-masterçš„kubectlå‘½ä»¤&#39;) {
            steps {
               sh &#39;&#39;&#39;ssh root@192.168.11.201 kubectl apply -f /usr/local/k8s/pipeline.yml
                ssh root@192.168.11.201 kubectl rollout restart deployment pipeline -n test&#39;&#39;&#39;
            }
        }

    }
    post {
        success {
            dingtalk(
                robot: &#39;Jenkins-DingDing&#39;,
                type: &#39;MARKDOWN&#39;,
                title: &quot;success: ${JOB_NAME}&quot;,
                text: [&quot;- æˆåŠŸæ„å»ºï¼š${JOB_NAME}! \n- ç‰ˆæœ¬ï¼šlatest \n- æŒç»­æ—¶é—´ï¼š${currentBuild.durationString}&quot; ]
            )
        }
        failure {
            dingtalk(
                robot: &#39;Jenkins-DingDing&#39;,
                type: &#39;MARKDOWN&#39;,
                title: &quot;success: ${JOB_NAME}&quot;,
                text: [&quot;- æ„å»ºå¤±è´¥ï¼š${JOB_NAME}! \n- ç‰ˆæœ¬ï¼šlatest \n- æŒç»­æ—¶é—´ï¼š${currentBuild.durationString}&quot; ]
            )
        }
    }
}

</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿®æ”¹pipeline.ymlï¼Œæ›´æ”¹é•œåƒç‰ˆæœ¬</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> test
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pipeline
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> pipeline
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> pipeline
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> pipeline    
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> pipeline
        <span class="token key atrule">image</span><span class="token punctuation">:</span> 192.168.11.102<span class="token punctuation">:</span>80/repo/pipeline<span class="token punctuation">:</span>latest   <span class="token comment"># è¿™é‡Œ</span>
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
<span class="token comment"># çœç•¥å…¶ä»–å†…å®¹â€¦â€¦â€¦â€¦</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_10-6-3-æ»šåŠ¨æ›´æ–°" tabindex="-1"><a class="header-anchor" href="#_10-6-3-æ»šåŠ¨æ›´æ–°" aria-hidden="true">#</a> 10.6.3 æ»šåŠ¨æ›´æ–°</h5><p>å› ä¸ºpipelineæ²¡æœ‰æ”¹å˜æ—¶ï¼Œæ¯æ¬¡ä¸ä¼šé‡æ–°åŠ è½½ï¼Œè¿™æ ·ä¼šå¯¼è‡´Podä¸­çš„å®¹å™¨ä¸ä¼šåŠ¨æ€æ›´æ–°ï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨kubectlçš„rollout restartå‘½ä»¤æ»šåŠ¨æ›´æ–°</p><table><thead><tr><th style="text-align:center;">è®¾ç½®Jenkinsfle</th></tr></thead><tbody><tr><td style="text-align:center;"><img src="/assets/1642501521065-c6044dce.png" alt="1642501521065" loading="lazy"></td></tr><tr><td style="text-align:center;"><img src="/assets/1642501549176-3b6176b9.png" alt="1642501549176" loading="lazy"></td></tr></tbody></table></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/heplex/ezfri-docs/edit/main/src/kb/operation/devops/devops.md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: zcilive@gmail.com">chun.zheng</span><!--]--><!--]--></div></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"><a href="https://beian.miit.gov.cn/" target="_blank">æµ™ICPå¤‡2021004971å·</a></div><div class="copyright">Copyright Â© 2023 è½»æ¾æ˜ŸæœŸäº”</div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-52ae57e5.js" defer></script>
  </body>
</html>
