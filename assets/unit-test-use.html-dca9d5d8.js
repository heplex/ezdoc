import{_ as p,W as e,X as o,$ as n,a0 as a,Z as t,a1 as c,C as l}from"./framework-b609eea8.js";const i={},u=c(`<h1 id="å•å…ƒæµ‹è¯•ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å•å…ƒæµ‹è¯•ä½¿ç”¨" aria-hidden="true">#</a> å•å…ƒæµ‹è¯•ä½¿ç”¨</h1><h2 id="æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#æ¦‚è¿°" aria-hidden="true">#</a> æ¦‚è¿°</h2><p>åœ¨ Spring Boot é¡¹ç›®ä¸­ï¼Œæœ‰ä¸€ä¸ª spring-boot-test æ¨¡å—ï¼Œå°è£…äº† Spring Boot å¯¹ Test çš„å°è£…ã€‚ä¾‹å¦‚è¯´ï¼Œæä¾›äº† @MockBean æ³¨è§£ï¼Œåˆ›å»ºä¸€ä¸ªä½¿ç”¨ Mockito è¿›è¡Œ Mock çš„ Beanï¼Œæ³¨å…¥åˆ°ä¾èµ–è¯¥ Bean çš„å…¶å®ƒ Bean ä¸­ã€‚</p><p>å¦å¤–ï¼ŒSpring é¡¹ç›®ä¸­ï¼Œä¹Ÿæœ‰ä¸€ä¸ª spring-test æ¨¡å—ï¼Œå°è£…äº† Spring å¯¹ Test çš„å°è£…ã€‚ä¾‹å¦‚è¯´ï¼Œæä¾›äº† MockMvc ç±»ï¼Œå…è®¸æˆ‘ä»¬æ–¹ä¾¿çš„å¯¹ SpringMVC è¿›è¡Œ Mockã€‚</p><p>æœ¬æ–‡ä¸­æˆ‘ä»¬å¹¶ä¸ä¼šç‰¹åˆ«æ·±å…¥çš„è®²å•å…ƒæµ‹è¯•çš„ä½¿ç”¨ï¼Œè€Œæ˜¯ä¾§é‡åœ¨ Spring Boot ä¸­ï¼Œå¦‚ä½•ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œé’ˆå¯¹æ¯ä¸€ä¸ªå±‚çº§ã€‚ä¾‹å¦‚è¯´ï¼ŒController å±‚ã€Service å±‚ã€Dao å±‚ã€‚</p><h2 id="å¿«é€Ÿå…¥é—¨" tabindex="-1"><a class="header-anchor" href="#å¿«é€Ÿå…¥é—¨" aria-hidden="true">#</a> å¿«é€Ÿå…¥é—¨</h2><p>æœ¬å°èŠ‚ï¼Œæˆ‘ä»¬å…ˆæ¥æ­å»ºä¸€ä¸ªæä¾›è¯»å–æŒ‡å®šç”¨æˆ·ä¿¡æ¯çš„ HTTP API çš„ Spring Boot åº”ç”¨ï¼Œç„¶åç¼–å†™è¯¥ HTTP API æ¶‰åŠåˆ°çš„ Controllerã€Serviceã€Dao çš„å•å…ƒæµ‹è¯•ã€‚</p><h3 id="å¼•å…¥ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#å¼•å…¥ä¾èµ–" aria-hidden="true">#</a> å¼•å…¥ä¾èµ–</h3><p>åœ¨<code>pom.xml</code>æ–‡ä»¶ä¸­ï¼Œå¼•å…¥ç›¸å…³ä¾èµ–ã€‚</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span> <span class="token comment">&lt;!-- lookup parent from repository --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lab-42-demo01<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- å®ç°å¯¹ Spring MVC çš„è‡ªåŠ¨åŒ–é…ç½® --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!-- å®ç°å¯¹æ•°æ®åº“è¿æ¥æ± çš„è‡ªåŠ¨åŒ–é…ç½® --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- æœ¬ç¤ºä¾‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ MySQL --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.46<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!-- æ–¹ä¾¿ç­‰ä¼šå†™å•å…ƒæµ‹è¯• --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.h2database<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- å•å…ƒæµ‹è¯•ï¼Œæˆ‘ä»¬é‡‡ç”¨ H2 ä½œä¸ºæ•°æ®åº“ --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>h2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¼•å…¥ <code>spring-boot-starter-test</code> ä¾èµ–ï¼Œå®ç°å¯¹ Spring Boot Test çš„è‡ªåŠ¨åŒ–é…ç½®ã€‚åœ¨å…¶ä¸­ï¼Œå®ƒä¼šå¼•å…¥ JUnitã€Mockitoã€Hamcrest ç­‰ç­‰æ¡†æ¶ï¼Œç”¨äºç¼–å†™æµ‹è¯•ã€‚</li><li>å¼•å…¥ <code>com.h2database.h2</code> ä¾èµ–ï¼Œå› ä¸ºæ™šç‚¹ç¼–å†™ Dao çš„å•å…ƒæµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬æ˜¾ç„¶ä¸èƒ½ä½¿ç”¨ MySQLï¼Œè¿™æ ·ä¼šå­˜åœ¨å¯¹å¤–éƒ¨ç¯å¢ƒçš„ä¾èµ–ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨ H2 å†…å­˜æ•°æ®åº“ã€‚</li></ul><h3 id="é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#é…ç½®æ–‡ä»¶" aria-hidden="true">#</a> é…ç½®æ–‡ä»¶</h3><p>åœ¨ <code>main/resources/</code> ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬åˆ›å»ºåº”ç”¨çš„é…ç½®æ–‡ä»¶ <code>application.yml</code>ã€‚é…ç½®å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment"># datasource æ•°æ®æºé…ç½®å†…å®¹</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/lab<span class="token punctuation">-</span>39<span class="token punctuation">-</span>mysql<span class="token punctuation">?</span>useSSL=false<span class="token important">&amp;useUnicode=true&amp;characterEncoding=UTF-</span><span class="token number">8</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œå®é™…æˆ‘ä»¬å¹¶ä¸ä¼šä½¿ç”¨åˆ°è¯¥é…ç½®æ–‡ä»¶ï¼Œä»…ä»…å ä¸ªâ€œå‘â€ã€‚ç¨åæˆ‘ä»¬ä¼šä½¿ç”¨æµ‹è¯•ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ï¼Œâ€œè¦†ç›–â€å®ƒã€‚ åœ¨ test/resources/ ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬åˆ›å»ºæµ‹è¯•çš„é…ç½®æ–‡ä»¶ã€‚é…ç½®å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment"># datasource æ•°æ®æºé…ç½®å†…å®¹</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>h2<span class="token punctuation">:</span>mem<span class="token punctuation">:</span>testdb
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> org.h2.Driver
    <span class="token key atrule">username</span><span class="token punctuation">:</span> sa
    <span class="token key atrule">password</span><span class="token punctuation">:</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ <code>spring.datasource.url</code> é…ç½®é¡¹ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº† H2 å†…å­˜æ•°æ®åº“ã€‚é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œæˆ‘ä»¬åœ¨å•å…ƒæµ‹è¯•ä¸­ï¼Œä½¿ç”¨ H2 å†…å­˜æ•°æ®åº“ï¼Œè€Œä¸æ˜¯ MySQL æ•°æ®åº“ã€‚</p><h3 id="http-api" tabindex="-1"><a class="header-anchor" href="#http-api" aria-hidden="true">#</a> HTTP API</h3><p>è¯»å–ä¹‹åœ°å½“ç”¨æˆ·ä¿¡æ¯ HTTP APIï¼Œä¸€å…±æ¶‰åŠå¦‚ä¸‹å››ä¸ªç±»ï¼š</p><ul><li>controller/UserController</li><li>service/UserService</li><li>dao/UserDao</li><li>dataobject/UserDO</li></ul><p>ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// UserController.java</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * è·å¾—æŒ‡å®šç”¨æˆ·ç¼–å·çš„ç”¨æˆ·
     *
     * <span class="token keyword">@param</span> <span class="token parameter">id</span> ç”¨æˆ·ç¼–å·
     * <span class="token keyword">@return</span> ç”¨æˆ·
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/get&quot;</span><span class="token punctuation">)</span> <span class="token comment">// URL ä¿®æ”¹æˆ /get</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDO</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æŸ¥è¯¢å¹¶è¿”å›ç”¨æˆ·</span>
        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment">// UserService.java</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> userDao<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">UserDO</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> userDao<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment">// UserDao.java</span>
<span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDao</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> template<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">UserDO</span> <span class="token function">selectById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> template<span class="token punctuation">.</span><span class="token function">queryForObject</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT id, username, password FROM t_user WHERE id = ?&quot;</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">BeanPropertyRowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">UserDO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// ç»“æœè½¬æ¢æˆå¯¹åº”çš„å¯¹è±¡</span>
                id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment">// UserDO.java</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDO</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * ç”¨æˆ·ç¼–å·
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * è´¦å·
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * å¯†ç ï¼ˆæ˜æ–‡ï¼‰
     *
     * psï¼šç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œåƒä¸‡ä¸è¦æ˜æ–‡å™¢
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
    
    <span class="token comment">// ... çœç•¥ set/get æ–¹æ³•</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æŒ‰ç…§ Controller =&gt; Service =&gt; Dao è°ƒç”¨ï¼Œæ¯”è¾ƒç®€å•ã€‚</li></ul><h3 id="å•å…ƒæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#å•å…ƒæµ‹è¯•" aria-hidden="true">#</a> å•å…ƒæµ‹è¯•</h3><p>ä¸‹é¢ï¼Œæˆ‘ä»¬ç»™HTTP APIæ¶‰åŠåˆ°çš„ Controllerã€Serviceã€Dao ç¼–å†™å•å…ƒæµ‹è¯•ã€‚</p><h4 id="controller-å•å…ƒæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#controller-å•å…ƒæµ‹è¯•" aria-hidden="true">#</a> Controller å•å…ƒæµ‹è¯•</h4><p>åœ¨ <code>test/java</code> ç›®å½•ä¸‹ï¼Œåˆ›å»º <code>com.ezfri.springboot.testdemo.controller</code> åŒ…ï¼Œç„¶ååˆ›å»º UserController å¯¹åº”çš„ UserControllerTest å•å…ƒæµ‹è¯•ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// &lt;1.1&gt;</span>
<span class="token annotation punctuation">@SpringBootTest</span> <span class="token comment">// &lt;1.2&gt;</span>
<span class="token annotation punctuation">@AutoConfigureMockMvc</span> <span class="token comment">// &lt;1.3&gt;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserControllerTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MockMvc</span> mvc<span class="token punctuation">;</span> <span class="token comment">// &lt;1.3&gt;</span>

    <span class="token annotation punctuation">@MockBean</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span> <span class="token comment">// &lt;1.4&gt;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// &lt;2.1&gt; Mock UserService çš„ get æ–¹æ³•</span>
        <span class="token class-name">Mockito</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>userService<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">UserDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;username:1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password:1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &lt;2.2&gt; æŸ¥è¯¢ç”¨æˆ·</span>
        <span class="token class-name">ResultActions</span> resultActions <span class="token operator">=</span> mvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token class-name">MockMvcRequestBuilders</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/user/get?id=1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &lt;2.3&gt; æ ¡éªŒå“åº”çŠ¶æ€ç </span>
        resultActions<span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å“åº”çŠ¶æ€ç  200</span>

        <span class="token comment">// &lt;2.4.1&gt; æ ¡éªŒå“åº”å†…å®¹æ–¹å¼ä¸€ï¼šç›´æ¥å…¨éƒ¨åŒ¹é…</span>
        resultActions<span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string">&quot;{\\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;    \\&quot;id\\&quot;: 1,\\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;    \\&quot;username\\&quot;: \\&quot;username:1\\&quot;,\\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;    \\&quot;password\\&quot;: \\&quot;password:1\\&quot;\\n&quot;</span> <span class="token operator">+</span>
                <span class="token string">&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å“åº”ç»“æœ</span>

        <span class="token comment">// &lt;2.4.2&gt; æ ¡éªŒå“åº”å†…å®¹æ–¹å¼äºŒï¼šé€ä¸ªå­—æ®µåŒ¹é…</span>
        resultActions<span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token class-name">IsEqual</span><span class="token punctuation">.</span><span class="token function">equalTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultActions<span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> <span class="token class-name">IsEqual</span><span class="token punctuation">.</span><span class="token function">equalTo</span><span class="token punctuation">(</span><span class="token string">&quot;username:1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultActions<span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token class-name">IsEqual</span><span class="token punctuation">.</span><span class="token function">equalTo</span><span class="token punctuation">(</span><span class="token string">&quot;password:1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>æˆ‘ä»¬å…ˆæ¥ä¸€èµ·çœ‹çœ‹é…ç½®ç›¸å…³</strong></p></blockquote><ul><li><p><code>&lt;1.1&gt;</code> å¤„ï¼Œ@RunWith æ³¨è§£ï¼Œæ˜¯ JUnit æ‰€æä¾›ã€‚é€šè¿‡æ·»åŠ  @RunWith(SpringRunner.class)ï¼Œå‘Šè¯‰ JUnit ä½¿ç”¨ SpringRunner ä½œä¸º Junit Runnerï¼Œä»è€Œåœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œå¯ä»¥åˆ›å»º Spring å®¹å™¨ã€‚</p></li><li><p><code>&lt;1.2&gt;</code> å¤„ï¼Œ@SpringBootTest æ³¨è§£ï¼Œè¡¨ç¤ºåŸºäº Spring Boot çš„æµ‹è¯•ç±»ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ Spring Boot Test æä¾›çš„åŠŸèƒ½ã€‚</p></li><li><p><code>&lt;1.3&gt;</code> å¤„ï¼Œ@AutoConfigureMockMvc æ³¨è§£ï¼Œç”¨äºè‡ªåŠ¨åŒ–é…ç½®æˆ‘ä»¬ç¨åæ³¨å…¥çš„ MockMvc Bean å¯¹è±¡ mvc ã€‚åœ¨åç»­çš„æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°éƒ½æ˜¯é€šè¿‡ mvc è°ƒç”¨åç«¯ API æ¥å£ã€‚</p></li><li><p><code>&lt;1.4&gt;</code> å¤„ï¼Œåœ¨ç±»å‹ä¸º UserService çš„ userService å±æ€§ä¸Šï¼Œæ·»åŠ äº† @MockBean æ³¨è§£ï¼Œåˆ›å»ºäº†ä¸€ä¸ªåŸºäº Mockito çš„ UserService Mock ä»£ç†å¯¹è±¡ Beanã€‚åŒæ—¶ï¼Œè¯¥ Bean ä¼šæ³¨å…¥åˆ°ä¾èµ– UserService çš„ UserController ä¸­ã€‚è¿™æ ·ï¼Œç¨åæˆ‘ä»¬å°±å¯ä»¥ mock userService çš„æ–¹æ³•ï¼Œå®ç°å¯¹ UserController çš„å•å…ƒæµ‹è¯•ã€‚</p></li></ul><blockquote><p>æˆ‘ä»¬å†æ¥ä¸€èµ·çœ‹çœ‹ <code>#testGet()</code> æ–¹æ³•ï¼Œé’ˆå¯¹ <code>/user/get</code> æ¥å£çš„å•å…ƒæµ‹è¯•ã€‚</p></blockquote><ul><li><p><code>&lt;2.1&gt;</code> å¤„ï¼Œå¯¹ <code>userService</code> çš„ <code>#get(Integer id)</code> æ–¹æ³•è¿›è¡Œ mockï¼Œå½“ä¼ å…¥ id=1 æ—¶ï¼Œè¿”å›æŒ‡å®šçš„ UserDO ä¿¡æ¯ã€‚</p></li><li><p><code>&lt;2.2&gt;</code> å¤„ï¼Œä½¿ç”¨ <code>mvc</code> è¿›è¡Œäº†ä¸€æ¬¡ <code>GET /user/get</code> è°ƒç”¨ï¼ŒæŸ¥è¯¢ <code>id=1</code> çš„ç”¨æˆ·ã€‚ğŸ˜ˆ è¿™é‡Œæˆ‘ä»¬å¹¶æœªå¯åŠ¨ä¸€ä¸ªçœŸå® çš„ Web å®¹å™¨ï¼Œè€Œæ˜¯é€šè¿‡ MockMvc æ¨¡æ‹Ÿçš„æ–¹å¼ã€‚</p></li></ul><p>è°ƒç”¨å®Œæˆåï¼Œä¼šè¿”å› <strong>ResultActions</strong> ç»“æœå¯¹è±¡ã€‚é€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œæ‰“å°è¯·æ±‚ç»“æœã€æ–­è¨€è¯·æ±‚ç»“æœç­‰ç­‰æ“ä½œã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬åœ¨ <code>&lt;2.3&gt;</code>ã€<code>&lt;2.4&gt;</code> éƒ¨åˆ†ï¼Œå°±ä¼šå¯¹ç»“æœè¿›è¡Œæ–­è¨€ã€‚</p><ul><li><code>&lt;2.3&gt;</code> å¤„ï¼Œæ ¡éªŒå“åº”çŠ¶æ€ç ã€‚</li><li><code>&lt;2.4.1&gt;</code> å¤„ï¼Œæ ¡éªŒå“åº”å†…å®¹æ–¹å¼ä¸€ï¼šç›´æ¥å…¨éƒ¨åŒ¹é…ã€‚</li><li><code>&lt;2.4.2&gt;</code> å¤„ï¼Œæ ¡éªŒå“åº”å†…å®¹æ–¹å¼äºŒï¼šé€ä¸ªå­—æ®µåŒ¹é…ã€‚</li></ul><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå› ä¸º Controller ä¸»è¦æ˜¯å¯¹ Service çš„ç®€å•è°ƒç”¨ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šå¯¹å…¶è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚</p><h4 id="service-å•å…ƒæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#service-å•å…ƒæµ‹è¯•" aria-hidden="true">#</a> Service å•å…ƒæµ‹è¯•</h4><p>åœ¨ <code>test/java</code> ç›®å½•ä¸‹ï¼Œåˆ›å»º <code>com.ezfri.springboot.testdemo.service</code> åŒ…ï¼Œç„¶ååˆ›å»º UserService å¯¹åº”çš„ UserServiceTest å•å…ƒæµ‹è¯•ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@MockBean</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> userDao<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Mock UserDao çš„ selectById æ–¹æ³•</span>
        <span class="token class-name">Mockito</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>userDao<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">UserDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;username:1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;password:1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æŸ¥è¯¢ç”¨æˆ·</span>
        <span class="token class-name">UserDO</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ ¡éªŒç»“æœ</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;ç¼–å·ä¸åŒ¹é…&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;ç”¨æˆ·åä¸åŒ¹é…&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;username:1&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;å¯†ç ä¸åŒ¹é…&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password:1&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ä½“å’Œ<code>Controller å•å…ƒæµ‹è¯•</code>å·®ä¸å¤šï¼Œè¿™é‡Œè¯´è¯´å·®å¼‚ç‚¹</p><ul><li>æ— éœ€ä½¿ç”¨ @AutoConfigureMockMvc æ³¨è§£ï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨ MockMvcã€‚</li><li>å¯¹ UserDao è¿›è¡Œ mockã€‚</li><li>ä½¿ç”¨ JUnit æä¾›çš„ Assert ç±»ï¼Œè¿›è¡Œç»“æœçš„æ–­è¨€ã€‚</li></ul><p>Service çš„å•å…ƒæµ‹è¯•ï¼Œæ˜¯æ¯”è¾ƒæ¨èå»å†™çš„ã€‚ä¸è¿‡è€ƒè™‘åˆ°æ—¥å¸¸å¼€å‘éƒ½æ˜¯æ¯”è¾ƒå¿™çš„ï¼Œä¸ä¸€å®šæœ‰æ—¶é—´å»ç¼–å†™å•å…ƒæµ‹è¯•ã€‚è¿™é‡Œå»ºè®®ï¼š</p><ol><li>å¯¹äºé€»è¾‘å¤æ‚çš„ Service æ–¹æ³•ï¼Œä¸€å®šè¦å»å†™å•å…ƒæµ‹è¯•ï¼Œè¿™æ ·è™½ç„¶å¤šè´¹ç‚¹æ—¶é—´ï¼Œä½†æ˜¯ç»å¯¹èƒ½å¤Ÿä¿è¯äº¤ä»˜è´¨é‡ã€‚åŒæ—¶æˆ‘ä»¬ä¼šå‘ç°ï¼Œä¸ºäº†æ›´å¥½çš„è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œæˆ‘ä»¬ä¼šæŠŠä¸€ä¸ªå¤§çš„æ–¹æ³•ï¼Œæ‹†åˆ†æˆè‹¥å¹²å°çš„æ–¹æ³•ã€‚</li><li>åœ¨æµ‹è¯•é˜¶æ®µçš„æ—¶å€™ï¼Œä¸€èˆ¬å·¥ä½œé‡ä¼šç¨å¾®å°ä¸€ç‚¹ã€‚æ­¤æ—¶ï¼Œå¯ä»¥è€ƒè™‘è¡¥é½ä¸€äº›å•å…ƒæµ‹è¯•ã€‚è™½ç„¶è¯´ï¼Œéƒ½å·²ç»å¼€å‘å®Œæˆï¼Œè‡ªå·±ä¹Ÿæµ‹è¯•è¿‡ä¸€è½®äº†ï¼Œä½†æ˜¯æƒ³æƒ³ï¼Œæœªæ¥å¼€å‘çš„æ—¶å€™ï¼Œè¿™äº›å•å…ƒè¿˜æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</li></ol><h4 id="dao-å•å…ƒæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#dao-å•å…ƒæµ‹è¯•" aria-hidden="true">#</a> Dao å•å…ƒæµ‹è¯•</h4><p>åœ¨ <code>test/java</code> ç›®å½•ä¸‹ï¼Œåˆ›å»º <code>com.ezfri.springboot.testdemo.dao</code> åŒ…ï¼Œç„¶ååˆ›å»º UserDao å¯¹åº”çš„ UserDaoTest å•å…ƒæµ‹è¯•ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDaoTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> userDao<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token annotation punctuation">@Sql</span><span class="token punctuation">(</span>scripts <span class="token operator">=</span> <span class="token string">&quot;/sql/create_tables.sql&quot;</span><span class="token punctuation">,</span> executionPhase <span class="token operator">=</span> <span class="token class-name">Sql<span class="token punctuation">.</span>ExecutionPhase</span><span class="token punctuation">.</span><span class="token constant">BEFORE_TEST_METHOD</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Sql</span><span class="token punctuation">(</span>statements <span class="token operator">=</span> <span class="token string">&quot;INSERT INTO \`t_user\`(\`id\`, \`username\`, \`password\`) VALUES (1, &#39;username:1&#39;, &#39;password:1&#39;);&quot;</span><span class="token punctuation">,</span> executionPhase <span class="token operator">=</span> <span class="token class-name">Sql<span class="token punctuation">.</span>ExecutionPhase</span><span class="token punctuation">.</span><span class="token constant">BEFORE_TEST_METHOD</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Sql</span><span class="token punctuation">(</span>scripts <span class="token operator">=</span> <span class="token string">&quot;/sql/clean.sql&quot;</span><span class="token punctuation">,</span> executionPhase <span class="token operator">=</span> <span class="token class-name">Sql<span class="token punctuation">.</span>ExecutionPhase</span><span class="token punctuation">.</span><span class="token constant">AFTER_TEST_METHOD</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æŸ¥è¯¢ç”¨æˆ·</span>
        <span class="token class-name">UserDO</span> user <span class="token operator">=</span> userDao<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ ¡éªŒç»“æœ</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;ç¼–å·ä¸åŒ¹é…&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;ç”¨æˆ·åä¸åŒ¹é…&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;username:1&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;å¯†ç ä¸åŒ¹é…&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password:1&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é’ˆå¯¹ Dao çš„æµ‹è¯•ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šä½¿ç”¨ Mockito è¿›è¡Œ mock çš„æ–¹å¼ï¼Œè€Œæ˜¯ä½¿ç”¨å†…å­˜æ•°æ®åº“ï¼Œè¿›è¡Œå¯¹åº”çš„æ•°æ®åº“æ“ä½œã€‚ä¾‹å¦‚è¯´ï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ H2 å†…å­˜æ•°æ®åº“ã€‚</p><p>åœ¨ <code>#testSelectById()</code> æ–¹æ³•ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨ Spring Test æä¾›çš„ <code>@Sql</code> æ³¨è§£ï¼Œå®ç° <code>t_user</code> è¡¨çš„åˆ›å»ºï¼Œä»¥åŠæ’å…¥ä¸€æ¡ id=1 çš„æ•°æ®ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œå¯¹åº”çš„å•å…ƒæµ‹è¯•ã€‚æ¯ä¸€ä¸ª <code>@Sql</code> æ³¨è§£çš„ä½œç”¨å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ä¸€æ¡ï¼Œåœ¨å•å…ƒæµ‹è¯•æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œæ‰§è¡Œ /sql/create_tables.sql è„šæœ¬ï¼Œåˆ›å»º <code>t_user</code> è¡¨ã€‚è„šæœ¬å¦‚ä¸‹ï¼š</li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
   <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;ç”¨æˆ·ç¼–å·&#39;</span><span class="token punctuation">,</span>
   <span class="token identifier"><span class="token punctuation">\`</span>username<span class="token punctuation">\`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;è´¦å·&#39;</span><span class="token punctuation">,</span>
   <span class="token identifier"><span class="token punctuation">\`</span>password<span class="token punctuation">\`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;å¯†ç &#39;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ç¬¬äºŒæ¡ï¼Œåœ¨å•å…ƒæµ‹è¯•æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œæ‰§è¡Œåœ¨ statements å±æ€§å®šä¹‰çš„ SQL æ“ä½œï¼Œæ’å…¥ä¸€æ¡ <code>id=1</code> çš„æ•°æ®ã€‚</li><li>ç¬¬ä¸‰æ¡ï¼Œåœ¨å•å…ƒæµ‹è¯•æ–¹æ³•æ‰§è¡Œä¹‹åï¼Œ<code>/sql/clean.sql</code> è„šæœ¬ï¼Œæ¸…ç©ºæ•°æ®ã€‚æ¯•ç«Ÿï¼Œå¤šä¸ªå•å…ƒæµ‹è¯•æ˜¯å…±äº«ä¸€ä¸ª H2 å†…å­˜æ•°æ®åº“ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œæ¸…ç†ã€‚è„šæœ¬å¦‚ä¸‹ï¼š</li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>t_user<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
   <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;ç”¨æˆ·ç¼–å·&#39;</span><span class="token punctuation">,</span>
   <span class="token identifier"><span class="token punctuation">\`</span>username<span class="token punctuation">\`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;è´¦å·&#39;</span><span class="token punctuation">,</span>
   <span class="token identifier"><span class="token punctuation">\`</span>password<span class="token punctuation">\`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;å¯†ç &#39;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸º Dao å±‚ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šé‡‡ç”¨ JPAã€MyBatis ç­‰ç­‰ ORM æ¡†æ¶ï¼Œæ‰€ä»¥å¯¹å®ƒçš„å•å…ƒæµ‹è¯•ï¼Œå†™çš„ä¹Ÿæ˜¯æ¯”è¾ƒå°‘çš„ã€‚</p><p>[å‚è€ƒå¼•ç”¨]ï¼š</p>`,53),k={href:"https://www.iocoder.cn/Spring-Boot/Unit-Test/",target:"_blank",rel:"noopener noreferrer"},r={href:"https://www.docs4dev.com/docs/zh/spring-boot/2.1.1.RELEASE/reference/boot-features-testing.html",target:"_blank",rel:"noopener noreferrer"};function d(v,m){const s=l("ExternalLinkIcon");return e(),o("div",null,[u,n("ul",null,[n("li",null,[n("a",k,[a("https://www.iocoder.cn/Spring-Boot/Unit-Test/"),t(s)])]),n("li",null,[n("a",r,[a("https://www.docs4dev.com/docs/zh/spring-boot/2.1.1.RELEASE/reference/boot-features-testing.html"),t(s)])])])])}const b=p(i,[["render",d],["__file","unit-test-use.html.vue"]]);export{b as default};
